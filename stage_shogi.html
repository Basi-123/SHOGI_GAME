
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>„Çπ„ÉÜ„Éº„Ç∏Âà∂„Éª„Ç™„É™„Ç∏„Éä„É´Êº¢Â≠óÈßí Â∞ÜÊ£ã</title>
<style>
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', Meiryo, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
  }
  .app {
    width: 100%;
    max-width: 1200px;
    background: #fff;
    border-radius: 16px;
    padding: 24px;
    box-shadow: 0 16px 40px rgba(0,0,0,.25);
  }
  .header { display: flex; align-items: center; justify-content: space-between; gap: 16px; margin-bottom: 16px; }
  .title { font-size: 24px; font-weight: 800; color: #333; }
  .subtitle { color: #555; font-weight: 600; }
  .row { display: flex; gap: 24px; flex-wrap: wrap; align-items: flex-start; }
  .board-wrap { position: relative; }
  .board {
    width: 540px; /* 9 * 60 */
    height: 540px;
    display: grid;
    grid-template-columns: repeat(9, 1fr);
    grid-template-rows: repeat(9, 1fr);
    gap: 2px;
    background: #8b5a2b;
    border: 4px solid #5a3b17;
    border-radius: 8px;
    padding: 6px;
  }
  .cell {
    background: #f1d1a1;
    border: 1px solid #d1a574;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
    position: relative;
    transition: transform .1s ease;
    user-select: none;
  }
  .cell:hover { transform: scale(1.02); }
  .cell.selected { box-shadow: inset 0 0 0 3px #ffd54f; background: #ffe6b3; }
  .cell.valid { outline: 3px solid rgba(76, 175, 80, .6); }
  .cell.blocked { background: #6c757d; color: #fff; cursor: not-allowed; }
  .cell.blocked:hover { background: #5a6268; }

  /* Áü¢Âç∞„Éû„Çπ„ÅÆ„Çπ„Çø„Ç§„É´ */
  .cell.arrow-up { 
    background: linear-gradient(45deg, #e3f2fd, #bbdefb) !important; 
    color: #1976d2 !important; 
    position: relative;
  }
  .cell.arrow-up::before { 
    content: '‚Üë'; 
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-weight: 900;
    font-size: 20px;
    text-shadow: 0 0 3px rgba(25, 118, 210, 0.8);
  }
  
  .cell.arrow-left { 
    background: linear-gradient(45deg, #f3e5f5, #e1bee7) !important; 
    color: #7b1fa2 !important; 
    position: relative;
  }
  .cell.arrow-left::before { 
    content: '‚Üê'; 
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-weight: 900;
    font-size: 20px;
    text-shadow: 0 0 3px rgba(123, 31, 162, 0.8);
  }
  
  .cell.arrow-down { 
    background: linear-gradient(45deg, #e8f5e8, #c8e6c9) !important; 
    color: #388e3c !important; 
    position: relative;
  }
  .cell.arrow-down::before { 
    content: '‚Üì'; 
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-weight: 900;
    font-size: 20px;
    text-shadow: 0 0 3px rgba(56, 142, 60, 0.8);
  }
  
  .cell.arrow-right { 
    background: linear-gradient(45deg, #fff3e0, #ffcc80) !important; 
    color: #f57c00 !important; 
    position: relative;
  }
  .cell.arrow-right::before { 
    content: '‚Üí'; 
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-weight: 900;
    font-size: 20px;
    text-shadow: 0 0 3px rgba(245, 124, 0, 0.8);
  }

  /* Âë™„ÅÑ„Éû„Çπ„ÅÆ„Çπ„Çø„Ç§„É´ */
  .cell.curse-tile { 
    background: linear-gradient(45deg, #1a1a1a, #2d1b69, #4b0082) !important; 
    color: #9370db !important; 
    position: relative;
    box-shadow: 
      inset 0 0 20px rgba(75, 0, 130, 0.8),
      0 0 15px rgba(75, 0, 130, 0.6) !important;
    animation: curseFlicker 3s ease-in-out infinite;
  }
  .cell.curse-tile::before { 
    content: 'Âë™'; 
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-weight: 900;
    font-size: 18px;
    text-shadow: 
      0 0 5px rgba(147, 112, 219, 0.9),
      0 0 10px rgba(75, 0, 130, 0.8),
      0 0 15px rgba(138, 43, 226, 0.7);
    animation: curseGlow 2s ease-in-out infinite alternate;
  }
  
  /* Ë°åÂãï‰∏çËÉΩÁä∂ÊÖã„ÅÆÈßí„ÅÆË¶ñË¶öÁöÑ„Ç®„Éï„Çß„ÇØ„Éà */
  .cell.imprisoned {
    position: relative;
    background: linear-gradient(45deg, #2c3e50, #34495e) !important;
    border: 3px solid #e74c3c !important;
    box-shadow: 
      0 0 10px rgba(231, 76, 60, 0.8),
      inset 0 0 10px rgba(0, 0, 0, 0.5) !important;
    animation: prisonShake 2s ease-in-out infinite !important;
  }
  
  .cell.imprisoned::before {
    content: 'üîí';
    position: absolute;
    top: 2px;
    right: 2px;
    font-size: 12px;
    z-index: 10;
    text-shadow: 0 0 3px rgba(0, 0, 0, 0.8);
  }
  
  .cell.imprisoned::after {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(45deg, #e74c3c, #c0392b, #e74c3c);
    border-radius: 4px;
    z-index: -1;
    animation: prisonGlow 1.5s ease-in-out infinite alternate;
  }
  
  /* Â≥∞„ÅÆ‰øùË≠∑„Ç®„Éï„Çß„ÇØ„Éà */
  .cell.peak-protected {
    position: relative;
    background: linear-gradient(45deg, #2c3e50, #34495e) !important;
    border: 3px solid #f39c12 !important;
    box-shadow: 
      0 0 10px rgba(243, 156, 18, 0.8),
      inset 0 0 10px rgba(0, 0, 0, 0.5) !important;
    animation: peakProtection 2s ease-in-out infinite !important;
  }
  
  .cell.peak-protected::before {
    content: 'üõ°Ô∏è';
    position: absolute;
    top: 2px;
    right: 2px;
    font-size: 12px;
    z-index: 10;
    text-shadow: 0 0 3px rgba(0, 0, 0, 0.8);
  }
  
  .cell.peak-protected::after {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(45deg, #f39c12, #e67e22, #f39c12);
    border-radius: 4px;
    z-index: -1;
    animation: peakGlow 1.5s ease-in-out infinite alternate;
  }
  
  @keyframes peakProtection {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-1px); }
    75% { transform: translateX(1px); }
  }
  
  @keyframes peakGlow {
    0% { opacity: 0.6; }
    100% { opacity: 1; }
  }
  
  /* Â≤©„ÅÆÈò≤Âæ°Âº∑Âåñ„Ç®„Éï„Çß„ÇØ„Éà */
  .cell.rock-protected {
    position: relative;
    background: linear-gradient(45deg, #8B4513, #A0522D) !important;
    border: 3px solid #654321 !important;
    box-shadow: 
      0 0 10px rgba(101, 67, 33, 0.8),
      inset 0 0 10px rgba(0, 0, 0, 0.5) !important;
    animation: rockProtection 2s ease-in-out infinite !important;
  }

  /* Â≤©„ÅÆÈöúÂÆ≥Áâ©„Ç®„Éï„Çß„ÇØ„Éà */
  .cell.rock-barrier {
    position: relative;
    background: linear-gradient(45deg, #8B4513, #A0522D) !important;
    border: 4px solid #654321 !important;
    box-shadow: 
      0 0 15px rgba(101, 67, 33, 0.9),
      inset 0 0 15px rgba(0, 0, 0, 0.6) !important;
    cursor: not-allowed !important;
  }

  .cell.rock-barrier::before {
    content: 'ü™®';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 24px;
    z-index: 10;
    text-shadow: 0 0 8px rgba(0, 0, 0, 0.8);
    filter: grayscale(20%) brightness(0.8);
  }

  .cell.rock-barrier::after {
    content: '';
    position: absolute;
    top: -3px;
    left: -3px;
    right: -3px;
    bottom: -3px;
    background: linear-gradient(45deg, 
      rgba(101, 67, 33, 0.4), 
      rgba(139, 69, 19, 0.3), 
      rgba(160, 82, 45, 0.2),
      rgba(101, 67, 33, 0.4));
    border-radius: 6px;
    z-index: -1;
    animation: rockBarrierGlow 3s ease-in-out infinite;
  }
  
  .cell.rock-protected::before {
    content: 'üõ°Ô∏è';
    position: absolute;
    top: 2px;
    right: 2px;
    font-size: 12px;
    z-index: 10;
    text-shadow: 0 0 3px rgba(0, 0, 0, 0.8);
  }
  
  .cell.rock-protected::after {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(45deg, #654321, #8B4513, #654321);
    border-radius: 4px;
    z-index: -1;
    animation: rockGlow 1.5s ease-in-out infinite alternate;
  }
  
  @keyframes rockProtection {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-1px); }
    75% { transform: translateX(1px); }
  }
  
  @keyframes prisonShake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-1px); }
    75% { transform: translateX(1px); }
  }
  
  @keyframes prisonGlow {
    0% { opacity: 0.6; }
    100% { opacity: 1; }
  }
  
  /* Áâ¢„Å®Êüµ„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà */
  @keyframes prisonMove {
    0% { 
      transform: scale(1);
      box-shadow: 0 0 5px rgba(231, 76, 60, 0.5);
    }
    50% { 
      transform: scale(1.1);
      box-shadow: 0 0 15px rgba(231, 76, 60, 0.8);
    }
    100% { 
      transform: scale(1);
      box-shadow: 0 0 5px rgba(231, 76, 60, 0.5);
    }
  }
  
  @keyframes fenceMove {
    0% { 
      transform: scale(1);
      box-shadow: 0 0 5px rgba(52, 73, 94, 0.5);
    }
    50% { 
      transform: scale(1.1);
      box-shadow: 0 0 15px rgba(52, 73, 94, 0.8);
    }
    100% { 
      transform: scale(1);
      box-shadow: 0 0 5px rgba(52, 73, 94, 0.5);
    }
  }
  
  /* Áâ¢„Å®Êüµ„ÅÆÁâπÊÆä„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes prisonGlow {
    0% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 15px rgba(231, 76, 60, 0.8), 
        inset 0 0 10px rgba(0, 0, 0, 0.4),
        0 0 25px rgba(231, 76, 60, 0.6);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 20px rgba(231, 76, 60, 1), 
        inset 0 0 15px rgba(0, 0, 0, 0.6),
        0 0 35px rgba(231, 76, 60, 0.8);
    }
    100% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 15px rgba(231, 76, 60, 0.8), 
        inset 0 0 10px rgba(0, 0, 0, 0.4),
        0 0 25px rgba(231, 76, 60, 0.6);
    }
  }
  
  @keyframes fenceGlow {
    0% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 15px rgba(52, 152, 219, 0.8), 
        inset 0 0 10px rgba(0, 0, 0, 0.4),
        0 0 25px rgba(52, 152, 219, 0.6);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 20px rgba(52, 152, 219, 1), 
        inset 0 0 15px rgba(0, 0, 0, 0.6),
        0 0 35px rgba(52, 152, 219, 0.8);
    }
    100% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 15px rgba(52, 152, 219, 0.8), 
        inset 0 0 10px rgba(0, 0, 0, 0.4),
        0 0 25px rgba(52, 152, 219, 0.6);
    }
  }
  
  @keyframes prisonIconFloat {
    0% { transform: translateY(0px) rotate(0deg); }
    100% { transform: translateY(-3px) rotate(5deg); }
  }
  
  @keyframes fenceIconFloat {
    0% { transform: translateY(0px) rotate(0deg); }
    100% { transform: translateY(-3px) rotate(-5deg); }
  }
  
  @keyframes prisonRing {
    0% { transform: rotate(0deg); opacity: 0.8; }
    100% { transform: rotate(360deg); opacity: 0.4; }
  }
  
  @keyframes fenceRing {
    0% { transform: rotate(0deg); opacity: 0.8; }
    100% { transform: rotate(-360deg); opacity: 0.4; }
  }
  
  /* Â∂∫„Å®Â≥∞„ÅÆÁâπÊÆä„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes ridgeGlow {
    0% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 15px rgba(101, 67, 33, 0.8), 
        inset 0 0 10px rgba(0, 0, 0, 0.4),
        0 0 25px rgba(101, 67, 33, 0.6);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 20px rgba(101, 67, 33, 1), 
        inset 0 0 15px rgba(0, 0, 0, 0.6),
        0 0 35px rgba(101, 67, 33, 0.8);
    }
    100% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 15px rgba(101, 67, 33, 0.8), 
        inset 0 0 10px rgba(0, 0, 0, 0.4),
        0 0 25px rgba(101, 67, 33, 0.6);
    }
  }
  
  @keyframes peakGlow {
    0% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 20px rgba(232, 244, 253, 0.9), 
        inset 0 0 15px rgba(255, 255, 255, 0.3),
        0 0 30px rgba(232, 244, 253, 0.7);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 25px rgba(232, 244, 253, 1), 
        inset 0 0 20px rgba(255, 255, 255, 0.5),
        0 0 40px rgba(232, 244, 253, 0.9);
    }
    100% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 20px rgba(232, 244, 253, 0.9), 
        inset 0 0 15px rgba(255, 255, 255, 0.3),
        0 0 30px rgba(232, 244, 253, 0.7);
    }
  }
  
  @keyframes ridgeIconFloat {
    0% { transform: translateY(0px) rotate(0deg); }
    100% { transform: translateY(-2px) rotate(3deg); }
  }
  
  @keyframes peakIconFloat {
    0% { transform: translateY(0px) rotate(0deg); }
    100% { transform: translateY(-4px) rotate(-2deg); }
  }
  
  @keyframes ridgeRing {
    0% { transform: rotate(0deg); opacity: 0.8; }
    100% { transform: rotate(360deg); opacity: 0.4; }
  }
  
  @keyframes peakRing {
    0% { transform: rotate(0deg); opacity: 0.9; }
    100% { transform: rotate(-360deg); opacity: 0.3; }
  }
  
  /* Â∂∫„Å®Â±±„ÅÆÁâπÊÆä„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes ridgeMove {
    0% { 
      transform: scale(1);
      box-shadow: 0 0 5px rgba(139, 69, 19, 0.5);
    }
    50% { 
      transform: scale(1.1);
      box-shadow: 0 0 15px rgba(139, 69, 19, 0.8);
    }
    100% { 
      transform: scale(1);
      box-shadow: 0 0 5px rgba(139, 69, 19, 0.5);
    }
  }
  
  @keyframes peakMove {
    0% { 
      transform: scale(1);
      box-shadow: 0 0 5px rgba(44, 62, 80, 0.5);
    }
    50% { 
      transform: scale(1.1);
      box-shadow: 0 0 15px rgba(44, 62, 80, 0.8);
    }
    100% { 
      transform: scale(1);
      box-shadow: 0 0 5px rgba(44, 62, 80, 0.5);
    }
  }
  
  @keyframes mountainGlow {
    0% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 12px rgba(101, 67, 33, 0.7), 
        inset 0 0 8px rgba(0, 0, 0, 0.3),
        0 0 20px rgba(101, 67, 33, 0.5);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 16px rgba(101, 67, 33, 0.9), 
        inset 0 0 12px rgba(0, 0, 0, 0.5),
        0 0 25px rgba(101, 67, 33, 0.7);
    }
    100% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 12px rgba(101, 67, 33, 0.7), 
        inset 0 0 8px rgba(0, 0, 0, 0.3),
        0 0 20px rgba(101, 67, 33, 0.5);
    }
  }
  
  @keyframes mountainIconFloat {
    0% { transform: translateY(0px) rotate(0deg); }
    100% { transform: translateY(-2px) rotate(2deg); }
  }
  
  @keyframes rockGlow {
    0% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 12px rgba(101, 67, 33, 0.7), 
        inset 0 0 8px rgba(0, 0, 0, 0.3),
        0 0 20px rgba(101, 67, 33, 0.5);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 16px rgba(101, 67, 33, 0.9), 
        inset 0 0 12px rgba(0, 0, 0, 0.5),
        0 0 25px rgba(101, 67, 33, 0.7);
    }
    100% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 12px rgba(101, 67, 33, 0.7), 
        inset 0 0 8px rgba(0, 0, 0, 0.3),
        0 0 20px rgba(101, 67, 33, 0.5);
    }
  }
  
  @keyframes rockIconFloat {
    0% { transform: translateY(0px) rotate(0deg); }
    100% { transform: translateY(-3px) rotate(5deg); }
  }
  
  @keyframes rockIconGlow {
    0% { 
      text-shadow: 
        0 0 8px rgba(255, 215, 0, 0.8),
        0 0 16px rgba(255, 165, 0, 0.6),
        0 0 24px rgba(0, 0, 0, 0.8);
    }
    50% { 
      text-shadow: 
        0 0 12px rgba(255, 215, 0, 1),
        0 0 24px rgba(255, 165, 0, 0.8),
        0 0 36px rgba(0, 0, 0, 0.9);
    }
    100% { 
      text-shadow: 
        0 0 8px rgba(255, 215, 0, 0.8),
        0 0 16px rgba(255, 165, 0, 0.6),
        0 0 24px rgba(0, 0, 0, 0.8);
    }
  }
  
  @keyframes rockPulse {
    0% { 
      transform: scale(1);
      box-shadow: 
        0 0 20px rgba(255, 215, 0, 0.8),
        0 0 40px rgba(255, 165, 0, 0.6),
        0 0 60px rgba(101, 67, 33, 0.4),
        inset 0 0 15px rgba(255, 215, 0, 0.3),
        inset 0 0 30px rgba(0, 0, 0, 0.2),
        0 0 80px rgba(255, 215, 0, 0.3);
    }
    50% { 
      transform: scale(1.05);
      box-shadow: 
        0 0 30px rgba(255, 215, 0, 1),
        0 0 60px rgba(255, 165, 0, 0.8),
        0 0 90px rgba(101, 67, 33, 0.6),
        inset 0 0 20px rgba(255, 215, 0, 0.5),
        inset 0 0 40px rgba(0, 0, 0, 0.3),
        0 0 120px rgba(255, 215, 0, 0.5);
    }
    100% { 
      transform: scale(1);
      box-shadow: 
        0 0 20px rgba(255, 215, 0, 0.8),
        0 0 40px rgba(255, 165, 0, 0.6),
        0 0 60px rgba(101, 67, 33, 0.4),
        inset 0 0 15px rgba(255, 215, 0, 0.3),
        inset 0 0 30px rgba(0, 0, 0, 0.2),
        0 0 80px rgba(255, 215, 0, 0.3);
    }
  }
  
  @keyframes rockRing {
    0% { 
      transform: rotate(0deg) scale(1);
      opacity: 0.8;
    }
    50% { 
      transform: rotate(180deg) scale(1.1);
      opacity: 0.4;
    }
    100% { 
      transform: rotate(360deg) scale(1);
      opacity: 0.8;
    }
  }
  
  @keyframes oreGlow {
    0% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 12px rgba(255, 193, 7, 0.7), 
        inset 0 0 8px rgba(0, 0, 0, 0.3),
        0 0 20px rgba(255, 193, 7, 0.5);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 16px rgba(255, 193, 7, 0.9), 
        inset 0 0 12px rgba(0, 0, 0, 0.5),
        0 0 25px rgba(255, 193, 7, 0.7);
    }
    100% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 12px rgba(255, 193, 7, 0.7), 
        inset 0 0 8px rgba(0, 0, 0, 0.3),
        0 0 20px rgba(255, 193, 7, 0.5);
    }
  }
  
  @keyframes oreIconFloat {
    0% { transform: translateY(0px) rotate(0deg); }
    100% { transform: translateY(-2px) rotate(2deg); }
  }

  @keyframes graveGlow {
    0% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 15px rgba(128, 0, 128, 0.8), 
        inset 0 0 10px rgba(0, 0, 0, 0.6),
        0 0 25px rgba(128, 0, 128, 0.6);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 20px rgba(128, 0, 128, 1.0), 
        inset 0 0 15px rgba(0, 0, 0, 0.8),
        0 0 30px rgba(128, 0, 128, 0.8);
    }
    100% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 15px rgba(128, 0, 128, 0.8), 
        inset 0 0 10px rgba(0, 0, 0, 0.6),
        0 0 25px rgba(128, 0, 128, 0.6);
    }
  }
  
  @keyframes graveIconFloat {
    0% { transform: translateY(0px) rotate(0deg); }
    100% { transform: translateY(-3px) rotate(-3deg); }
  }

  @keyframes graveRing {
    0% { transform: rotate(0deg) scale(1); opacity: 0.3; }
    50% { transform: rotate(180deg) scale(1.1); opacity: 0.5; }
    100% { transform: rotate(360deg) scale(1); opacity: 0.3; }
  }

  @keyframes spiritGlow {
    0% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 15px rgba(255, 255, 255, 0.8), 
        inset 0 0 10px rgba(221, 160, 221, 0.4),
        0 0 25px rgba(255, 255, 255, 0.6);
      opacity: 0.9;
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 20px rgba(255, 255, 255, 1.0), 
        inset 0 0 15px rgba(221, 160, 221, 0.6),
        0 0 30px rgba(255, 255, 255, 0.8);
      opacity: 0.7;
    }
    100% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 15px rgba(255, 255, 255, 0.8), 
        inset 0 0 10px rgba(221, 160, 221, 0.4),
        0 0 25px rgba(255, 255, 255, 0.6);
      opacity: 0.9;
    }
  }
  
  @keyframes spiritIconFloat {
    0% { transform: translateY(0px) rotate(0deg); opacity: 1; }
    100% { transform: translateY(-2px) rotate(5deg); opacity: 0.8; }
  }

  @keyframes spiritRing {
    0% { transform: rotate(0deg) scale(1); opacity: 0.4; }
    50% { transform: rotate(-180deg) scale(1.05); opacity: 0.6; }
    100% { transform: rotate(-360deg) scale(1); opacity: 0.4; }
  }

  @keyframes ahMove {
    0% { 
      transform: scale(1);
      box-shadow: 0 0 15px rgba(147, 112, 219, 0.8);
      background: linear-gradient(45deg, #1a1a2e, #16213e);
    }
    50% { 
      transform: scale(1.1);
      box-shadow: 0 0 25px rgba(147, 112, 219, 1.0);
      background: linear-gradient(45deg, #16213e, #0f3460);
    }
    100% { 
      transform: scale(1);
      box-shadow: 0 0 15px rgba(147, 112, 219, 0.8);
      background: linear-gradient(45deg, #1a1a2e, #16213e);
    }
  }

  @keyframes ahLanding {
    0% { 
      transform: scale(1);
      box-shadow: 0 0 10px rgba(147, 112, 219, 0.6);
    }
    50% { 
      transform: scale(1.2);
      box-shadow: 0 0 30px rgba(147, 112, 219, 1.0);
    }
    100% { 
      transform: scale(1);
      box-shadow: 0 0 10px rgba(147, 112, 219, 0.6);
    }
  }

  @keyframes ahTransform {
    0% { 
      transform: scale(1) rotate(0deg);
      box-shadow: 0 0 10px rgba(147, 112, 219, 0.5);
      filter: hue-rotate(0deg);
    }
    25% { 
      transform: scale(1.3) rotate(90deg);
      box-shadow: 0 0 20px rgba(147, 112, 219, 0.8);
      filter: hue-rotate(90deg);
    }
    50% { 
      transform: scale(1.5) rotate(180deg);
      box-shadow: 0 0 30px rgba(147, 112, 219, 1.0);
      filter: hue-rotate(180deg);
    }
    75% { 
      transform: scale(1.2) rotate(270deg);
      box-shadow: 0 0 25px rgba(147, 112, 219, 0.9);
      filter: hue-rotate(270deg);
    }
    100% { 
      transform: scale(1) rotate(360deg);
      box-shadow: 0 0 15px rgba(147, 112, 219, 0.7);
      filter: hue-rotate(360deg);
    }
  }

  @keyframes ahTransformText {
    0% { 
      opacity: 0;
      transform: translateY(0px) scale(0.5);
    }
    25% { 
      opacity: 1;
      transform: translateY(-10px) scale(1.2);
    }
    75% { 
      opacity: 1;
      transform: translateY(-20px) scale(1);
    }
    100% { 
      opacity: 0;
      transform: translateY(-30px) scale(0.8);
    }
  }

  @keyframes curseFlicker {
    0% { 
      box-shadow: 
        inset 0 0 20px rgba(75, 0, 130, 0.8),
        0 0 15px rgba(75, 0, 130, 0.6);
    }
    33% { 
      box-shadow: 
        inset 0 0 25px rgba(138, 43, 226, 1.0),
        0 0 20px rgba(138, 43, 226, 0.8);
    }
    66% { 
      box-shadow: 
        inset 0 0 15px rgba(75, 0, 130, 0.6),
        0 0 10px rgba(75, 0, 130, 0.4);
    }
    100% { 
      box-shadow: 
        inset 0 0 20px rgba(75, 0, 130, 0.8),
        0 0 15px rgba(75, 0, 130, 0.6);
    }
  }

  @keyframes curseGlow {
    0% { 
      text-shadow: 
        0 0 5px rgba(147, 112, 219, 0.9),
        0 0 10px rgba(75, 0, 130, 0.8),
        0 0 15px rgba(138, 43, 226, 0.7);
      transform: translate(-50%, -50%) scale(1);
    }
    100% { 
      text-shadow: 
        0 0 8px rgba(147, 112, 219, 1.0),
        0 0 15px rgba(75, 0, 130, 1.0),
        0 0 20px rgba(138, 43, 226, 0.9);
      transform: translate(-50%, -50%) scale(1.05);
    }
  }
  
  @keyframes mountainSpawn {
    0% { 
      transform: scale(0) rotate(0deg);
      opacity: 0;
    }
    50% { 
      transform: scale(1.2) rotate(180deg);
      opacity: 0.8;
    }
    100% { 
      transform: scale(1) rotate(360deg);
      opacity: 1;
    }
  }

  @keyframes rockMove {
    0% { 
      transform: scale(1);
      box-shadow: 0 0 5px rgba(139, 69, 19, 0.5);
    }
    50% { 
      transform: scale(1.1);
      box-shadow: 0 0 15px rgba(139, 69, 19, 0.8);
    }
    100% { 
      transform: scale(1);
      box-shadow: 0 0 5px rgba(139, 69, 19, 0.5);
    }
  }

  @keyframes rockBarrierAppear {
    0% { 
      opacity: 0;
      transform: scale(0.3) translateY(20px);
      background: linear-gradient(45deg, #8B4513, #A0522D);
    }
    50% { 
      opacity: 0.8;
      transform: scale(1.1) translateY(-5px);
      background: linear-gradient(45deg, #654321, #8B4513);
    }
    100% { 
      opacity: 1;
      transform: scale(1) translateY(0px);
      background: linear-gradient(45deg, #8B4513, #A0522D);
    }
  }

  @keyframes rockBarrierGlow {
    0% { 
      opacity: 0.4;
      transform: scale(1);
    }
    50% { 
      opacity: 0.7;
      transform: scale(1.05);
    }
    100% { 
      opacity: 0.4;
      transform: scale(1);
    }
  }

  @keyframes oreMove {
    0% { 
      transform: scale(1);
      box-shadow: 0 0 5px rgba(255, 193, 7, 0.5);
    }
    50% { 
      transform: scale(1.1);
      box-shadow: 0 0 15px rgba(255, 193, 7, 0.8);
    }
    100% { 
      transform: scale(1);
      box-shadow: 0 0 5px rgba(255, 193, 7, 0.5);
    }
  }

  @keyframes oreMining {
    0% { 
      transform: scale(1) rotate(0deg);
      opacity: 1;
    }
    50% { 
      transform: scale(1.3) rotate(180deg);
      opacity: 0.7;
    }
    100% { 
      transform: scale(0) rotate(360deg);
      opacity: 0;
    }
  }

  @keyframes oreUpgrade {
    0% { 
      transform: scale(1) rotate(0deg);
      box-shadow: 0 0 5px rgba(255, 193, 7, 0.5);
    }
    25% { 
      transform: scale(1.2) rotate(90deg);
      box-shadow: 0 0 15px rgba(255, 193, 7, 0.8);
    }
    50% { 
      transform: scale(1.4) rotate(180deg);
      box-shadow: 0 0 25px rgba(255, 193, 7, 1);
    }
    75% { 
      transform: scale(1.2) rotate(270deg);
      box-shadow: 0 0 15px rgba(255, 193, 7, 0.8);
    }
    100% { 
      transform: scale(1) rotate(360deg);
      box-shadow: 0 0 5px rgba(255, 193, 7, 0.5);
    }
  }

  @keyframes graveMove {
    0% { 
      transform: scale(1);
      box-shadow: 0 0 10px rgba(128, 0, 128, 0.5);
      background: linear-gradient(45deg, #2c2c2c, #4a4a4a);
    }
    50% { 
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(128, 0, 128, 0.8);
      background: linear-gradient(45deg, #4a4a4a, #6a6a6a);
    }
    100% { 
      transform: scale(1);
      box-shadow: 0 0 10px rgba(128, 0, 128, 0.5);
      background: linear-gradient(45deg, #2c2c2c, #4a4a4a);
    }
  }

  @keyframes graveCaptureEffect {
    0% { 
      transform: scale(1) rotate(0deg);
      box-shadow: 0 0 5px rgba(128, 0, 128, 0.3);
    }
    25% { 
      transform: scale(0.8) rotate(-10deg);
      box-shadow: 0 0 15px rgba(128, 0, 128, 0.6);
    }
    50% { 
      transform: scale(0.6) rotate(0deg);
      box-shadow: 0 0 25px rgba(128, 0, 128, 0.9);
    }
    75% { 
      transform: scale(0.4) rotate(10deg);
      box-shadow: 0 0 30px rgba(128, 0, 128, 1);
    }
    100% { 
      transform: scale(0.2) rotate(0deg);
      box-shadow: 0 0 35px rgba(128, 0, 128, 0.8);
      opacity: 0;
    }
  }

  @keyframes spiritMove {
    0% { 
      transform: scale(1);
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      opacity: 1;
    }
    50% { 
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
      opacity: 0.7;
    }
    100% { 
      transform: scale(1);
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      opacity: 1;
    }
  }

  @keyframes spiritPossessionEffect {
    0% { 
      transform: scale(1);
      box-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
      opacity: 1;
    }
    25% { 
      transform: scale(1.1);
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.6);
      opacity: 0.8;
    }
    50% { 
      transform: scale(1.2);
      box-shadow: 0 0 25px rgba(255, 255, 255, 0.9);
      opacity: 0.6;
    }
    75% { 
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.7);
      opacity: 0.4;
    }
    100% { 
      transform: scale(1);
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      opacity: 0.2;
    }
  }

  @keyframes spiritSummon {
    0% { 
      opacity: 0;
      background: linear-gradient(45deg, #9370DB, #8A2BE2);
      transform: scale(0.3) translateY(20px);
      box-shadow: 0 0 20px rgba(147, 112, 219, 0.8);
    }
    50% { 
      opacity: 0.8;
      background: linear-gradient(45deg, #DA70D6, #9370DB);
      transform: scale(1.2) translateY(-10px);
      box-shadow: 0 0 30px rgba(218, 112, 214, 1);
    }
    100% { 
      opacity: 1;
      background: linear-gradient(45deg, #9370DB, #8A2BE2);
      transform: scale(1) translateY(0px);
      box-shadow: 0 0 15px rgba(147, 112, 219, 0.6);
    }
  }

  .piece {
    width: 48px; height: 48px; 
    clip-path: polygon(50% 0%, 100% 20%, 100% 100%, 0% 100%, 0% 20%);
    display: flex; align-items: center; justify-content: center;
    font-weight: 800; font-size: 22px; color: #fff;
    text-shadow: 0 1px 3px rgba(0,0,0,.5);
  }
   .piece.player { background: linear-gradient(45deg, #dc3545, #c82333); border: 2px solid #721c24; box-shadow: 0 0 6px rgba(220,53,69,.45); }
   .piece.computer { background: linear-gradient(45deg, #007bff, #0056b3); border: 2px solid #004085; box-shadow: 0 0 6px rgba(0,123,255,.45); transform: rotate(180deg); }
   
   /* Áâ¢„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
   .piece.prison-piece {
     background: linear-gradient(45deg, #2c3e50, #34495e, #2c3e50) !important;
     background-size: 200% 200% !important;
     border: 3px solid #e74c3c !important;
     box-shadow: 
       0 0 15px rgba(231, 76, 60, 0.8), 
       inset 0 0 10px rgba(0, 0, 0, 0.4),
       0 0 25px rgba(231, 76, 60, 0.6) !important;
     animation: prisonGlow 3s ease-in-out infinite !important;
     position: relative !important;
   }
   
   .piece.prison-piece::before {
     content: 'üîí';
     position: absolute;
     top: -5px;
     right: -5px;
     font-size: 14px;
     z-index: 10;
     text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
     animation: prisonIconFloat 2s ease-in-out infinite alternate;
   }
   
   .piece.prison-piece::after {
     content: '';
     position: absolute;
     top: -3px;
     left: -3px;
     right: -3px;
     bottom: -3px;
     background: linear-gradient(45deg, #e74c3c, #c0392b, #e74c3c);
     border-radius: 50%;
     z-index: -1;
     animation: prisonRing 2.5s linear infinite;
   }
   
   /* Êüµ„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
   .piece.fence-piece {
     background: linear-gradient(45deg, #34495e, #2c3e50, #34495e) !important;
     background-size: 200% 200% !important;
     border: 3px solid #3498db !important;
     box-shadow: 
       0 0 15px rgba(52, 152, 219, 0.8), 
       inset 0 0 10px rgba(0, 0, 0, 0.4),
       0 0 25px rgba(52, 152, 219, 0.6) !important;
     animation: fenceGlow 3s ease-in-out infinite !important;
     position: relative !important;
   }
   
   .piece.fence-piece::before {
     content: 'üöß';
     position: absolute;
     top: -5px;
     right: -5px;
     font-size: 14px;
     z-index: 10;
     text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
     animation: fenceIconFloat 2s ease-in-out infinite alternate;
   }
   
   .piece.fence-piece::after {
     content: '';
     position: absolute;
     top: -3px;
     left: -3px;
     right: -3px;
     bottom: -3px;
     background: linear-gradient(45deg, #3498db, #2980b9, #3498db);
     border-radius: 50%;
     z-index: -1;
     animation: fenceRing 2.5s linear infinite;
   }
   
   /* Â∂∫„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
   .piece.ridge-piece {
     background: linear-gradient(45deg, #8B4513, #A0522D, #8B4513) !important;
     background-size: 200% 200% !important;
     border: 3px solid #654321 !important;
     box-shadow: 
       0 0 15px rgba(101, 67, 33, 0.8), 
       inset 0 0 10px rgba(0, 0, 0, 0.4),
       0 0 25px rgba(101, 67, 33, 0.6) !important;
     animation: ridgeGlow 3s ease-in-out infinite !important;
     position: relative !important;
   }
   
   .piece.ridge-piece::before {
     content: '‚õ∞Ô∏è';
     position: absolute;
     top: -5px;
     right: -5px;
     font-size: 14px;
     z-index: 10;
     text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
     animation: ridgeIconFloat 2s ease-in-out infinite alternate;
   }
   
   .piece.ridge-piece::after {
     content: '';
     position: absolute;
     top: -3px;
     left: -3px;
     right: -3px;
     bottom: -3px;
     background: linear-gradient(45deg, #654321, #8B4513, #654321);
     border-radius: 50%;
     z-index: -1;
     animation: ridgeRing 2.5s linear infinite;
   }
   
   /* Â≥∞„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
   .piece.peak-piece {
     background: linear-gradient(45deg, #2C3E50, #34495E, #2C3E50) !important;
     background-size: 200% 200% !important;
     border: 3px solid #E8F4FD !important;
     box-shadow: 
       0 0 20px rgba(232, 244, 253, 0.9), 
       inset 0 0 15px rgba(255, 255, 255, 0.3),
       0 0 30px rgba(232, 244, 253, 0.7) !important;
     animation: peakGlow 3s ease-in-out infinite !important;
     position: relative !important;
   }
   
   .piece.peak-piece::before {
     content: 'üèîÔ∏è';
     position: absolute;
     top: -5px;
     right: -5px;
     font-size: 14px;
     z-index: 10;
     text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
     animation: peakIconFloat 2s ease-in-out infinite alternate;
   }
   
   .piece.peak-piece::after {
     content: '';
     position: absolute;
     top: -3px;
     left: -3px;
     right: -3px;
     bottom: -3px;
     background: linear-gradient(45deg, #E8F4FD, #B8D4F0, #E8F4FD);
     border-radius: 50%;
     z-index: -1;
     animation: peakRing 2.5s linear infinite;
   }
   
   /* Â±±„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
   .piece.mountain-piece {
     background: linear-gradient(45deg, #8B4513, #A0522D, #8B4513) !important;
     background-size: 200% 200% !important;
     border: 3px solid #654321 !important;
     box-shadow: 
       0 0 12px rgba(101, 67, 33, 0.7), 
       inset 0 0 8px rgba(0, 0, 0, 0.3),
       0 0 20px rgba(101, 67, 33, 0.5) !important;
     animation: mountainGlow 2.5s ease-in-out infinite !important;
     position: relative !important;
   }
   
   .piece.mountain-piece::before {
     content: 'üèîÔ∏è';
     position: absolute;
     top: -5px;
     right: -5px;
     font-size: 12px;
     z-index: 10;
     text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
     animation: mountainIconFloat 1.8s ease-in-out infinite alternate;
  }
  
  /* Â≤©„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.rock-piece {
    background: 
      radial-gradient(circle at 30% 30%, #FFD700, transparent 50%),
      radial-gradient(circle at 70% 70%, #FFA500, transparent 50%),
      linear-gradient(45deg, #8B4513, #A0522D, #8B4513, #654321, #8B4513) !important;
    background-size: 200% 200%, 200% 200%, 300% 300% !important;
    border: 4px solid #FFD700 !important;
    box-shadow: 
      0 0 20px rgba(255, 215, 0, 0.8),
      0 0 40px rgba(255, 165, 0, 0.6),
      0 0 60px rgba(101, 67, 33, 0.4),
      inset 0 0 15px rgba(255, 215, 0, 0.3),
      inset 0 0 30px rgba(0, 0, 0, 0.2),
      0 0 80px rgba(255, 215, 0, 0.3) !important;
    animation: rockGlow 2s ease-in-out infinite, rockPulse 3s ease-in-out infinite !important;
    position: relative !important;
  }
  
  /* „Éó„É¨„Ç§„É§„Éº„ÅÆÂ≤©Èßí */
  .piece.rock-piece.player {
    transform: perspective(1000px) rotateX(5deg) !important;
  }
  
  /* „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÂ≤©Èßí */
  .piece.rock-piece.computer {
    transform: perspective(1000px) rotateX(5deg) rotate(180deg) !important;
  }
  
  .piece.rock-piece::before {
    content: 'üõ°Ô∏è';
    position: absolute;
    top: -8px;
    right: -8px;
    font-size: 16px;
    z-index: 10;
    text-shadow: 
      0 0 8px rgba(255, 215, 0, 0.8),
      0 0 16px rgba(255, 165, 0, 0.6),
      0 0 24px rgba(0, 0, 0, 0.8);
    animation: rockIconFloat 1.5s ease-in-out infinite alternate, rockIconGlow 2s ease-in-out infinite;
  }
  
  .piece.rock-piece::after {
    content: '';
    position: absolute;
    top: -3px;
    left: -3px;
    right: -3px;
    bottom: -3px;
    background: linear-gradient(45deg, 
      rgba(255, 215, 0, 0.3), 
      rgba(255, 165, 0, 0.2), 
      rgba(101, 67, 33, 0.1),
      rgba(255, 215, 0, 0.3));
    border-radius: 8px;
    z-index: -1;
    animation: rockRing 4s linear infinite;
  }
  
  /* Èâ±„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.ore-piece {
    background: linear-gradient(45deg, #FFD700, #FFA500, #FFD700) !important;
    background-size: 200% 200% !important;
    border: 3px solid #FF8C00 !important;
    box-shadow: 
      0 0 12px rgba(255, 193, 7, 0.7), 
      inset 0 0 8px rgba(0, 0, 0, 0.3),
      0 0 20px rgba(255, 193, 7, 0.5) !important;
    animation: oreGlow 2.5s ease-in-out infinite !important;
    position: relative !important;
  }
  
  .piece.ore-piece::before {
    content: '‚õèÔ∏è';
    position: absolute;
    top: -5px;
    right: -5px;
    font-size: 12px;
    z-index: 10;
    text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
    animation: oreIconFloat 1.8s ease-in-out infinite alternate;
  }

  /* Â¢ì„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.grave-piece {
    background: linear-gradient(45deg, #2c2c2c, #4a4a4a, #2c2c2c) !important;
    background-size: 200% 200% !important;
    border: 3px solid #800080 !important;
    box-shadow: 
      0 0 15px rgba(128, 0, 128, 0.8), 
      inset 0 0 10px rgba(0, 0, 0, 0.6),
      0 0 25px rgba(128, 0, 128, 0.6) !important;
    animation: graveGlow 3s ease-in-out infinite !important;
    position: relative !important;
  }
  
  .piece.grave-piece::before {
    content: '‚ö±Ô∏è';
    position: absolute;
    top: -6px;
    right: -6px;
    font-size: 14px;
    z-index: 10;
    text-shadow: 0 0 8px rgba(128, 0, 128, 0.9);
    animation: graveIconFloat 2s ease-in-out infinite alternate;
  }

  .piece.grave-piece::after {
    content: '';
    position: absolute;
    top: -3px;
    left: -3px;
    right: -3px;
    bottom: -3px;
    background: linear-gradient(45deg, 
      rgba(128, 0, 128, 0.3), 
      rgba(75, 0, 130, 0.2), 
      rgba(128, 0, 128, 0.3));
    border-radius: 50%;
    z-index: -1;
    animation: graveRing 4s linear infinite;
  }

  /* Èúä„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.spirit-piece {
    background: linear-gradient(45deg, #f8f8ff, #e6e6fa, #ffffff) !important;
    background-size: 200% 200% !important;
    border: 3px solid #dda0dd !important;
    box-shadow: 
      0 0 15px rgba(255, 255, 255, 0.8), 
      inset 0 0 10px rgba(221, 160, 221, 0.4),
      0 0 25px rgba(255, 255, 255, 0.6) !important;
    animation: spiritGlow 2.5s ease-in-out infinite !important;
    position: relative !important;
    opacity: 0.9 !important;
  }
  
  .piece.spirit-piece::before {
    content: 'üëª';
    position: absolute;
    top: -6px;
    right: -6px;
    font-size: 14px;
    z-index: 10;
    text-shadow: 0 0 8px rgba(255, 255, 255, 0.9);
    animation: spiritIconFloat 1.5s ease-in-out infinite alternate;
  }

  .piece.spirit-piece::after {
    content: '';
    position: absolute;
    top: -3px;
    left: -3px;
    right: -3px;
    bottom: -3px;
    background: linear-gradient(45deg, 
      rgba(255, 255, 255, 0.4), 
      rgba(221, 160, 221, 0.3), 
      rgba(255, 255, 255, 0.4));
    border-radius: 50%;
    z-index: -1;
    animation: spiritRing 3s linear infinite reverse;
  }
   
   /* ÊØí„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
   .piece.poison-piece {
     background: linear-gradient(45deg, #4a0e4e, #8b008b, #ff00ff, #4a0e4e) !important;
     background-size: 200% 200% !important;
     border: 3px solid #8b008b !important;
     box-shadow: 0 0 15px rgba(139, 0, 139, 0.8), inset 0 0 8px rgba(255, 0, 255, 0.3) !important;
     animation: poisonGlow 2s ease-in-out infinite !important;
     position: relative !important;
   }
   
   .piece.poison-piece::before {
     content: '';
     position: absolute;
     top: -2px;
     left: -2px;
     right: -2px;
     bottom: -2px;
     background: linear-gradient(45deg, #ff00ff, #8b008b, #4a0e4e, #8b008b);
     border-radius: 50%;
     z-index: -1;
     animation: poisonRotate 3s linear infinite;
   }
   
   /* Ê≤º„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
   .piece.swamp-piece {
     background: linear-gradient(45deg, #2d5016, #4a7c59, #6b8e23, #2d5016) !important;
     background-size: 200% 200% !important;
     border: 3px solid #4a7c59 !important;
     box-shadow: 0 0 15px rgba(74, 124, 89, 0.8), inset 0 0 8px rgba(107, 142, 35, 0.3) !important;
     animation: swampRipple 2.5s ease-in-out infinite !important;
     position: relative !important;
   }
   
   .piece.swamp-piece::before {
     content: '';
     position: absolute;
     top: -3px;
     left: -3px;
     right: -3px;
     bottom: -3px;
     background: radial-gradient(circle, rgba(107, 142, 35, 0.3) 0%, transparent 70%);
     border-radius: 50%;
     z-index: -1;
     animation: swampBubble 2s ease-in-out infinite;
   }

  /* Èè°„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.mirror-piece {
    background: linear-gradient(45deg, #e8f4f8, #b8e6f0, #87ceeb, #e8f4f8) !important;
    background-size: 200% 200% !important;
    border: 3px solid #87ceeb !important;
    box-shadow: 0 0 15px rgba(135, 206, 235, 0.8), inset 0 0 8px rgba(255, 255, 255, 0.5) !important;
    animation: mirrorShine 2s ease-in-out infinite !important;
    position: relative !important;
  }
  
  .piece.mirror-piece::before {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, transparent 70%);
    border-radius: 50%;
    z-index: -1;
    animation: mirrorGlow 1.5s ease-in-out infinite;
  }

  /* Êò†„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.reflection-piece {
    background: linear-gradient(45deg, #fff8dc, #f0e68c, #daa520, #fff8dc) !important;
    background-size: 200% 200% !important;
    border: 2px solid #daa520 !important;
    box-shadow: 0 0 8px rgba(218, 165, 32, 0.4), inset 0 0 4px rgba(255, 255, 255, 0.3) !important;
    animation: reflectionShine 4s ease-in-out infinite !important;
    position: relative !important;
  }
  
  .piece.reflection-piece::before {
    content: '';
    position: absolute;
    top: -1px;
    left: -1px;
    right: -1px;
    bottom: -1px;
    background: radial-gradient(circle, rgba(218, 165, 32, 0.15) 0%, transparent 60%);
    border-radius: 50%;
    z-index: -1;
    animation: reflectionGlow 3s ease-in-out infinite;
  }

  /* „ÅÇ„ÅÆÈßí„ÅÆÈ≠îÂäõ„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.magic-ah-piece {
    background: linear-gradient(45deg, #2d0a2d, #4b0a4b, #8b008b, #2d0a2d, #4a0a4a, #2d0a2d) !important;
    background-size: 300% 300% !important;
    border: 3px solid #8b008b !important;
    box-shadow: 0 0 20px rgba(139, 0, 139, 0.9), 0 0 40px rgba(75, 0, 75, 0.6), inset 0 0 10px rgba(139, 0, 139, 0.4) !important;
    animation: magicPulse 2s ease-in-out infinite, magicRotate 4s linear infinite !important;
    position: relative !important;
    color: #fff !important;
    text-shadow: 0 0 10px #8b008b, 0 0 20px #8b008b, 0 0 30px #8b008b !important;
  }
  
  .piece.magic-ah-piece::before {
    content: '';
    position: absolute;
    top: -4px;
    left: -4px;
    right: -4px;
    bottom: -4px;
    background: conic-gradient(from 0deg, #8b008b, #4b0a4b, #2d0a2d, #4a0a4a, #8b008b);
    border-radius: 50%;
    z-index: -1;
    animation: magicRing 3s linear infinite;
  }
  
  .piece.magic-ah-piece::after {
    content: '‚ú®';
    position: absolute;
    top: -8px;
    right: -8px;
    font-size: 12px;
    color: #8b008b;
    animation: magicSparkle 1.5s ease-in-out infinite;
    z-index: 1;
  }

  /* Êïµ„ÅÆ„ÅÇ„ÅÆÈßí„ÅÆÈ≠îÂäõ„Ç®„Éï„Çß„ÇØ„ÉàÔºàÂõûËª¢ÂØæÂøúÔºâ */
  .piece.magic-ah-piece.computer {
    background: linear-gradient(45deg, #2d0a2d, #4b0a4b, #8b008b, #2d0a2d, #4a0a4a, #2d0a2d) !important;
    background-size: 300% 300% !important;
    border: 3px solid #8b008b !important;
    box-shadow: 0 0 20px rgba(139, 0, 139, 0.9), 0 0 40px rgba(75, 0, 75, 0.6), inset 0 0 10px rgba(139, 0, 139, 0.4) !important;
    animation: magicPulseComputer 2s ease-in-out infinite, magicRotate 4s linear infinite !important;
    position: relative !important;
    color: #fff !important;
    text-shadow: 0 0 10px #8b008b, 0 0 20px #8b008b, 0 0 30px #8b008b !important;
    transform: rotate(180deg) !important;
  }
  
  .piece.magic-ah-piece.computer::before {
    content: '';
    position: absolute;
    top: -4px;
    left: -4px;
    right: -4px;
    bottom: -4px;
    background: conic-gradient(from 0deg, #8b008b, #4b0a4b, #2d0a2d, #4a0a4a, #8b008b);
    border-radius: 50%;
    z-index: -1;
    animation: magicRing 3s linear infinite;
  }
  
  .piece.magic-ah-piece.computer::after {
    content: '‚ú®';
    position: absolute;
    top: -8px;
    right: -8px;
    font-size: 12px;
    color: #8b008b;
    animation: magicSparkle 1.5s ease-in-out infinite;
    z-index: 1;
  }
  
  /* „Ç™„É™„Ç∏„Éä„É´Èßí„ÅÆÂÖâ„ÇãÂäπÊûú */
  .piece.original {
    animation: glow 2s ease-in-out infinite alternate;
    box-shadow: 0 0 10px #ffd54f, 0 0 20px #ffd54f, 0 0 30px #ffd54f !important;
  }
  
  @keyframes glow {
    from {
      box-shadow: 0 0 10px #ffd54f, 0 0 20px #ffd54f, 0 0 30px #ffd54f;
    }
    to {
      box-shadow: 0 0 15px #ffd54f, 0 0 25px #ffd54f, 0 0 35px #ffd54f;
    }
  }

  /* „ÅÇ„ÅÆÈßí„ÅÆÈ≠îÂäõ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes magicPulse {
    0% {
      box-shadow: 0 0 20px rgba(139, 0, 139, 0.9), 0 0 40px rgba(75, 0, 75, 0.6), inset 0 0 10px rgba(139, 0, 139, 0.4);
      transform: scale(1);
    }
    50% {
      box-shadow: 0 0 30px rgba(139, 0, 139, 1), 0 0 60px rgba(75, 0, 75, 0.8), inset 0 0 15px rgba(139, 0, 139, 0.6);
      transform: scale(1.05);
    }
    100% {
      box-shadow: 0 0 20px rgba(139, 0, 139, 0.9), 0 0 40px rgba(75, 0, 75, 0.6), inset 0 0 10px rgba(139, 0, 139, 0.4);
      transform: scale(1);
    }
  }

  @keyframes magicRotate {
    0% {
      background-position: 0% 50%;
    }
    100% {
      background-position: 100% 50%;
    }
  }

  @keyframes magicRing {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }

  @keyframes magicSparkle {
    0%, 100% {
      opacity: 1;
      transform: scale(1) rotate(0deg);
    }
    50% {
      opacity: 0.7;
      transform: scale(1.2) rotate(180deg);
    }
  }

  /* Êïµ„ÅÆ„ÅÇ„ÅÆÈßí„ÅÆ„Éë„É´„Çπ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÔºàÂõûËª¢ÂØæÂøúÔºâ */
  @keyframes magicPulseComputer {
    0% {
      box-shadow: 0 0 20px rgba(139, 0, 139, 0.9), 0 0 40px rgba(75, 0, 75, 0.6), inset 0 0 10px rgba(139, 0, 139, 0.4);
      transform: rotate(180deg) scale(1);
    }
    50% {
      box-shadow: 0 0 30px rgba(139, 0, 139, 1), 0 0 60px rgba(75, 0, 75, 0.8), inset 0 0 15px rgba(139, 0, 139, 0.6);
      transform: rotate(180deg) scale(1.05);
    }
    100% {
      box-shadow: 0 0 20px rgba(139, 0, 139, 0.9), 0 0 40px rgba(75, 0, 75, 0.6), inset 0 0 10px rgba(139, 0, 139, 0.4);
      transform: rotate(180deg) scale(1);
    }
  }

  /* ÊôÇÈñìÂÅúÊ≠¢„Ç®„Éï„Çß„ÇØ„Éà„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes timeStopEffect {
    0% { filter: hue-rotate(0deg) saturate(1); }
    50% { filter: hue-rotate(180deg) saturate(0.5); }
    100% { filter: hue-rotate(360deg) saturate(1); }
  }

  @keyframes timeStopPulse {
    0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.7; }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
  }

  /* ÊôÇÈñìÂÅúÊ≠¢Áä∂ÊÖã„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.time-stopped {
    filter: grayscale(0.8) hue-rotate(180deg);
    opacity: 0.7;
    animation: timeStopEffect 2s ease-in-out infinite;
  }

  /* ÊôÇ„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  @keyframes timePieceGlow {
    0% { 
      box-shadow: 0 0 5px #00bcd4, 0 0 10px #00bcd4, 0 0 15px #00bcd4;
      text-shadow: 0 0 5px #00bcd4;
    }
    50% { 
      box-shadow: 0 0 10px #00bcd4, 0 0 20px #00bcd4, 0 0 30px #00bcd4;
      text-shadow: 0 0 10px #00bcd4, 0 0 20px #00bcd4;
    }
    100% { 
      box-shadow: 0 0 5px #00bcd4, 0 0 10px #00bcd4, 0 0 15px #00bcd4;
      text-shadow: 0 0 5px #00bcd4;
    }
  }
  
  @keyframes timePieceFloat {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-3px); }
    100% { transform: translateY(0px); }
  }
  
  @keyframes timePieceRotate {
    0% { transform: rotate(0deg); }
    25% { transform: rotate(1deg); }
    75% { transform: rotate(-1deg); }
    100% { transform: rotate(0deg); }
  }
  
  @keyframes timePieceFloatComputer {
    0% { transform: translateY(0px) rotate(180deg); }
    50% { transform: translateY(-3px) rotate(180deg); }
    100% { transform: translateY(0px) rotate(180deg); }
  }
  
  @keyframes timePieceRotateComputer {
    0% { transform: rotate(180deg); }
    25% { transform: rotate(181deg); }
    75% { transform: rotate(179deg); }
    100% { transform: rotate(180deg); }
  }
  
  @keyframes timeParticles {
    0% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0) rotate(0deg);
    }
    50% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1) rotate(180deg);
    }
    100% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0) rotate(360deg);
    }
  }
  
  .piece.time-piece {
    animation: timePieceGlow 3s ease-in-out infinite, 
               timePieceFloat 4s ease-in-out infinite,
               timePieceRotate 6s ease-in-out infinite;
    background: linear-gradient(45deg, #00bcd4, #0097a7, #00bcd4);
    background-size: 200% 200%;
    border-radius: 50%;
    position: relative;
    overflow: hidden;
  }
  
  .piece.time-piece::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(0, 188, 212, 0.3) 0%, transparent 70%);
    transform: translate(-50%, -50%);
    animation: timeParticles 2s ease-in-out infinite;
  }
  
  .piece.time-piece::after {
    content: '‚è∞';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 12px;
    color: #ffffff;
    text-shadow: 0 0 5px #00bcd4;
    animation: timeStopPulse 2s ease-in-out infinite;
    pointer-events: none;
  }
  
  /* ÊôÇ„ÅÆÈßí„ÅÆ„Éõ„Éê„Éº„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.time-piece:hover {
    animation: timePieceGlow 1s ease-in-out infinite, 
               timePieceFloat 2s ease-in-out infinite;
    transform: scale(1.1);
    transition: transform 0.3s ease;
  }
  
  /* ÊôÇ„ÅÆÈßí„ÅÆÈÅ∏ÊäûÊôÇ„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.time-piece.selected {
    animation: timePieceGlow 0.5s ease-in-out infinite, 
               timePieceFloat 1s ease-in-out infinite;
    transform: scale(1.2);
    box-shadow: 0 0 20px #00bcd4, 0 0 40px #00bcd4, 0 0 60px #00bcd4;
  }

  /* ÊôÇ„ÅÆÈßí„ÅÆÊïµÈßíÁî®„Çπ„Çø„Ç§„É´ */
  .piece.time-piece.computer {
    animation: timePieceGlow 3s ease-in-out infinite, 
               timePieceFloatComputer 4s ease-in-out infinite,
               timePieceRotateComputer 6s ease-in-out infinite;
  }

  .piece.time-piece.computer:hover {
    animation: timePieceGlow 1s ease-in-out infinite, 
               timePieceFloatComputer 2s ease-in-out infinite;
    transform: scale(1.1) rotate(180deg);
    transition: transform 0.3s ease;
  }

  .piece.time-piece.computer.selected {
    animation: timePieceGlow 0.5s ease-in-out infinite, 
               timePieceFloatComputer 1s ease-in-out infinite;
    transform: scale(1.2) rotate(180deg);
    box-shadow: 0 0 20px #00bcd4, 0 0 40px #00bcd4, 0 0 60px #00bcd4;
  }

  /* Èõ™„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  @keyframes snowPieceGlow {
    0% { 
      box-shadow: 0 0 5px #ffffff, 0 0 10px #ffffff, 0 0 15px #87ceeb;
      text-shadow: 0 0 5px #ffffff;
    }
    50% { 
      box-shadow: 0 0 10px #ffffff, 0 0 20px #ffffff, 0 0 30px #87ceeb;
      text-shadow: 0 0 10px #ffffff, 0 0 20px #87ceeb;
    }
    100% { 
      box-shadow: 0 0 5px #ffffff, 0 0 10px #ffffff, 0 0 15px #87ceeb;
      text-shadow: 0 0 5px #ffffff;
    }
  }
  
  @keyframes snowPieceFloat {
    0% { transform: translateY(0px) rotate(0deg); }
    25% { transform: translateY(-2px) rotate(1deg); }
    50% { transform: translateY(-4px) rotate(0deg); }
    75% { transform: translateY(-2px) rotate(-1deg); }
    100% { transform: translateY(0px) rotate(0deg); }
  }
  
  @keyframes snowPieceFloatComputer {
    0% { transform: translateY(0px) rotate(180deg); }
    25% { transform: translateY(-2px) rotate(181deg); }
    50% { transform: translateY(-4px) rotate(180deg); }
    75% { transform: translateY(-2px) rotate(179deg); }
    100% { transform: translateY(0px) rotate(180deg); }
  }
  
  @keyframes snowParticles {
    0% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0) rotate(0deg);
    }
    50% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1) rotate(180deg);
    }
    100% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0) rotate(360deg);
    }
  }
  
  @keyframes snowflakeFall {
    0% { 
      opacity: 0; 
      transform: translateY(-10px) rotate(0deg);
    }
    50% { 
      opacity: 1; 
      transform: translateY(0px) rotate(180deg);
    }
    100% { 
      opacity: 0; 
      transform: translateY(10px) rotate(360deg);
    }
  }

  /* Á†Ç„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Ç≠„Éº„Éï„É¨„Éº„É† */
  @keyframes sandPieceGlow {
    0% { 
      box-shadow: 0 0 5px #D2B48C, 0 0 10px #DEB887, 0 0 15px #F4A460;
      text-shadow: 2px 2px 4px #8B4513, -1px -1px 2px #8B4513, 1px -1px 2px #8B4513, -1px 1px 2px #8B4513;
    }
    50% { 
      box-shadow: 0 0 10px #D2B48C, 0 0 20px #DEB887, 0 0 30px #F4A460;
      text-shadow: 3px 3px 6px #8B4513, -2px -2px 4px #8B4513, 2px -2px 4px #8B4513, -2px 2px 4px #8B4513;
    }
    100% { 
      box-shadow: 0 0 5px #D2B48C, 0 0 10px #DEB887, 0 0 15px #F4A460;
      text-shadow: 2px 2px 4px #8B4513, -1px -1px 2px #8B4513, 1px -1px 2px #8B4513, -1px 1px 2px #8B4513;
    }
  }
  
  @keyframes sandPieceFloat {
    0% { transform: translateY(0px) rotate(0deg); }
    25% { transform: translateY(-1px) rotate(0.5deg); }
    50% { transform: translateY(-2px) rotate(0deg); }
    75% { transform: translateY(-1px) rotate(-0.5deg); }
    100% { transform: translateY(0px) rotate(0deg); }
  }
  
  @keyframes sandPieceFloatComputer {
    0% { transform: translateY(0px) rotate(180deg); }
    25% { transform: translateY(-1px) rotate(180.5deg); }
    50% { transform: translateY(-2px) rotate(180deg); }
    75% { transform: translateY(-1px) rotate(179.5deg); }
    100% { transform: translateY(0px) rotate(180deg); }
  }
  
  @keyframes sandParticles {
    0% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0) rotate(0deg);
    }
    50% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1) rotate(180deg);
    }
    100% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0) rotate(360deg);
    }
  }
  
  @keyframes sandstormEffect {
    0% { 
      opacity: 0.7; 
      transform: translate(-50%, -50%) scale(0.8) rotate(0deg);
    }
    50% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1.2) rotate(180deg);
    }
    100% { 
      opacity: 0.7; 
      transform: translate(-50%, -50%) scale(0.8) rotate(360deg);
    }
  }

  /* È¢®„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Ç≠„Éº„Éï„É¨„Éº„É† */
  @keyframes windPieceGlow {
    0% { 
      box-shadow: 0 0 5px #E6E6FA, 0 0 10px #F0F8FF, 0 0 15px #E0FFFF;
      text-shadow: 2px 2px 4px #FFFFFF, -1px -1px 2px #FFFFFF, 1px -1px 2px #FFFFFF, -1px 1px 2px #FFFFFF;
    }
    50% { 
      box-shadow: 0 0 10px #E6E6FA, 0 0 20px #F0F8FF, 0 0 30px #E0FFFF;
      text-shadow: 3px 3px 6px #FFFFFF, -2px -2px 4px #FFFFFF, 2px -2px 4px #FFFFFF, -2px 2px 4px #FFFFFF;
    }
    100% { 
      box-shadow: 0 0 5px #E6E6FA, 0 0 10px #F0F8FF, 0 0 15px #E0FFFF;
      text-shadow: 2px 2px 4px #FFFFFF, -1px -1px 2px #FFFFFF, 1px -1px 2px #FFFFFF, -1px 1px 2px #FFFFFF;
    }
  }
  
  @keyframes windPieceFloat {
    0% { transform: translateY(0px) translateX(0px); }
    25% { transform: translateY(-1px) translateX(1px); }
    50% { transform: translateY(-2px) translateX(0px); }
    75% { transform: translateY(-1px) translateX(-1px); }
    100% { transform: translateY(0px) translateX(0px); }
  }
  
  @keyframes windPieceFloatComputer {
    0% { transform: translateY(0px) translateX(0px) rotate(180deg); }
    25% { transform: translateY(-1px) translateX(1px) rotate(180deg); }
    50% { transform: translateY(-2px) translateX(0px) rotate(180deg); }
    75% { transform: translateY(-1px) translateX(-1px) rotate(180deg); }
    100% { transform: translateY(0px) translateX(0px) rotate(180deg); }
  }
  
  @keyframes windParticles {
    0% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0) rotate(0deg);
    }
    50% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1) rotate(180deg);
    }
    100% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0) rotate(360deg);
    }
  }
  
  @keyframes windFlowEffect {
    0% { 
      opacity: 0.8; 
      transform: translate(-50%, -50%) scale(0.9) rotate(0deg);
    }
    50% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1.1) rotate(180deg);
    }
    100% { 
      opacity: 0.8; 
      transform: translate(-50%, -50%) scale(0.9) rotate(360deg);
    }
  }

  /* Á†Ç„ÅÆÈÄ£ÂãïÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà */
  @keyframes sandChainMoveEffect {
    0% { 
      transform: scale(1) rotate(0deg);
      box-shadow: 0 0 5px #D2B48C;
    }
    50% { 
      transform: scale(1.1) rotate(180deg);
      box-shadow: 0 0 15px #F4A460;
    }
    100% { 
      transform: scale(1) rotate(360deg);
      box-shadow: 0 0 5px #D2B48C;
    }
  }
  
  @keyframes sandChainMovePulse {
    0% { 
      opacity: 0.7; 
      transform: translate(-50%, -50%) scale(0.8);
    }
    50% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1.2);
    }
    100% { 
      opacity: 0.7; 
      transform: translate(-50%, -50%) scale(0.8);
    }
  }
  
  @keyframes sandChainTextFade {
    0% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0.8);
    }
    20% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1.1);
    }
    80% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1.0);
    }
    100% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0.9);
    }
  }

  /* ÂøçËÄÖ„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.ninja-piece {
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 50%, #2c3e50 100%);
    color: #ecf0f1;
    font-weight: bold;
    text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    animation: ninjaPieceGlow 3s ease-in-out infinite, 
               ninjaPieceFloat 4s ease-in-out infinite;
  }
  
  .piece.ninja-piece::before {
    content: 'ü•∑';
    position: absolute;
    top: -5px;
    left: -5px;
    font-size: 12px;
    opacity: 0.8;
    animation: ninjaShuriken 2s ease-in-out infinite;
  }
  
  .piece.ninja-piece::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(52, 73, 94, 0.3) 0%, transparent 70%);
    border-radius: 50%;
    animation: ninjaShadow 3s ease-in-out infinite;
  }
  
  .piece.ninja-piece:hover {
    animation: ninjaPieceGlow 1s ease-in-out infinite, 
               ninjaPieceFloat 2s ease-in-out infinite;
    transform: scale(1.1);
    transition: transform 0.3s ease;
  }
  
  .piece.ninja-piece.selected {
    animation: ninjaPieceGlow 0.5s ease-in-out infinite, 
               ninjaPieceFloat 1s ease-in-out infinite;
    transform: scale(1.2);
    box-shadow: 0 0 20px #34495e, 0 0 40px #34495e, 0 0 60px #34495e;
  }

  /* ÂΩ±„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.shadow-piece {
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 50%, #2c3e50 100%);
    color: #95a5a6;
    font-weight: bold;
    text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    animation: shadowPieceGlow 3s ease-in-out infinite, 
               shadowPieceFloat 4s ease-in-out infinite;
  }
  
  .piece.shadow-piece::before {
    content: 'üë§';
    position: absolute;
    top: -5px;
    left: -5px;
    font-size: 12px;
    opacity: 0.6;
    animation: shadowFade 2s ease-in-out infinite;
  }
  
  .piece.shadow-piece::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(149, 165, 166, 0.4) 0%, transparent 70%);
    border-radius: 50%;
    animation: shadowEffect 3s ease-in-out infinite;
  }
  
  .piece.shadow-piece:hover {
    animation: shadowPieceGlow 1s ease-in-out infinite, 
               shadowPieceFloat 2s ease-in-out infinite;
    transform: scale(1.1);
    transition: transform 0.3s ease;
  }
  
  .piece.shadow-piece.selected {
    animation: shadowPieceGlow 0.5s ease-in-out infinite, 
               shadowPieceFloat 1s ease-in-out infinite;
    transform: scale(1.2);
    box-shadow: 0 0 20px #95a5a6, 0 0 40px #95a5a6, 0 0 60px #95a5a6;
  }

  /* „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÂøçËÄÖ„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.ninja-piece.computer {
    animation: ninjaPieceGlow 3s ease-in-out infinite, 
               ninjaPieceFloatComputer 4s ease-in-out infinite;
  }
  
  .piece.ninja-piece.computer:hover {
    animation: ninjaPieceGlow 1s ease-in-out infinite, 
               ninjaPieceFloatComputer 2s ease-in-out infinite;
    transform: scale(1.1) rotate(180deg);
    transition: transform 0.3s ease;
  }
  
  .piece.ninja-piece.computer.selected {
    animation: ninjaPieceGlow 0.5s ease-in-out infinite, 
               ninjaPieceFloatComputer 1s ease-in-out infinite;
    transform: scale(1.2) rotate(180deg);
    box-shadow: 0 0 20px #34495e, 0 0 40px #34495e, 0 0 60px #34495e;
  }

  /* „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÂΩ±„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.shadow-piece.computer {
    animation: shadowPieceGlow 3s ease-in-out infinite, 
               shadowPieceFloatComputer 4s ease-in-out infinite;
  }
  
  .piece.shadow-piece.computer:hover {
    animation: shadowPieceGlow 1s ease-in-out infinite, 
               shadowPieceFloatComputer 2s ease-in-out infinite;
    transform: scale(1.1) rotate(180deg);
    transition: transform 0.3s ease;
  }
  
  .piece.shadow-piece.computer.selected {
    animation: shadowPieceGlow 0.5s ease-in-out infinite, 
               shadowPieceFloatComputer 1s ease-in-out infinite;
    transform: scale(1.2) rotate(180deg);
    box-shadow: 0 0 20px #95a5a6, 0 0 40px #95a5a6, 0 0 60px #95a5a6;
  }

  /* Á´ú„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.dragon-piece {
    background: linear-gradient(135deg, #8B0000 0%, #DC143C 50%, #8B0000 100%);
    color: #FFD700;
    font-weight: bold;
    text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    animation: dragonPieceGlow 3s ease-in-out infinite, 
               dragonPieceFloat 4s ease-in-out infinite;
  }
  
  .piece.dragon-piece::before {
    content: 'üêâ';
    position: absolute;
    top: -5px;
    left: -5px;
    font-size: 12px;
    opacity: 0.9;
    animation: dragonBreath 2s ease-in-out infinite;
  }
  
  .piece.dragon-piece::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(139, 0, 0, 0.4) 0%, transparent 70%);
    border-radius: 50%;
    animation: dragonAura 3s ease-in-out infinite;
  }
  
  .piece.dragon-piece:hover {
    animation: dragonPieceGlow 1s ease-in-out infinite, 
               dragonPieceFloat 2s ease-in-out infinite;
    transform: scale(1.1);
    transition: transform 0.3s ease;
  }
  
  .piece.dragon-piece.selected {
    animation: dragonPieceGlow 0.5s ease-in-out infinite, 
               dragonPieceFloat 1s ease-in-out infinite;
    transform: scale(1.2);
    box-shadow: 0 0 20px #DC143C, 0 0 40px #DC143C, 0 0 60px #DC143C;
  }

  /* È≥≥„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.phoenix-piece {
    background: linear-gradient(135deg, #FF8C00 0%, #FFD700 50%, #FF8C00 100%);
    color: #FF4500;
    font-weight: bold;
    text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    animation: phoenixPieceGlow 3s ease-in-out infinite, 
               phoenixPieceFloat 4s ease-in-out infinite;
  }
  
  .piece.phoenix-piece::before {
    content: 'ü¶Ö';
    position: absolute;
    top: -5px;
    left: -5px;
    font-size: 12px;
    opacity: 0.9;
    animation: phoenixWings 2s ease-in-out infinite;
  }
  
  .piece.phoenix-piece::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(255, 140, 0, 0.4) 0%, transparent 70%);
    border-radius: 50%;
    animation: phoenixFire 3s ease-in-out infinite;
  }
  
  .piece.phoenix-piece:hover {
    animation: phoenixPieceGlow 1s ease-in-out infinite, 
               phoenixPieceFloat 2s ease-in-out infinite;
    transform: scale(1.1);
    transition: transform 0.3s ease;
  }
  
  .piece.phoenix-piece.selected {
    animation: phoenixPieceGlow 0.5s ease-in-out infinite, 
               phoenixPieceFloat 1s ease-in-out infinite;
    transform: scale(1.2);
    box-shadow: 0 0 20px #FFD700, 0 0 40px #FFD700, 0 0 60px #FFD700;
  }

  /* „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁ´ú„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.dragon-piece.computer {
    animation: dragonPieceGlow 3s ease-in-out infinite, 
               dragonPieceFloatComputer 4s ease-in-out infinite;
  }
  
  .piece.dragon-piece.computer:hover {
    animation: dragonPieceGlow 1s ease-in-out infinite, 
               dragonPieceFloatComputer 2s ease-in-out infinite;
    transform: scale(1.1) rotate(180deg);
    transition: transform 0.3s ease;
  }
  
  .piece.dragon-piece.computer.selected {
    animation: dragonPieceGlow 0.5s ease-in-out infinite, 
               dragonPieceFloatComputer 1s ease-in-out infinite;
    transform: scale(1.2) rotate(180deg);
    box-shadow: 0 0 20px #DC143C, 0 0 40px #DC143C, 0 0 60px #DC143C;
  }

  /* Ëæ∞„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ÔºàË¶öÈÜí„Åó„ÅüÁ´úÔºâ */
  .piece.dragon-awakened-piece {
    background: linear-gradient(135deg, #FFD700 0%, #FFA500 25%, #FF6347 50%, #DC143C 75%, #8B0000 100%);
    color: #FFFFFF;
    font-weight: bold;
    text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    animation: dragonAwakenedGlow 2s ease-in-out infinite, 
               dragonAwakenedFloat 3s ease-in-out infinite,
               dragonAwakenedPulse 1.5s ease-in-out infinite;
    border: 3px solid #FFD700;
    border-radius: 50%;
    transform: scale(1.15);
  }
  
  .piece.dragon-awakened-piece::before {
    content: 'üêâ‚ú®';
    position: absolute;
    top: -8px;
    left: -8px;
    font-size: 16px;
    opacity: 1;
    animation: dragonAwakenedBreath 1.5s ease-in-out infinite;
    text-shadow: 0 0 10px #FFD700, 0 0 20px #FFA500;
  }
  
  .piece.dragon-awakened-piece::after {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    width: calc(100% + 10px);
    height: calc(100% + 10px);
    background: radial-gradient(circle, rgba(255, 215, 0, 0.6) 0%, rgba(255, 165, 0, 0.4) 30%, transparent 70%);
    border-radius: 50%;
    animation: dragonAwakenedAura 2s ease-in-out infinite;
  }
  
  .piece.dragon-awakened-piece:hover {
    animation: dragonAwakenedGlow 1s ease-in-out infinite, 
               dragonAwakenedFloat 1.5s ease-in-out infinite,
               dragonAwakenedPulse 0.8s ease-in-out infinite;
    transform: scale(1.25);
    transition: transform 0.3s ease;
  }
  
  .piece.dragon-awakened-piece.selected {
    animation: dragonAwakenedGlow 0.5s ease-in-out infinite, 
               dragonAwakenedFloat 1s ease-in-out infinite,
               dragonAwakenedPulse 0.5s ease-in-out infinite;
    transform: scale(1.3);
    box-shadow: 0 0 30px #FFD700, 0 0 60px #FFA500, 0 0 90px #FF6347;
  }

  /* „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆËæ∞„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.dragon-awakened-piece.computer {
    animation: dragonAwakenedGlow 2s ease-in-out infinite, 
               dragonAwakenedFloatComputer 3s ease-in-out infinite,
               dragonAwakenedPulse 1.5s ease-in-out infinite;
    transform: rotate(180deg) !important;
  }
  
  .piece.dragon-awakened-piece.computer:hover {
    animation: dragonAwakenedGlow 1s ease-in-out infinite, 
               dragonAwakenedFloatComputer 1.5s ease-in-out infinite,
               dragonAwakenedPulse 0.8s ease-in-out infinite;
    transform: scale(1.25) rotate(180deg) !important;
    transition: transform 0.3s ease;
  }
  
  .piece.dragon-awakened-piece.computer.selected {
    animation: dragonAwakenedGlow 0.5s ease-in-out infinite, 
               dragonAwakenedFloatComputer 1s ease-in-out infinite,
               dragonAwakenedPulse 0.5s ease-in-out infinite;
    transform: scale(1.3) rotate(180deg) !important;
    box-shadow: 0 0 30px #FFD700, 0 0 60px #FFA500, 0 0 90px #FF6347;
  }

  /* „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÈ≥≥„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.phoenix-piece.computer {
    animation: phoenixPieceGlow 3s ease-in-out infinite, 
               phoenixPieceFloatComputer 4s ease-in-out infinite;
  }
  
  .piece.phoenix-piece.computer:hover {
    animation: phoenixPieceGlow 1s ease-in-out infinite, 
               phoenixPieceFloatComputer 2s ease-in-out infinite;
    transform: scale(1.1) rotate(180deg);
    transition: transform 0.3s ease;
  }
  
  .piece.phoenix-piece.computer.selected {
    animation: phoenixPieceGlow 0.5s ease-in-out infinite, 
               phoenixPieceFloatComputer 1s ease-in-out infinite;
    transform: scale(1.2) rotate(180deg);
    box-shadow: 0 0 20px #FFD700, 0 0 40px #FFD700, 0 0 60px #FFD700;
  }

  /* ÂÖâ„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.light-piece {
    background: linear-gradient(135deg, #FFFFFF 0%, #FFFF00 50%, #FFFFFF 100%);
    color: #FF6B35;
    font-weight: bold;
    text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    animation: lightPieceGlow 3s ease-in-out infinite, 
               lightPieceFloat 4s ease-in-out infinite;
  }
  
  .piece.light-piece::before {
    content: '‚ú®';
    position: absolute;
    top: -5px;
    left: -5px;
    font-size: 12px;
    opacity: 0.9;
    animation: lightSparkle 2s ease-in-out infinite;
  }
  
  .piece.light-piece::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, transparent 70%);
    border-radius: 50%;
    animation: lightAura 3s ease-in-out infinite;
  }
  
  .piece.light-piece:hover {
    animation: lightPieceGlow 1s ease-in-out infinite, 
               lightPieceFloat 2s ease-in-out infinite;
    transform: scale(1.1);
    transition: transform 0.3s ease;
  }
  
  .piece.light-piece.selected {
    animation: lightPieceGlow 0.5s ease-in-out infinite, 
               lightPieceFloat 1s ease-in-out infinite;
    transform: scale(1.2);
    box-shadow: 0 0 20px #FFFF00, 0 0 40px #FFFF00, 0 0 60px #FFFF00;
  }

  /* Êòü„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.star-piece {
    background: linear-gradient(135deg, #87CEEB 0%, #FFD700 50%, #87CEEB 100%);
    color: #FF4500;
    font-weight: bold;
    text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    animation: starPieceGlow 3s ease-in-out infinite, 
               starPieceFloat 4s ease-in-out infinite;
  }
  
  .piece.star-piece::before {
    content: '‚≠ê';
    position: absolute;
    top: -5px;
    left: -5px;
    font-size: 12px;
    opacity: 0.9;
    animation: starTwinkle 2s ease-in-out infinite;
  }
  
  .piece.star-piece::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(135, 206, 235, 0.4) 0%, transparent 70%);
    border-radius: 50%;
    animation: starAura 3s ease-in-out infinite;
  }
  
  .piece.star-piece:hover {
    animation: starPieceGlow 1s ease-in-out infinite, 
               starPieceFloat 2s ease-in-out infinite;
    transform: scale(1.1);
    transition: transform 0.3s ease;
  }
  
  .piece.star-piece.selected {
    animation: starPieceGlow 0.5s ease-in-out infinite, 
               starPieceFloat 1s ease-in-out infinite;
    transform: scale(1.2);
    box-shadow: 0 0 20px #FFD700, 0 0 40px #FFD700, 0 0 60px #FFD700;
  }

  /* „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÂÖâ„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.light-piece.computer {
    animation: lightPieceGlow 3s ease-in-out infinite, 
               lightPieceFloatComputer 4s ease-in-out infinite;
  }
  
  .piece.light-piece.computer:hover {
    animation: lightPieceGlow 1s ease-in-out infinite, 
               lightPieceFloatComputer 2s ease-in-out infinite;
    transform: scale(1.1) rotate(180deg);
    transition: transform 0.3s ease;
  }
  
  .piece.light-piece.computer.selected {
    animation: lightPieceGlow 0.5s ease-in-out infinite, 
               lightPieceFloatComputer 1s ease-in-out infinite;
    transform: scale(1.2) rotate(180deg);
    box-shadow: 0 0 20px #FFFF00, 0 0 40px #FFFF00, 0 0 60px #FFFF00;
  }

  /* „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÊòü„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.star-piece.computer {
    animation: starPieceGlow 3s ease-in-out infinite, 
               starPieceFloatComputer 4s ease-in-out infinite;
  }
  
  .piece.star-piece.computer:hover {
    animation: starPieceGlow 1s ease-in-out infinite, 
               starPieceFloatComputer 2s ease-in-out infinite;
    transform: scale(1.1) rotate(180deg);
    transition: transform 0.3s ease;
  }
  
  .piece.star-piece.computer.selected {
    animation: starPieceGlow 0.5s ease-in-out infinite, 
               starPieceFloatComputer 1s ease-in-out infinite;
    transform: scale(1.2) rotate(180deg);
    box-shadow: 0 0 20px #FFD700, 0 0 40px #FFD700, 0 0 60px #FFD700;
  }

  /* È≠ö„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Ç≠„Éº„Éï„É¨„Éº„É† */
  @keyframes fishPieceGlow {
    0% { 
      box-shadow: 0 0 5px #4682B4, 0 0 10px #5F9EA0, 0 0 15px #87CEEB;
      text-shadow: 0 0 5px #F0F8FF;
    }
    50% { 
      box-shadow: 0 0 10px #4682B4, 0 0 20px #5F9EA0, 0 0 30px #87CEEB;
      text-shadow: 0 0 10px #F0F8FF, 0 0 20px #4682B4;
    }
    100% { 
      box-shadow: 0 0 5px #4682B4, 0 0 10px #5F9EA0, 0 0 15px #87CEEB;
      text-shadow: 0 0 5px #F0F8FF;
    }
  }
  
  @keyframes fishPieceFloat {
    0% { transform: translateY(0px) translateX(0px); }
    25% { transform: translateY(-2px) translateX(1px); }
    50% { transform: translateY(-3px) translateX(0px); }
    75% { transform: translateY(-2px) translateX(-1px); }
    100% { transform: translateY(0px) translateX(0px); }
  }
  
  @keyframes fishPieceFloatComputer {
    0% { transform: translateY(0px) translateX(0px) rotate(180deg); }
    25% { transform: translateY(-2px) translateX(1px) rotate(180deg); }
    50% { transform: translateY(-3px) translateX(0px) rotate(180deg); }
    75% { transform: translateY(-2px) translateX(-1px) rotate(180deg); }
    100% { transform: translateY(0px) translateX(0px) rotate(180deg); }
  }
  
  @keyframes fishSwim {
    0% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0) rotate(0deg);
    }
    50% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1) rotate(180deg);
    }
    100% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0) rotate(360deg);
    }
  }
  
  @keyframes fishBubbleEffect {
    0% { 
      opacity: 0.7; 
      transform: translate(-50%, -50%) scale(0.8) rotate(0deg);
    }
    50% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1.2) rotate(180deg);
    }
    100% { 
      opacity: 0.7; 
      transform: translate(-50%, -50%) scale(0.8) rotate(360deg);
    }
  }

  /* Ëãî„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Ç≠„Éº„Éï„É¨„Éº„É† */
  @keyframes mossPieceGlow {
    0% { 
      box-shadow: 0 0 5px #228B22, 0 0 10px #32CD32, 0 0 15px #90EE90;
      text-shadow: 0 0 5px #F0FFF0;
    }
    50% { 
      box-shadow: 0 0 10px #228B22, 0 0 20px #32CD32, 0 0 30px #90EE90;
      text-shadow: 0 0 10px #F0FFF0, 0 0 20px #228B22;
    }
    100% { 
      box-shadow: 0 0 5px #228B22, 0 0 10px #32CD32, 0 0 15px #90EE90;
      text-shadow: 0 0 5px #F0FFF0;
    }
  }
  
  @keyframes mossPieceFloat {
    0% { transform: translateY(0px) scale(1); }
    25% { transform: translateY(-1px) scale(1.02); }
    50% { transform: translateY(-2px) scale(1); }
    75% { transform: translateY(-1px) scale(0.98); }
    100% { transform: translateY(0px) scale(1); }
  }
  
  @keyframes mossPieceFloatComputer {
    0% { transform: translateY(0px) scale(1) rotate(180deg); }
    25% { transform: translateY(-1px) scale(1.02) rotate(180deg); }
    50% { transform: translateY(-2px) scale(1) rotate(180deg); }
    75% { transform: translateY(-1px) scale(0.98) rotate(180deg); }
    100% { transform: translateY(0px) scale(1) rotate(180deg); }
  }
  
  @keyframes mossGrowth {
    0% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0) rotate(0deg);
    }
    50% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1) rotate(180deg);
    }
    100% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0) rotate(360deg);
    }
  }
  
  @keyframes mossSpreadEffect {
    0% { 
      opacity: 0.7; 
      transform: translate(-50%, -50%) scale(0.8) rotate(0deg);
    }
    50% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1.2) rotate(180deg);
    }
    100% { 
      opacity: 0.7; 
      transform: translate(-50%, -50%) scale(0.8) rotate(360deg);
    }
  }

  @keyframes mossSpawn {
    0% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0) rotate(0deg);
      filter: drop-shadow(0 0 0px #32CD32);
    }
    25% { 
      opacity: 0.5; 
      transform: translate(-50%, -50%) scale(0.5) rotate(90deg);
      filter: drop-shadow(0 0 5px #32CD32);
    }
    50% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1.2) rotate(180deg);
      filter: drop-shadow(0 0 15px #32CD32);
    }
    75% { 
      opacity: 0.8; 
      transform: translate(-50%, -50%) scale(1) rotate(270deg);
      filter: drop-shadow(0 0 10px #32CD32);
    }
    100% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1) rotate(360deg);
      filter: drop-shadow(0 0 8px #32CD32);
    }
  }

  /* Èõ≤„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Ç≠„Éº„Éï„É¨„Éº„É† */
  @keyframes cloudPieceGlow {
    0% { 
      box-shadow: 0 0 5px #87CEEB, 0 0 10px #B0E0E6, 0 0 15px #E0F6FF;
      text-shadow: 0 0 5px #4682B4;
    }
    50% { 
      box-shadow: 0 0 10px #87CEEB, 0 0 20px #B0E0E6, 0 0 30px #E0F6FF;
      text-shadow: 0 0 10px #4682B4, 0 0 20px #87CEEB;
    }
    100% { 
      box-shadow: 0 0 5px #87CEEB, 0 0 10px #B0E0E6, 0 0 15px #E0F6FF;
      text-shadow: 0 0 5px #4682B4;
    }
  }
  
  @keyframes cloudPieceFloat {
    0% { transform: translateY(0px) scale(1); }
    25% { transform: translateY(-2px) scale(1.02); }
    50% { transform: translateY(-4px) scale(1); }
    75% { transform: translateY(-2px) scale(0.98); }
    100% { transform: translateY(0px) scale(1); }
  }
  
  @keyframes cloudPieceFloatComputer {
    0% { transform: translateY(0px) scale(1) rotate(180deg); }
    25% { transform: translateY(-2px) scale(1.02) rotate(180deg); }
    50% { transform: translateY(-4px) scale(1) rotate(180deg); }
    75% { transform: translateY(-2px) scale(0.98) rotate(180deg); }
    100% { transform: translateY(0px) scale(1) rotate(180deg); }
  }
  
  @keyframes cloudParticles {
    0% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0) rotate(0deg);
    }
    50% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1) rotate(180deg);
    }
    100% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0) rotate(360deg);
    }
  }
  
  @keyframes cloudDriftEffect {
    0% { 
      opacity: 0.7; 
      transform: translate(-50%, -50%) scale(0.8) rotate(0deg);
    }
    50% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1.2) rotate(180deg);
    }
    100% { 
      opacity: 0.7; 
      transform: translate(-50%, -50%) scale(0.8) rotate(360deg);
    }
  }

  /* Ëôπ„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Ç≠„Éº„Éï„É¨„Éº„É† */
  @keyframes rainbowPieceGlow {
    0% { 
      box-shadow: 0 0 5px #FF69B4, 0 0 10px #FFB6C1, 0 0 15px #FFC0CB;
      text-shadow: 0 0 5px #FF1493;
    }
    16.66% { 
      box-shadow: 0 0 5px #FFA500, 0 0 10px #FFD700, 0 0 15px #FFFF00;
      text-shadow: 0 0 5px #FF8C00;
    }
    33.33% { 
      box-shadow: 0 0 5px #FFFF00, 0 0 10px #ADFF2F, 0 0 15px #32CD32;
      text-shadow: 0 0 5px #9ACD32;
    }
    50% { 
      box-shadow: 0 0 5px #00FFFF, 0 0 10px #87CEEB, 0 0 15px #4169E1;
      text-shadow: 0 0 5px #00BFFF;
    }
    66.66% { 
      box-shadow: 0 0 5px #8A2BE2, 0 0 10px #9370DB, 0 0 15px #9932CC;
      text-shadow: 0 0 5px #9400D3;
    }
    83.33% { 
      box-shadow: 0 0 5px #FF1493, 0 0 10px #FF69B4, 0 0 15px #FFB6C1;
      text-shadow: 0 0 5px #DC143C;
    }
    100% { 
      box-shadow: 0 0 5px #FF69B4, 0 0 10px #FFB6C1, 0 0 15px #FFC0CB;
      text-shadow: 0 0 5px #FF1493;
    }
  }
  
  @keyframes rainbowPieceFloat {
    0% { transform: translateY(0px) scale(1); }
    25% { transform: translateY(-1px) scale(1.01); }
    50% { transform: translateY(-2px) scale(1); }
    75% { transform: translateY(-1px) scale(0.99); }
    100% { transform: translateY(0px) scale(1); }
  }
  
  @keyframes rainbowPieceFloatComputer {
    0% { transform: translateY(0px) scale(1) rotate(180deg); }
    25% { transform: translateY(-1px) scale(1.01) rotate(180deg); }
    50% { transform: translateY(-2px) scale(1) rotate(180deg); }
    75% { transform: translateY(-1px) scale(0.99) rotate(180deg); }
    100% { transform: translateY(0px) scale(1) rotate(180deg); }
  }
  
  @keyframes rainbowParticles {
    0% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0) rotate(0deg);
    }
    50% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1) rotate(180deg);
    }
    100% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0) rotate(360deg);
    }
  }

  /* ËôπËâ≤ÊüìËâ≤„Ç®„Éï„Çß„ÇØ„Éà„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes rainbowPulse {
    0% { 
      transform: translate(-50%, -50%) scale(0.8);
      opacity: 0.8;
    }
    50% { 
      transform: translate(-50%, -50%) scale(1.2);
      opacity: 1;
    }
    100% { 
      transform: translate(-50%, -50%) scale(0.8);
      opacity: 0.8;
    }
  }

  @keyframes rainbowExpand {
    0% { 
      transform: translate(-50%, -50%) scale(0);
      opacity: 1;
    }
    100% { 
      transform: translate(-50%, -50%) scale(1.5);
      opacity: 0;
    }
  }

  @keyframes rainbowShimmer {
    0% { 
      background: linear-gradient(45deg, #ff0000, #ff8000, #ffff00, #00ff00, #0080ff, #8000ff);
      filter: hue-rotate(0deg);
    }
    100% { 
      background: linear-gradient(45deg, #ff0000, #ff8000, #ffff00, #00ff00, #0080ff, #8000ff);
      filter: hue-rotate(360deg);
    }
  }

  @keyframes poisonPulse {
    0% { 
      background-position: 0% 50%;
      box-shadow: 0 0 15px rgba(139, 0, 139, 0.8), inset 0 0 8px rgba(255, 0, 255, 0.3);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 0 0 25px rgba(139, 0, 139, 1.0), inset 0 0 12px rgba(255, 0, 255, 0.5);
    }
    100% { 
      background-position: 0% 50%;
      box-shadow: 0 0 15px rgba(139, 0, 139, 0.8), inset 0 0 8px rgba(255, 0, 255, 0.3);
    }
  }

  @keyframes swampBubble {
    0% { 
      background-position: 0% 50%;
      box-shadow: 0 0 15px rgba(74, 124, 89, 0.8), inset 0 0 8px rgba(107, 142, 35, 0.3);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 0 0 20px rgba(74, 124, 89, 1.0), inset 0 0 10px rgba(107, 142, 35, 0.5);
    }
    100% { 
      background-position: 0% 50%;
      box-shadow: 0 0 15px rgba(74, 124, 89, 0.8), inset 0 0 8px rgba(107, 142, 35, 0.3);
    }
  }

  @keyframes poisonSmoke {
    0% { 
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.5);
    }
    30% { 
      opacity: 1;
      transform: translate(-50%, -50%) scale(1.2);
    }
    70% { 
      opacity: 0.8;
      transform: translate(-50%, -50%) scale(1.5);
    }
    100% { 
      opacity: 0;
      transform: translate(-50%, -50%) scale(2.0);
    }
  }

  @keyframes swampBubbles {
    0% { 
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.3);
    }
    20% { 
      opacity: 1;
      transform: translate(-50%, -50%) scale(0.8);
    }
    50% { 
      opacity: 0.9;
      transform: translate(-50%, -50%) scale(1.2);
    }
    80% { 
      opacity: 0.6;
      transform: translate(-50%, -50%) scale(1.5);
    }
    100% { 
      opacity: 0;
      transform: translate(-50%, -50%) scale(2.0);
    }
  }

  @keyframes mirrorShine {
    0% { 
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.5) rotate(0deg);
    }
    30% { 
      opacity: 1;
      transform: translate(-50%, -50%) scale(1) rotate(90deg);
    }
    70% { 
      opacity: 0.8;
      transform: translate(-50%, -50%) scale(1.3) rotate(180deg);
    }
    100% { 
      opacity: 0;
      transform: translate(-50%, -50%) scale(1.8) rotate(360deg);
    }
  }

  @keyframes reflectionShine {
    0% { 
      background-position: 0% 50%;
      box-shadow: 0 0 8px rgba(218, 165, 32, 0.4), inset 0 0 4px rgba(255, 255, 255, 0.3);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 0 0 12px rgba(218, 165, 32, 0.6), inset 0 0 6px rgba(255, 255, 255, 0.5);
    }
    100% { 
      background-position: 0% 50%;
      box-shadow: 0 0 8px rgba(218, 165, 32, 0.4), inset 0 0 4px rgba(255, 255, 255, 0.3);
    }
  }

  @keyframes mirrorShine {
    0% { 
      background-position: 0% 50%;
      box-shadow: 0 0 15px rgba(135, 206, 235, 0.8), inset 0 0 8px rgba(255, 255, 255, 0.5);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 0 0 25px rgba(135, 206, 235, 1), inset 0 0 12px rgba(255, 255, 255, 0.8);
    }
    100% { 
      background-position: 0% 50%;
      box-shadow: 0 0 15px rgba(135, 206, 235, 0.8), inset 0 0 8px rgba(255, 255, 255, 0.5);
    }
  }

  @keyframes mirrorGlow {
    0% { 
      opacity: 0.3;
      transform: scale(0.8);
    }
    50% { 
      opacity: 0.8;
      transform: scale(1.2);
    }
    100% { 
      opacity: 0.3;
      transform: scale(0.8);
    }
  }

  @keyframes reflectionGlow {
    0% { 
      opacity: 0.1;
      transform: scale(0.95);
    }
    50% { 
      opacity: 0.3;
      transform: scale(1.05);
    }
    100% { 
      opacity: 0.1;
      transform: scale(0.95);
    }
  }

  @keyframes poisonGlow {
    0% { 
      background-position: 0% 50%;
      box-shadow: 0 0 15px rgba(139, 0, 139, 0.8), inset 0 0 8px rgba(255, 0, 255, 0.3);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 0 0 25px rgba(139, 0, 139, 1.0), inset 0 0 12px rgba(255, 0, 255, 0.5);
    }
    100% { 
      background-position: 0% 50%;
      box-shadow: 0 0 15px rgba(139, 0, 139, 0.8), inset 0 0 8px rgba(255, 0, 255, 0.3);
    }
  }

  @keyframes poisonRotate {
    0% { 
      transform: rotate(0deg);
    }
    100% { 
      transform: rotate(360deg);
    }
  }

  @keyframes swampRipple {
    0% { 
      background-position: 0% 50%;
      box-shadow: 0 0 15px rgba(74, 124, 89, 0.8), inset 0 0 8px rgba(107, 142, 35, 0.3);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 0 0 20px rgba(74, 124, 89, 1.0), inset 0 0 10px rgba(107, 142, 35, 0.5);
    }
    100% { 
      background-position: 0% 50%;
      box-shadow: 0 0 15px rgba(74, 124, 89, 0.8), inset 0 0 8px rgba(107, 142, 35, 0.3);
    }
  }

  /* ÊØí„Éû„Çπ„ÅÆ„Çπ„Çø„Ç§„É´ */
  .poison-square {
    background: radial-gradient(circle, rgba(139, 0, 139, 0.4) 0%, rgba(255, 0, 255, 0.2) 50%, transparent 100%) !important;
    box-shadow: inset 0 0 12px rgba(139, 0, 139, 0.7), 0 0 8px rgba(139, 0, 139, 0.5) !important;
    animation: poisonSquarePulse 2s ease-in-out infinite !important;
    position: relative !important;
    z-index: 10 !important;
    border: 2px solid rgba(139, 0, 139, 0.8) !important;
  }
  
  /* ÊØí„Éû„Çπ„ÅÆËøΩÂä†„Ç®„Éï„Çß„ÇØ„Éà */
  .poison-square::before {
    content: '‚ò†';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 16px;
    color: rgba(139, 0, 139, 0.8);
    z-index: 11;
    pointer-events: none;
    animation: poisonIconPulse 1.5s ease-in-out infinite alternate;
  }
  
  @keyframes poisonIconPulse {
    0% { 
      opacity: 0.6;
      transform: translate(-50%, -50%) scale(0.8);
    }
    100% { 
      opacity: 1;
      transform: translate(-50%, -50%) scale(1.2);
    }
  }

  @keyframes poisonSquarePulse {
    0% { 
      background: radial-gradient(circle, rgba(139, 0, 139, 0.8) 0%, rgba(255, 0, 255, 0.4) 50%, rgba(139, 0, 139, 0.2) 100%);
      box-shadow: inset 0 0 20px rgba(139, 0, 139, 1), 0 0 15px rgba(139, 0, 139, 0.8);
      border-color: rgba(139, 0, 139, 1);
    }
    50% { 
      background: radial-gradient(circle, rgba(139, 0, 139, 1) 0%, rgba(255, 0, 255, 0.6) 50%, rgba(139, 0, 139, 0.4) 100%);
      box-shadow: inset 0 0 25px rgba(139, 0, 139, 1), 0 0 20px rgba(139, 0, 139, 1);
      border-color: rgba(255, 0, 255, 1);
    }
    100% { 
      background: radial-gradient(circle, rgba(139, 0, 139, 0.8) 0%, rgba(255, 0, 255, 0.4) 50%, rgba(139, 0, 139, 0.2) 100%);
      box-shadow: inset 0 0 20px rgba(139, 0, 139, 1), 0 0 15px rgba(139, 0, 139, 0.8);
      border-color: rgba(139, 0, 139, 1);
    }
  }

  /* ËôπËâ≤Âà∂ÈôêÁä∂ÊÖã„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.rainbow-limited-piece {
    background: linear-gradient(45deg, #ff0000, #ff8000, #ffff00, #00ff00, #0080ff, #8000ff) !important;
    background-size: 300% 300% !important;
    color: #FFFFFF !important;
    border: 3px solid #FFD700 !important;
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.9), inset 0 0 10px rgba(255, 255, 255, 0.3) !important;
    animation: rainbowShimmer 2s ease-in-out infinite !important;
    opacity: 1.0 !important;
    font-weight: bold !important;
    text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000 !important;
    position: relative !important;
    z-index: 10 !important;
  }

  /* ÊØíÁä∂ÊÖã„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.poisoned-piece {
    background: linear-gradient(45deg, #4a0e4e, #8b008b, #ff00ff, #4a0e4e) !important;
    background-size: 200% 200% !important;
    color: #FFFFFF !important;
    border: 3px solid #8b008b !important;
    box-shadow: 0 0 15px rgba(139, 0, 139, 0.8), inset 0 0 8px rgba(255, 0, 255, 0.3) !important;
    animation: poisonPulse 1.5s ease-in-out infinite !important;
    opacity: 0.9 !important;
    font-weight: bold !important;
    text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000 !important;
    position: relative !important;
    z-index: 10 !important;
  }

  /* Ê≤ºÁä∂ÊÖã„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.swamp-trapped-piece {
    background: linear-gradient(45deg, #2d5016, #4a7c59, #6b8e23, #2d5016) !important;
    background-size: 200% 200% !important;
    color: #FFFFFF !important;
    border: 3px solid #4a7c59 !important;
    box-shadow: 0 0 15px rgba(74, 124, 89, 0.8), inset 0 0 8px rgba(107, 142, 35, 0.3) !important;
    animation: swampBubble 2s ease-in-out infinite !important;
    opacity: 0.9 !important;
    font-weight: bold !important;
    text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000 !important;
    position: relative !important;
    z-index: 10 !important;
  }
  
  @keyframes rainbowSparkleEffect {
    0% { 
      opacity: 0.7; 
      transform: translate(-50%, -50%) scale(0.8) rotate(0deg);
    }
    50% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1.2) rotate(180deg);
    }
    100% { 
      opacity: 0.7; 
      transform: translate(-50%, -50%) scale(0.8) rotate(360deg);
    }
  }

  /* Á†≤„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Ç≠„Éº„Éï„É¨„Éº„É† */
  @keyframes cannonPieceGlow {
    0% { 
      box-shadow: 0 0 5px #8B4513, 0 0 10px #A0522D, 0 0 15px #CD853F;
      text-shadow: 0 0 5px #F5F5DC;
    }
    50% { 
      box-shadow: 0 0 10px #8B4513, 0 0 20px #A0522D, 0 0 30px #CD853F;
      text-shadow: 0 0 10px #F5F5DC, 0 0 20px #8B4513;
    }
    100% { 
      box-shadow: 0 0 5px #8B4513, 0 0 10px #A0522D, 0 0 15px #CD853F;
      text-shadow: 0 0 5px #F5F5DC;
    }
  }
  
  @keyframes cannonPieceFloat {
    0% { transform: translateY(0px) scale(1); }
    25% { transform: translateY(-1px) scale(1.02); }
    50% { transform: translateY(-2px) scale(1); }
    75% { transform: translateY(-1px) scale(0.98); }
    100% { transform: translateY(0px) scale(1); }
  }
  
  @keyframes cannonPieceFloatComputer {
    0% { transform: translateY(0px) scale(1) rotate(180deg); }
    25% { transform: translateY(-1px) scale(1.02) rotate(180deg); }
    50% { transform: translateY(-2px) scale(1) rotate(180deg); }
    75% { transform: translateY(-1px) scale(0.98) rotate(180deg); }
    100% { transform: translateY(0px) scale(1) rotate(180deg); }
  }
  
  @keyframes cannonParticles {
    0% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0) rotate(0deg);
    }
    50% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1) rotate(180deg);
    }
    100% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0) rotate(360deg);
    }
  }
  
  @keyframes cannonExplosionEffect {
    0% { 
      opacity: 0.7; 
      transform: translate(-50%, -50%) scale(0.8) rotate(0deg);
    }
    50% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1.3) rotate(180deg);
    }
    100% { 
      opacity: 0.7; 
      transform: translate(-50%, -50%) scale(0.8) rotate(360deg);
    }
  }
  
  .piece.snow-piece {
    animation: snowPieceGlow 4s ease-in-out infinite, 
               snowPieceFloat 6s ease-in-out infinite;
    background: linear-gradient(45deg, #ffffff, #f0f8ff, #e6f3ff);
    background-size: 200% 200%;
    border-radius: 50%;
    position: relative;
    overflow: hidden;
    color: #4682b4;
    font-weight: bold;
  }
  
  /* „Ç≥„É≥„Éî„É•„Éº„ÇøÂÅ¥„ÅÆÈõ™„ÅÆÈßí„ÅÆÂèçËª¢ */
  .piece.snow-piece.computer {
    animation: snowPieceGlow 4s ease-in-out infinite, 
               snowPieceFloatComputer 6s ease-in-out infinite;
  }
  
  .piece.snow-piece::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, transparent 70%);
    transform: translate(-50%, -50%);
    animation: snowParticles 3s ease-in-out infinite;
  }
  
  .piece.snow-piece::after {
    content: '‚ùÑ';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 14px;
    color: #87ceeb;
    text-shadow: 0 0 5px #ffffff;
    animation: snowflakeFall 2s ease-in-out infinite;
    pointer-events: none;
  }
  
  /* Èõ™„ÅÆÈßí„ÅÆ„Éõ„Éê„Éº„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.snow-piece:hover {
    animation: snowPieceGlow 2s ease-in-out infinite, 
               snowPieceFloat 3s ease-in-out infinite;
    transform: scale(1.1);
    transition: transform 0.3s ease;
  }
  
  .piece.snow-piece.computer:hover {
    animation: snowPieceGlow 2s ease-in-out infinite, 
               snowPieceFloatComputer 3s ease-in-out infinite;
    transform: scale(1.1) rotate(180deg);
    transition: transform 0.3s ease;
  }
  
  /* Èõ™„ÅÆÈßí„ÅÆÈÅ∏ÊäûÊôÇ„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.snow-piece.selected {
    animation: snowPieceGlow 1s ease-in-out infinite, 
               snowPieceFloat 2s ease-in-out infinite;
    transform: scale(1.2);
    box-shadow: 0 0 20px #ffffff, 0 0 40px #87ceeb, 0 0 60px #4682b4;
  }
  
  .piece.snow-piece.computer.selected {
    animation: snowPieceGlow 1s ease-in-out infinite, 
               snowPieceFloatComputer 2s ease-in-out infinite;
    transform: scale(1.2) rotate(180deg);
    box-shadow: 0 0 20px #ffffff, 0 0 40px #87ceeb, 0 0 60px #4682b4;
  }

  /* Á†Ç„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.sand-piece {
    animation: sandPieceGlow 4s ease-in-out infinite, 
               sandPieceFloat 6s ease-in-out infinite;
    background: linear-gradient(45deg, #D2B48C, #DEB887, #F4A460);
    background-size: 200% 200%;
    border-radius: 50%;
    position: relative;
    overflow: hidden;
    color: #FFFFFF;
    font-weight: bold;
    text-shadow: 2px 2px 4px #8B4513, -1px -1px 2px #8B4513, 1px -1px 2px #8B4513, -1px 1px 2px #8B4513;
    font-size: 1.5em;
  }
  
  /* „Ç≥„É≥„Éî„É•„Éº„ÇøÂÅ¥„ÅÆÁ†Ç„ÅÆÈßí„ÅÆÂèçËª¢ */
  .piece.sand-piece.computer {
    animation: sandPieceGlow 4s ease-in-out infinite, 
               sandPieceFloatComputer 6s ease-in-out infinite;
  }
  
  .piece.sand-piece::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(210, 180, 140, 0.4) 0%, transparent 70%);
    transform: translate(-50%, -50%);
    animation: sandParticles 3s ease-in-out infinite;
  }
  
  .piece.sand-piece::after {
    content: 'üèúÔ∏è';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 12px;
    color: #8B4513;
    text-shadow: 0 0 5px #D2B48C;
    animation: sandstormEffect 2s ease-in-out infinite;
    pointer-events: none;
  }
  
  /* Á†Ç„ÅÆÈßí„ÅÆ„Éõ„Éê„Éº„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.sand-piece:hover {
    animation: sandPieceGlow 2s ease-in-out infinite, 
               sandPieceFloat 3s ease-in-out infinite;
    transform: scale(1.1);
    transition: transform 0.3s ease;
    text-shadow: 3px 3px 6px #8B4513, -2px -2px 4px #8B4513, 2px -2px 4px #8B4513, -2px 2px 4px #8B4513;
  }
  
  .piece.sand-piece.computer:hover {
    animation: sandPieceGlow 2s ease-in-out infinite, 
               sandPieceFloatComputer 3s ease-in-out infinite;
    transform: scale(1.1) rotate(180deg);
    transition: transform 0.3s ease;
  }
  
  /* Á†Ç„ÅÆÈßí„ÅÆÈÅ∏ÊäûÊôÇ„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.sand-piece.selected {
    animation: sandPieceGlow 1s ease-in-out infinite, 
               sandPieceFloat 2s ease-in-out infinite;
    transform: scale(1.2);
    box-shadow: 0 0 20px #D2B48C, 0 0 40px #DEB887, 0 0 60px #F4A460;
    text-shadow: 4px 4px 8px #8B4513, -3px -3px 6px #8B4513, 3px -3px 6px #8B4513, -3px 3px 6px #8B4513;
  }
  
  .piece.sand-piece.computer.selected {
    animation: sandPieceGlow 1s ease-in-out infinite, 
               sandPieceFloatComputer 2s ease-in-out infinite;
    transform: scale(1.2) rotate(180deg);
    box-shadow: 0 0 20px #D2B48C, 0 0 40px #DEB887, 0 0 60px #F4A460;
  }

  /* È¢®„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.wind-piece {
    animation: windPieceGlow 4s ease-in-out infinite, 
               windPieceFloat 6s ease-in-out infinite;
    background: linear-gradient(45deg, #E6E6FA, #F0F8FF, #E0FFFF);
    background-size: 200% 200%;
    border-radius: 50%;
    position: relative;
    overflow: hidden;
    color: #000080;
    font-weight: bold;
    text-shadow: 2px 2px 4px #FFFFFF, -1px -1px 2px #FFFFFF, 1px -1px 2px #FFFFFF, -1px 1px 2px #FFFFFF;
    font-size: 1.5em;
  }
  
  /* „Ç≥„É≥„Éî„É•„Éº„ÇøÂÅ¥„ÅÆÈ¢®„ÅÆÈßí„ÅÆÂèçËª¢ */
  .piece.wind-piece.computer {
    animation: windPieceGlow 4s ease-in-out infinite, 
               windPieceFloatComputer 6s ease-in-out infinite;
  }
  
  .piece.wind-piece::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(230, 230, 250, 0.4) 0%, transparent 70%);
    transform: translate(-50%, -50%);
    animation: windParticles 3s ease-in-out infinite;
  }
  
  .piece.wind-piece::after {
    content: 'üí®';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 12px;
    color: #4682B4;
    text-shadow: 0 0 5px #E6E6FA;
    animation: windFlowEffect 2s ease-in-out infinite;
    pointer-events: none;
  }
  
  /* È¢®„ÅÆÈßí„ÅÆ„Éõ„Éê„Éº„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.wind-piece:hover {
    animation: windPieceGlow 2s ease-in-out infinite, 
               windPieceFloat 3s ease-in-out infinite;
    transform: scale(1.1);
    transition: transform 0.3s ease;
    text-shadow: 3px 3px 6px #FFFFFF, -2px -2px 4px #FFFFFF, 2px -2px 4px #FFFFFF, -2px 2px 4px #FFFFFF;
  }
  
  .piece.wind-piece.computer:hover {
    animation: windPieceGlow 2s ease-in-out infinite, 
               windPieceFloatComputer 3s ease-in-out infinite;
    transform: scale(1.1) rotate(180deg);
    transition: transform 0.3s ease;
  }
  
  /* È¢®„ÅÆÈßí„ÅÆÈÅ∏ÊäûÊôÇ„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.wind-piece.selected {
    animation: windPieceGlow 1s ease-in-out infinite, 
               windPieceFloat 2s ease-in-out infinite;
    transform: scale(1.2);
    box-shadow: 0 0 20px #E6E6FA, 0 0 40px #F0F8FF, 0 0 60px #E0FFFF;
    text-shadow: 4px 4px 8px #FFFFFF, -3px -3px 6px #FFFFFF, 3px -3px 6px #FFFFFF, -3px 3px 6px #FFFFFF;
  }
  
  .piece.wind-piece.computer.selected {
    animation: windPieceGlow 1s ease-in-out infinite, 
               windPieceFloatComputer 2s ease-in-out infinite;
    transform: scale(1.2) rotate(180deg);
    box-shadow: 0 0 20px #E6E6FA, 0 0 40px #F0F8FF, 0 0 60px #E0FFFF;
  }

  /* È≠ö„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.fish-piece {
    animation: fishPieceGlow 4s ease-in-out infinite, 
               fishPieceFloat 6s ease-in-out infinite;
    background: linear-gradient(45deg, #4682B4, #5F9EA0, #87CEEB);
    background-size: 200% 200%;
    border-radius: 50%;
    position: relative;
    overflow: hidden;
    color: #F0F8FF;
    font-weight: bold;
    text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    font-size: 1.5em;
  }
  
  /* „Ç≥„É≥„Éî„É•„Éº„ÇøÂÅ¥„ÅÆÈ≠ö„ÅÆÈßí„ÅÆÂèçËª¢ */
  .piece.fish-piece.computer {
    animation: fishPieceGlow 4s ease-in-out infinite, 
               fishPieceFloatComputer 6s ease-in-out infinite;
  }
  
  .piece.fish-piece::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(70, 130, 180, 0.4) 0%, transparent 70%);
    transform: translate(-50%, -50%);
    animation: fishSwim 3s ease-in-out infinite;
  }
  
  .piece.fish-piece::after {
    content: 'üêü';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 12px;
    color: #4682B4;
    text-shadow: 0 0 5px #87CEEB;
    animation: fishBubbleEffect 2s ease-in-out infinite;
    pointer-events: none;
  }
  
  /* È≠ö„ÅÆÈßí„ÅÆ„Éõ„Éê„Éº„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.fish-piece:hover {
    animation: fishPieceGlow 2s ease-in-out infinite, 
               fishPieceFloat 3s ease-in-out infinite;
    transform: scale(1.1);
    transition: transform 0.3s ease;
    text-shadow: 3px 3px 6px #000000, -2px -2px 4px #000000, 2px -2px 4px #000000, -2px 2px 4px #000000;
  }
  
  .piece.fish-piece.computer:hover {
    animation: fishPieceGlow 2s ease-in-out infinite, 
               fishPieceFloatComputer 3s ease-in-out infinite;
    transform: scale(1.1) rotate(180deg);
    transition: transform 0.3s ease;
  }
  
  /* È≠ö„ÅÆÈßí„ÅÆÈÅ∏ÊäûÊôÇ„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.fish-piece.selected {
    animation: fishPieceGlow 1s ease-in-out infinite, 
               fishPieceFloat 2s ease-in-out infinite;
    transform: scale(1.2);
    box-shadow: 0 0 20px #4682B4, 0 0 40px #5F9EA0, 0 0 60px #87CEEB;
    text-shadow: 4px 4px 8px #000000, -3px -3px 6px #000000, 3px -3px 6px #000000, -3px 3px 6px #000000;
  }
  
  .piece.fish-piece.computer.selected {
    animation: fishPieceGlow 1s ease-in-out infinite, 
               fishPieceFloatComputer 2s ease-in-out infinite;
    transform: scale(1.2) rotate(180deg);
    box-shadow: 0 0 20px #4682B4, 0 0 40px #5F9EA0, 0 0 60px #87CEEB;
  }

  /* Ëãî„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.moss-piece {
    animation: mossPieceGlow 4s ease-in-out infinite, 
               mossPieceFloat 6s ease-in-out infinite;
    background: linear-gradient(45deg, #228B22, #32CD32, #90EE90);
    background-size: 200% 200%;
    border-radius: 50%;
    position: relative;
    overflow: hidden;
    color: #F0FFF0;
    font-weight: bold;
    text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    font-size: 1.5em;
  }
  
  /* „Ç≥„É≥„Éî„É•„Éº„ÇøÂÅ¥„ÅÆËãî„ÅÆÈßí„ÅÆÂèçËª¢ */
  .piece.moss-piece.computer {
    animation: mossPieceGlow 4s ease-in-out infinite, 
               mossPieceFloatComputer 6s ease-in-out infinite;
  }
  
  .piece.moss-piece::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(34, 139, 34, 0.4) 0%, transparent 70%);
    transform: translate(-50%, -50%);
    animation: mossGrowth 3s ease-in-out infinite;
  }
  
  .piece.moss-piece::after {
    content: 'üåø';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 12px;
    color: #228B22;
    text-shadow: 0 0 5px #32CD32;
    animation: mossSpreadEffect 2s ease-in-out infinite;
    pointer-events: none;
  }
  
  /* Ëãî„ÅÆÈßí„ÅÆ„Éõ„Éê„Éº„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.moss-piece:hover {
    animation: mossPieceGlow 2s ease-in-out infinite, 
               mossPieceFloat 3s ease-in-out infinite;
    transform: scale(1.1);
    transition: transform 0.3s ease;
    text-shadow: 3px 3px 6px #000000, -2px -2px 4px #000000, 2px -2px 4px #000000, -2px 2px 4px #000000;
  }
  
  .piece.moss-piece.computer:hover {
    animation: mossPieceGlow 2s ease-in-out infinite, 
               mossPieceFloatComputer 3s ease-in-out infinite;
    transform: scale(1.1) rotate(180deg);
    transition: transform 0.3s ease;
  }
  
  /* Ëãî„ÅÆÈßí„ÅÆÈÅ∏ÊäûÊôÇ„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.moss-piece.selected {
    animation: mossPieceGlow 1s ease-in-out infinite, 
               mossPieceFloat 2s ease-in-out infinite;
    transform: scale(1.2);
    box-shadow: 0 0 20px #228B22, 0 0 40px #32CD32, 0 0 60px #90EE90;
    text-shadow: 4px 4px 8px #000000, -3px -3px 6px #000000, 3px -3px 6px #000000, -3px 3px 6px #000000;
  }
  
  .piece.moss-piece.computer.selected {
    animation: mossPieceGlow 1s ease-in-out infinite, 
               mossPieceFloatComputer 2s ease-in-out infinite;
    transform: scale(1.2) rotate(180deg);
    box-shadow: 0 0 20px #228B22, 0 0 40px #32CD32, 0 0 60px #90EE90;
  }

  /* Èõ≤„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.cloud-piece {
    animation: cloudPieceGlow 4s ease-in-out infinite, 
               cloudPieceFloat 6s ease-in-out infinite;
    background: linear-gradient(45deg, #87CEEB, #B0E0E6, #E0F6FF);
    background-size: 200% 200%;
    border-radius: 50%;
    position: relative;
    overflow: hidden;
    color: #4682B4;
    font-weight: bold;
    text-shadow: 2px 2px 4px #FFFFFF, -1px -1px 2px #FFFFFF, 1px -1px 2px #FFFFFF, -1px 1px 2px #FFFFFF;
    font-size: 1.5em;
  }
  
  /* „Ç≥„É≥„Éî„É•„Éº„ÇøÂÅ¥„ÅÆÈõ≤„ÅÆÈßí„ÅÆÂèçËª¢ */
  .piece.cloud-piece.computer {
    animation: cloudPieceGlow 4s ease-in-out infinite, 
               cloudPieceFloatComputer 6s ease-in-out infinite;
  }
  
  .piece.cloud-piece::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(135, 206, 235, 0.4) 0%, transparent 70%);
    transform: translate(-50%, -50%);
    animation: cloudParticles 3s ease-in-out infinite;
  }
  
  .piece.cloud-piece::after {
    content: '‚òÅ';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 14px;
    color: #87CEEB;
    text-shadow: 0 0 5px #FFFFFF;
    animation: cloudDriftEffect 2s ease-in-out infinite;
    pointer-events: none;
  }
  
  /* Èõ≤„ÅÆÈßí„ÅÆ„Éõ„Éê„Éº„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.cloud-piece:hover {
    animation: cloudPieceGlow 2s ease-in-out infinite, 
               cloudPieceFloat 3s ease-in-out infinite;
    transform: scale(1.1);
    transition: transform 0.3s ease;
  }
  
  .piece.cloud-piece.computer:hover {
    animation: cloudPieceGlow 2s ease-in-out infinite, 
               cloudPieceFloatComputer 3s ease-in-out infinite;
    transform: scale(1.1) rotate(180deg);
    transition: transform 0.3s ease;
  }
  
  /* Èõ≤„ÅÆÈßí„ÅÆÈÅ∏ÊäûÊôÇ„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.cloud-piece.selected {
    animation: cloudPieceGlow 1s ease-in-out infinite, 
               cloudPieceFloat 2s ease-in-out infinite;
    transform: scale(1.2);
    box-shadow: 0 0 20px #87CEEB, 0 0 40px #B0E0E6, 0 0 60px #E0F6FF;
  }
  
  .piece.cloud-piece.computer.selected {
    animation: cloudPieceGlow 1s ease-in-out infinite, 
               cloudPieceFloatComputer 2s ease-in-out infinite;
    transform: scale(1.2) rotate(180deg);
    box-shadow: 0 0 20px #87CEEB, 0 0 40px #B0E0E6, 0 0 60px #E0F6FF;
  }

  /* Ëôπ„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.rainbow-piece {
    animation: rainbowPieceGlow 6s ease-in-out infinite, 
               rainbowPieceFloat 4s ease-in-out infinite;
    background: linear-gradient(45deg, #FF69B4, #FFA500, #FFFF00, #00FFFF, #8A2BE2, #FF1493);
    background-size: 300% 300%;
    border-radius: 50%;
    position: relative;
    overflow: hidden;
    color: #FFFFFF;
    font-weight: bold;
    text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    font-size: 1.5em;
  }
  
  /* „Ç≥„É≥„Éî„É•„Éº„ÇøÂÅ¥„ÅÆËôπ„ÅÆÈßí„ÅÆÂèçËª¢ */
  .piece.rainbow-piece.computer {
    animation: rainbowPieceGlow 6s ease-in-out infinite, 
               rainbowPieceFloatComputer 4s ease-in-out infinite;
  }
  
  .piece.rainbow-piece::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(255, 105, 180, 0.4) 0%, transparent 70%);
    transform: translate(-50%, -50%);
    animation: rainbowParticles 3s ease-in-out infinite;
  }
  
  .piece.rainbow-piece::after {
    content: 'üåà';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 12px;
    color: #FF1493;
    text-shadow: 0 0 5px #FFFFFF;
    animation: rainbowSparkleEffect 2s ease-in-out infinite;
    pointer-events: none;
  }
  
  /* Ëôπ„ÅÆÈßí„ÅÆ„Éõ„Éê„Éº„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.rainbow-piece:hover {
    animation: rainbowPieceGlow 3s ease-in-out infinite, 
               rainbowPieceFloat 2s ease-in-out infinite;
    transform: scale(1.1);
    transition: transform 0.3s ease;
  }
  
  .piece.rainbow-piece.computer:hover {
    animation: rainbowPieceGlow 3s ease-in-out infinite, 
               rainbowPieceFloatComputer 2s ease-in-out infinite;
    transform: scale(1.1) rotate(180deg);
    transition: transform 0.3s ease;
  }
  
  /* Ëôπ„ÅÆÈßí„ÅÆÈÅ∏ÊäûÊôÇ„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.rainbow-piece.selected {
    animation: rainbowPieceGlow 1.5s ease-in-out infinite, 
               rainbowPieceFloat 1s ease-in-out infinite;
    transform: scale(1.2);
    box-shadow: 0 0 20px #FF69B4, 0 0 40px #FFA500, 0 0 60px #FFFF00;
  }
  
  .piece.rainbow-piece.computer.selected {
    animation: rainbowPieceGlow 1.5s ease-in-out infinite, 
               rainbowPieceFloatComputer 1s ease-in-out infinite;
    transform: scale(1.2) rotate(180deg);
    box-shadow: 0 0 20px #FF69B4, 0 0 40px #FFA500, 0 0 60px #FFFF00;
  }

  /* Á†≤„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.cannon-piece {
    animation: cannonPieceGlow 4s ease-in-out infinite, 
               cannonPieceFloat 6s ease-in-out infinite;
    background: linear-gradient(45deg, #8B4513, #A0522D, #CD853F);
    background-size: 200% 200%;
    border-radius: 50%;
    position: relative;
    overflow: hidden;
    color: #F5F5DC;
    font-weight: bold;
  }
  
  /* „Ç≥„É≥„Éî„É•„Éº„ÇøÂÅ¥„ÅÆÁ†≤„ÅÆÈßí„ÅÆÂèçËª¢ */
  .piece.cannon-piece.computer {
    animation: cannonPieceGlow 4s ease-in-out infinite, 
               cannonPieceFloatComputer 6s ease-in-out infinite;
  }
  
  .piece.cannon-piece::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(139, 69, 19, 0.4) 0%, transparent 70%);
    transform: translate(-50%, -50%);
    animation: cannonParticles 3s ease-in-out infinite;
  }
  
  .piece.cannon-piece::after {
    content: 'üí•';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 12px;
    color: #FF4500;
    text-shadow: 0 0 5px #8B4513;
    animation: cannonExplosionEffect 2s ease-in-out infinite;
    pointer-events: none;
  }
  
  /* Á†≤„ÅÆÈßí„ÅÆ„Éõ„Éê„Éº„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.cannon-piece:hover {
    animation: cannonPieceGlow 2s ease-in-out infinite, 
               cannonPieceFloat 3s ease-in-out infinite;
    transform: scale(1.1);
    transition: transform 0.3s ease;
  }
  
  .piece.cannon-piece.computer:hover {
    animation: cannonPieceGlow 2s ease-in-out infinite, 
               cannonPieceFloatComputer 3s ease-in-out infinite;
    transform: scale(1.1) rotate(180deg);
    transition: transform 0.3s ease;
  }
  
  /* Á†≤„ÅÆÈßí„ÅÆÈÅ∏ÊäûÊôÇ„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.cannon-piece.selected {
    animation: cannonPieceGlow 1s ease-in-out infinite, 
               cannonPieceFloat 2s ease-in-out infinite;
    transform: scale(1.2);
    box-shadow: 0 0 20px #8B4513, 0 0 40px #A0522D, 0 0 60px #CD853F;
  }
  
  .piece.cannon-piece.computer.selected {
    animation: cannonPieceGlow 1s ease-in-out infinite, 
               cannonPieceFloatComputer 2s ease-in-out infinite;
    transform: scale(1.2) rotate(180deg);
    box-shadow: 0 0 20px #8B4513, 0 0 40px #A0522D, 0 0 60px #CD853F;
  }

  /* ÂàÄ„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.sword-piece {
    background: linear-gradient(135deg, #C0C0C0 0%, #FFD700 25%, #FFA500 50%, #FF6347 75%, #DC143C 100%);
    color: #FFFFFF;
    font-weight: bold;
    text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    animation: swordPieceGlow 2s ease-in-out infinite, 
               swordPieceFloat 3s ease-in-out infinite;
    border: 2px solid #FFD700;
    border-radius: 50%;
    position: relative;
    overflow: hidden;
  }
  
  .piece.sword-piece::before {
    content: '‚öîÔ∏è';
    position: absolute;
    top: -8px;
    left: -8px;
    font-size: 16px;
    opacity: 1;
    animation: swordSparkle 1.5s ease-in-out infinite;
    text-shadow: 0 0 10px #FFD700, 0 0 20px #FFA500;
  }
  
  .piece.sword-piece::after {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    width: calc(100% + 10px);
    height: calc(100% + 10px);
    background: radial-gradient(circle, rgba(255, 215, 0, 0.6) 0%, rgba(255, 165, 0, 0.4) 30%, transparent 70%);
    border-radius: 50%;
    animation: swordAura 2s ease-in-out infinite;
  }
  
  .piece.sword-piece:hover {
    animation: swordPieceGlow 1s ease-in-out infinite, 
               swordPieceFloat 1.5s ease-in-out infinite;
    transform: scale(1.1);
    transition: transform 0.3s ease;
  }
  
  .piece.sword-piece.selected {
    animation: swordPieceGlow 0.5s ease-in-out infinite, 
               swordPieceFloat 1s ease-in-out infinite;
    transform: scale(1.2);
    box-shadow: 0 0 20px #FFD700, 0 0 40px #FFA500, 0 0 60px #FF6347;
  }

  /* „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÂàÄ„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.sword-piece.computer {
    animation: swordPieceGlow 2s ease-in-out infinite, 
               swordPieceFloatComputer 3s ease-in-out infinite;
  }
  
  .piece.sword-piece.computer:hover {
    animation: swordPieceGlow 1s ease-in-out infinite, 
               swordPieceFloatComputer 1.5s ease-in-out infinite;
    transform: scale(1.1) rotate(180deg);
    transition: transform 0.3s ease;
  }
  
  .piece.sword-piece.computer.selected {
    animation: swordPieceGlow 0.5s ease-in-out infinite, 
               swordPieceFloatComputer 1s ease-in-out infinite;
    transform: scale(1.2) rotate(180deg);
    box-shadow: 0 0 20px #FFD700, 0 0 40px #FFA500, 0 0 60px #FF6347;
  }

  /* Èéß„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.armor-piece {
    background: linear-gradient(135deg, #708090 0%, #2F4F4F 25%, #000080 50%, #191970 75%, #000000 100%);
    color: #FFFFFF;
    font-weight: bold;
    text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    animation: armorPieceGlow 3s ease-in-out infinite, 
               armorPieceFloat 4s ease-in-out infinite;
    border: 2px solid #708090;
    border-radius: 50%;
    position: relative;
    overflow: hidden;
  }
  
  .piece.armor-piece::before {
    content: 'üõ°Ô∏è';
    position: absolute;
    top: -8px;
    left: -8px;
    font-size: 16px;
    opacity: 1;
    animation: armorShield 2s ease-in-out infinite;
    text-shadow: 0 0 10px #708090, 0 0 20px #2F4F4F;
  }
  
  .piece.armor-piece::after {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    width: calc(100% + 10px);
    height: calc(100% + 10px);
    background: radial-gradient(circle, rgba(112, 128, 144, 0.6) 0%, rgba(47, 79, 79, 0.4) 30%, transparent 70%);
    border-radius: 50%;
    animation: armorAura 3s ease-in-out infinite;
  }
  
  .piece.armor-piece:hover {
    animation: armorPieceGlow 1.5s ease-in-out infinite, 
               armorPieceFloat 2s ease-in-out infinite;
    transform: scale(1.1);
    transition: transform 0.3s ease;
  }
  
  .piece.armor-piece.selected {
    animation: armorPieceGlow 0.8s ease-in-out infinite, 
               armorPieceFloat 1.5s ease-in-out infinite;
    transform: scale(1.2);
    box-shadow: 0 0 20px #708090, 0 0 40px #2F4F4F, 0 0 60px #000080;
  }

  /* „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÈéß„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.armor-piece.computer {
    animation: armorPieceGlow 3s ease-in-out infinite, 
               armorPieceFloatComputer 4s ease-in-out infinite;
  }
  
  .piece.armor-piece.computer:hover {
    animation: armorPieceGlow 1.5s ease-in-out infinite, 
               armorPieceFloatComputer 2s ease-in-out infinite;
    transform: scale(1.1) rotate(180deg);
    transition: transform 0.3s ease;
  }
  
  .piece.armor-piece.computer.selected {
    animation: armorPieceGlow 0.8s ease-in-out infinite, 
               armorPieceFloatComputer 1.5s ease-in-out infinite;
    transform: scale(1.2) rotate(180deg);
    box-shadow: 0 0 20px #708090, 0 0 40px #2F4F4F, 0 0 60px #000080;
  }

  /* ÈäÉ„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.gun-piece {
    background: linear-gradient(135deg, #2F2F2F 0%, #696969 25%, #A9A9A9 50%, #D3D3D3 75%, #FFFFFF 100%);
    color: #000000;
    font-weight: bold;
    text-shadow: 1px 1px 2px #FFFFFF, -1px -1px 2px #FFFFFF, 1px -1px 2px #FFFFFF, -1px 1px 2px #FFFFFF;
    animation: gunPieceGlow 2.5s ease-in-out infinite, 
               gunPieceFloat 3.5s ease-in-out infinite;
    border: 2px solid #696969;
    border-radius: 50%;
    position: relative;
    overflow: hidden;
  }
  
  .piece.gun-piece::before {
    content: 'üî´';
    position: absolute;
    top: -8px;
    left: -8px;
    font-size: 16px;
    opacity: 1;
    animation: gunFire 1.8s ease-in-out infinite;
    text-shadow: 0 0 10px #FF4500, 0 0 20px #FF6347;
  }
  
  .piece.gun-piece::after {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    width: calc(100% + 10px);
    height: calc(100% + 10px);
    background: radial-gradient(circle, rgba(105, 105, 105, 0.6) 0%, rgba(169, 169, 169, 0.4) 30%, transparent 70%);
    border-radius: 50%;
    animation: gunAura 2.5s ease-in-out infinite;
  }
  
  .piece.gun-piece:hover {
    animation: gunPieceGlow 1.2s ease-in-out infinite, 
               gunPieceFloat 2s ease-in-out infinite;
    transform: scale(1.1);
    transition: transform 0.3s ease;
  }
  
  .piece.gun-piece.selected {
    animation: gunPieceGlow 0.6s ease-in-out infinite, 
               gunPieceFloat 1.2s ease-in-out infinite;
    transform: scale(1.2);
    box-shadow: 0 0 20px #696969, 0 0 40px #A9A9A9, 0 0 60px #D3D3D3;
  }

  /* „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÈäÉ„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.gun-piece.computer {
    animation: gunPieceGlow 2.5s ease-in-out infinite, 
               gunPieceFloatComputer 3.5s ease-in-out infinite;
  }
  
  .piece.gun-piece.computer:hover {
    animation: gunPieceGlow 1.2s ease-in-out infinite, 
               gunPieceFloatComputer 2s ease-in-out infinite;
    transform: scale(1.1) rotate(180deg);
    transition: transform 0.3s ease;
  }
  
  .piece.gun-piece.computer.selected {
    animation: gunPieceGlow 0.6s ease-in-out infinite, 
               gunPieceFloatComputer 1.2s ease-in-out infinite;
    transform: scale(1.2) rotate(180deg);
    box-shadow: 0 0 20px #696969, 0 0 40px #A9A9A9, 0 0 60px #D3D3D3;
  }

  .side {
    width: 280px;
    background: #f7f9fc;
    border: 1px solid #e6edf5;
    border-radius: 12px;
    padding: 16px;
  }
  .side h3 { margin: 0 0 12px; font-size: 16px; color: #333; }
  .hand { display: flex; flex-wrap: wrap; gap: 6px; }
  .hand .piece { 
    width: 36px; height: 36px; 
    clip-path: polygon(50% 0%, 100% 20%, 100% 100%, 0% 100%, 0% 20%);
    font-size: 16px; 
    cursor: pointer; transition: transform .1s ease;
  }
  .hand .piece:hover { transform: scale(1.1); }

  .controls { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px; }
  button {
    background: linear-gradient(45deg, #007bff, #0056b3);
    border: none; color: #fff; padding: 10px 14px; border-radius: 999px;
    cursor: pointer; font-weight: 700; box-shadow: 0 4px 10px rgba(0,0,0,.15);
  }
  button.secondary { background: linear-gradient(45deg, #6c757d, #495057); }
  button.success { background: linear-gradient(45deg, #28a745, #1e7e34); }
  .status { margin-top: 10px; padding: 10px; border-radius: 8px; color: #fff; font-weight: 700; text-align: center; }
  .status.playing { background: #17a2b8; }
  .status.win { background: #28a745; }
  .status.lose { background: #dc3545; }

  @keyframes glow {
    from { box-shadow: 0 0 5px #FFD700, 0 0 10px #FFD700, 0 0 15px #FFD700; }
    to { box-shadow: 0 0 10px #FFD700, 0 0 20px #FFD700, 0 0 30px #FFD700; }
  }
  
  @keyframes firePulse {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.2); opacity: 0.8; }
    100% { transform: scale(1); opacity: 1; }
  }
  
  @keyframes destructionEffect {
    0% { transform: scale(0.5); opacity: 0; }
    25% { transform: scale(1.5); opacity: 1; }
    50% { transform: scale(1.2); opacity: 0.8; }
    75% { transform: scale(1.8); opacity: 0.6; }
    100% { transform: scale(2.5); opacity: 0; }
  }
  
  @keyframes waterFlow {
    0% { transform: scale(1) rotate(0deg); opacity: 0.7; }
    50% { transform: scale(1.3) rotate(180deg); opacity: 1; }
    100% { transform: scale(1) rotate(360deg); opacity: 0.7; }
  }
  
  @keyframes waveFlow {
    0% { transform: scale(1) translateX(0); opacity: 0.7; }
    25% { transform: scale(1.2) translateX(-2px); opacity: 1; }
    50% { transform: scale(1.1) translateX(2px); opacity: 0.9; }
    75% { transform: scale(1.3) translateX(-1px); opacity: 1; }
    100% { transform: scale(1) translateX(0); opacity: 0.7; }
  }
  
  @keyframes pushEffect {
    0% { transform: scale(0.8) translateX(0); opacity: 0; }
    25% { transform: scale(1.2) translateX(5px); opacity: 1; }
    50% { transform: scale(1) translateX(10px); opacity: 0.8; }
    75% { transform: scale(0.9) translateX(15px); opacity: 0.6; }
    100% { transform: scale(0.7) translateX(20px); opacity: 0; }
  }
  
  @keyframes treeGrowth {
    0% { transform: scale(0.5) rotate(0deg); opacity: 0.5; }
    50% { transform: scale(1.3) rotate(180deg); opacity: 1; }
    100% { transform: scale(1) rotate(360deg); opacity: 0.8; }
  }
  
  @keyframes treeSpawn {
    0% { transform: scale(0.3) translateY(10px); opacity: 0; }
    25% { transform: scale(1.2) translateY(-5px); opacity: 1; }
    50% { transform: scale(1) translateY(0); opacity: 0.9; }
    75% { transform: scale(1.1) translateY(-2px); opacity: 0.7; }
    100% { transform: scale(1) translateY(0); opacity: 0.5; }
  }
  
  @keyframes leafScatter {
    0% { transform: scale(0.8) rotate(0deg) translateY(0); opacity: 0; }
    25% { transform: scale(1.2) rotate(90deg) translateY(-3px); opacity: 1; }
    50% { transform: scale(1) rotate(180deg) translateY(0); opacity: 0.8; }
    75% { transform: scale(1.1) rotate(270deg) translateY(2px); opacity: 0.6; }
    100% { transform: scale(0.9) rotate(360deg) translateY(0); opacity: 0.3; }
  }
  
  @keyframes leafPush {
    0% { transform: scale(0.8) translateX(0) translateY(0); opacity: 0; }
    25% { transform: scale(1.2) translateX(5px) translateY(-2px); opacity: 1; }
    50% { transform: scale(1) translateX(10px) translateY(0); opacity: 0.9; }
    75% { transform: scale(1.1) translateX(15px) translateY(2px); opacity: 0.7; }
    100% { transform: scale(0.9) translateX(20px) translateY(0); opacity: 0.4; }
  }
  
  @keyframes starFlow {
    0% { transform: scale(0.8) rotate(0deg); opacity: 0; }
    25% { transform: scale(1.2) rotate(90deg); opacity: 1; }
    50% { transform: scale(1) rotate(180deg); opacity: 0.8; }
    75% { transform: scale(1.1) rotate(270deg); opacity: 0.6; }
    100% { transform: scale(0.9) rotate(360deg); opacity: 0.4; }
  }
  
  @keyframes starPushEffect {
    0% { transform: scale(0.8) translateX(0); opacity: 0; }
    25% { transform: scale(1.2) translateX(3px); opacity: 1; }
    50% { transform: scale(1) translateX(6px); opacity: 0.9; }
    75% { transform: scale(1.1) translateX(9px); opacity: 0.7; }
    100% { transform: scale(0.9) translateX(12px); opacity: 0.4; }
  }
  
  @keyframes darkAbsorptionEffect {
    0% { transform: scale(0.8) rotate(0deg); opacity: 0; }
    25% { transform: scale(1.2) rotate(90deg); opacity: 1; }
    50% { transform: scale(1) rotate(180deg); opacity: 0.8; }
    75% { transform: scale(1.1) rotate(270deg); opacity: 0.6; }
    100% { transform: scale(0.9) rotate(360deg); opacity: 0.4; }
  }
  
  @keyframes absorptionEffect {
    0% { transform: scale(0.8) translateY(0); opacity: 0; }
    25% { transform: scale(1.2) translateY(-3px); opacity: 1; }
    50% { transform: scale(1) translateY(0); opacity: 0.9; }
    75% { transform: scale(1.1) translateY(3px); opacity: 0.7; }
    100% { transform: scale(0.9) translateY(0); opacity: 0.4; }
  }
  
  @keyframes darkeningEffect {
    0% { transform: scale(0.5) rotate(0deg); opacity: 0; }
    25% { transform: scale(1.5) rotate(90deg); opacity: 0.8; }
    50% { transform: scale(1.2) rotate(180deg); opacity: 1; }
    75% { transform: scale(1.3) rotate(270deg); opacity: 0.9; }
    100% { transform: scale(1) rotate(360deg); opacity: 0.7; }
  }
  
  @keyframes demonDestructionEffect {
    0% { transform: scale(0.8) rotate(0deg); opacity: 0; }
    25% { transform: scale(1.3) rotate(90deg); opacity: 1; }
    50% { transform: scale(1) rotate(180deg); opacity: 0.8; }
    75% { transform: scale(1.2) rotate(270deg); opacity: 0.6; }
    100% { transform: scale(0.9) rotate(360deg); opacity: 0.4; }
  }
  
  @keyframes tinTransformationEffect {
    0% { transform: scale(0.8) rotate(0deg); opacity: 0; }
    25% { transform: scale(1.3) rotate(90deg); opacity: 1; }
    50% { transform: scale(1.1) rotate(180deg); opacity: 0.9; }
    75% { transform: scale(1.2) rotate(270deg); opacity: 0.7; }
    100% { transform: scale(1) rotate(360deg); opacity: 0.5; }
  }
  
  @keyframes treasureGlowEffect {
    0% { transform: scale(0.8) rotate(0deg); opacity: 0; }
    25% { transform: scale(1.4) rotate(90deg); opacity: 1; }
    50% { transform: scale(1.2) rotate(180deg); opacity: 0.9; }
    75% { transform: scale(1.3) rotate(270deg); opacity: 0.7; }
    100% { transform: scale(1) rotate(360deg); opacity: 0.5; }
  }
  
  @keyframes electricConductionEffect {
    0% { transform: scale(0.8) rotate(0deg); opacity: 0; }
    25% { transform: scale(1.3) rotate(45deg); opacity: 1; }
    50% { transform: scale(1.1) rotate(90deg); opacity: 0.9; }
    75% { transform: scale(1.2) rotate(135deg); opacity: 0.7; }
    100% { transform: scale(1) rotate(180deg); opacity: 0.5; }
  }
  
  @keyframes thunderDischargeEffect {
    0% { transform: scale(0.8) rotate(0deg); opacity: 0; }
    25% { transform: scale(1.5) rotate(90deg); opacity: 1; }
    50% { transform: scale(1.2) rotate(180deg); opacity: 0.9; }
    75% { transform: scale(1.4) rotate(270deg); opacity: 0.7; }
    100% { transform: scale(1) rotate(360deg); opacity: 0.5; }
  }
  
  @keyframes ironMagneticEffect {
    0% { transform: scale(0.8) translateX(0); opacity: 0; }
    25% { transform: scale(1.2) translateX(-5px); opacity: 1; }
    50% { transform: scale(1) translateX(-10px); opacity: 0.9; }
    75% { transform: scale(1.1) translateX(-15px); opacity: 0.7; }
    100% { transform: scale(0.9) translateX(-20px); opacity: 0.5; }
  }

  @keyframes iceFreezeEffect {
    0% { transform: scale(0.5) rotate(0deg); opacity: 0; }
    25% { transform: scale(1.2) rotate(90deg); opacity: 0.8; }
    50% { transform: scale(1) rotate(180deg); opacity: 1; }
    75% { transform: scale(1.1) rotate(270deg); opacity: 0.9; }
    100% { transform: scale(1) rotate(360deg); opacity: 0.7; }
  }

  @keyframes iceFreeze {
    0% { transform: scale(1); opacity: 1; }
    25% { transform: scale(1.1); opacity: 0.9; }
    50% { transform: scale(1.05); opacity: 1; }
    75% { transform: scale(1.15); opacity: 0.8; }
    100% { transform: scale(1); opacity: 1; }
  }

  @keyframes snowIceEffect {
    0% { transform: scale(1); opacity: 1; }
    25% { transform: scale(1.2); opacity: 0.8; }
    50% { transform: scale(1.1); opacity: 1; }
    75% { transform: scale(1.3); opacity: 0.9; }
    100% { transform: scale(1); opacity: 1; }
  }

  @keyframes iceAcquisitionPulse {
    0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    50% { transform: translate(-50%, -50%) scale(1.5); opacity: 0.7; }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
  }

  @keyframes snowMove {
    0% { transform: scale(1); opacity: 1; }
    25% { transform: scale(1.1); opacity: 0.9; }
    50% { transform: scale(1.05); opacity: 1; }
    75% { transform: scale(1.15); opacity: 0.8; }
    100% { transform: scale(1); opacity: 1; }
  }

  /* ÂøçËÄÖ„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Ç≠„Éº„Éï„É¨„Éº„É† */
  @keyframes ninjaPieceGlow {
    0% { 
      box-shadow: 0 0 5px #34495e;
      text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    }
    50% { 
      box-shadow: 0 0 15px #34495e, 0 0 25px #34495e;
      text-shadow: 2px 2px 6px #000000, -1px -1px 3px #000000, 1px -1px 3px #000000, -1px 1px 3px #000000;
    }
    100% { 
      box-shadow: 0 0 5px #34495e;
      text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    }
  }
  
  @keyframes ninjaPieceFloat {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-3px); }
    100% { transform: translateY(0px); }
  }
  
  @keyframes ninjaPieceFloatComputer {
    0% { transform: translateY(0px) rotate(180deg); }
    50% { transform: translateY(-3px) rotate(180deg); }
    100% { transform: translateY(0px) rotate(180deg); }
  }
  
  @keyframes ninjaShuriken {
    0% { 
      opacity: 0.8; 
      transform: rotate(0deg) scale(1);
    }
    50% { 
      opacity: 1; 
      transform: rotate(180deg) scale(1.2);
    }
    100% { 
      opacity: 0.8; 
      transform: rotate(360deg) scale(1);
    }
  }
  
  @keyframes ninjaShadow {
    0% { 
      opacity: 0.3; 
      transform: scale(1);
    }
    50% { 
      opacity: 0.6; 
      transform: scale(1.1);
    }
    100% { 
      opacity: 0.3; 
      transform: scale(1);
    }
  }

  /* ÂΩ±„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Ç≠„Éº„Éï„É¨„Éº„É† */
  @keyframes shadowPieceGlow {
    0% { 
      box-shadow: 0 0 5px #95a5a6;
      text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    }
    50% { 
      box-shadow: 0 0 15px #95a5a6, 0 0 25px #95a5a6;
      text-shadow: 2px 2px 6px #000000, -1px -1px 3px #000000, 1px -1px 3px #000000, -1px 1px 3px #000000;
    }
    100% { 
      box-shadow: 0 0 5px #95a5a6;
      text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    }
  }
  
  @keyframes shadowPieceFloat {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-3px); }
    100% { transform: translateY(0px); }
  }
  
  @keyframes shadowPieceFloatComputer {
    0% { transform: translateY(0px) rotate(180deg); }
    50% { transform: translateY(-3px) rotate(180deg); }
    100% { transform: translateY(0px) rotate(180deg); }
  }
  
  @keyframes shadowFade {
    0% { 
      opacity: 0.6; 
      transform: scale(1);
    }
    50% { 
      opacity: 0.9; 
      transform: scale(1.1);
    }
    100% { 
      opacity: 0.6; 
      transform: scale(1);
    }
  }
  
  @keyframes shadowEffect {
    0% { 
      opacity: 0.4; 
      transform: scale(1);
    }
    50% { 
      opacity: 0.7; 
      transform: scale(1.1);
    }
    100% { 
      opacity: 0.4; 
      transform: scale(1);
    }
  }

  /* Á´ú„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Ç≠„Éº„Éï„É¨„Éº„É† */
  @keyframes dragonPieceGlow {
    0% { 
      box-shadow: 0 0 5px #DC143C;
      text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    }
    50% { 
      box-shadow: 0 0 15px #DC143C, 0 0 25px #DC143C;
      text-shadow: 2px 2px 6px #000000, -1px -1px 3px #000000, 1px -1px 3px #000000, -1px 1px 3px #000000;
    }
    100% { 
      box-shadow: 0 0 5px #DC143C;
      text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    }
  }
  
  @keyframes dragonPieceFloat {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-3px); }
    100% { transform: translateY(0px); }
  }
  
  @keyframes dragonPieceFloatComputer {
    0% { transform: translateY(0px) rotate(180deg); }
    50% { transform: translateY(-3px) rotate(180deg); }
    100% { transform: translateY(0px) rotate(180deg); }
  }

  /* Ëæ∞„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes dragonAwakenedGlow {
    0%, 100% { 
      box-shadow: 
        0 0 20px #FFD700, 
        0 0 40px #FFA500, 
        0 0 60px #FF6347,
        0 0 80px #DC143C;
    }
    50% { 
      box-shadow: 
        0 0 30px #FFD700, 
        0 0 60px #FFA500, 
        0 0 90px #FF6347,
        0 0 120px #DC143C;
    }
  }
  
  @keyframes dragonAwakenedFloat {
    0%, 100% { transform: translateY(0px) scale(1.15); }
    25% { transform: translateY(-2px) scale(1.18); }
    50% { transform: translateY(-4px) scale(1.2); }
    75% { transform: translateY(-2px) scale(1.18); }
  }
  
  @keyframes dragonAwakenedFloatComputer {
    0%, 100% { transform: translateY(0px) scale(1.15) rotate(180deg); }
    25% { transform: translateY(-2px) scale(1.18) rotate(180deg); }
    50% { transform: translateY(-4px) scale(1.2) rotate(180deg); }
    75% { transform: translateY(-2px) scale(1.18) rotate(180deg); }
  }
  
  @keyframes dragonAwakenedPulse {
    0%, 100% { 
      transform: scale(1.15);
      border-color: #FFD700;
    }
    50% { 
      transform: scale(1.2);
      border-color: #FFA500;
    }
  }
  
  @keyframes dragonAwakenedBreath {
    0% { 
      opacity: 0.8; 
      transform: scale(1) rotate(0deg);
      text-shadow: 0 0 10px #FFD700, 0 0 20px #FFA500;
    }
    50% { 
      opacity: 1; 
      transform: scale(1.2) rotate(5deg);
      text-shadow: 0 0 15px #FFD700, 0 0 30px #FFA500, 0 0 45px #FF6347;
    }
    100% { 
      opacity: 0.8; 
      transform: scale(1) rotate(0deg);
      text-shadow: 0 0 10px #FFD700, 0 0 20px #FFA500;
    }
  }
  
  @keyframes dragonAwakenedAura {
    0%, 100% { 
      opacity: 0.6; 
      transform: scale(1);
    }
    50% { 
      opacity: 1; 
      transform: scale(1.1);
    }
  }

  /* Ëæ∞„ÅÆ„Çπ„Ç≠„É´ÔºöÊ∂àÊªÖ„Ç®„Éï„Çß„ÇØ„Éà */
  @keyframes dragonAwakenedDestruction {
    0% { 
      opacity: 1; 
      transform: scale(0.5);
      background: radial-gradient(circle, rgba(255,0,0,0.8) 0%, rgba(255,100,0,0.6) 30%, transparent 70%);
    }
    50% { 
      opacity: 0.8; 
      transform: scale(1.5);
      background: radial-gradient(circle, rgba(255,255,0,0.9) 0%, rgba(255,0,0,0.7) 40%, transparent 80%);
    }
    100% { 
      opacity: 0; 
      transform: scale(2);
      background: radial-gradient(circle, rgba(255,255,255,0.5) 0%, rgba(255,0,0,0.3) 50%, transparent 100%);
    }
  }

  /* ÂÆüÔºàÂÆüÈ®ì‰ΩìÔºâ„ÅÆ„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.experiment-piece {
    background: linear-gradient(135deg, #10B981, #059669) !important;
    border: 2px solid #047857 !important;
    box-shadow: 
      0 0 15px rgba(16, 185, 129, 0.6),
      0 0 30px rgba(5, 150, 105, 0.4),
      inset 0 0 10px rgba(255, 255, 255, 0.2) !important;
    animation: experimentGlow 2s ease-in-out infinite alternate;
  }

  .piece.experiment-piece::before {
    content: 'üß™';
    position: absolute;
    top: 2px;
    right: 2px;
    font-size: 12px;
    z-index: 10;
    text-shadow: 0 0 3px rgba(0, 0, 0, 0.8);
    animation: experimentBubble 3s ease-in-out infinite;
  }

  .piece.experiment-piece:hover {
    transform: scale(1.1) !important;
    box-shadow: 
      0 0 20px rgba(16, 185, 129, 0.8),
      0 0 40px rgba(5, 150, 105, 0.6),
      inset 0 0 15px rgba(255, 255, 255, 0.3) !important;
    animation: experimentPulse 1s ease-in-out infinite;
  }

  .piece.experiment-piece.selected {
    box-shadow: 
      0 0 25px rgba(16, 185, 129, 1),
      0 0 50px rgba(5, 150, 105, 0.8),
      inset 0 0 20px rgba(255, 255, 255, 0.4) !important;
    animation: experimentSelected 0.5s ease-in-out infinite alternate;
  }

  /* Áï∞ÔºàÂ§âÁï∞‰ΩìÔºâ„ÅÆ„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.mutant-piece {
    background: linear-gradient(135deg, #8B5CF6, #7C3AED) !important;
    border: 2px solid #6D28D9 !important;
    box-shadow: 
      0 0 20px rgba(139, 92, 246, 0.7),
      0 0 40px rgba(124, 58, 237, 0.5),
      inset 0 0 15px rgba(255, 255, 255, 0.3) !important;
    animation: mutantGlow 2.5s ease-in-out infinite alternate;
  }

  .piece.mutant-piece::before {
    content: 'üß¨';
    position: absolute;
    top: 2px;
    right: 2px;
    font-size: 12px;
    z-index: 10;
    text-shadow: 0 0 3px rgba(0, 0, 0, 0.8);
    animation: mutantDNA 4s ease-in-out infinite;
  }

  .piece.mutant-piece:hover {
    transform: scale(1.15) !important;
    box-shadow: 
      0 0 25px rgba(139, 92, 246, 0.9),
      0 0 50px rgba(124, 58, 237, 0.7),
      inset 0 0 20px rgba(255, 255, 255, 0.4) !important;
    animation: mutantPulse 0.8s ease-in-out infinite;
  }

  .piece.mutant-piece.selected {
    box-shadow: 
      0 0 30px rgba(139, 92, 246, 1),
      0 0 60px rgba(124, 58, 237, 0.9),
      inset 0 0 25px rgba(255, 255, 255, 0.5) !important;
    animation: mutantSelected 0.3s ease-in-out infinite alternate;
  }

  /* ÂÆüÔºàÂÆüÈ®ì‰ΩìÔºâ„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes experimentGlow {
    0%, 100% { 
      box-shadow: 
        0 0 15px rgba(16, 185, 129, 0.6),
        0 0 30px rgba(5, 150, 105, 0.4),
        inset 0 0 10px rgba(255, 255, 255, 0.2);
    }
    50% { 
      box-shadow: 
        0 0 20px rgba(16, 185, 129, 0.8),
        0 0 40px rgba(5, 150, 105, 0.6),
        inset 0 0 15px rgba(255, 255, 255, 0.3);
    }
  }

  @keyframes experimentBubble {
    0%, 100% { 
      transform: scale(1) rotate(0deg);
      opacity: 0.8;
    }
    50% { 
      transform: scale(1.2) rotate(180deg);
      opacity: 1;
    }
  }

  @keyframes experimentPulse {
    0%, 100% { 
      transform: scale(1.1);
    }
    50% { 
      transform: scale(1.2);
    }
  }

  @keyframes experimentSelected {
    0%, 100% { 
      box-shadow: 
        0 0 25px rgba(16, 185, 129, 1),
        0 0 50px rgba(5, 150, 105, 0.8),
        inset 0 0 20px rgba(255, 255, 255, 0.4);
    }
    50% { 
      box-shadow: 
        0 0 30px rgba(16, 185, 129, 1),
        0 0 60px rgba(5, 150, 105, 1),
        inset 0 0 25px rgba(255, 255, 255, 0.6);
    }
  }

  /* Áï∞ÔºàÂ§âÁï∞‰ΩìÔºâ„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes mutantGlow {
    0%, 100% { 
      box-shadow: 
        0 0 20px rgba(139, 92, 246, 0.7),
        0 0 40px rgba(124, 58, 237, 0.5),
        inset 0 0 15px rgba(255, 255, 255, 0.3);
    }
    50% { 
      box-shadow: 
        0 0 25px rgba(139, 92, 246, 0.9),
        0 0 50px rgba(124, 58, 237, 0.7),
        inset 0 0 20px rgba(255, 255, 255, 0.4);
    }
  }

  @keyframes mutantDNA {
    0%, 100% { 
      transform: scale(1) rotate(0deg);
      opacity: 0.7;
    }
    25% { 
      transform: scale(1.1) rotate(90deg);
      opacity: 0.9;
    }
    50% { 
      transform: scale(1.3) rotate(180deg);
      opacity: 1;
    }
    75% { 
      transform: scale(1.1) rotate(270deg);
      opacity: 0.9;
    }
  }

  @keyframes mutantPulse {
    0%, 100% { 
      transform: scale(1.15);
    }
    50% { 
      transform: scale(1.25);
    }
  }

  @keyframes mutantSelected {
    0%, 100% { 
      box-shadow: 
        0 0 30px rgba(139, 92, 246, 1),
        0 0 60px rgba(124, 58, 237, 0.9),
        inset 0 0 25px rgba(255, 255, 255, 0.5);
    }
    50% { 
      box-shadow: 
        0 0 35px rgba(139, 92, 246, 1),
        0 0 70px rgba(124, 58, 237, 1),
        inset 0 0 30px rgba(255, 255, 255, 0.7);
    }
  }

  /* KÂçöÂ£´Ôºà„Éú„ÇπÔºâ„ÅÆ„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.k-boss-piece {
    background: linear-gradient(135deg, #DC2626, #991B1B, #7F1D1D) !important;
    border: 3px solid #B91C1C !important;
    box-shadow: 
      0 0 30px rgba(220, 38, 38, 0.8),
      0 0 60px rgba(153, 27, 27, 0.6),
      0 0 90px rgba(127, 29, 29, 0.4),
      inset 0 0 20px rgba(255, 255, 255, 0.3) !important;
    animation: kBossGlow 2s ease-in-out infinite alternate, kBossAura 4s ease-in-out infinite;
    position: relative;
  }

  .piece.k-boss-piece::before {
    content: 'üëë';
    position: absolute;
    top: -5px;
    right: -5px;
    font-size: 16px;
    z-index: 10;
    text-shadow: 0 0 5px rgba(255, 215, 0, 0.8);
    animation: kCrownFloat 3s ease-in-out infinite;
  }

  .piece.k-boss-piece::after {
    content: '';
    position: absolute;
    top: -10px;
    left: -10px;
    right: -10px;
    bottom: -10px;
    background: radial-gradient(circle, rgba(255, 0, 0, 0.3) 0%, rgba(255, 100, 0, 0.2) 30%, transparent 70%);
    border-radius: 50%;
    z-index: -1;
    animation: kBossAura 4s ease-in-out infinite;
  }

  .piece.k-boss-piece:hover {
    transform: scale(1.2) !important;
    box-shadow: 
      0 0 40px rgba(220, 38, 38, 1),
      0 0 80px rgba(153, 27, 27, 0.8),
      0 0 120px rgba(127, 29, 29, 0.6),
      inset 0 0 25px rgba(255, 255, 255, 0.4) !important;
    animation: kBossPulse 0.8s ease-in-out infinite, kBossAura 4s ease-in-out infinite;
  }

  .piece.k-boss-piece.selected {
    box-shadow: 
      0 0 50px rgba(220, 38, 38, 1),
      0 0 100px rgba(153, 27, 27, 0.9),
      0 0 150px rgba(127, 29, 29, 0.7),
      inset 0 0 30px rgba(255, 255, 255, 0.5) !important;
    animation: kBossSelected 0.5s ease-in-out infinite alternate, kBossAura 4s ease-in-out infinite;
  }

  /* KÂçöÂ£´„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes kBossGlow {
    0%, 100% { 
      box-shadow: 
        0 0 30px rgba(220, 38, 38, 0.8),
        0 0 60px rgba(153, 27, 27, 0.6),
        0 0 90px rgba(127, 29, 29, 0.4),
        inset 0 0 20px rgba(255, 255, 255, 0.3);
    }
    50% { 
      box-shadow: 
        0 0 40px rgba(220, 38, 38, 1),
        0 0 80px rgba(153, 27, 27, 0.8),
        0 0 120px rgba(127, 29, 29, 0.6),
        inset 0 0 25px rgba(255, 255, 255, 0.4);
    }
  }

  @keyframes kBossAura {
    0%, 100% { 
      opacity: 0.6;
      transform: scale(1);
    }
    50% { 
      opacity: 1;
      transform: scale(1.1);
    }
  }

  @keyframes kCrownFloat {
    0%, 100% { 
      transform: translateY(0px) rotate(0deg);
      opacity: 0.9;
    }
    25% { 
      transform: translateY(-2px) rotate(5deg);
      opacity: 1;
    }
    50% { 
      transform: translateY(-4px) rotate(0deg);
      opacity: 1;
    }
    75% { 
      transform: translateY(-2px) rotate(-5deg);
      opacity: 1;
    }
  }

  @keyframes kBossPulse {
    0%, 100% { 
      transform: scale(1.2);
    }
    50% { 
      transform: scale(1.3);
    }
  }

  @keyframes kBossSelected {
    0%, 100% { 
      box-shadow: 
        0 0 50px rgba(220, 38, 38, 1),
        0 0 100px rgba(153, 27, 27, 0.9),
        0 0 150px rgba(127, 29, 29, 0.7),
        inset 0 0 30px rgba(255, 255, 255, 0.5);
    }
    50% { 
      box-shadow: 
        0 0 60px rgba(220, 38, 38, 1),
        0 0 120px rgba(153, 27, 27, 1),
        0 0 180px rgba(127, 29, 29, 0.9),
        inset 0 0 35px rgba(255, 255, 255, 0.7);
    }
  }

  @keyframes kSummonPulse {
    0% { 
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.5);
    }
    50% { 
      opacity: 1;
      transform: translate(-50%, -50%) scale(1.2);
    }
    100% { 
      opacity: 0;
      transform: translate(-50%, -50%) scale(1.5);
    }
  }

  @keyframes kDefensePulse {
    0% { 
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.5);
    }
    50% { 
      opacity: 1;
      transform: translate(-50%, -50%) scale(1.2);
    }
    100% { 
      opacity: 0;
      transform: translate(-50%, -50%) scale(1.5);
    }
  }

  @keyframes experimentMutationPulse {
    0% { 
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.5);
    }
    50% { 
      opacity: 1;
      transform: translate(-50%, -50%) scale(1.2);
    }
    100% { 
      opacity: 0;
      transform: translate(-50%, -50%) scale(1.5);
    }
  }

  @keyframes experimentReturnPulse {
    0% { 
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.5);
    }
    50% { 
      opacity: 1;
      transform: translate(-50%, -50%) scale(1.2);
    }
    100% { 
      opacity: 0;
      transform: translate(-50%, -50%) scale(1.5);
    }
  }
  
  @keyframes dragonBreath {
    0% { 
      opacity: 0.9; 
      transform: scale(1) rotate(0deg);
    }
    50% { 
      opacity: 1; 
      transform: scale(1.2) rotate(180deg);
    }
    100% { 
      opacity: 0.9; 
      transform: scale(1) rotate(360deg);
    }
  }
  
  @keyframes dragonAura {
    0% { 
      opacity: 0.4; 
      transform: scale(1);
    }
    50% { 
      opacity: 0.7; 
      transform: scale(1.1);
    }
    100% { 
      opacity: 0.4; 
      transform: scale(1);
    }
  }

  /* È≥≥„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Ç≠„Éº„Éï„É¨„Éº„É† */
  @keyframes phoenixPieceGlow {
    0% { 
      box-shadow: 0 0 5px #FFD700;
      text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    }
    50% { 
      box-shadow: 0 0 15px #FFD700, 0 0 25px #FFD700;
      text-shadow: 2px 2px 6px #000000, -1px -1px 3px #000000, 1px -1px 3px #000000, -1px 1px 3px #000000;
    }
    100% { 
      box-shadow: 0 0 5px #FFD700;
      text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    }
  }
  
  @keyframes phoenixPieceFloat {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-3px); }
    100% { transform: translateY(0px); }
  }
  
  @keyframes phoenixPieceFloatComputer {
    0% { transform: translateY(0px) rotate(180deg); }
    50% { transform: translateY(-3px) rotate(180deg); }
    100% { transform: translateY(0px) rotate(180deg); }
  }
  
  @keyframes phoenixWings {
    0% { 
      opacity: 0.9; 
      transform: scale(1) rotate(0deg);
    }
    50% { 
      opacity: 1; 
      transform: scale(1.2) rotate(180deg);
    }
    100% { 
      opacity: 0.9; 
      transform: scale(1) rotate(360deg);
    }
  }
  
  @keyframes phoenixFire {
    0% { 
      opacity: 0.4; 
      transform: scale(1);
    }
    50% { 
      opacity: 0.7; 
      transform: scale(1.1);
    }
    100% { 
      opacity: 0.4; 
      transform: scale(1);
    }
  }

  /* ÂÖâ„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Ç≠„Éº„Éï„É¨„Éº„É† */
  @keyframes lightPieceGlow {
    0% { 
      box-shadow: 0 0 5px #FFFF00;
      text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    }
    50% { 
      box-shadow: 0 0 15px #FFFF00, 0 0 25px #FFFF00;
      text-shadow: 2px 2px 6px #000000, -1px -1px 3px #000000, 1px -1px 3px #000000, -1px 1px 3px #000000;
    }
    100% { 
      box-shadow: 0 0 5px #FFFF00;
      text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    }
  }
  
  @keyframes lightPieceFloat {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-3px); }
    100% { transform: translateY(0px); }
  }
  
  @keyframes lightPieceFloatComputer {
    0% { transform: translateY(0px) rotate(180deg); }
    50% { transform: translateY(-3px) rotate(180deg); }
    100% { transform: translateY(0px) rotate(180deg); }
  }
  
  @keyframes lightSparkle {
    0% { 
      opacity: 0.9; 
      transform: scale(1) rotate(0deg);
    }
    50% { 
      opacity: 1; 
      transform: scale(1.2) rotate(180deg);
    }
    100% { 
      opacity: 0.9; 
      transform: scale(1) rotate(360deg);
    }
  }
  
  @keyframes lightAura {
    0% { 
      opacity: 0.4; 
      transform: scale(1);
    }
    50% { 
      opacity: 0.7; 
      transform: scale(1.1);
    }
    100% { 
      opacity: 0.4; 
      transform: scale(1);
    }
  }

  /* Êòü„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Ç≠„Éº„Éï„É¨„Éº„É† */
  @keyframes starPieceGlow {
    0% { 
      box-shadow: 0 0 5px #FFD700;
      text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    }
    50% { 
      box-shadow: 0 0 15px #FFD700, 0 0 25px #FFD700;
      text-shadow: 2px 2px 6px #000000, -1px -1px 3px #000000, 1px -1px 3px #000000, -1px 1px 3px #000000;
    }
    100% { 
      box-shadow: 0 0 5px #FFD700;
      text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    }
  }
  
  @keyframes starPieceFloat {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-3px); }
    100% { transform: translateY(0px); }
  }
  
  @keyframes starPieceFloatComputer {
    0% { transform: translateY(0px) rotate(180deg); }
    50% { transform: translateY(-3px) rotate(180deg); }
    100% { transform: translateY(0px) rotate(180deg); }
  }
  
  @keyframes starTwinkle {
    0% { 
      opacity: 0.9; 
      transform: scale(1) rotate(0deg);
    }
    50% { 
      opacity: 1; 
      transform: scale(1.2) rotate(180deg);
    }
    100% { 
      opacity: 0.9; 
      transform: scale(1) rotate(360deg);
    }
  }
  
  @keyframes starAura {
    0% { 
      opacity: 0.4; 
      transform: scale(1);
    }
    50% { 
      opacity: 0.7; 
      transform: scale(1.1);
    }
    100% { 
      opacity: 0.4; 
      transform: scale(1);
    }
  }

  /* È¢®„ÅÆ„Çπ„Ç≠„É´„Ç®„Éï„Çß„ÇØ„Éà */
  @keyframes windPushEffect {
    0% { 
      transform: scale(1) rotate(0deg);
      box-shadow: 0 0 5px #87CEEB;
    }
    50% { 
      transform: scale(1.1) rotate(180deg);
      box-shadow: 0 0 15px #4682B4;
    }
    100% { 
      transform: scale(1) rotate(360deg);
      box-shadow: 0 0 5px #87CEEB;
    }
  }
  
  @keyframes windPushPulse {
    0% { 
      opacity: 0.7; 
      transform: translate(-50%, -50%) scale(0.8);
    }
    50% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1.2);
    }
    100% { 
      opacity: 0.7; 
      transform: translate(-50%, -50%) scale(0.8);
    }
  }
  
  @keyframes windPushTextFade {
    0% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0.8);
    }
    20% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1.1);
    }
    80% { 
      opacity: 1; 
      transform: translate(-50%, -50%) scale(1.0);
    }
    100% { 
      opacity: 0; 
      transform: translate(-50%, -50%) scale(0.9);
    }
  }
  
  .fire-mark {
    position: fixed;
    font-size: 28px;
    z-index: 1000;
    pointer-events: none;
    animation: firePulse 0.5s ease-in-out;
    filter: drop-shadow(0 0 8px #ff4500);
  }
  
  .destruction-mark {
    position: fixed;
    font-size: 32px;
    z-index: 1001;
    pointer-events: none;
    animation: destructionEffect 1s ease-in-out forwards;
    filter: drop-shadow(0 0 12px #ff0000);
  }
    
    .fire-piece {
      background: linear-gradient(135deg, #FFD700, #FFA500) !important;
      border-color: #FF4500 !important;
      box-shadow: 0 0 10px rgba(255, 69, 0, 0.5);
    }
    
    .fire-valid {
      background: #FFE4B5 !important;
      border-color: #FF6347 !important;
      box-shadow: 0 0 15px rgba(255, 99, 71, 0.6);
    }
    
    .fire-piece:hover {
      background: linear-gradient(135deg, #FFA500, #FF6347) !important;
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(255, 69, 0, 0.8);
    }

  .water-mark {
    position: fixed;
    font-size: 24px;
    z-index: 1000;
    pointer-events: none;
    animation: waterFlow 1s ease-in-out;
    filter: drop-shadow(0 0 8px #0066cc);
  }

  .wave-mark {
    position: fixed;
    font-size: 24px;
    z-index: 1000;
    pointer-events: none;
    animation: waveFlow 1s ease-in-out;
    filter: drop-shadow(0 0 8px #0099cc);
  }

  .push-mark {
    position: fixed;
    font-size: 20px;
    z-index: 1002;
    pointer-events: none;
    animation: pushEffect 0.8s ease-in-out;
    filter: drop-shadow(0 0 6px #00cc00);
  }

  .water-piece {
    background: linear-gradient(135deg, #87CEEB, #4682B4) !important;
    border-color: #0066CC !important;
    box-shadow: 0 0 10px rgba(0, 102, 204, 0.5);
  }
  
  .water-valid {
    background: #E0F6FF !important;
    border-color: #0099CC !important;
    box-shadow: 0 0 15px rgba(0, 153, 204, 0.6);
  }
  
  .water-piece:hover {
    background: linear-gradient(135deg, #4682B4, #0066CC) !important;
    transform: scale(1.1);
    box-shadow: 0 0 20px rgba(0, 102, 204, 0.8);
  }

  .tree-mark {
    position: fixed;
    font-size: 24px;
    z-index: 1000;
    pointer-events: none;
    animation: treeGrowth 1s ease-in-out;
    filter: drop-shadow(0 0 8px #228B22);
  }

  .tin-mark {
    position: fixed;
    font-size: 28px;
    z-index: 1000;
    pointer-events: none;
    animation: tinTransformationEffect 2s ease-in-out;
    filter: drop-shadow(0 0 8px #C0C0C0);
  }

  .iron-mark {
    position: fixed;
    font-size: 28px;
    z-index: 1000;
    pointer-events: none;
    animation: ironMagneticEffect 2s ease-in-out;
    filter: drop-shadow(0 0 8px #708090);
  }

  .treasure-mark {
    position: fixed;
    font-size: 28px;
    z-index: 1000;
    pointer-events: none;
    animation: treasureGlowEffect 2s ease-in-out;
    filter: drop-shadow(0 0 8px #FFD700);
  }

  .electric-mark {
    position: fixed;
    font-size: 28px;
    z-index: 1000;
    pointer-events: none;
    animation: electricConductionEffect 2s ease-in-out;
    filter: drop-shadow(0 0 8px #00BFFF);
  }

  .thunder-mark {
    position: fixed;
    font-size: 28px;
    z-index: 1000;
    pointer-events: none;
    animation: thunderDischargeEffect 2s ease-in-out;
    filter: drop-shadow(0 0 8px #FFD700);
  }

  .spawn-mark {
    position: fixed;
    font-size: 28px;
    z-index: 1003;
    pointer-events: none;
    animation: treeSpawn 1.2s ease-in-out;
    filter: drop-shadow(0 0 10px #32CD32);
  }

  .tree-piece {
    background: linear-gradient(135deg, #90EE90, #228B22) !important;
    border-color: #006400 !important;
    box-shadow: 0 0 10px rgba(34, 139, 34, 0.5);
  }
  
  .tree-valid {
    background: #F0FFF0 !important;
    border-color: #228B22 !important;
    box-shadow: 0 0 15px rgba(34, 139, 34, 0.6);
  }
  
  .tree-piece:hover {
    background: linear-gradient(135deg, #228B22, #006400) !important;
    transform: scale(1.1);
    box-shadow: 0 0 20px rgba(34, 139, 34, 0.8);
  }

  /* ÈáëÂ±ûÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .metal-piece {
    background: linear-gradient(135deg, #708090, #C0C0C0) !important;
    border-color: #2F4F4F !important;
    box-shadow: 0 0 10px rgba(112, 128, 144, 0.5);
    text-shadow: 0 1px 3px rgba(0,0,0,.7);
  }
  
  .metal-valid {
    background: #E6E6FA !important;
    border-color: #708090 !important;
    box-shadow: 0 0 15px rgba(112, 128, 144, 0.6);
  }
  
  .metal-piece:hover {
    background: linear-gradient(135deg, #C0C0C0, #708090) !important;
    transform: scale(1.1);
    box-shadow: 0 0 20px rgba(112, 128, 144, 0.8);
  }

  /* ÈäÖ„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .copper-piece {
    background: linear-gradient(135deg, #CD7F32, #B87333) !important;
    border-color: #8B4513 !important;
    box-shadow: 0 0 10px rgba(205, 127, 50, 0.5);
    text-shadow: 0 1px 3px rgba(0,0,0,.7);
  }
  
  .copper-valid {
    background: #F5DEB3 !important;
    border-color: #CD7F32 !important;
    box-shadow: 0 0 15px rgba(205, 127, 50, 0.6);
  }
  
  .copper-piece:hover {
    background: linear-gradient(135deg, #B87333, #CD7F32) !important;
    transform: scale(1.1);
    box-shadow: 0 0 20px rgba(205, 127, 50, 0.8);
  }

  /* ÈâÑ„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .iron-piece {
    background: linear-gradient(135deg, #708090, #2F4F4F) !important;
    border-color: #191970 !important;
    box-shadow: 0 0 10px rgba(112, 128, 144, 0.5);
    text-shadow: 0 1px 3px rgba(0,0,0,.7);
  }
  
  .iron-valid {
    background: #F0F8FF !important;
    border-color: #708090 !important;
    box-shadow: 0 0 15px rgba(112, 128, 144, 0.6);
  }
  
  .iron-piece:hover {
    background: linear-gradient(135deg, #2F4F4F, #708090) !important;
    transform: scale(1.1);
    box-shadow: 0 0 20px rgba(112, 128, 144, 0.8);
  }

  /* Èå´„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .tin-piece {
    background: linear-gradient(135deg, #C0C0C0, #A9A9A9) !important;
    border-color: #696969 !important;
    box-shadow: 0 0 10px rgba(192, 192, 192, 0.5);
    text-shadow: 0 1px 3px rgba(0,0,0,.7);
  }
  
  .tin-valid {
    background: #F5F5F5 !important;
    border-color: #C0C0C0 !important;
    box-shadow: 0 0 15px rgba(192, 192, 192, 0.6);
  }
  
  .tin-piece:hover {
    background: linear-gradient(135deg, #A9A9A9, #C0C0C0) !important;
    transform: scale(1.1);
    box-shadow: 0 0 20px rgba(192, 192, 192, 0.8);
  }

  /* Èâõ„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .lead-piece {
    background: linear-gradient(135deg, #696969, #2F4F4F) !important;
    border-color: #191970 !important;
    box-shadow: 0 0 10px rgba(105, 105, 105, 0.5);
    text-shadow: 0 1px 3px rgba(0,0,0,.7);
  }
  
  .lead-valid {
    background: #F8F8FF !important;
    border-color: #696969 !important;
    box-shadow: 0 0 15px rgba(105, 105, 105, 0.6);
  }
  
  .lead-piece:hover {
    background: linear-gradient(135deg, #2F4F4F, #696969) !important;
    transform: scale(1.1);
    box-shadow: 0 0 20px rgba(105, 105, 105, 0.8);
  }

  /* ÂÆù„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .treasure-piece {
    background: linear-gradient(135deg, #FFD700, #FFA500) !important;
    border-color: #B8860B !important;
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    text-shadow: 0 1px 3px rgba(0,0,0,.7);
  }
  
  .treasure-valid {
    background: #FFFACD !important;
    border-color: #FFD700 !important;
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
  }
  
  .treasure-piece:hover {
    background: linear-gradient(135deg, #FFA500, #FFD700) !important;
    transform: scale(1.1);
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
  }

  /* Èõª„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .electric-piece {
    background: linear-gradient(135deg, #00BFFF, #1E90FF) !important;
    border-color: #0066CC !important;
    box-shadow: 0 0 10px rgba(0, 191, 255, 0.5);
    text-shadow: 0 1px 3px rgba(0,0,0,.7);
  }
  
  .electric-valid {
    background: #E6F3FF !important;
    border-color: #00BFFF !important;
    box-shadow: 0 0 15px rgba(0, 191, 255, 0.6);
  }
  
  .electric-piece:hover {
    background: linear-gradient(135deg, #1E90FF, #00BFFF) !important;
    transform: scale(1.1);
    box-shadow: 0 0 20px rgba(0, 191, 255, 0.8);
  }

  /* Èõ∑„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .thunder-piece {
    background: linear-gradient(135deg, #FFD700, #FFA500) !important;
    border-color: #FF8C00 !important;
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    text-shadow: 0 1px 3px rgba(0,0,0,.7);
  }
  
  .thunder-valid {
    background: #FFFACD !important;
    border-color: #FFD700 !important;
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
  }
  
  .thunder-piece:hover {
    background: linear-gradient(135deg, #FFA500, #FFD700) !important;
    transform: scale(1.1);
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
  }

  /* Èóá„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .dark-piece {
    background: linear-gradient(135deg, #2F2F2F, #1A1A1A) !important;
    border-color: #000000 !important;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
    text-shadow: 0 1px 3px rgba(255,255,255,.3);
    color: #CCCCCC !important;
  }
  
  .dark-valid {
    background: #1A1A1A !important;
    border-color: #2F2F2F !important;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.9);
  }
  
  .dark-piece:hover {
    background: linear-gradient(135deg, #1A1A1A, #000000) !important;
    transform: scale(1.1);
    box-shadow: 0 0 20px rgba(0, 0, 0, 1);
  }

  /* È≠î„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .demon-piece {
    background: linear-gradient(135deg, #8B0000, #4B0082) !important;
    border-color: #FF0000 !important;
    box-shadow: 0 0 10px rgba(139, 0, 0, 0.8);
    text-shadow: 0 1px 3px rgba(255,255,255,.3);
    color: #FFD700 !important;
  }
  
  .demon-valid {
    background: #4B0082 !important;
    border-color: #8B0000 !important;
    box-shadow: 0 0 15px rgba(139, 0, 0, 0.9);
  }
  
  .demon-piece:hover {
    background: linear-gradient(135deg, #4B0082, #8B0000) !important;
    transform: scale(1.1);
    box-shadow: 0 0 20px rgba(139, 0, 0, 1);
  }

  /* Ê∞∑„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .ice-piece {
    background: linear-gradient(135deg, #E0F6FF, #B0E0E6) !important;
    border-color: #4682B4 !important;
    box-shadow: 0 0 10px rgba(70, 130, 180, 0.8);
    text-shadow: 0 1px 3px rgba(0,0,0,.3);
    color: #2F4F4F !important;
  }

  .ice-piece:hover {
    background: linear-gradient(135deg, #F0F8FF, #E0F6FF) !important;
    transform: scale(1.05);
    box-shadow: 0 0 15px rgba(70, 130, 180, 0.9);
  }

  .ice-valid {
    background: linear-gradient(135deg, #E0F6FF, #B0E0E6) !important;
    border-color: #4682B4 !important;
    box-shadow: inset 0 0 8px rgba(70, 130, 180, 0.5);
  }

  .ice-valid:hover {
    background: linear-gradient(135deg, #F0F8FF, #E0F6FF) !important;
    transform: scale(1.05);
    box-shadow: inset 0 0 12px rgba(70, 130, 180, 0.7);
  }

  /* ÂáçÁµêÁä∂ÊÖã„ÅÆ„Çπ„Çø„Ç§„É´ */
  .frozen {
    opacity: 0.6;
    filter: grayscale(0.3) brightness(0.8);
    position: relative;
  }

  .frozen::after {
    content: '‚ùÑÔ∏è';
    position: absolute;
    top: 2px;
    right: 2px;
    font-size: 12px;
    color: #4682B4;
    text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  }

  .spawn-mark {
    position: fixed;
    font-size: 28px;
    z-index: 1003;
    pointer-events: none;
    animation: treeSpawn 1.2s ease-in-out;
    filter: drop-shadow(0 0 10px #32CD32);
  }
  
  .leaf-mark {
    position: fixed;
    font-size: 20px;
    z-index: 1000;
    pointer-events: none;
    animation: leafScatter 1.5s ease-in-out;
    filter: drop-shadow(0 0 6px #228B22);
  }
  
  .leaf-push-mark {
    position: fixed;
    font-size: 24px;
    z-index: 1001;
    pointer-events: none;
    animation: leafPush 1.2s ease-in-out;
    filter: drop-shadow(0 0 8px #228B22);
  }
  
  .star-mark {
    position: fixed;
    font-size: 24px;
    z-index: 1000;
    pointer-events: none;
    animation: starFlow 1s ease-in-out;
    filter: drop-shadow(0 0 8px #FFD700);
  }
  
  .star-push-mark {
    position: fixed;
    font-size: 20px;
    z-index: 1002;
    pointer-events: none;
    animation: starPushEffect 0.8s ease-in-out;
    filter: drop-shadow(0 0 6px #FFD700);
  }
  
  .dark-mark {
    position: fixed;
    font-size: 24px;
    z-index: 1000;
    pointer-events: none;
    animation: darkAbsorptionEffect 1s ease-in-out forwards;
    filter: drop-shadow(0 0 12px #000000);
  }
  
  .absorption-mark {
    position: fixed;
    font-size: 24px;
    z-index: 1001;
    pointer-events: none;
    animation: absorptionEffect 1s ease-in-out forwards;
    filter: drop-shadow(0 0 12px #000000);
  }

  .darkening-mark {
    position: fixed;
    font-size: 32px;
    z-index: 1002;
    pointer-events: none;
    animation: darkeningEffect 1.5s ease-in-out forwards;
    filter: drop-shadow(0 0 15px #000000);
  }

  .demon-mark {
    position: fixed;
    font-size: 24px;
    z-index: 1000;
    pointer-events: none;
    animation: demonDestructionEffect 1s ease-in-out forwards;
    filter: drop-shadow(0 0 12px #8B0000);
  }

  .demon-destruction-mark {
    position: fixed;
    font-size: 32px;
    z-index: 1002;
    pointer-events: none;
    animation: demonDestructionEffect 1.5s ease-in-out forwards;
    filter: drop-shadow(0 0 15px #FF0000);
  }

  /* Ëãî„ÅÆ„Çπ„Ç≠„É´„Ç®„Éï„Çß„ÇØ„ÉàÁî®„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes mossSpawn {
    0% { 
      transform: translate(-50%, -50%) scale(0) rotate(0deg);
      opacity: 0;
    }
    50% { 
      transform: translate(-50%, -50%) scale(1.2) rotate(180deg);
      opacity: 1;
    }
    100% { 
      transform: translate(-50%, -50%) scale(1) rotate(360deg);
      opacity: 1;
    }
  }

  @keyframes mossGrowth {
    0% { 
      transform: translate(-50%, -50%) scale(0);
      opacity: 0;
    }
    30% { 
      transform: translate(-50%, -50%) scale(1.5);
      opacity: 0.8;
    }
    70% { 
      transform: translate(-50%, -50%) scale(1.2);
      opacity: 1;
    }
    100% { 
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }
  }

  @keyframes mossTextFade {
    0% { 
      transform: translate(-50%, -50%) scale(0.8);
      opacity: 0;
    }
    20% { 
      transform: translate(-50%, -50%) scale(1.1);
      opacity: 1;
    }
    80% { 
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }
    100% { 
      transform: translate(-50%, -50%) scale(0.9);
      opacity: 0;
    }
  }

  @keyframes mossParticle {
    0% { 
      transform: translate(var(--start-x), var(--start-y)) scale(1);
      opacity: 1;
    }
    100% { 
      transform: translate(var(--end-x), var(--end-y)) scale(0);
      opacity: 0;
    }
  }

  @keyframes mossDecoration {
    0% { 
      transform: translate(-50%, -50%) scale(1) rotate(0deg);
      opacity: 1;
    }
    50% { 
      transform: translate(-50%, -50%) scale(1.3) rotate(180deg);
      opacity: 0.8;
    }
    100% { 
      transform: translate(-50%, -50%) scale(1) rotate(360deg);
      opacity: 1;
    }
  }

  /* È≠ö„ÅÆÊ∫∫„Çå„Çπ„Ç≠„É´„Ç®„Éï„Çß„ÇØ„ÉàÁî®„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes fishDrowning {
    0% { 
      transform: translate(-50%, -50%) scale(0) rotate(0deg);
      opacity: 0;
    }
    50% { 
      transform: translate(-50%, -50%) scale(1.3) rotate(180deg);
      opacity: 1;
    }
    100% { 
      transform: translate(-50%, -50%) scale(1) rotate(360deg);
      opacity: 1;
    }
  }

  @keyframes fishSmallDrops {
    0% { 
      transform: translate(-50%, -50%) scale(0);
      opacity: 0;
    }
    30% { 
      transform: translate(-50%, -50%) scale(1.5);
      opacity: 0.8;
    }
    70% { 
      transform: translate(-50%, -50%) scale(1.2);
      opacity: 1;
    }
    100% { 
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }
  }

  @keyframes fishSkillText {
    0% { 
      transform: translate(-50%, -50%) scale(0.8);
      opacity: 0;
    }
    20% { 
      transform: translate(-50%, -50%) scale(1.2);
      opacity: 1;
    }
    80% { 
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }
    100% { 
      transform: translate(-50%, -50%) scale(0.9);
      opacity: 0;
    }
  }

  @keyframes fishDrowningText {
    0% { 
      transform: translate(-50%, -50%) scale(0.8);
      opacity: 0;
    }
    20% { 
      transform: translate(-50%, -50%) scale(1.1);
      opacity: 1;
    }
    80% { 
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }
    100% { 
      transform: translate(-50%, -50%) scale(0.9);
      opacity: 0;
    }
  }

  @keyframes fishWaveEffect {
    0% { 
      transform: translate(-50%, -50%) scale(1) rotate(0deg);
      opacity: 1;
    }
    50% { 
      transform: translate(-50%, -50%) scale(1.4) rotate(180deg);
      opacity: 0.7;
    }
    100% { 
      transform: translate(-50%, -50%) scale(1) rotate(360deg);
      opacity: 1;
    }
  }

  @keyframes fishParticle {
    0% { 
      transform: translate(var(--start-x), var(--start-y)) scale(1);
      opacity: 1;
    }
    100% { 
      transform: translate(var(--end-x), var(--end-y)) scale(0);
      opacity: 0;
    }
  }

  /* Ê∫∫„ÇåÁä∂ÊÖã„ÅÆÈßí„ÅÆ„Çπ„Çø„Ç§„É´ */
  .piece.drowned-piece,
  .drowned-piece {
    opacity: 0.7 !important;
    filter: hue-rotate(180deg) saturate(1.5) !important;
    border: 3px solid #00BFFF !important;
    box-shadow: 0 0 15px #00BFFF, inset 0 0 10px #00BFFF !important;
    background-color: rgba(0, 191, 255, 0.2) !important;
    color: #0066CC !important;
    transform: scale(1.05) !important;
    transition: all 0.3s ease !important;
    position: relative !important;
    overflow: visible !important;
  }

  /* Ê∫∫„ÇåÁä∂ÊÖã„ÅÆÈßí„ÅÆ„Éõ„Éê„ÉºÂäπÊûú */
  .piece.drowned-piece:hover,
  .drowned-piece:hover {
    box-shadow: 0 0 25px #00BFFF, inset 0 0 15px #00BFFF !important;
    transform: scale(1.1) !important;
  }

  /* Ê∫∫„ÇåÁä∂ÊÖã„ÅÆÈßí„ÅÆ„ÉÜ„Ç≠„Çπ„ÉàËâ≤„ÇíÂº∑Âà∂ */
  .piece.drowned-piece,
  .drowned-piece {
    color: #0066CC !important;
    text-shadow: 0 0 5px #00BFFF !important;
  }

  /* Ê∞¥„Éû„Éº„ÇØ„ÅÆÊµÆÈÅä„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes waterMarkFloat {
    0% { 
      transform: translateY(0px) scale(1);
      opacity: 1;
    }
    25% { 
      transform: translateY(-3px) scale(1.1);
      opacity: 0.9;
    }
    50% { 
      transform: translateY(-6px) scale(1.2);
      opacity: 0.8;
    }
    75% { 
      transform: translateY(-3px) scale(1.1);
      opacity: 0.9;
    }
    100% { 
      transform: translateY(0px) scale(1);
      opacity: 1;
    }
  }

  /* Ê∫∫„ÇåÁä∂ÊÖã„ÅÆÈßí„ÅÆÂº∑Ë™øË°®Á§∫ */
  .drowned-piece {
    position: relative;
    overflow: visible;
  }

  /* Âπª„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.phantom-piece {
    background: linear-gradient(45deg, #9370DB, #8A2BE2, #9370DB) !important;
    background-size: 200% 200% !important;
    border: 3px solid #9370DB !important;
    box-shadow: 
      0 0 20px rgba(147, 112, 219, 0.8), 
      inset 0 0 15px rgba(138, 43, 226, 0.4),
      0 0 30px rgba(147, 112, 219, 0.6) !important;
    animation: phantomGlow 3s ease-in-out infinite, phantomFloat 4s ease-in-out infinite !important;
    position: relative !important;
    border-radius: 50% !important;
  }
  
  /* Êïµ„ÅÆÂπª„ÅÆÈßí„ÅÆÂõûËª¢ÂäπÊûú */
  .piece.phantom-piece.computer {
    transform: rotate(180deg) !important;
  }
  
  .piece.phantom-piece::before {
    content: '‚ú®';
    position: absolute;
    top: -8px;
    right: -8px;
    font-size: 16px;
    z-index: 10;
    text-shadow: 0 0 5px rgba(147, 112, 219, 0.8);
    animation: phantomSparkle 2s ease-in-out infinite alternate;
  }
  
  .piece.phantom-piece::after {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    border: 2px solid rgba(147, 112, 219, 0.6);
    border-radius: 50%;
    animation: phantomPulse 2s ease-in-out infinite;
    pointer-events: none;
  }

  /* Èúß„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.mist-piece {
    background: linear-gradient(45deg, #B0C4DE, #87CEEB, #B0C4DE) !important;
    background-size: 200% 200% !important;
    border: 3px solid #B0C4DE !important;
    box-shadow: 
      0 0 20px rgba(176, 196, 222, 0.8), 
      inset 0 0 15px rgba(135, 206, 235, 0.4),
      0 0 30px rgba(176, 196, 222, 0.6) !important;
    animation: mistGlow 3s ease-in-out infinite, mistFloat 4s ease-in-out infinite !important;
    position: relative !important;
    border-radius: 50% !important;
  }
  
  /* Êïµ„ÅÆÈúß„ÅÆÈßí„ÅÆÂõûËª¢ÂäπÊûú */
  .piece.mist-piece.computer {
    transform: rotate(180deg) !important;
  }
  
  .piece.mist-piece::before {
    content: 'üå´Ô∏è';
    position: absolute;
    top: -8px;
    right: -8px;
    font-size: 16px;
    z-index: 10;
    text-shadow: 0 0 5px rgba(176, 196, 222, 0.8);
    animation: mistFog 2s ease-in-out infinite alternate;
  }
  
  .piece.mist-piece::after {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    border: 2px solid rgba(176, 196, 222, 0.6);
    border-radius: 50%;
    animation: mistPulse 2s ease-in-out infinite;
    pointer-events: none;
  }

  /* Âπª„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes phantomGlow {
    0%, 100% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 20px rgba(147, 112, 219, 0.8), 
        inset 0 0 15px rgba(138, 43, 226, 0.4),
        0 0 30px rgba(147, 112, 219, 0.6);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 25px rgba(147, 112, 219, 1), 
        inset 0 0 20px rgba(138, 43, 226, 0.6),
        0 0 35px rgba(147, 112, 219, 0.8);
    }
  }
  
  @keyframes phantomFloat {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    25% { transform: translateY(-3px) rotate(1deg); }
    50% { transform: translateY(-6px) rotate(0deg); }
    75% { transform: translateY(-3px) rotate(-1deg); }
  }
  
  @keyframes phantomSparkle {
    0% { opacity: 0.6; transform: scale(0.8); }
    100% { opacity: 1; transform: scale(1.2); }
  }
  
  @keyframes phantomPulse {
    0% { 
      opacity: 0.6; 
      transform: scale(0.8);
      border-color: rgba(147, 112, 219, 0.6);
    }
    50% { 
      opacity: 1; 
      transform: scale(1.1);
      border-color: rgba(147, 112, 219, 1);
    }
    100% { 
      opacity: 0.6; 
      transform: scale(0.8);
      border-color: rgba(147, 112, 219, 0.6);
    }
  }

  /* Èúß„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes mistGlow {
    0%, 100% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 20px rgba(176, 196, 222, 0.8), 
        inset 0 0 15px rgba(135, 206, 235, 0.4),
        0 0 30px rgba(176, 196, 222, 0.6);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 25px rgba(176, 196, 222, 1), 
        inset 0 0 20px rgba(135, 206, 235, 0.6),
        0 0 35px rgba(176, 196, 222, 0.8);
    }
  }
  
  @keyframes mistFloat {
    0%, 100% { transform: translateY(0px) translateX(0px); }
    25% { transform: translateY(-2px) translateX(1px); }
    50% { transform: translateY(-4px) translateX(0px); }
    75% { transform: translateY(-2px) translateX(-1px); }
  }
  
  @keyframes mistFog {
    0% { opacity: 0.6; transform: scale(0.8) rotate(0deg); }
    100% { opacity: 1; transform: scale(1.2) rotate(5deg); }
  }
  
  @keyframes mistPulse {
    0% { 
      opacity: 0.6; 
      transform: scale(0.8);
      border-color: rgba(176, 196, 222, 0.6);
    }
    50% { 
      opacity: 1; 
      transform: scale(1.1);
      border-color: rgba(176, 196, 222, 1);
    }
    100% { 
      opacity: 0.6; 
      transform: scale(0.8);
      border-color: rgba(176, 196, 222, 0.6);
    }
  }

  /* Êúà„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.moon-piece {
    background: linear-gradient(45deg, #F0E68C, #FFD700, #FFA500, #F0E68C) !important;
    background-size: 300% 300% !important;
    border: 3px solid #FFD700 !important;
    box-shadow: 
      0 0 25px rgba(255, 215, 0, 0.9), 
      inset 0 0 20px rgba(255, 165, 0, 0.5),
      0 0 40px rgba(240, 230, 140, 0.7) !important;
    animation: moonGlow 4s ease-in-out infinite, moonFloat 5s ease-in-out infinite !important;
    position: relative !important;
    border-radius: 50% !important;
  }
  
  /* Êïµ„ÅÆÊúà„ÅÆÈßí„ÅÆÂõûËª¢ÂäπÊûú */
  .piece.moon-piece.computer {
    transform: rotate(180deg) !important;
  }
  
  .piece.moon-piece::before {
    content: 'üåô';
    position: absolute;
    top: -8px;
    right: -8px;
    font-size: 16px;
    z-index: 10;
    text-shadow: 0 0 8px rgba(255, 215, 0, 1);
    animation: moonSparkle 2.5s ease-in-out infinite alternate;
  }
  
  .piece.moon-piece::after {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    border: 2px solid rgba(255, 215, 0, 0.8);
    border-radius: 50%;
    animation: moonPulse 2.5s ease-in-out infinite;
    pointer-events: none;
  }

  /* Ê©ü„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.machine-piece {
    background: linear-gradient(45deg, #C0C0C0, #E8E8E8, #A0A0A0, #F0F0F0) !important;
    background-size: 300% 300% !important;
    border: 3px solid #808080 !important;
    box-shadow: 
      0 0 25px rgba(192, 192, 192, 0.9), 
      inset 0 0 20px rgba(128, 128, 128, 0.5),
      0 0 40px rgba(160, 160, 160, 0.7) !important;
    animation: machineGlow 3s ease-in-out infinite, machinePulse 2s ease-in-out infinite !important;
    position: relative !important;
    border-radius: 15% !important;
  }
  
  /* Êïµ„ÅÆÊ©ü„ÅÆÈßí„ÅÆÂõûËª¢ÂäπÊûú */
  .piece.machine-piece.computer {
    transform: rotate(180deg) !important;
  }
  
  .piece.machine-piece::before {
    content: '‚öôÔ∏è';
    position: absolute;
    top: -8px;
    right: -8px;
    font-size: 16px;
    z-index: 10;
    text-shadow: 0 0 8px rgba(192, 192, 192, 1);
    animation: machineRotate 2s linear infinite;
  }
  
  .piece.machine-piece::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 120%;
    height: 120%;
    background: radial-gradient(circle, rgba(192, 192, 192, 0.3) 0%, transparent 70%);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    z-index: -1;
    animation: machineAura 4s ease-in-out infinite;
  }
  
  /* Ê©ü„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes machineGlow {
    0%, 100% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 25px rgba(192, 192, 192, 0.9), 
        inset 0 0 20px rgba(128, 128, 128, 0.5),
        0 0 40px rgba(160, 160, 160, 0.7);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 35px rgba(224, 224, 224, 1), 
        inset 0 0 25px rgba(96, 96, 96, 0.6),
        0 0 50px rgba(180, 180, 180, 0.8);
    }
  }
  
  @keyframes machinePulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }
  
  @keyframes machineRotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  @keyframes machineAura {
    0%, 100% { 
      opacity: 0.3;
      transform: translate(-50%, -50%) scale(1);
    }
    50% { 
      opacity: 0.6;
      transform: translate(-50%, -50%) scale(1.2);
    }
  }

  /* Ê≠Ø„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.gear-piece {
    background: linear-gradient(45deg, #8B4513, #A0522D, #D2691E, #CD853F) !important;
    background-size: 300% 300% !important;
    border: 3px solid #654321 !important;
    box-shadow: 
      0 0 25px rgba(139, 69, 19, 0.9), 
      inset 0 0 20px rgba(101, 67, 33, 0.5),
      0 0 40px rgba(160, 82, 45, 0.7) !important;
    animation: gearGlow 2.5s ease-in-out infinite, gearVibrate 0.1s ease-in-out infinite !important;
    position: relative !important;
    border-radius: 25% !important;
  }
  
  /* Êïµ„ÅÆÊ≠Ø„ÅÆÈßí„ÅÆÂõûËª¢ÂäπÊûú */
  .piece.gear-piece.computer {
    transform: rotate(180deg) !important;
  }
  
  .piece.gear-piece::before {
    content: '‚öôÔ∏è';
    position: absolute;
    top: -8px;
    right: -8px;
    font-size: 16px;
    z-index: 10;
    text-shadow: 0 0 8px rgba(139, 69, 19, 1);
    animation: gearSpin 1.5s linear infinite;
  }
  
  .piece.gear-piece::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 110%;
    height: 110%;
    background: radial-gradient(circle, rgba(139, 69, 19, 0.4) 0%, transparent 70%);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    z-index: -1;
    animation: gearRipple 3s ease-in-out infinite;
  }
  
  /* Ê≠Ø„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes gearGlow {
    0%, 100% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 25px rgba(139, 69, 19, 0.9), 
        inset 0 0 20px rgba(101, 67, 33, 0.5),
        0 0 40px rgba(160, 82, 45, 0.7);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 35px rgba(205, 133, 63, 1), 
        inset 0 0 25px rgba(139, 69, 19, 0.6),
        0 0 50px rgba(210, 105, 30, 0.8);
    }
  }
  
  @keyframes gearVibrate {
    0%, 100% { transform: translateX(0px); }
    25% { transform: translateX(-1px); }
    75% { transform: translateX(1px); }
  }
  
  @keyframes gearSpin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  @keyframes gearRipple {
    0%, 100% { 
      opacity: 0.4;
      transform: translate(-50%, -50%) scale(1);
    }
    50% { 
      opacity: 0.7;
      transform: translate(-50%, -50%) scale(1.1);
    }
  }

  /* Ëàü„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.boat-piece {
    background: linear-gradient(45deg, #87CEEB, #4682B4, #5F9EA0, #87CEEB) !important;
    background-size: 300% 300% !important;
    border: 3px solid #4682B4 !important;
    box-shadow: 
      0 0 25px rgba(135, 206, 235, 0.9), 
      inset 0 0 20px rgba(70, 130, 180, 0.5),
      0 0 40px rgba(95, 158, 160, 0.7) !important;
    animation: boatGlow 3.5s ease-in-out infinite, boatFloat 4.5s ease-in-out infinite !important;
    position: relative !important;
    border-radius: 15px !important;
  }
  
  /* Êïµ„ÅÆËàü„ÅÆÈßí„ÅÆÂõûËª¢ÂäπÊûú */
  .piece.boat-piece.computer {
    transform: rotate(180deg) !important;
  }
  
  .piece.boat-piece::before {
    content: '‚õµ';
    position: absolute;
    top: -8px;
    right: -8px;
    font-size: 16px;
    z-index: 10;
    text-shadow: 0 0 8px rgba(135, 206, 235, 1);
    animation: boatWave 2s ease-in-out infinite alternate;
  }
  
  .piece.boat-piece::after {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    border: 2px solid rgba(135, 206, 235, 0.8);
    border-radius: 15px;
    animation: boatPulse 2s ease-in-out infinite;
    pointer-events: none;
  }

  /* Êúà„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes moonGlow {
    0%, 100% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 25px rgba(255, 215, 0, 0.9), 
        inset 0 0 20px rgba(255, 165, 0, 0.5),
        0 0 40px rgba(240, 230, 140, 0.7);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 35px rgba(255, 215, 0, 1.2), 
        inset 0 0 25px rgba(255, 165, 0, 0.7),
        0 0 50px rgba(240, 230, 140, 0.9);
    }
  }
  
  @keyframes moonFloat {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    25% { transform: translateY(-4px) rotate(2deg); }
    50% { transform: translateY(-8px) rotate(0deg); }
    75% { transform: translateY(-4px) rotate(-2deg); }
  }
  
  @keyframes moonSparkle {
    0% { opacity: 0.7; transform: scale(0.9) rotate(0deg); }
    100% { opacity: 1; transform: scale(1.3) rotate(10deg); }
  }
  
  @keyframes moonPulse {
    0% { 
      opacity: 0.7; 
      transform: scale(0.9);
      border-color: rgba(255, 215, 0, 0.8);
    }
    50% { 
      opacity: 1; 
      transform: scale(1.2);
      border-color: rgba(255, 215, 0, 1);
    }
    100% { 
      opacity: 0.7; 
      transform: scale(0.9);
      border-color: rgba(255, 215, 0, 0.8);
    }
  }

  /* Ëàü„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes boatGlow {
    0%, 100% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 25px rgba(135, 206, 235, 0.9), 
        inset 0 0 20px rgba(70, 130, 180, 0.5),
        0 0 40px rgba(95, 158, 160, 0.7);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 35px rgba(135, 206, 235, 1.2), 
        inset 0 0 25px rgba(70, 130, 180, 0.7),
        0 0 50px rgba(95, 158, 160, 0.9);
    }
  }
  
  @keyframes boatFloat {
    0%, 100% { transform: translateY(0px) translateX(0px) rotate(0deg); }
    25% { transform: translateY(-3px) translateX(2px) rotate(1deg); }
    50% { transform: translateY(-6px) translateX(0px) rotate(0deg); }
    75% { transform: translateY(-3px) translateX(-2px) rotate(-1deg); }
  }
  
  @keyframes boatWave {
    0% { opacity: 0.7; transform: scale(0.9) rotate(-5deg); }
    100% { opacity: 1; transform: scale(1.2) rotate(5deg); }
  }
  
  @keyframes boatPulse {
    0% { 
      opacity: 0.7; 
      transform: scale(0.9);
      border-color: rgba(135, 206, 235, 0.8);
    }
    50% { 
      opacity: 1; 
      transform: scale(1.1);
      border-color: rgba(135, 206, 235, 1);
    }
    100% { 
      opacity: 0.7; 
      transform: scale(0.9);
      border-color: rgba(135, 206, 235, 0.8);
    }
  }

  /* ÂÆ∂„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.house-piece {
    background: linear-gradient(45deg, #8B4513, #A0522D, #8B4513) !important;
    background-size: 200% 200% !important;
    border: 3px solid #8B4513 !important;
    box-shadow: 
      0 0 20px rgba(139, 69, 19, 0.8), 
      inset 0 0 15px rgba(160, 82, 45, 0.4),
      0 0 30px rgba(139, 69, 19, 0.6) !important;
    animation: houseGlow 3s ease-in-out infinite, houseWarmth 4s ease-in-out infinite !important;
    position: relative !important;
    border-radius: 8px !important;
  }
  
  /* Êïµ„ÅÆÂÆ∂„ÅÆÈßí„ÅÆÂõûËª¢ÂäπÊûú */
  .piece.house-piece.computer {
    transform: rotate(180deg) !important;
  }
  
  .piece.house-piece::before {
    content: 'üè†';
    position: absolute;
    top: -8px;
    right: -8px;
    font-size: 16px;
    z-index: 10;
    text-shadow: 0 0 5px rgba(139, 69, 19, 0.8);
    animation: houseSparkle 2s ease-in-out infinite alternate;
  }
  
  .piece.house-piece::after {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    border: 2px solid rgba(139, 69, 19, 0.6);
    border-radius: 8px;
    animation: housePulse 2s ease-in-out infinite;
    pointer-events: none;
  }

  /* Ê∞ë„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.people-piece {
    background: linear-gradient(45deg, #4169E1, #1E90FF, #4169E1) !important;
    background-size: 200% 200% !important;
    border: 3px solid #4169E1 !important;
    box-shadow: 
      0 0 20px rgba(65, 105, 225, 0.8), 
      inset 0 0 15px rgba(30, 144, 255, 0.4),
      0 0 30px rgba(65, 105, 225, 0.6) !important;
    animation: peopleGlow 3s ease-in-out infinite, peoplePeace 4s ease-in-out infinite !important;
    position: relative !important;
    border-radius: 50% !important;
  }
  
  /* Êïµ„ÅÆÊ∞ë„ÅÆÈßí„ÅÆÂõûËª¢ÂäπÊûú */
  .piece.people-piece.computer {
    transform: rotate(180deg) !important;
  }
  
  .piece.people-piece::before {
    content: 'üë•';
    position: absolute;
    top: -8px;
    right: -8px;
    font-size: 16px;
    z-index: 10;
    text-shadow: 0 0 5px rgba(65, 105, 225, 0.8);
    animation: peopleSparkle 2s ease-in-out infinite alternate;
  }
  
  .piece.people-piece::after {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    border: 2px solid rgba(65, 105, 225, 0.6);
    border-radius: 50%;
    animation: peoplePulse 2s ease-in-out infinite;
    pointer-events: none;
  }

  /* Áïë„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.field-piece {
    background: linear-gradient(45deg, #228B22, #32CD32, #228B22) !important;
    background-size: 200% 200% !important;
    border: 3px solid #228B22 !important;
    box-shadow: 
      0 0 20px rgba(34, 139, 34, 0.8), 
      inset 0 0 15px rgba(50, 205, 50, 0.4),
      0 0 30px rgba(34, 139, 34, 0.6) !important;
    animation: fieldGlow 3s ease-in-out infinite, fieldGrowth 4s ease-in-out infinite !important;
    position: relative !important;
    border-radius: 8px !important;
  }
  
  /* Êïµ„ÅÆÁïë„ÅÆÈßí„ÅÆÂõûËª¢ÂäπÊûú */
  .piece.field-piece.computer {
    transform: rotate(180deg) !important;
  }
  
  .piece.field-piece::before {
    content: 'üåæ';
    position: absolute;
    top: -8px;
    right: -8px;
    font-size: 16px;
    z-index: 10;
    text-shadow: 0 0 5px rgba(34, 139, 34, 0.8);
    animation: fieldSparkle 2s ease-in-out infinite alternate;
  }
  
  .piece.field-piece::after {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    border: 2px solid rgba(34, 139, 34, 0.6);
    border-radius: 8px;
    animation: fieldPulse 2s ease-in-out infinite;
    pointer-events: none;
  }

  /* Êúà„ÅÆ„Çπ„Ç≠„É´Áô∫Âãï„Ç®„Éï„Çß„ÇØ„Éà */
  @keyframes moonSkillActivation {
    0% { 
      transform: scale(1) rotate(0deg);
      box-shadow: 0 0 30px rgba(255, 215, 0, 1), 0 0 60px rgba(255, 165, 0, 0.8);
      opacity: 1;
      filter: brightness(1);
    }
    25% { 
      transform: scale(1.4) rotate(90deg);
      box-shadow: 0 0 50px rgba(255, 215, 0, 1.5), 0 0 100px rgba(255, 165, 0, 1.2);
      opacity: 0.9;
      filter: brightness(1.5);
    }
    50% { 
      transform: scale(1.8) rotate(180deg);
      box-shadow: 0 0 80px rgba(255, 215, 0, 2), 0 0 150px rgba(255, 165, 0, 1.5);
      opacity: 0.7;
      filter: brightness(2);
    }
    75% { 
      transform: scale(1.4) rotate(270deg);
      box-shadow: 0 0 50px rgba(255, 215, 0, 1.5), 0 0 100px rgba(255, 165, 0, 1.2);
      opacity: 0.9;
      filter: brightness(1.5);
    }
    100% { 
      transform: scale(1) rotate(360deg);
      box-shadow: 0 0 30px rgba(255, 215, 0, 1), 0 0 60px rgba(255, 165, 0, 0.8);
      opacity: 1;
      filter: brightness(1);
    }
  }
  
  /* Êúà„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÊôÇ„ÅÆÂÖâ„ÅÆÊ≥¢Á¥ã„Ç®„Éï„Çß„ÇØ„Éà */
  @keyframes moonSkillRipple {
    0% { 
      transform: scale(0) rotate(0deg);
      opacity: 1;
      box-shadow: 0 0 0 rgba(255, 215, 0, 0);
    }
    50% { 
      transform: scale(2) rotate(180deg);
      opacity: 0.8;
      box-shadow: 0 0 50px rgba(255, 215, 0, 0.8);
    }
    100% { 
      transform: scale(4) rotate(360deg);
      opacity: 0;
      box-shadow: 0 0 100px rgba(255, 215, 0, 0);
    }
  }
  
  /* Êúà„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÊôÇ„ÅÆ„Éë„Éº„ÉÜ„Ç£„ÇØ„É´„Ç®„Éï„Çß„ÇØ„Éà */
  @keyframes moonSkillParticles {
    0% { 
      transform: translate(-50%, -50%) scale(0) rotate(0deg);
      opacity: 1;
    }
    25% { 
      transform: translate(-50%, -50%) scale(1) rotate(90deg);
      opacity: 0.8;
    }
    50% { 
      transform: translate(-50%, -50%) scale(1.5) rotate(180deg);
      opacity: 0.6;
    }
    75% { 
      transform: translate(-50%, -50%) scale(1) rotate(270deg);
      opacity: 0.4;
    }
    100% { 
      transform: translate(-50%, -50%) scale(0) rotate(360deg);
      opacity: 0;
    }
  }

  /* Ëàü„ÅÆ„Çπ„Ç≠„É´Áô∫Âãï„Ç®„Éï„Çß„ÇØ„Éà */
  @keyframes boatSkillActivation {
    0% { 
      transform: scale(1) rotate(0deg);
      box-shadow: 0 0 25px rgba(135, 206, 235, 0.9), 0 0 50px rgba(70, 130, 180, 0.7);
      opacity: 1;
      filter: brightness(1);
    }
    25% { 
      transform: scale(1.3) rotate(5deg);
      box-shadow: 0 0 40px rgba(135, 206, 235, 1.2), 0 0 80px rgba(70, 130, 180, 1);
      opacity: 0.9;
      filter: brightness(1.3);
    }
    50% { 
      transform: scale(1.6) rotate(0deg);
      box-shadow: 0 0 60px rgba(135, 206, 235, 1.5), 0 0 120px rgba(70, 130, 180, 1.2);
      opacity: 0.8;
      filter: brightness(1.6);
    }
    75% { 
      transform: scale(1.3) rotate(-5deg);
      box-shadow: 0 0 40px rgba(135, 206, 235, 1.2), 0 0 80px rgba(70, 130, 180, 1);
      opacity: 0.9;
      filter: brightness(1.3);
    }
    100% { 
      transform: scale(1) rotate(0deg);
      box-shadow: 0 0 25px rgba(135, 206, 235, 0.9), 0 0 50px rgba(70, 130, 180, 0.7);
      opacity: 1;
      filter: brightness(1);
    }
  }
  
  /* Ëàü„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÊôÇ„ÅÆÊ∞¥„ÅÆÊ≥¢Á¥ã„Ç®„Éï„Çß„ÇØ„Éà */
  @keyframes boatSkillRipple {
    0% { 
      transform: scale(0) rotate(0deg);
      opacity: 1;
      box-shadow: 0 0 0 rgba(135, 206, 235, 0);
    }
    50% { 
      transform: scale(2.5) rotate(180deg);
      opacity: 0.7;
      box-shadow: 0 0 60px rgba(135, 206, 235, 0.8);
    }
    100% { 
      transform: scale(5) rotate(360deg);
      opacity: 0;
      box-shadow: 0 0 120px rgba(135, 206, 235, 0);
    }
  }
  
  /* Ëàü„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÊôÇ„ÅÆÊ≥¢„Ç®„Éï„Çß„ÇØ„Éà */
  @keyframes boatSkillWaves {
    0% { 
      transform: translate(-50%, -50%) scale(0) rotate(0deg);
      opacity: 1;
    }
    25% { 
      transform: translate(-50%, -50%) scale(1) rotate(5deg);
      opacity: 0.8;
    }
    50% { 
      transform: translate(-50%, -50%) scale(1.5) rotate(0deg);
      opacity: 0.6;
    }
    75% { 
      transform: translate(-50%, -50%) scale(1) rotate(-5deg);
      opacity: 0.4;
    }
    100% { 
      transform: translate(-50%, -50%) scale(0) rotate(0deg);
      opacity: 0;
    }
  }
  
  /* Ëàü„ÅÆÂæåÁ∂öÈßíÊ∂àÂ§±„Ç®„Éï„Çß„ÇØ„Éà */
  @keyframes boatSkillDisappear {
    0% { 
      transform: scale(1) rotate(0deg);
      opacity: 1;
      filter: brightness(1);
    }
    50% { 
      transform: scale(0.5) rotate(180deg);
      opacity: 0.5;
      filter: brightness(0.5);
    }
    100% { 
      transform: scale(0) rotate(360deg);
      opacity: 0;
      filter: brightness(0);
    }
  }
  
  /* Ëàü„ÅÆÂæåÁ∂öÈßíÂá∫Áèæ„Ç®„Éï„Çß„ÇØ„Éà */
  @keyframes boatSkillAppear {
    0% { 
      transform: scale(0) rotate(0deg);
      opacity: 0;
      filter: brightness(0);
    }
    50% { 
      transform: scale(1.2) rotate(180deg);
      opacity: 0.8;
      filter: brightness(1.2);
    }
    100% { 
      transform: scale(1) rotate(360deg);
      opacity: 1;
      filter: brightness(1);
    }
  }

  /* Âπª„ÅÆÂõûÈÅø„Ç®„Éï„Çß„ÇØ„Éà */
  @keyframes phantomEvasion {
    0% { 
      transform: scale(1) rotate(0deg);
      box-shadow: 0 0 20px rgba(147, 112, 219, 0.8);
      opacity: 1;
    }
    25% { 
      transform: scale(1.3) rotate(90deg);
      box-shadow: 0 0 30px rgba(147, 112, 219, 1);
      opacity: 0.8;
    }
    50% { 
      transform: scale(1.5) rotate(180deg);
      box-shadow: 0 0 40px rgba(147, 112, 219, 1.2);
      opacity: 0.6;
    }
    75% { 
      transform: scale(1.3) rotate(270deg);
      box-shadow: 0 0 30px rgba(147, 112, 219, 1);
      opacity: 0.8;
    }
    100% { 
      transform: scale(1) rotate(360deg);
      box-shadow: 0 0 20px rgba(147, 112, 219, 0.8);
      opacity: 1;
    }
  }

  /* Âπª„ÅÆ„Çπ„Ç≠„É´Áô∫Âãï„Ç®„Éï„Çß„ÇØ„Éà */
  @keyframes phantomSkillActivation {
    0% { 
      transform: scale(1) rotate(0deg);
      box-shadow: 0 0 30px rgba(147, 112, 219, 1), 0 0 60px rgba(138, 43, 226, 0.8);
      opacity: 1;
      filter: brightness(1);
    }
    25% { 
      transform: scale(1.4) rotate(90deg);
      box-shadow: 0 0 50px rgba(147, 112, 219, 1.5), 0 0 100px rgba(138, 43, 226, 1.2);
      opacity: 0.9;
      filter: brightness(1.5);
    }
    50% { 
      transform: scale(1.8) rotate(180deg);
      box-shadow: 0 0 80px rgba(147, 112, 219, 2), 0 0 150px rgba(138, 43, 226, 1.5);
      opacity: 0.7;
      filter: brightness(2);
    }
    75% { 
      transform: scale(1.4) rotate(270deg);
      box-shadow: 0 0 50px rgba(147, 112, 219, 1.5), 0 0 100px rgba(138, 43, 226, 1.2);
      opacity: 0.9;
      filter: brightness(1.5);
    }
    100% { 
      transform: scale(1) rotate(360deg);
      box-shadow: 0 0 30px rgba(147, 112, 219, 1), 0 0 60px rgba(138, 43, 226, 0.8);
      opacity: 1;
      filter: brightness(1);
    }
  }

  /* Âπª„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÊôÇ„ÅÆÂÖâ„ÅÆÊ≥¢Á¥ã„Ç®„Éï„Çß„ÇØ„Éà */
  @keyframes phantomSkillRipple {
    0% { 
      transform: scale(0) rotate(0deg);
      opacity: 1;
      box-shadow: 0 0 0 rgba(147, 112, 219, 0);
    }
    50% { 
      transform: scale(2) rotate(180deg);
      opacity: 0.8;
      box-shadow: 0 0 50px rgba(147, 112, 219, 0.8);
    }
    100% { 
      transform: scale(4) rotate(360deg);
      opacity: 0;
      box-shadow: 0 0 100px rgba(147, 112, 219, 0);
    }
  }

  /* Âπª„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÊôÇ„ÅÆ„Éë„Éº„ÉÜ„Ç£„ÇØ„É´„Ç®„Éï„Çß„ÇØ„Éà */
  @keyframes phantomSkillParticles {
    0% { 
      transform: translate(-50%, -50%) scale(0) rotate(0deg);
      opacity: 1;
    }
    25% { 
      transform: translate(-50%, -50%) scale(1) rotate(90deg);
      opacity: 0.8;
    }
    50% { 
      transform: translate(-50%, -50%) scale(1.5) rotate(180deg);
      opacity: 0.6;
    }
    75% { 
      transform: translate(-50%, -50%) scale(1) rotate(270deg);
      opacity: 0.4;
    }
    100% { 
      transform: translate(-50%, -50%) scale(0) rotate(360deg);
      opacity: 0;
    }
  }

  /* Èúß„ÅÆ„Çπ„Ç≠„É´Áô∫Âãï„Ç®„Éï„Çß„ÇØ„Éà */
  @keyframes mistSkillActivation {
    0% { 
      transform: scale(1) rotate(0deg);
      box-shadow: 0 0 20px rgba(176, 196, 222, 0.8), 0 0 40px rgba(135, 206, 235, 0.6);
      opacity: 1;
      filter: brightness(1);
    }
    25% { 
      transform: scale(1.3) rotate(90deg);
      box-shadow: 0 0 40px rgba(176, 196, 222, 1.2), 0 0 80px rgba(135, 206, 235, 1);
      opacity: 0.9;
      filter: brightness(1.3);
    }
    50% { 
      transform: scale(1.6) rotate(180deg);
      box-shadow: 0 0 60px rgba(176, 196, 222, 1.5), 0 0 120px rgba(135, 206, 235, 1.2);
      opacity: 0.8;
      filter: brightness(1.6);
    }
    75% { 
      transform: scale(1.3) rotate(270deg);
      box-shadow: 0 0 40px rgba(176, 196, 222, 1.2), 0 0 80px rgba(135, 206, 235, 1);
      opacity: 0.9;
      filter: brightness(1.3);
    }
    100% { 
      transform: scale(1) rotate(360deg);
      box-shadow: 0 0 20px rgba(176, 196, 222, 0.8), 0 0 40px rgba(135, 206, 235, 0.6);
      opacity: 1;
      filter: brightness(1);
    }
  }

  /* Èúß„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÊôÇ„ÅÆÈúß„ÅÆÊ≥¢Á¥ã„Ç®„Éï„Çß„ÇØ„Éà */
  @keyframes mistSkillFog {
    0% { 
      transform: scale(0) rotate(0deg);
      opacity: 1;
      box-shadow: 0 0 0 rgba(176, 196, 222, 0);
    }
    50% { 
      transform: scale(2.5) rotate(180deg);
      opacity: 0.7;
      box-shadow: 0 0 60px rgba(176, 196, 222, 0.8);
    }
    100% { 
      transform: scale(5) rotate(360deg);
      opacity: 0;
      box-shadow: 0 0 120px rgba(176, 196, 222, 0);
    }
  }

  /* ÂÆ∂„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes houseGlow {
    0%, 100% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 20px rgba(139, 69, 19, 0.8), 
        inset 0 0 15px rgba(160, 82, 45, 0.4),
        0 0 30px rgba(139, 69, 19, 0.6);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 30px rgba(139, 69, 19, 1), 
        inset 0 0 20px rgba(160, 82, 45, 0.6),
        0 0 40px rgba(139, 69, 19, 0.8);
    }
  }
  
  @keyframes houseWarmth {
    0%, 100% { transform: translateY(0px) scale(1); }
    25% { transform: translateY(-2px) scale(1.02); }
    50% { transform: translateY(-4px) scale(1.05); }
    75% { transform: translateY(-2px) scale(1.02); }
  }
  
  @keyframes houseSparkle {
    0% { opacity: 0.7; transform: scale(0.9) rotate(0deg); }
    100% { opacity: 1; transform: scale(1.1) rotate(10deg); }
  }
  
  @keyframes housePulse {
    0% { 
      opacity: 0.7; 
      transform: scale(0.9);
      border-color: rgba(139, 69, 19, 0.8);
    }
    50% { 
      opacity: 1; 
      transform: scale(1.1);
      border-color: rgba(139, 69, 19, 1);
    }
    100% { 
      opacity: 0.7; 
      transform: scale(0.9);
      border-color: rgba(139, 69, 19, 0.8);
    }
  }

  /* Ê∞ë„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes peopleGlow {
    0%, 100% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 20px rgba(65, 105, 225, 0.8), 
        inset 0 0 15px rgba(30, 144, 255, 0.4),
        0 0 30px rgba(65, 105, 225, 0.6);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 30px rgba(65, 105, 225, 1), 
        inset 0 0 20px rgba(30, 144, 255, 0.6),
        0 0 40px rgba(65, 105, 225, 0.8);
    }
  }
  
  @keyframes peoplePeace {
    0%, 100% { transform: translateY(0px) scale(1); }
    25% { transform: translateY(-1px) scale(1.01); }
    50% { transform: translateY(-2px) scale(1.02); }
    75% { transform: translateY(-1px) scale(1.01); }
  }
  
  @keyframes peopleSparkle {
    0% { opacity: 0.7; transform: scale(0.9) rotate(0deg); }
    100% { opacity: 1; transform: scale(1.1) rotate(5deg); }
  }
  
  @keyframes peoplePulse {
    0% { 
      opacity: 0.7; 
      transform: scale(0.9);
      border-color: rgba(65, 105, 225, 0.8);
    }
    50% { 
      opacity: 1; 
      transform: scale(1.1);
      border-color: rgba(65, 105, 225, 1);
    }
    100% { 
      opacity: 0.7; 
      transform: scale(0.9);
      border-color: rgba(65, 105, 225, 0.8);
    }
  }

  /* Áïë„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes fieldGlow {
    0%, 100% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 20px rgba(34, 139, 34, 0.8), 
        inset 0 0 15px rgba(50, 205, 50, 0.4),
        0 0 30px rgba(34, 139, 34, 0.6);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 30px rgba(34, 139, 34, 1), 
        inset 0 0 20px rgba(50, 205, 50, 0.6),
        0 0 40px rgba(34, 139, 34, 0.8);
    }
  }
  
  @keyframes fieldGrowth {
    0%, 100% { transform: translateY(0px) scale(1); }
    25% { transform: translateY(-1px) scale(1.01); }
    50% { transform: translateY(-2px) scale(1.03); }
    75% { transform: translateY(-1px) scale(1.01); }
  }
  
  @keyframes fieldSparkle {
    0% { opacity: 0.7; transform: scale(0.9) rotate(0deg); }
    100% { opacity: 1; transform: scale(1.1) rotate(8deg); }
  }
  
  @keyframes fieldPulse {
    0% { 
      opacity: 0.7; 
      transform: scale(0.9);
      border-color: rgba(34, 139, 34, 0.8);
    }
    50% { 
      opacity: 1; 
      transform: scale(1.1);
      border-color: rgba(34, 139, 34, 1);
    }
    100% { 
      opacity: 0.7; 
      transform: scale(0.9);
      border-color: rgba(34, 139, 34, 0.8);
    }
  }

  /* Ê≥â„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà */
  .piece.spring-piece {
    background: linear-gradient(45deg, #00BFFF, #87CEEB, #00BFFF) !important;
    background-size: 200% 200% !important;
    border: 3px solid #00BFFF !important;
    box-shadow: 
      0 0 20px rgba(0, 191, 255, 0.8), 
      inset 0 0 15px rgba(135, 206, 235, 0.4),
      0 0 30px rgba(0, 191, 255, 0.6) !important;
    animation: springGlow 3s ease-in-out infinite, springFlow 4s ease-in-out infinite !important;
    position: relative !important;
    border-radius: 50% !important;
  }
  
  /* Êïµ„ÅÆÊ≥â„ÅÆÈßí„ÅÆÂõûËª¢ÂäπÊûú */
  .piece.spring-piece.computer {
    transform: rotate(180deg) !important;
  }
  
  .piece.spring-piece::before {
    content: 'üíß';
    position: absolute;
    top: -8px;
    right: -8px;
    font-size: 16px;
    z-index: 10;
    text-shadow: 0 0 5px rgba(0, 191, 255, 0.8);
    animation: springSparkle 2s ease-in-out infinite alternate;
  }
  
  .piece.spring-piece::after {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    background: radial-gradient(circle, rgba(0, 191, 255, 0.3) 0%, transparent 70%);
    border-radius: 50%;
    animation: springPulse 2s ease-in-out infinite;
    pointer-events: none;
  }

  /* Ê≥â„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes springGlow {
    0%, 100% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 20px rgba(0, 191, 255, 0.8), 
        inset 0 0 15px rgba(135, 206, 235, 0.4),
        0 0 30px rgba(0, 191, 255, 0.6);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 30px rgba(0, 191, 255, 1), 
        inset 0 0 20px rgba(135, 206, 235, 0.6),
        0 0 40px rgba(0, 191, 255, 0.8);
    }
  }
  
  @keyframes springFlow {
    0%, 100% { transform: translateY(0px) scale(1); }
    25% { transform: translateY(-1px) scale(1.01); }
    50% { transform: translateY(-2px) scale(1.03); }
    75% { transform: translateY(-1px) scale(1.01); }
  }
  
  @keyframes springSparkle {
    0% { opacity: 0.7; transform: scale(0.9) rotate(0deg); }
    100% { opacity: 1; transform: scale(1.1) rotate(8deg); }
  }
  
  @keyframes springPulse {
    0% { 
      opacity: 0.7; 
      transform: scale(0.9);
      border-color: rgba(0, 191, 255, 0.8);
    }
    50% { 
      opacity: 1; 
      transform: scale(1.1);
      border-color: rgba(0, 191, 255, 1);
    }
    100% { 
      opacity: 0.7; 
      transform: scale(0.9);
      border-color: rgba(0, 191, 255, 0.8);
    }
  }

  /* Ê≥â„ÅÆÂº∑Âåñ„Ç®„Éï„Çß„ÇØ„Éà„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes springEnhancePulse {
    0% { 
      opacity: 0;
      transform: scale(0.5);
      border-color: rgba(0, 191, 255, 0.5);
    }
    50% { 
      opacity: 1;
      transform: scale(1.2);
      border-color: rgba(0, 191, 255, 1);
    }
    100% { 
      opacity: 0;
      transform: scale(1.5);
      border-color: rgba(0, 191, 255, 0.3);
    }
  }

  /* Ê≥â„Å´„Çà„Å£„Å¶Âº∑Âåñ„Åï„Çå„ÅüÈßí„ÅÆ„Ç®„Éï„Çß„ÇØ„ÉàÔºàË∂ÖÊ¥æÊâãÁâàÔºâ */
  .piece.spring-enhanced {
    position: relative !important;
    background: linear-gradient(45deg, #00BFFF, #87CEEB, #00BFFF, #87CEEB) !important;
    background-size: 400% 400% !important;
    box-shadow: 
      0 0 30px rgba(0, 191, 255, 1), 
      inset 0 0 20px rgba(135, 206, 235, 0.8),
      0 0 50px rgba(0, 191, 255, 0.9),
      0 0 80px rgba(0, 191, 255, 0.6),
      0 0 120px rgba(0, 191, 255, 0.4) !important;
    animation: springEnhancedGlow 1.5s ease-in-out infinite, springEnhancedRainbow 3s linear infinite !important;
    border: 3px solid #00BFFF !important;
    border-radius: 50% !important;
    transform: scale(1.1) !important;
  }

  /* „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÂº∑Âåñ„Åï„Çå„ÅüÈßí„ÅÆÂõûËª¢ */
  .piece.spring-enhanced.computer {
    transform: scale(1.1) rotate(180deg) !important;
    animation: springEnhancedGlowComputer 1.5s ease-in-out infinite, springEnhancedRainbow 3s linear infinite !important;
  }

  /* ÊïµÈßí„ÅÆÂõûËª¢Âá¶ÁêÜ */
  .piece.experiment-piece.computer {
    transform: rotate(180deg) !important;
  }

  .piece.experiment-piece.computer:hover {
    transform: scale(1.1) rotate(180deg) !important;
  }

  .piece.experiment-piece.computer.selected {
    transform: scale(1.1) rotate(180deg) !important;
  }

  .piece.mutant-piece.computer {
    transform: rotate(180deg) !important;
  }

  .piece.mutant-piece.computer:hover {
    transform: scale(1.15) rotate(180deg) !important;
  }

  .piece.mutant-piece.computer.selected {
    transform: scale(1.15) rotate(180deg) !important;
  }

  .piece.k-boss-piece.computer {
    transform: rotate(180deg) !important;
  }

  .piece.k-boss-piece.computer:hover {
    transform: scale(1.2) rotate(180deg) !important;
  }

  .piece.k-boss-piece.computer.selected {
    transform: scale(1.2) rotate(180deg) !important;
  }
  
  .piece.spring-enhanced::before {
    content: 'üíß‚ú®üíß';
    position: absolute;
    top: -15px;
    right: -15px;
    font-size: 18px;
    z-index: 15;
    text-shadow: 
      0 0 10px rgba(0, 191, 255, 1),
      0 0 20px rgba(135, 206, 235, 0.8),
      0 0 30px rgba(0, 191, 255, 0.6);
    animation: springEnhancedSparkle 1s ease-in-out infinite alternate, springEnhancedFloat 2s ease-in-out infinite;
  }
  
  .piece.spring-enhanced::after {
    content: '';
    position: absolute;
    top: -8px;
    left: -8px;
    right: -8px;
    bottom: -8px;
    background: 
      radial-gradient(circle at 30% 30%, rgba(0, 191, 255, 0.6) 0%, transparent 50%),
      radial-gradient(circle at 70% 70%, rgba(135, 206, 235, 0.4) 0%, transparent 50%),
      radial-gradient(circle at 50% 50%, rgba(0, 191, 255, 0.3) 0%, transparent 70%);
    border: 2px solid rgba(0, 191, 255, 0.8);
    border-radius: 50%;
    animation: springEnhancedPulse 1.5s ease-in-out infinite, springEnhancedRotate 4s linear infinite;
    pointer-events: none;
  }

  /* Ê≥âÂº∑Âåñ„Ç®„Éï„Çß„ÇØ„Éà„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÔºàË∂ÖÊ¥æÊâãÁâàÔºâ */
  @keyframes springEnhancedGlow {
    0%, 100% { 
      box-shadow: 
        0 0 30px rgba(0, 191, 255, 1), 
        inset 0 0 20px rgba(135, 206, 235, 0.8),
        0 0 50px rgba(0, 191, 255, 0.9),
        0 0 80px rgba(0, 191, 255, 0.6),
        0 0 120px rgba(0, 191, 255, 0.4);
      transform: scale(1.1) rotate(0deg);
    }
    25% { 
      box-shadow: 
        0 0 40px rgba(0, 191, 255, 1.2), 
        inset 0 0 25px rgba(135, 206, 235, 1),
        0 0 70px rgba(0, 191, 255, 1.1),
        0 0 100px rgba(0, 191, 255, 0.8),
        0 0 150px rgba(0, 191, 255, 0.6);
      transform: scale(1.15) rotate(1deg);
    }
    50% { 
      box-shadow: 
        0 0 50px rgba(0, 191, 255, 1.4), 
        inset 0 0 30px rgba(135, 206, 235, 1.2),
        0 0 90px rgba(0, 191, 255, 1.3),
        0 0 120px rgba(0, 191, 255, 1),
        0 0 180px rgba(0, 191, 255, 0.8);
      transform: scale(1.2) rotate(0deg);
    }
    75% { 
      box-shadow: 
        0 0 40px rgba(0, 191, 255, 1.2), 
        inset 0 0 25px rgba(135, 206, 235, 1),
        0 0 70px rgba(0, 191, 255, 1.1),
        0 0 100px rgba(0, 191, 255, 0.8),
        0 0 150px rgba(0, 191, 255, 0.6);
      transform: scale(1.15) rotate(-1deg);
    }
  }

  /* „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÂº∑Âåñ„Åï„Çå„ÅüÈßíÁî®„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes springEnhancedGlowComputer {
    0%, 100% { 
      box-shadow: 
        0 0 30px rgba(0, 191, 255, 1), 
        inset 0 0 20px rgba(135, 206, 235, 0.8),
        0 0 50px rgba(0, 191, 255, 0.9),
        0 0 80px rgba(0, 191, 255, 0.6),
        0 0 120px rgba(0, 191, 255, 0.4);
      transform: scale(1.1) rotate(180deg);
    }
    25% { 
      box-shadow: 
        0 0 40px rgba(0, 191, 255, 1.2), 
        inset 0 0 25px rgba(135, 206, 235, 1),
        0 0 70px rgba(0, 191, 255, 1.1),
        0 0 100px rgba(0, 191, 255, 0.8),
        0 0 150px rgba(0, 191, 255, 0.6);
      transform: scale(1.15) rotate(181deg);
    }
    50% { 
      box-shadow: 
        0 0 50px rgba(0, 191, 255, 1.4), 
        inset 0 0 30px rgba(135, 206, 235, 1.2),
        0 0 90px rgba(0, 191, 255, 1.3),
        0 0 120px rgba(0, 191, 255, 1),
        0 0 180px rgba(0, 191, 255, 0.8);
      transform: scale(1.2) rotate(180deg);
    }
    75% { 
      box-shadow: 
        0 0 40px rgba(0, 191, 255, 1.2), 
        inset 0 0 25px rgba(135, 206, 235, 1),
        0 0 70px rgba(0, 191, 255, 1.1),
        0 0 100px rgba(0, 191, 255, 0.8),
        0 0 150px rgba(0, 191, 255, 0.6);
      transform: scale(1.15) rotate(179deg);
    }
  }
  
  @keyframes springEnhancedRainbow {
    0% { background-position: 0% 50%; }
    25% { background-position: 100% 50%; }
    50% { background-position: 100% 100%; }
    75% { background-position: 0% 100%; }
    100% { background-position: 0% 50%; }
  }
  
  @keyframes springEnhancedSparkle {
    0% { 
      opacity: 0.8; 
      transform: scale(0.8) rotate(0deg); 
      text-shadow: 
        0 0 10px rgba(0, 191, 255, 1),
        0 0 20px rgba(135, 206, 235, 0.8),
        0 0 30px rgba(0, 191, 255, 0.6);
    }
    50% { 
      opacity: 1; 
      transform: scale(1.3) rotate(15deg); 
      text-shadow: 
        0 0 15px rgba(0, 191, 255, 1.2),
        0 0 30px rgba(135, 206, 235, 1),
        0 0 45px rgba(0, 191, 255, 0.8);
    }
    100% { 
      opacity: 0.8; 
      transform: scale(0.8) rotate(30deg); 
      text-shadow: 
        0 0 10px rgba(0, 191, 255, 1),
        0 0 20px rgba(135, 206, 235, 0.8),
        0 0 30px rgba(0, 191, 255, 0.6);
    }
  }
  
  @keyframes springEnhancedFloat {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    25% { transform: translateY(-3px) rotate(2deg); }
    50% { transform: translateY(-5px) rotate(0deg); }
    75% { transform: translateY(-3px) rotate(-2deg); }
  }
  
  @keyframes springEnhancedPulse {
    0% { 
      opacity: 0.7; 
      transform: scale(0.9);
      border-color: rgba(0, 191, 255, 0.8);
    }
    25% { 
      opacity: 0.9; 
      transform: scale(1.1);
      border-color: rgba(0, 191, 255, 1);
    }
    50% { 
      opacity: 1; 
      transform: scale(1.3);
      border-color: rgba(135, 206, 235, 1);
    }
    75% { 
      opacity: 0.9; 
      transform: scale(1.1);
      border-color: rgba(0, 191, 255, 1);
    }
    100% { 
      opacity: 0.7; 
      transform: scale(0.9);
      border-color: rgba(0, 191, 255, 0.8);
    }
  }
  
  @keyframes springEnhancedRotate {
    0% { transform: rotate(0deg) scale(1); }
    25% { transform: rotate(90deg) scale(1.1); }
    50% { transform: rotate(180deg) scale(1.2); }
    75% { transform: rotate(270deg) scale(1.1); }
    100% { transform: rotate(360deg) scale(1); }
  }
  
  @keyframes springSparkleFloat {
    0% { 
      opacity: 0; 
      transform: scale(0) translateY(0px) rotate(0deg); 
    }
    20% { 
      opacity: 1; 
      transform: scale(1) translateY(-10px) rotate(72deg); 
    }
    50% { 
      opacity: 0.8; 
      transform: scale(1.2) translateY(-20px) rotate(180deg); 
    }
    80% { 
      opacity: 0.4; 
      transform: scale(0.8) translateY(-30px) rotate(288deg); 
    }
    100% { 
      opacity: 0; 
      transform: scale(0) translateY(-40px) rotate(360deg); 
    }
  }

  /* Èúß„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÊôÇ„ÅÆÊ∂àÊªÖ„Ç®„Éï„Çß„ÇØ„Éà */
  @keyframes mistSkillDisappear {
    0% { 
      transform: scale(1) rotate(0deg);
      opacity: 1;
      filter: brightness(1);
    }
    50% { 
      transform: scale(0.5) rotate(180deg);
      opacity: 0.5;
      filter: brightness(0.5);
    }
    100% { 
      transform: scale(0) rotate(360deg);
      opacity: 0;
      filter: brightness(0);
    }
  }

  /* ÂàÄ„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Ç≠„Éº„Éï„É¨„Éº„É† */
  @keyframes swordPieceGlow {
    0% { 
      box-shadow: 0 0 5px #FFD700, 0 0 10px #FFA500, 0 0 15px #FF6347;
      text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    }
    50% { 
      box-shadow: 0 0 15px #FFD700, 0 0 25px #FFA500, 0 0 35px #FF6347;
      text-shadow: 2px 2px 6px #000000, -1px -1px 3px #000000, 1px -1px 3px #000000, -1px 1px 3px #000000;
    }
    100% { 
      box-shadow: 0 0 5px #FFD700, 0 0 10px #FFA500, 0 0 15px #FF6347;
      text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    }
  }

  @keyframes swordPieceFloat {
    0% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-3px) rotate(2deg); }
    100% { transform: translateY(0px) rotate(0deg); }
  }

  @keyframes swordPieceFloatComputer {
    0% { transform: translateY(0px) rotate(180deg); }
    50% { transform: translateY(-3px) rotate(182deg); }
    100% { transform: translateY(0px) rotate(180deg); }
  }

  @keyframes swordSparkle {
    0% { 
      transform: scale(1) rotate(0deg);
      opacity: 1;
      text-shadow: 0 0 10px #FFD700, 0 0 20px #FFA500;
    }
    50% { 
      transform: scale(1.2) rotate(180deg);
      opacity: 0.8;
      text-shadow: 0 0 15px #FFD700, 0 0 30px #FFA500;
    }
    100% { 
      transform: scale(1) rotate(360deg);
      opacity: 1;
      text-shadow: 0 0 10px #FFD700, 0 0 20px #FFA500;
    }
  }

  @keyframes swordAura {
    0% { 
      opacity: 0.6;
      transform: scale(1);
    }
    50% { 
      opacity: 0.8;
      transform: scale(1.1);
    }
    100% { 
      opacity: 0.6;
      transform: scale(1);
    }
  }

  /* Èéß„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Ç≠„Éº„Éï„É¨„Éº„É† */
  @keyframes armorPieceGlow {
    0% { 
      box-shadow: 0 0 5px #708090, 0 0 10px #2F4F4F, 0 0 15px #000080;
      text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    }
    50% { 
      box-shadow: 0 0 15px #708090, 0 0 25px #2F4F4F, 0 0 35px #000080;
      text-shadow: 2px 2px 6px #000000, -1px -1px 3px #000000, 1px -1px 3px #000000, -1px 1px 3px #000000;
    }
    100% { 
      box-shadow: 0 0 5px #708090, 0 0 10px #2F4F4F, 0 0 15px #000080;
      text-shadow: 2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000;
    }
  }

  @keyframes armorPieceFloat {
    0% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-2px) rotate(1deg); }
    100% { transform: translateY(0px) rotate(0deg); }
  }

  @keyframes armorPieceFloatComputer {
    0% { transform: translateY(0px) rotate(180deg); }
    50% { transform: translateY(-2px) rotate(181deg); }
    100% { transform: translateY(0px) rotate(180deg); }
  }

  @keyframes armorShield {
    0% { 
      transform: scale(1) rotate(0deg);
      opacity: 1;
      text-shadow: 0 0 10px #708090, 0 0 20px #2F4F4F;
    }
    50% { 
      transform: scale(1.1) rotate(5deg);
      opacity: 0.9;
      text-shadow: 0 0 15px #708090, 0 0 30px #2F4F4F;
    }
    100% { 
      transform: scale(1) rotate(0deg);
      opacity: 1;
      text-shadow: 0 0 10px #708090, 0 0 20px #2F4F4F;
    }
  }

  @keyframes armorAura {
    0% { 
      opacity: 0.6;
      transform: scale(1);
    }
    50% { 
      opacity: 0.8;
      transform: scale(1.05);
    }
    100% { 
      opacity: 0.6;
      transform: scale(1);
    }
  }

  /* ÈäÉ„ÅÆÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Ç≠„Éº„Éï„É¨„Éº„É† */
  @keyframes gunPieceGlow {
    0% { 
      box-shadow: 0 0 5px #696969, 0 0 10px #A9A9A9, 0 0 15px #D3D3D3;
      text-shadow: 1px 1px 2px #FFFFFF, -1px -1px 2px #FFFFFF, 1px -1px 2px #FFFFFF, -1px 1px 2px #FFFFFF;
    }
    50% { 
      box-shadow: 0 0 15px #696969, 0 0 25px #A9A9A9, 0 0 35px #D3D3D3;
      text-shadow: 1px 1px 3px #FFFFFF, -1px -1px 3px #FFFFFF, 1px -1px 3px #FFFFFF, -1px 1px 3px #FFFFFF;
    }
    100% { 
      box-shadow: 0 0 5px #696969, 0 0 10px #A9A9A9, 0 0 15px #D3D3D3;
      text-shadow: 1px 1px 2px #FFFFFF, -1px -1px 2px #FFFFFF, 1px -1px 2px #FFFFFF, -1px 1px 2px #FFFFFF;
    }
  }

  @keyframes gunPieceFloat {
    0% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-2px) rotate(1deg); }
    100% { transform: translateY(0px) rotate(0deg); }
  }

  @keyframes gunPieceFloatComputer {
    0% { transform: translateY(0px) rotate(180deg); }
    50% { transform: translateY(-2px) rotate(181deg); }
    100% { transform: translateY(0px) rotate(180deg); }
  }

  @keyframes gunFire {
    0% { 
      transform: scale(1) rotate(0deg);
      opacity: 1;
      text-shadow: 0 0 10px #FF4500, 0 0 20px #FF6347;
    }
    50% { 
      transform: scale(1.1) rotate(10deg);
      opacity: 0.9;
      text-shadow: 0 0 15px #FF4500, 0 0 30px #FF6347;
    }
    100% { 
      transform: scale(1) rotate(0deg);
      opacity: 1;
      text-shadow: 0 0 10px #FF4500, 0 0 20px #FF6347;
    }
  }

  @keyframes gunAura {
    0% { 
      opacity: 0.6;
      transform: scale(1);
    }
    50% { 
      opacity: 0.8;
      transform: scale(1.05);
    }
    100% { 
      opacity: 0.6;
      transform: scale(1);
    }
  }

  /* Êõ∏„ÅÆ„Çπ„Ç≠„É´‰ΩøÁî®‰∏≠„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes bookSkillPulse {
    0% { 
      background-position: 0% 50%;
      box-shadow: 0 0 20px rgba(52, 152, 219, 0.8), inset 0 0 10px rgba(52, 152, 219, 0.3);
      transform: scale(1);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 0 0 30px rgba(52, 152, 219, 1.0), inset 0 0 15px rgba(52, 152, 219, 0.5);
      transform: scale(1.05);
    }
    100% { 
      background-position: 0% 50%;
      box-shadow: 0 0 20px rgba(52, 152, 219, 0.8), inset 0 0 10px rgba(52, 152, 219, 0.3);
      transform: scale(1);
    }
  }

  /* Â∞Å„ÅÆ„Çπ„Ç≠„É´‰ΩøÁî®‰∏≠„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes sealSkillPulse {
    0% { 
      background-position: 0% 50%;
      box-shadow: 0 0 20px rgba(231, 76, 60, 0.8), inset 0 0 10px rgba(231, 76, 60, 0.3);
      transform: scale(1);
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 0 0 30px rgba(231, 76, 60, 1.0), inset 0 0 15px rgba(231, 76, 60, 0.5);
      transform: scale(1.05);
    }
    100% { 
      background-position: 0% 50%;
      box-shadow: 0 0 20px rgba(231, 76, 60, 0.8), inset 0 0 10px rgba(231, 76, 60, 0.3);
      transform: scale(1);
    }
  }

  /* Â∞ÅÂç∞„Åï„Çå„ÅüÈßí„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes sealedPulse {
    0% { 
      background-position: 0% 50%;
      box-shadow: 0 0 15px rgba(44, 62, 80, 0.6), inset 0 0 8px rgba(52, 73, 94, 0.3);
      opacity: 0.7;
    }
    50% { 
      background-position: 100% 50%;
      box-shadow: 0 0 25px rgba(44, 62, 80, 0.8), inset 0 0 12px rgba(52, 73, 94, 0.5);
      opacity: 0.5;
    }
    100% { 
      background-position: 0% 50%;
      box-shadow: 0 0 15px rgba(44, 62, 80, 0.6), inset 0 0 8px rgba(52, 73, 94, 0.3);
      opacity: 0.7;
    }
  }

  /* Êõ∏„ÅÆ„Ç≥„Éî„ÉºÂäπÊûú„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes bookCopyEffect {
    0% { 
      background-position: 0% 50%;
      box-shadow: 0 0 25px rgba(52, 152, 219, 0.9), inset 0 0 12px rgba(52, 152, 219, 0.4);
      transform: scale(1);
    }
    25% { 
      background-position: 25% 50%;
      box-shadow: 0 0 35px rgba(52, 152, 219, 1.0), inset 0 0 15px rgba(52, 152, 219, 0.6);
      transform: scale(1.02);
    }
    50% { 
      background-position: 50% 50%;
      box-shadow: 0 0 40px rgba(52, 152, 219, 1.1), inset 0 0 18px rgba(52, 152, 219, 0.8);
      transform: scale(1.05);
    }
    75% { 
      background-position: 75% 50%;
      box-shadow: 0 0 35px rgba(52, 152, 219, 1.0), inset 0 0 15px rgba(52, 152, 219, 0.6);
      transform: scale(1.02);
    }
    100% { 
      background-position: 100% 50%;
      box-shadow: 0 0 25px rgba(52, 152, 219, 0.9), inset 0 0 12px rgba(52, 152, 219, 0.4);
      transform: scale(1);
    }
  }

  /* „ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes tooltipPulse {
    0% { 
      opacity: 0.8;
      transform: translateX(-50%) translateY(0px);
    }
    50% { 
      opacity: 1.0;
      transform: translateX(-50%) translateY(-2px);
    }
    100% { 
      opacity: 0.8;
      transform: translateX(-50%) translateY(0px);
    }
  }

  /* Êõ∏„ÅÆË±™ËèØ„Å™ÂÖâ„Çã„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes luxuryBookGlow {
    0% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 30px rgba(102, 126, 234, 0.8),
        0 0 60px rgba(118, 75, 162, 0.6),
        inset 0 0 20px rgba(255, 215, 0, 0.3),
        inset 0 0 40px rgba(255, 255, 255, 0.1);
      transform: scale(1);
    }
    25% { 
      background-position: 25% 50%;
      box-shadow: 
        0 0 40px rgba(102, 126, 234, 1.0),
        0 0 80px rgba(118, 75, 162, 0.8),
        inset 0 0 30px rgba(255, 215, 0, 0.5),
        inset 0 0 60px rgba(255, 255, 255, 0.2);
      transform: scale(1.02);
    }
    50% { 
      background-position: 50% 50%;
      box-shadow: 
        0 0 50px rgba(102, 126, 234, 1.2),
        0 0 100px rgba(118, 75, 162, 1.0),
        inset 0 0 40px rgba(255, 215, 0, 0.7),
        inset 0 0 80px rgba(255, 255, 255, 0.3);
      transform: scale(1.05);
    }
    75% { 
      background-position: 75% 50%;
      box-shadow: 
        0 0 40px rgba(102, 126, 234, 1.0),
        0 0 80px rgba(118, 75, 162, 0.8),
        inset 0 0 30px rgba(255, 215, 0, 0.5),
        inset 0 0 60px rgba(255, 255, 255, 0.2);
      transform: scale(1.02);
    }
    100% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 30px rgba(102, 126, 234, 0.8),
        0 0 60px rgba(118, 75, 162, 0.6),
        inset 0 0 20px rgba(255, 215, 0, 0.3),
        inset 0 0 40px rgba(255, 255, 255, 0.1);
      transform: scale(1);
    }
  }

  /* Êõ∏„ÅÆ„Çπ„Ç≠„É´‰ΩøÁî®‰∏≠„ÅÆË±™ËèØ„Å™„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes luxuryBookSkillPulse {
    0% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 40px rgba(102, 126, 234, 1.0),
        0 0 80px rgba(118, 75, 162, 0.8),
        0 0 120px rgba(240, 147, 251, 0.6),
        inset 0 0 30px rgba(255, 215, 0, 0.5),
        inset 0 0 60px rgba(255, 255, 255, 0.2);
      transform: scale(1.1);
    }
    25% { 
      background-position: 25% 50%;
      box-shadow: 
        0 0 60px rgba(102, 126, 234, 1.2),
        0 0 120px rgba(118, 75, 162, 1.0),
        0 0 180px rgba(240, 147, 251, 0.8),
        inset 0 0 50px rgba(255, 215, 0, 0.7),
        inset 0 0 100px rgba(255, 255, 255, 0.4);
      transform: scale(1.15);
    }
    50% { 
      background-position: 50% 50%;
      box-shadow: 
        0 0 80px rgba(102, 126, 234, 1.4),
        0 0 160px rgba(118, 75, 162, 1.2),
        0 0 240px rgba(240, 147, 251, 1.0),
        inset 0 0 70px rgba(255, 215, 0, 0.9),
        inset 0 0 140px rgba(255, 255, 255, 0.6);
      transform: scale(1.2);
    }
    75% { 
      background-position: 75% 50%;
      box-shadow: 
        0 0 60px rgba(102, 126, 234, 1.2),
        0 0 120px rgba(118, 75, 162, 1.0),
        0 0 180px rgba(240, 147, 251, 0.8),
        inset 0 0 50px rgba(255, 215, 0, 0.7),
        inset 0 0 100px rgba(255, 255, 255, 0.4);
      transform: scale(1.15);
    }
    100% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 40px rgba(102, 126, 234, 1.0),
        0 0 80px rgba(118, 75, 162, 0.8),
        0 0 120px rgba(240, 147, 251, 0.6),
        inset 0 0 30px rgba(255, 215, 0, 0.5),
        inset 0 0 60px rgba(255, 255, 255, 0.2);
      transform: scale(1.1);
    }
  }

  /* Êõ∏„ÅÆÂÖâ„ÇãÂäπÊûú„ÅÆÂõûËª¢„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes bookGlowRotate {
    0% { 
      transform: rotate(0deg);
      opacity: 0.3;
    }
    50% { 
      transform: rotate(180deg);
      opacity: 0.6;
    }
    100% { 
      transform: rotate(360deg);
      opacity: 0.3;
    }
  }

  /* Â∞Å„ÅÆË±™ËèØ„Å™ÂÖâ„Çã„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes luxurySealGlow {
    0% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 30px rgba(44, 62, 80, 0.8),
        0 0 60px rgba(52, 73, 94, 0.6),
        inset 0 0 20px rgba(139, 69, 19, 0.3),
        inset 0 0 40px rgba(255, 255, 255, 0.1);
      transform: scale(1);
    }
    25% { 
      background-position: 25% 50%;
      box-shadow: 
        0 0 40px rgba(44, 62, 80, 1.0),
        0 0 80px rgba(52, 73, 94, 0.8),
        inset 0 0 30px rgba(139, 69, 19, 0.5),
        inset 0 0 60px rgba(255, 255, 255, 0.2);
      transform: scale(1.02);
    }
    50% { 
      background-position: 50% 50%;
      box-shadow: 
        0 0 50px rgba(44, 62, 80, 1.2),
        0 0 100px rgba(52, 73, 94, 1.0),
        inset 0 0 40px rgba(139, 69, 19, 0.7),
        inset 0 0 80px rgba(255, 255, 255, 0.3);
      transform: scale(1.05);
    }
    75% { 
      background-position: 75% 50%;
      box-shadow: 
        0 0 40px rgba(44, 62, 80, 1.0),
        0 0 80px rgba(52, 73, 94, 0.8),
        inset 0 0 30px rgba(139, 69, 19, 0.5),
        inset 0 0 60px rgba(255, 255, 255, 0.2);
      transform: scale(1.02);
    }
    100% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 30px rgba(44, 62, 80, 0.8),
        0 0 60px rgba(52, 73, 94, 0.6),
        inset 0 0 20px rgba(139, 69, 19, 0.3),
        inset 0 0 40px rgba(255, 255, 255, 0.1);
      transform: scale(1);
    }
  }

  /* Â∞Å„ÅÆ„Çπ„Ç≠„É´‰ΩøÁî®‰∏≠„ÅÆË±™ËèØ„Å™„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes luxurySealSkillPulse {
    0% { 
      background-position: 0% 50%;
      box-shadow: 
        0 0 40px rgba(44, 62, 80, 1.0),
        0 0 80px rgba(52, 73, 94, 0.8),
        0 0 120px rgba(74, 103, 65, 0.6),
        inset 0 0 30px rgba(139, 69, 19, 0.5),
        inset 0 0 60px rgba(255, 255, 255, 0.2);
      transform: scale(1.1);
    }
    25% { 
      background-position: 25% 50%;
      box-shadow: 
        0 0 60px rgba(44, 62, 80, 1.2),
        0 0 120px rgba(52, 73, 94, 1.0),
        0 0 180px rgba(74, 103, 65, 0.8),
        inset 0 0 50px rgba(139, 69, 19, 0.7),
        inset 0 0 100px rgba(255, 255, 255, 0.4);
      transform: scale(1.15);
    }
    50% { 
      background-position: 50% 50%;
      box-shadow: 
        0 0 80px rgba(44, 62, 80, 1.4),
        0 0 160px rgba(52, 73, 94, 1.2),
        0 0 240px rgba(74, 103, 65, 1.0),
        inset 0 0 70px rgba(139, 69, 19, 0.9),
        inset 0 0 140px rgba(255, 255, 255, 0.6);
      transform: scale(1.2);
    }
    75% { 
      background-position: 75% 50%;
      box-shadow: 
        0 0 60px rgba(44, 62, 80, 1.2),
        0 0 120px rgba(52, 73, 94, 1.0),
        0 0 180px rgba(74, 103, 65, 0.8),
        inset 0 0 50px rgba(139, 69, 19, 0.7),
        inset 0 0 100px rgba(255, 255, 255, 0.4);
      transform: scale(1.15);
    }
    100% { 
      background-position: 100% 50%;
      box-shadow: 
        0 0 40px rgba(44, 62, 80, 1.0),
        0 0 80px rgba(52, 73, 94, 0.8),
        0 0 120px rgba(74, 103, 65, 0.6),
        inset 0 0 30px rgba(139, 69, 19, 0.5),
        inset 0 0 60px rgba(255, 255, 255, 0.2);
      transform: scale(1.1);
    }
  }

  /* Â∞Å„ÅÆÂÖâ„ÇãÂäπÊûú„ÅÆÂõûËª¢„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes sealGlowRotate {
    0% { 
      transform: rotate(0deg);
      opacity: 0.3;
    }
    50% { 
      transform: rotate(180deg);
      opacity: 0.6;
    }
    100% { 
      transform: rotate(360deg);
      opacity: 0.3;
    }
  }

  /* ÊïµÈßí„ÅÆ„ÄåÊõ∏„Äç„ÄåÂ∞Å„Äç„Çí180Â∫¶ÂõûËª¢ */
  .piece.luxury-book-piece.computer,
  .piece.luxury-seal-piece.computer {
    transform: rotate(180deg) !important;
  }
  
  /* „Çà„ÇäÂÖ∑‰ΩìÁöÑ„Å™„Çª„É¨„ÇØ„Çø„Éº„ÅßÁ¢∫ÂÆü„Å´‰∏äÊõ∏„Åç */
  .piece.computer.luxury-book-piece,
  .piece.computer.luxury-seal-piece {
    transform: rotate(180deg) !important;
  }
  
  /* no-rotate„ÇØ„É©„Çπ„Åß180Â∫¶ÂõûËª¢„ÇíÈÅ©Áî® */
  .piece.no-rotate {
    transform: rotate(180deg) !important;
  }
</style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div>
        <div class="title">„Çπ„ÉÜ„Éº„Ç∏Âà∂„Éª„Ç™„É™„Ç∏„Éä„É´Êº¢Â≠óÈßí Â∞ÜÊ£ã</div>
        <div class="subtitle">Áõ∏Êâã„ÅÆ„ÄåÁéã„Äç„ÇíÂèñ„Çå„Å∞Âãù„Å°„ÄÇ„Çπ„ÉÜ„Éº„Ç∏„ÅåÈÄ≤„ÇÄ„Å®Áõ§Èù¢„Å®Èßí„ÅåÂ§âÂåñ„ÄÇ</div>
      </div>
      <div class="subtitle">„Çπ„ÉÜ„Éº„Ç∏: <span id="stage-label">1</span> / <span id="stage-total">3</span></div>
    </div>

    <div class="row">
      <div class="board-wrap">
        <div id="board" class="board"></div>
        <div id="status" class="status playing" style="margin-top:12px;">„ÅÇ„Å™„Åü„ÅÆÊâãÁï™</div>
        <div class="controls">
          <button onclick="undoMove()" class="secondary" id="undo-btn" disabled>1ÊâãÊàª„Åô</button>
          <button onclick="restartStage()" class="secondary">„Çπ„ÉÜ„Éº„Ç∏„ÇÑ„ÇäÁõ¥„Åó</button>
          <button onclick="nextStage()" class="success">Ê¨°„ÅÆ„Çπ„ÉÜ„Éº„Ç∏„Å∏</button>
          <button onclick="goHome()" style="background: linear-gradient(45deg, #6c757d, #495057);">„Éõ„Éº„É†„Å´Êàª„Çã</button>
        </div>
      </div>
      <div class="side">
        <h3>„ÅÇ„Å™„Åü„ÅÆÊåÅ„Å°Èßí</h3>
        <div id="hand-player" class="hand"></div>
        <div id="stage-info" style="margin-top:8px; font-size:12px; color:#666; text-align:center;"></div>
        <h3 style="margin-top:12px;">Êïµ„ÅÆÊåÅ„Å°Èßí</h3>
        <div id="hand-computer" class="hand"></div>
        <div class="controls" style="margin-top:16px;">
          <button onclick="newGame()">Êñ∞„Åó„ÅÑ„Ç≤„Éº„É†</button>
          <button onclick="restartStage()">„Çπ„ÉÜ„Éº„Ç∏ÂÜçÈñã</button>
          <button onclick="nextStage()">Ê¨°„ÅÆ„Çπ„ÉÜ„Éº„Ç∏</button>
          <button onclick="testDeckLoading(); showCurrentBoardState();" style="background: #6c757d;">„Éá„ÉÉ„Ç≠„ÉÜ„Çπ„Éà</button>
        </div>
      </div>
    </div>
  </div>

<script>
  // Áõ§„ÅØ 9x9 Âõ∫ÂÆöÔºàÁ∞°ÊòìÂåñÔºâ„ÄÇ
  const BOARD_SIZE = 9;

  // „Éá„ÉÉ„Ç≠Ë™≠„ÅøËæº„Åø
  function loadPlayerDeck() {
    try {
      const saved = JSON.parse(localStorage.getItem('original_shogi_deck_v1') || '[]');
      console.log('=== LOAD PLAYER DECK DEBUG ===');
      console.log('Raw localStorage value:', localStorage.getItem('original_shogi_deck_v1'));
      console.log('Parsed saved value:', saved);
      console.log('Is array:', Array.isArray(saved));
      if (Array.isArray(saved)) {
        console.log('Array length:', saved.length);
        if (saved.length > 0) {
          console.log('First element is array:', Array.isArray(saved[0]));
          if (Array.isArray(saved[0])) {
            console.log('2D array dimensions:', saved.length, 'x', saved[0].length);
            console.log('2D array content:', saved);
            
            // 8Ë°åÁõÆ„ÅÆ2ÂàóÁõÆ„Å®8ÂàóÁõÆ„ÇíÁâπÂà•„Å´Á¢∫Ë™ç
            if (saved.length > 1) {
              console.log('*** 8Ë°åÁõÆ2ÂàóÁõÆ„Å®8ÂàóÁõÆ„ÅÆÁ¢∫Ë™ç ***');
              console.log('„Éá„ÉÉ„Ç≠[1][1] (8Ë°åÁõÆ2ÂàóÁõÆ):', saved[1][1]);
              console.log('„Éá„ÉÉ„Ç≠[1][7] (8Ë°åÁõÆ8ÂàóÁõÆ):', saved[1][7]);
            }
          }
        }
      }
      console.log('=== END LOAD DEBUG ===');
      
      // ‰øùÂ≠ò„Åï„Çå„Åü„Éá„Éº„Çø„ÅåÁ©∫„ÅÆÂ†¥Âêà„ÅØ„Éá„Éï„Ç©„É´„Éà„Éá„ÉÉ„Ç≠„ÇíËøî„Åô
      if (!saved || saved.length === 0) {
        console.log('No saved deck found, returning default deck');
        return [];
      }
      
      // Êñ∞„Åó„ÅÑÂΩ¢ÂºèÔºà„Éú„Éº„ÉâÈÖçÁΩÆÔºâ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
      if (Array.isArray(saved[0])) {
        console.log('Detected 2D array format (board layout)');
        return saved;
      } else {
        console.log('Detected 1D array format (flat list)');
        return saved;
      }
    } catch(e) {
      console.error('Error loading player deck:', e);
      return [];
    }
  }

  // „ÉÜ„Çπ„ÉàÁî®: „Éá„ÉÉ„Ç≠„ÅÆÁä∂ÊÖã„ÇíÊâãÂãï„ÅßÁ¢∫Ë™ç
  function testDeckLoading() {
    console.log('=== MANUAL DECK TEST ===');
    const deck = loadPlayerDeck();
    console.log('Loaded deck:', deck);
    
    if (Array.isArray(deck) && deck.length > 0) {
      console.log('Deck structure:');
      deck.forEach((row, rowIndex) => {
        console.log(`Row ${rowIndex}:`, row);
      });
      
      // „Éó„É¨„Ç§„É§„ÉºÂÅ¥„ÅÆÈßí„ÇíÊäΩÂá∫
      const playerPieces = [];
      for (let row = 0; row < deck.length; row++) {
        for (let col = 0; col < deck[row].length; col++) {
          if (deck[row][col]) {
            playerPieces.push(`${deck[row][col]} at [${row}][${col}]`);
          }
        }
      }
      console.log('Player pieces found:', playerPieces);
    } else {
      console.log('No deck found or empty deck');
    }
    console.log('=== END MANUAL TEST ===');
  }

  // „ÉÜ„Çπ„ÉàÁî®: ÁèæÂú®„ÅÆ„Éú„Éº„ÉâÁä∂ÊÖã„ÇíË°®Á§∫
  function showCurrentBoardState() {
    console.log('=== CURRENT BOARD STATE ===');
    if (state.board && state.board.length > 0) {
      console.log('Board dimensions:', state.board.length, 'x', state.board[0].length);
      console.log('Board content:');
      state.board.forEach((row, rowIndex) => {
        const rowContent = row.map(cell => {
          if (!cell) return 'null';
          return `${cell.piece}(${cell.owner})`;
        });
        console.log(`Row ${rowIndex}:`, rowContent);
      });
    } else {
      console.log('No board state available');
    }
    console.log('=== END BOARD STATE ===');
  }

  // „Éó„É¨„Ç§„É§„Éº„ÅÆÈßí„Çí„Éá„ÉÉ„Ç≠„Å´Âü∫„Å•„ÅÑ„Å¶Â§âÊõ¥
  function getPlayerPieces() {
    const deck = loadPlayerDeck();
    const defaultPieces = ['È¶ô', 'Ê°Ç', 'ÈäÄ', 'Èáë', 'Áéâ', 'Èáë', 'ÈäÄ', 'Ê°Ç', 'È¶ô'];
    
    // „Éá„ÉÉ„Ç≠„ÅåÁ©∫„ÅÆÂ†¥Âêà„ÅØ„Éá„Éï„Ç©„É´„Éà
    if (deck.length === 0) return defaultPieces;
    
    // Êñ∞„Åó„ÅÑÂΩ¢ÂºèÔºà„Éú„Éº„ÉâÈÖçÁΩÆÔºâ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    if (Array.isArray(deck[0])) {
      // „Éú„Éº„ÉâÈÖçÁΩÆÂΩ¢Âºè„ÅÆÂ†¥Âêà„ÄÅ„Éó„É¨„Ç§„É§„ÉºÂÅ¥„ÅÆÈßí„ÇíÊäΩÂá∫
      const playerPieces = [];
      for (let row = 0; row < deck.length; row++) {
        for (let col = 0; col < deck[row].length; col++) {
          if (deck[row][col]) {
            playerPieces.push(deck[row][col]);
          }
        }
      }
      return playerPieces.length > 0 ? playerPieces : defaultPieces;
    } else {
      // Âè§„ÅÑÂΩ¢ÂºèÔºàÈÖçÂàóÔºâ„ÅÆÂ†¥Âêà
      return deck;
    }
  }

  // Â∫ßÊ®ôÂ§âÊèõ„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£
  // (1,1) = 1Ë°åÁõÆ1ÂàóÁõÆ (Â∑¶‰∏ä„Åã„ÇâÂè≥‰∏ã)
  // ÂÜÖÈÉ®ÈÖçÂàó„ÅØ (0,0) = Â∑¶‰∏ä„Åã„ÇâÂè≥‰∏ã
  function coordToArray(row, col) {
    return { row: row - 1, col: col - 1 };
  }
  
  function arrayToCoord(row, col) {
    return { row: row + 1, col: col + 1 };
  }
  
  // Â∫ßÊ®ô„ÅßÈßí„ÇíÈÖçÁΩÆ„Åô„Çã„Éò„É´„Éë„ÉºÈñ¢Êï∞
  function placePiece(board, row, col, piece) {
    const pos = coordToArray(row, col);
    board[pos.row][pos.col] = piece;
  }
  
  // Â∫ßÊ®ô„Ç∑„Çπ„ÉÜ„É†„ÅÆ‰ΩøÁî®‰æã
  // ‰æã: Áõ∏Êâã„ÅÆÁéã„Çí(1,5)„Å´ÈÖçÁΩÆ„Åô„ÇãÂ†¥Âêà
  // placePiece(board, 1, 5, 'CÁéã');
  
  // ‰æã: Áõ∏Êâã„ÅÆÊ≠©„Çí(4,1)„Åã„Çâ(4,9)„Åæ„ÅßÈÖçÁΩÆ„Åô„ÇãÂ†¥Âêà
  // for (let col = 1; col <= 9; col++) {
  //   placePiece(board, 4, col, 'CÊ≠©');
  // }

  // „Éó„É¨„Ç§„É§„Éº„ÅÆÈßí„ÅÆ‰ΩçÁΩÆ„Åã„Çâ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÇíÂèñÂæó
  function getPlayerPieceIndex(row, col) {
    // „Éó„É¨„Ç§„É§„Éº„ÅÆÈßí„ÅÆ‰ΩçÁΩÆ„ÇíÂÆöÁæ©ÔºàÂÖ®ÊÆµ„ÅÆÂÖ®‰ΩçÁΩÆÔºâ
    const playerPositions = [
      // 1ÊÆµÁõÆÔºàÊúÄ‰∏ãÊÆµÔºâ- 9ÂÄã
      {row: 8, col: 0}, {row: 8, col: 1}, {row: 8, col: 2}, {row: 8, col: 3}, 
      {row: 8, col: 4}, {row: 8, col: 5}, {row: 8, col: 6}, {row: 8, col: 7}, {row: 8, col: 8},
      // 2ÊÆµÁõÆÔºàÊ≠©Ôºâ- 9ÂÄã
      {row: 7, col: 0}, {row: 7, col: 1}, {row: 7, col: 2}, {row: 7, col: 3}, 
      {row: 7, col: 4}, {row: 7, col: 5}, {row: 7, col: 6}, {row: 7, col: 7}, {row: 7, col: 8},
      // 3ÊÆµÁõÆÔºàÊ≠©Ôºâ- 9ÂÄã
      {row: 6, col: 0}, {row: 6, col: 1}, {row: 6, col: 2}, {row: 6, col: 3}, 
      {row: 6, col: 4}, {row: 6, col: 5}, {row: 6, col: 6}, {row: 6, col: 7}, {row: 6, col: 8},
      // 4ÊÆµÁõÆÔºàÊ≠©Ôºâ- 9ÂÄã
      {row: 5, col: 0}, {row: 5, col: 1}, {row: 5, col: 2}, {row: 5, col: 3}, 
      {row: 5, col: 4}, {row: 5, col: 5}, {row: 5, col: 6}, {row: 5, col: 7}, {row: 5, col: 8},
      // 5ÊÆµÁõÆÔºàÊ≠©Ôºâ- 9ÂÄã
      {row: 4, col: 0}, {row: 4, col: 1}, {row: 4, col: 2}, {row: 4, col: 3}, 
      {row: 4, col: 4}, {row: 4, col: 5}, {row: 4, col: 6}, {row: 4, col: 7}, {row: 4, col: 8},
      // 6ÊÆµÁõÆÔºàÊ≠©Ôºâ- 9ÂÄã
      {row: 3, col: 0}, {row: 3, col: 1}, {row: 3, col: 2}, {row: 3, col: 3}, 
      {row: 3, col: 4}, {row: 3, col: 5}, {row: 3, col: 6}, {row: 3, col: 7}, {row: 3, col: 8},
      // 7ÊÆµÁõÆÔºàÊ≠©Ôºâ- 9ÂÄã
      {row: 2, col: 0}, {row: 2, col: 1}, {row: 2, col: 2}, {row: 2, col: 3}, 
      {row: 2, col: 4}, {row: 2, col: 5}, {row: 2, col: 6}, {row: 2, col: 7}, {row: 2, col: 8},
      // 8ÊÆµÁõÆÔºàÊ≠©Ôºâ- 9ÂÄã
      {row: 1, col: 0}, {row: 1, col: 1}, {row: 1, col: 2}, {row: 1, col: 3}, 
      {row: 1, col: 4}, {row: 1, col: 5}, {row: 1, col: 6}, {row: 1, col: 7}, {row: 1, col: 8},
      // 9ÊÆµÁõÆÔºàÊ≠©Ôºâ- 9ÂÄã
      {row: 0, col: 0}, {row: 0, col: 1}, {row: 0, col: 2}, {row: 0, col: 3}, 
      {row: 0, col: 4}, {row: 0, col: 5}, {row: 0, col: 6}, {row: 0, col: 7}, {row: 0, col: 8}
    ];
    
    // ‰ΩçÁΩÆ„ÇíÊ§úÁ¥¢„Åó„Å¶„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÇíËøî„Åô
    for (let i = 0; i < playerPositions.length; i++) {
      if (playerPositions[i].row === row && playerPositions[i].col === col) {
        return i;
      }
    }
    
    return -1; // Ë¶ã„Å§„Åã„Çâ„Å™„ÅÑÂ†¥Âêà
  }

  // „Çπ„ÉÜ„Éº„Ç∏ÂÆöÁæ©ÔºàP=player, C=computerÔºâ„ÄÇ'' „ÅØÁ©∫„Åç„ÄÇ
  // ÊñáÂ≠óÂàó„ÅØ 'PÁéâ' „Å™„Å©„ÅÆÊâÄÊúâËÄÖ+Èßí„ÄÇ‰æã: 'CÁéã', 'PÈ£õ', 'CÂøç' „Å™„Å©„ÄÇ
  const STAGES = [
    {
      name: 'ÊóÖÁ´ã„Å°',
      board: [
        ['CÈ¶ô','CÊ°Ç','CÈäÄ','CÈáë','CÁéã','CÈáë','CÈäÄ','CÊ°Ç','CÈ¶ô'],
        ['','CÈ£õ', '','',   '',   '',   '','CËßí',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   '',   '',   'PÈ£õ','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÊ°Ç','PÈ¶ô'],
      ],
      // ÂêÑÈßí„ÅÆÂãï„Åç„Çø„Ç§„Éó
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn'
      }
    },
    {
      name: 'ÂøçËÄÖ„ÅÆË©¶Á∑¥',
      board: [
        ['CÈ¶ô','CÂøç','CÈäÄ','CÈáë','CÁéã','CÈáë','CÂΩ±','CÊ°Ç','CÈ¶ô'],
        ['','CÁ†≤', '','',   '',   '',   '','CËßí',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   '',   '',   'PÈ£õ','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂøç','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'Âøç':'ninja','ÂΩ±':'shadow','Á†≤':'cannon'
      }
    },
    {
      name: 'Â§ßÈñÄ',
      board: [
        ['CÈ¶ô','CÂΩ±','CÈäÄ','CÈáë','CÁéã','CÈáë','CÂΩ±','CÊ°Ç','CÈ¶ô'],
        ['','CÈ£õ', '','',   'CÁ†≤','',   '','CËßí',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon'
      }
    },
    {
      name: 'Âè§Âüé',
      board: [
        ['CÈ¶ô','CÁ´ú','CÈäÄ','CÈáë','CÁéã','CÈáë','CÈ≥≥','CÊ°Ç','CÈ¶ô'],
        ['','CÈ£õ', '','',   'CÁ†≤','',   '','CËßí',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix'
      }
    },
    {
      name: 'ÁÇé„ÅÆ„ÉÄ„É≥„Ç∏„Éß„É≥',
      board: [
        ['CÈ¶ô','CÁÇé','CÈäÄ','CÈáë','CÁéã','CÈáë','CÁÅ´','CÊ°Ç','CÈ¶ô'],
        ['','CÈ£õ', '','',   'CÁ†≤','',   '','CËßí',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire'
      }
    },
    {
      name: 'Ê∞¥„ÅÆ„ÉÄ„É≥„Ç∏„Éß„É≥',
      board: [
        ['CÈ¶ô','CÊ∞¥','CÈäÄ','CÈáë','CÁéã','CÈáë','CÊ≥¢','CÊ°Ç','CÈ¶ô'],
        ['','CÈ£õ', '','',   'CÁ†≤','',   '','CËßí',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave'
      }
    },
    {
      name: 'Êú®„ÅÆ„ÉÄ„É≥„Ç∏„Éß„É≥',
      board: [
        ['CÈ¶ô','CÊú®','CÈäÄ','CÈáë','CÁéã','CÈáë','CËëâ','CÊ°Ç','CÈ¶ô'],
        ['','CÈ£õ', '','',   'CÁ†≤','',   '','CËßí',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf'
      }
    },
    {
      name: 'ÂÖâ„ÅÆ„ÉÄ„É≥„Ç∏„Éß„É≥',
      board: [
        ['CÈ¶ô','CÂÖâ','CÈäÄ','CÈáë','CÁéã','CÈáë','CÊòü','CÊ°Ç','CÈ¶ô'],
        ['','CÈ£õ', '','',   'CÁ†≤','',   '','CËßí',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star'
      }
    },
    {
      name: 'Èóá„ÅÆ„ÉÄ„É≥„Ç∏„Éß„É≥',
      board: [
        ['CÈ¶ô','CÈóá','CÈäÄ','CÈáë','CÁéã','CÈáë','CÈ≠î','CÊ°Ç','CÈ¶ô'],
        ['','CÈ£õ', '','',   'CÁ†≤','',   '','CËßí',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
                'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon'
      }
    },
    // Stage 10 (Âè§Èâ±Â±±) - New Addition
    {
      name: 'Âè§Èâ±Â±±',
      board: [
        ['CÈ¶ô','CÈäÖ','CÈå´','CÈáë','CÁéã','CÈáë','CÈâÑ','CÈâõ','CÈ¶ô'],
        ['','CÈ£õ', '','',   '','',   '','CËßí',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','X','X','X','',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   '','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈå´','PÈâõ','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead'
      }
    },
    // Stage 11 (ÂÆùÂ≥∂) - New Addition
    {
      name: 'ÂÆùÂ≥∂',
      board: [
        ['CÈ¶ô','CÂÆù','CÈäÄ','CÈáë','CÁéã','CÈáë','CÂÆù','CÊ°Ç','CÈ¶ô'],
        ['','CÈ£õ', '','',   'CÁ†≤','',   '','CËßí',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure'
      }
    },
    // Stage 12 (Â§âÈõªÊâÄ) - New Addition
    {
      name: 'Â§âÈõªÊâÄ',
      board: [
        ['CÈ¶ô','CÊ°Ç','CÈâÑ','CÈáë','CÁéã','CÈáë','CÈâÑ','CÊ°Ç','CÈ¶ô'],
        ['','CÈõª', '','',   '','',   '','CÈõ∑',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure','Èõª':'electric','Èõ∑':'thunder'
      }
    },
    // Stage 13 (ÊôÇÁ©∫„ÅÆËø∑ÂÆÆ) - New Addition
    {
      name: 'ÊôÇÁ©∫„ÅÆËø∑ÂÆÆ',
      board: [
        ['CÊôÇ','CÊ°Ç','CÈäÄ','CÈáë','CÁéã','CÈáë','CÈäÄ','CÊ°Ç','CÊôÇ'],
        ['','CÈ£õ', '','',   '',   '',   '','CËßí',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure','Èõª':'electric','Èõ∑':'thunder',
        'ÊôÇ':'time'
      }
    },
    // Stage 14 (Ê∞∑„ÅÆÂüé) - New Addition
    {
      name: 'Ê∞∑„ÅÆÂüé',
      board: [
        ['CÈ¶ô','CÊ°Ç','CÈõ™','CÈáë','CÁéã','CÈáë','CÈõ™','CÊ°Ç','CÈ¶ô'],
        ['','CÈ£õ', '','CÊ∞∑','CÊ∞∑','CÊ∞∑','','CËßí',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure','Èõª':'electric','Èõ∑':'thunder',
        'ÊôÇ':'time','Ê∞∑':'ice','Èõ™':'snow'
      }
    },
    // Stage 15 (Á†ÇÊº†„ÅÆÈÅ∫Ë∑°) - New Addition
    {
      name: 'Á†ÇÊº†„ÅÆÈÅ∫Ë∑°',
      board: [
        ['CÈ¶ô','CÊ°Ç','CÈäÄ','CÈáë','CÁéã','CÈáë','CÈäÄ','CÊ°Ç','CÈ¶ô'],
        ['','', 'CÈ¢®','',   '','',   'CÈ¢®','',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÁ†Ç','CÁ†Ç','CÁ†Ç','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure','Èõª':'electric','Èõ∑':'thunder',
        'ÊôÇ':'time','Ê∞∑':'ice','Èõ™':'snow','Á†Ç':'sand','È¢®':'wind'
      }
    },
    // Stage 16 (Êµ∑Â∫ïÁ•ûÊÆø) - New Addition
    {
      name: 'Êµ∑Â∫ïÁ•ûÊÆø',
      board: [
        ['CÈ¶ô','CÊ°Ç','CËãî','CÈáë','CÁéã','CÈáë','CËãî','CÊ°Ç','CÈ¶ô'],
        ['','', 'CÈ≠ö','',   'CÈ≠ö','',   'CÈ≠ö','',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure','Èõª':'electric','Èõ∑':'thunder',
        'ÊôÇ':'time','Ê∞∑':'ice','Èõ™':'snow','Á†Ç':'sand','È¢®':'wind','Ëãî':'moss','È≠ö':'fish'
      }
    },
    // Stage 17 (Èõ≤„ÅÆÊ•ΩÂúí) - New Addition
    {
      name: 'Èõ≤„ÅÆÊ•ΩÂúí',
      board: [
        ['CÈ¶ô','CÊ°Ç','CÈäÄ','CÈáë','CÁéã','CÈáë','CÈäÄ','CÊ°Ç','CÈ¶ô'],
        ['','', 'CÈõ≤','',   'CËôπ','',   'CÈõ≤','',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','X','','X',   '',   'X','',   'X',''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure','Èõª':'electric','Èõ∑':'thunder',
        'ÊôÇ':'time','Ê∞∑':'ice','Èõ™':'snow','Á†Ç':'sand','È¢®':'wind','Ëãî':'moss','È≠ö':'fish','Èõ≤':'cloud','Ëôπ':'rainbow'
      }
    },
    // Stage 18 (Âú∞Â∫ï„ÅÆÊ¥ûÁ™ü) - New Addition
    {
      name: 'ÊØí„ÅÆÊ≤ºÂú∞',
      board: [
        ['CÈ¶ô','CÊØí','CÊ≤º','CÈáë','CÁéã','CÈáë','CÊ≤º','CÊØí','CÈ¶ô'],
        ['','CÈ£õ', '','',   'CÊ≤º','',   '','CËßí',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure','Èõª':'electric','Èõ∑':'thunder',
        'ÊôÇ':'time','Ê∞∑':'ice','Èõ™':'snow','Á†Ç':'sand','È¢®':'wind','Ëãî':'moss','È≠ö':'fish','Èõ≤':'cloud','Ëôπ':'rainbow',
        'ÊØí':'poison','Ê≤º':'swamp'
      }
    },
    // Stage 19 (Èè°„ÅÆÈñì) - New Addition
    {
      name: 'Èè°„ÅÆÈñì',
      board: [
        ['CÈ¶ô','CÈè°','CÈäÄ','CÈáë','CÁéã','CÈáë','CÈäÄ','CÈè°','CÈ¶ô'],
        ['','', 'CÈ£õ','',   '','',   'CËßí','',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊò†','CÊ≠©','CÊò†','CÊ≠©','CÊò†','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   'X',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure','Èõª':'electric','Èõ∑':'thunder',
        'ÊôÇ':'time','Ê∞∑':'ice','Èõ™':'snow','Á†Ç':'sand','È¢®':'wind','Ëãî':'moss','È≠ö':'fish','Èõ≤':'cloud','Ëôπ':'rainbow',
        'ÊØí':'poison','Ê≤º':'swamp','Èè°':'mirror','Êò†':'reflection'
      }
    },
    // Stage 20 (‰∫úÁ©∫Èñì) - New Addition
    {
      name: '‰∫úÁ©∫Èñì',
      board: [
        ['CÈ¶ô','CÊ°Ç','CÈäÄ','CÈáë','CÁéã','CÈáë','CÈäÄ','CÊ°Ç','CÈ¶ô'],
        ['','CÈ£õ', 'CÈõ≤','',   'C„ÅÇ','',   'CÈõ≤','CËßí',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','X','',   '',   '',   'X',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure','Èõª':'electric','Èõ∑':'thunder',
        'ÊôÇ':'time','Ê∞∑':'ice','Èõ™':'snow','Á†Ç':'sand','È¢®':'wind','Ëãî':'moss','È≠ö':'fish','Èõ≤':'cloud','Ëôπ':'rainbow',
        '„ÅÇ':'ah','ÊØí':'poison','Ê≤º':'swamp','Èè°':'mirror','Êò†':'reflection',
      }
    },
     // Stage 21 (Èóá„ÅÆÂú∞‰∏ãÁâ¢) - New Addition
     {
      name: 'Èóá„ÅÆÂú∞‰∏ãÁâ¢',
      board: [
        ['CÈ¶ô','CÊ°Ç','CÁâ¢','CÈáë','CÁéã','CÈáë','CÁâ¢','CÊ°Ç','CÈ¶ô'],
        ['','CÈ£õ', '','',   'CÈóá','',   '','CËßí',   ''   ],
        ['CÊ≠©','CÊüµ','CÊ≠©','CÊüµ','CÊ≠©','CÊüµ','CÊ≠©','CÊüµ','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','X','',   '',   '',   'X',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure','Èõª':'electric','Èõ∑':'thunder',
        'ÊôÇ':'time','Ê∞∑':'ice','Èõ™':'snow','Á†Ç':'sand','È¢®':'wind','Ëãî':'moss','È≠ö':'fish','Èõ≤':'cloud','Ëôπ':'rainbow',
        '„ÅÇ':'ah','ÊØí':'poison','Ê≤º':'swamp','Èè°':'mirror','Êò†':'reflection','Áâ¢':'prison','Êüµ':'fence',
      }
    },
         // Stage 22 (È´òÂ±±) - New Addition
         {
      name: 'È´òÂ±±',
      board: [
        ['CÈ¶ô','CÊ°Ç','CÈäÄ','CÂ≥∞','CÁéã','CÂ≥∞','CÈäÄ','CÊ°Ç','CÈ¶ô'],
        ['','CÈ£õ', '','',   'CÂ∂∫','',   '','CËßí',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÂ∂∫','CÊ≠©','CÂ∂∫','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   'X',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure','Èõª':'electric','Èõ∑':'thunder',
        'ÊôÇ':'time','Ê∞∑':'ice','Èõ™':'snow','Á†Ç':'sand','È¢®':'wind','Ëãî':'moss','È≠ö':'fish','Èõ≤':'cloud','Ëôπ':'rainbow',
        '„ÅÇ':'ah','ÊØí':'poison','Ê≤º':'swamp','Èè°':'mirror','Êò†':'reflection','Áâ¢':'prison','Êüµ':'fence','Â∂∫':'ridge','Â≥∞':'peak',
      }
    },
             // Stage 23 (Âú∞Â∫ï„ÅÆÊ¥ûÁ™ü) - New Addition
             {
      name: 'Âú∞Â∫ï„ÅÆÊ¥ûÁ™ü',
      board: [
        ['CÈ¶ô','CÂ≤©','CÈäÄ','CÈáë','CÁéã','CÈáë','CÈäÄ','CÂ≤©','CÈ¶ô'],
        ['','CÈâ±', '','CÈâ±',   '','CÈâ±',   '','CÈâ±',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '‚Üê',   '‚Üì',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','‚Üë','‚Üí',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure','Èõª':'electric','Èõ∑':'thunder',
        'ÊôÇ':'time','Ê∞∑':'ice','Èõ™':'snow','Á†Ç':'sand','È¢®':'wind','Ëãî':'moss','È≠ö':'fish','Èõ≤':'cloud','Ëôπ':'rainbow',
        '„ÅÇ':'ah','ÊØí':'poison','Ê≤º':'swamp','Èè°':'mirror','Êò†':'reflection','Áâ¢':'prison','Êüµ':'fence','Â∂∫':'ridge','Â≥∞':'peak','Â≤©':'rock','Èâ±':'ore',
        '‚Üë':'arrow-up','‚Üê':'arrow-left','‚Üì':'arrow-down','‚Üí':'arrow-right',
      }
    },
    
    // Stage 24 (Âë™„ÅÑ„ÅÆÂ¢ìÂ†¥) - New Addition
    {
      name: 'Âë™„ÅÑ„ÅÆÂ¢ìÂ†¥',
      board: [
        ['CÈ¶ô','CÂ¢ì','CÈäÄ','CÈáë','CÁéã','CÈáë','CÈäÄ','CÂ¢ì','CÈ¶ô'],
        ['','CÈ£õ', '','',   '',   '',   '','CËßí',   ''   ],
        ['CÊ≠©','CÈúä','CÊ≠©','CÊ≠©','CÈúä','CÊ≠©','CÊ≠©','CÈúä','CÊ≠©'],
        ['','','','n',   '',   'n',   '',   '',   ''   ],
        ['','n','','',   'n',   '',   '',   'n',   ''   ],
        ['','','','n',   '',   'n',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   '',   '',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÊ°Ç','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'Âøç':'ninja','ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure','Èõª':'electric','Èõ∑':'thunder',
        'ÊôÇ':'time','Ê∞∑':'ice','Èõ™':'snow','Á†Ç':'sand','È¢®':'wind','Ëãî':'moss','È≠ö':'fish','Èõ≤':'cloud','Ëôπ':'rainbow',
        'ÊØí':'poison','Ê≤º':'swamp','Èè°':'mirror','Êò†':'reflection',
        '„ÅÇ':'ah','Áâ¢':'prison','Êüµ':'fence','Â∂∫':'ridge','Â≥∞':'peak',
        'Â¢ì':'grave','Èúä':'spirit',
        '‚Üë':'arrow-up','‚Üê':'arrow-left','‚Üì':'arrow-down','‚Üí':'arrow-right',
        'n':'curse-tile',
      }
    },
    
    // Stage 25 (Âπª„ÅÆÊ£Æ) - New Addition
    {
      name: 'Âπª„ÅÆÊ£Æ',
      board: [
        ['CÈ¶ô','CÊ°Ç','CÈäÄ','CÈáë','CÁéã','CÈáë','CÈäÄ','CÊ°Ç','CÈ¶ô'],
        ['','CÈ£õ', 'CÈúß','',   '','',   'CÈúß','CËßí',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÂπª','CÈúß','CÂπª','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure','Èõª':'electric','Èõ∑':'thunder',
        'ÊôÇ':'time','Ê∞∑':'ice','Èõ™':'snow','Á†Ç':'sand','È¢®':'wind','Ëãî':'moss','È≠ö':'fish','Èõ≤':'cloud','Ëôπ':'rainbow',
        'ÊØí':'poison','Ê≤º':'swamp','Èè°':'mirror','Êò†':'reflection',
        '„ÅÇ':'ah','Áâ¢':'prison','Êüµ':'fence','Â∂∫':'ridge','Â≥∞':'peak',
        'Â¢ì':'grave','Èúä':'spirit','Âπª':'phantom','Èúß':'mist'
      }
    },
    
    // Stage 26 (ÊúàÂÖâ„ÅÆÊπñ) - New Addition
    {
      name: 'ÊúàÂÖâ„ÅÆÊπñ',
      board: [
        ['CÈ¶ô','CÊ°Ç','CÊ≥¢','CÈáë','CÁéã','CÈáë','CÊ≥¢','CÊ°Ç','CÈ¶ô'],
        ['','CÈ£õ', '','',   'CÊúà',   '',   '','CËßí',   ''   ],
        ['CÊ≠©','CÊ≠©','CËàü','CÊ≠©','CËàü','CÊ≠©','CËàü','CÊ≠©','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','n','X','n',   '',   'n',   'X',   'n',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure','Èõª':'electric','Èõ∑':'thunder',
        'ÊôÇ':'time','Ê∞∑':'ice','Èõ™':'snow','Á†Ç':'sand','È¢®':'wind','Ëãî':'moss','È≠ö':'fish','Èõ≤':'cloud','Ëôπ':'rainbow',
        'ÊØí':'poison','Ê≤º':'swamp','Èè°':'mirror','Êò†':'reflection',
        '„ÅÇ':'ah','Áâ¢':'prison','Êüµ':'fence','Â∂∫':'ridge','Â≥∞':'peak',
        'Â¢ì':'grave','Èúä':'spirit','Âπª':'phantom','Èúß':'mist','Êúà':'moon','Ëàü':'boat'
      }
    },
    
    // Stage 27 (Ê©üÊ¢∞ÈÉΩÂ∏Ç) - New Addition
    {
      name: 'Ê©üÊ¢∞ÈÉΩÂ∏Ç',
      board: [
        ['CÈ¶ô','CÈõª','CÊ©ü','CÈáë','CÁéã','CÈáë','CÊ©ü','CÈõª','CÈ¶ô'],
        ['','CÈ£õ', '','',   'CÈõª',   '',   '','CËßí',   ''   ],
        ['CÊ≠©','CÊ≠Ø','CÊ≠Ø','CÊ≠Ø','CÊ≠©','CÊ≠Ø','CÊ≠Ø','CÊ≠Ø','CÊ≠©'],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['','','','',   '',   '',   '',   '',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','', 'PËßí','',   'PÁ†≤','',   'PËßí','',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÂΩ±','PÈ¶ô'],
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure','Èõª':'electric','Èõ∑':'thunder',
        'ÊôÇ':'time','Ê∞∑':'ice','Èõ™':'snow','Á†Ç':'sand','È¢®':'wind','Ëãî':'moss','È≠ö':'fish','Èõ≤':'cloud','Ëôπ':'rainbow',
        'ÊØí':'poison','Ê≤º':'swamp','Èè°':'mirror','Êò†':'reflection',
        '„ÅÇ':'ah','Áâ¢':'prison','Êüµ':'fence','Â∂∫':'ridge','Â≥∞':'peak',
        'Â¢ì':'grave','Èúä':'spirit','Âπª':'phantom','Èúß':'mist','Êúà':'moon','Ëàü':'boat','Ê©ü':'machine','Ê≠Ø':'gear'
      }
    },
    
    // Stage 28 (ÁßòÂ¢ÉÊùë) - New Addition
    {
      stage: 28,
      name: 'ÁßòÂ¢ÉÊùë',
      description: 'ÈùôÂØÇ„ÅÆ‰∏≠„ÅÆÊà¶„ÅÑ',
      board: [
        ['CÈ¶ô','CÂÆ∂','CÊ°Ç','CÈáë','CÁéã','CÈáë','CÊ°Ç','CÂÆ∂','CÈ¶ô'],
        ['','CÈ£õ', '','',   'CÁïë',   '',   '','CËßí',   ''   ],
        ['CÊ≠©','CÊ∞ë','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ∞ë','CÊ≠©'],
        ['','',   '','',   '','',   '','',   '','',   ''   ],
        ['','',   'n','‚Üì',   'n','‚Üë',   'n','',   '','',   ''   ],
        ['','',   '','',   '','',   '','',   '','',   ''   ],
        ['PÊ≠©','PÊ∞ë','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ∞ë','PÊ≠©'],
        ['','PËßí', '','',   'PÁïë',   '',   '','PÈ£õ',   ''   ],
        ['PÈ¶ô','PÂÆ∂','PÊ°Ç','PÈáë','PÁéã','PÈáë','PÊ°Ç','PÂÆ∂','PÈ¶ô']
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure','Èõª':'electric','Èõ∑':'thunder',
        'ÊôÇ':'time','Ê∞∑':'ice','Èõ™':'snow','Á†Ç':'sand','È¢®':'wind','Ëãî':'moss','È≠ö':'fish','Èõ≤':'cloud','Ëôπ':'rainbow',
        'ÊØí':'poison','Ê≤º':'swamp','Èè°':'mirror','Êò†':'reflection',
        '„ÅÇ':'ah','Áâ¢':'prison','Êüµ':'fence','Â∂∫':'ridge','Â≥∞':'peak',
        'Â¢ì':'grave','Èúä':'spirit','Âπª':'phantom','Èúß':'mist','Êúà':'moon','Ëàü':'boat','Ê©ü':'machine','Ê≠Ø':'gear',
        'ÂÆ∂':'house','Ê∞ë':'people','Áïë':'field'
      }
    },
    
    // Stage 29 (Á´ú„ÅÆÊ≥â) - New Addition
    {
      stage: 29,
      name: 'Á´ú„ÅÆÊ≥â',
      description: 'ËÅñ„Å™„ÇãÂäõ„ÅÆÊà¶„ÅÑ',
      board: [
        ['CÈ¶ô','CÊ°Ç','CÈäÄ','CÁ´ú','CÁéã','CÁ´ú','CÈäÄ','CÊ°Ç','CÈ¶ô'],
        ['','CÈ£õ', '','',   'CÊ≥â',   '',   '','CËßí',   ''   ],
        ['CÊ≠©','CÈ¢®','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÈ¢®','CÊ≠©'],
        ['','',   '','',   '','',   '','',   '','',   ''   ],
        ['','‚Üê',   '‚Üí','',   'X','',   '‚Üê','‚Üí',   '','',   ''   ],
        ['','',   '','',   '','',   '','',   '','',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','PËßí', '','',   'PÊ≥â',   '',   '','PÈ£õ',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÊ°Ç','PÈ¶ô']
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure','Èõª':'electric','Èõ∑':'thunder',
        'ÊôÇ':'time','Ê∞∑':'ice','Èõ™':'snow','Á†Ç':'sand','È¢®':'wind','Ëãî':'moss','È≠ö':'fish','Èõ≤':'cloud','Ëôπ':'rainbow',
        'ÊØí':'poison','Ê≤º':'swamp','Èè°':'mirror','Êò†':'reflection',
        '„ÅÇ':'ah','Áâ¢':'prison','Êüµ':'fence','Â∂∫':'ridge','Â≥∞':'peak',
        'Â¢ì':'grave','Èúä':'spirit','Âπª':'phantom','Èúß':'mist','Êúà':'moon','Ëàü':'boat','Ê©ü':'machine','Ê≠Ø':'gear',
        'ÂÆ∂':'house','Ê∞ë':'people','Áïë':'field','Ê≥â':'spring', 'Ëæ∞':'dragonAwakened'
      }
    },
    
    // Stage 30 (KÁ†îÁ©∂ÊâÄ) - Final Boss Stage
    {
      stage: 30,
      name: 'KÁ†îÁ©∂ÊâÄ',
      description: 'ÈÇ™ÊÇ™„Å™ÂÆüÈ®ì„Å´Â∑ª„ÅçËæº„Åæ„Çå„ÅüÊà¶„ÅÑ',
      board: [
        ['CÈ¶ô','CÊ°Ç','CÈäÄ','CÈáë','CÁéã','CÈáë','CÈäÄ','CÊ°Ç','CÈ¶ô'],
        ['','CÂÆü', '','',   'CK',   '',   '','CÂÆü',   ''   ],
        ['CÁÇé','CÊ≠©','CÊ∞¥','CÊ≠©','CÊú®','CÊ≠©','CÂÖâ','CÊ≠©','CÈóá'],
        ['','',   '','',   '','',   '','',   '','',   ''   ],
        ['','',   '','',   '','',   '','',   '','',   ''   ],
        ['','',   '','',   '','',   '','',   '','',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','PËßí', '','',   'PK',   '',   '','PÈ£õ',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÊ°Ç','PÈ¶ô']
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure','Èõª':'electric','Èõ∑':'thunder',
        'ÊôÇ':'time','Ê∞∑':'ice','Èõ™':'snow','Á†Ç':'sand','È¢®':'wind','Ëãî':'moss','È≠ö':'fish','Èõ≤':'cloud','Ëôπ':'rainbow',
        'ÊØí':'poison','Ê≤º':'swamp','Èè°':'mirror','Êò†':'reflection',
        '„ÅÇ':'ah','Áâ¢':'prison','Êüµ':'fence','Â∂∫':'ridge','Â≥∞':'peak',
        'Â¢ì':'grave','Èúä':'spirit','Âπª':'phantom','Èúß':'mist','Êúà':'moon','Ëàü':'boat','Ê©ü':'machine','Ê≠Ø':'gear',
        'ÂÆ∂':'house','Ê∞ë':'people','Áïë':'field','Ê≥â':'spring', 'Ëæ∞':'dragonAwakened',
        'K':'k', 'ÂÆü':'experiment', 'Áï∞':'mutant'
      }
    },
        // Stage 31 (Èñ¢„Ç±Âéü) - middle Boss Stage
        {
      stage: 31,
      name: 'Èñ¢„Ç±Âéü',
      description: 'Êà¶ÂõΩÊôÇ‰ª£„ÅÆÊà¶„ÅÑ',
      board: [
        ['CÈ¶ô','CÊ°Ç','CÈéß','CÈáë','CÁéã','CÈáë','CÈéß','CÊ°Ç','CÈ¶ô'],
        ['','CÈäÉ', '','',   '',   '',   '','CÈäÉ',   ''   ],
        ['CÊ≠©','CÂàÄ','CÊ≠©','CÂàÄ','CÊ≠©','CÂàÄ','CÊ≠©','CÂàÄ','CÊ≠©'],
        ['','',   '','',   '','',   '','',   '','',   ''   ],
        ['','',   '','',   '','',   '','',   '','',   ''   ],
        ['','',   '','',   '','',   '','',   '','',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','PËßí', '','',   'PK',   '',   '','PÈ£õ',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÊ°Ç','PÈ¶ô']
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure','Èõª':'electric','Èõ∑':'thunder',
        'ÊôÇ':'time','Ê∞∑':'ice','Èõ™':'snow','Á†Ç':'sand','È¢®':'wind','Ëãî':'moss','È≠ö':'fish','Èõ≤':'cloud','Ëôπ':'rainbow',
        'ÊØí':'poison','Ê≤º':'swamp','Èè°':'mirror','Êò†':'reflection',
        '„ÅÇ':'ah','Áâ¢':'prison','Êüµ':'fence','Â∂∫':'ridge','Â≥∞':'peak',
        'Â¢ì':'grave','Èúä':'spirit','Âπª':'phantom','Èúß':'mist','Êúà':'moon','Ëàü':'boat','Ê©ü':'machine','Ê≠Ø':'gear',
        'ÂÆ∂':'house','Ê∞ë':'people','Áïë':'field','Ê≥â':'spring', 'Ëæ∞':'dragonAwakened',
        'K':'k', 'ÂÆü':'experiment', 'Áï∞':'mutant', 'ÂàÄ':'sword', 'Èéß':'armor', 'ÈäÉ':'gun'
      }
    },
        // Stage 32 (Á¶ÅÊõ∏Â∫´) - Knowledge Stage
        {
      stage: 32,
      name: 'Á¶ÅÊõ∏Â∫´',
      description: 'Â∞ÅÂç∞„Åï„Çå„ÅüÁü•Ë≠ò„ÅÆÂÆùÂ∫´',
      board: [
        ['CÈ¶ô','CÊ°Ç','CÈäÄ','CÈáë','CÁéã','CÈáë','CÈäÄ','CÊ°Ç','CÈ¶ô'],
        ['','CÊüµ', 'CÊõ∏','CÈâÑ',   '',   'CÊüµ',   'CÊõ∏','CÈâÑ',   ''   ],
        ['CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©','CÂ∞Å','CÊ≠©','CÊ≠©','CÊ≠©','CÊ≠©'],
        ['','',   '','',   '','',   '','',   '','',   ''   ],
        ['','',   '','',   '','',   '','',   '','',   ''   ],
        ['','',   '','',   '','',   '','',   '','',   ''   ],
        ['PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©','PÊ≠©'],
        ['','PËßí', '','',   'PK',   '',   '','PÈ£õ',   ''   ],
        ['PÈ¶ô','PÊ°Ç','PÈäÄ','PÈáë','PÁéâ','PÈáë','PÈäÄ','PÊ°Ç','PÈ¶ô']
      ],
      pieces: {
        'Áéã':'king','Áéâ':'king','È£õ':'rook','Ëßí':'bishop','Èáë':'gold','ÈäÄ':'silver','Ê°Ç':'knight','È¶ô':'lance','Ê≠©':'pawn',
        'ÂΩ±':'shadow','Á†≤':'cannon','Á´ú':'dragon','È≥≥':'phoenix','ÁÇé':'flame','ÁÅ´':'fire','Ê∞¥':'water','Ê≥¢':'wave','Êú®':'tree','Ëëâ':'leaf',
        'ÂÖâ':'light','Êòü':'star','Èóá':'dark','È≠î':'demon',
        'ÈäÖ':'copper','ÈâÑ':'iron','Èå´':'tin','Èâõ':'lead',
        'ÂÆù':'treasure','Èõª':'electric','Èõ∑':'thunder',
        'ÊôÇ':'time','Ê∞∑':'ice','Èõ™':'snow','Á†Ç':'sand','È¢®':'wind','Ëãî':'moss','È≠ö':'fish','Èõ≤':'cloud','Ëôπ':'rainbow',
        'ÊØí':'poison','Ê≤º':'swamp','Èè°':'mirror','Êò†':'reflection',
        '„ÅÇ':'ah','Áâ¢':'prison','Êüµ':'fence','Â∂∫':'ridge','Â≥∞':'peak',
        'Â¢ì':'grave','Èúä':'spirit','Âπª':'phantom','Èúß':'mist','Êúà':'moon','Ëàü':'boat','Ê©ü':'machine','Ê≠Ø':'gear',
        'ÂÆ∂':'house','Ê∞ë':'people','Áïë':'field','Ê≥â':'spring', 'Ëæ∞':'dragonAwakened',
        'K':'k', 'ÂÆü':'experiment', 'Áï∞':'mutant', 'ÂàÄ':'sword', 'Èéß':'armor', 'ÈäÉ':'gun', 'Êõ∏':'book', 'Â∞Å':'seal'
      }
    },
  ];

  // „Ç≤„Éº„É†Áä∂ÊÖã
  const state = {
    board: [],
    currentPlayer: 'player',
    selected: null,
    validMoves: [],
    hands: {player: [], computer: []},
    gameOver: false,
    turnCount: 0,
    stageIndex: 0,
    // 1ÊâãÊàª„ÅôÊ©üËÉΩÁî®„ÅÆÂ±•Ê≠¥
    moveHistory: [],
    maxHistorySize: 50, // ÊúÄÂ§ßÂ±•Ê≠¥Êï∞
    // ÊØí„Éû„ÇπÁÆ°ÁêÜ
    poisonSquares: [],
    // ÊØí„ÅÆÈßí„ÅÆÁßªÂãïÂ±•Ê≠¥ÔºàÈÅéÂéª2„Çø„Éº„É≥ÂàÜÔºâ
    poisonHistory: [],
    // Â≤©„ÅÆÈöúÂÆ≥Áâ©ÁÆ°ÁêÜ
    rockBarriers: [],
    // ÊØíÁä∂ÊÖã„ÅÆÈßí„ÇíËøΩË∑°
    poisonedPieces: [],
    // Êúà„ÅÆÈßíÂ∞ÇÁî®„ÅÆ„Çø„Éº„É≥„Ç´„Ç¶„É≥„Çø„ÉºÔºà„Éó„É¨„Ç§„É§„Éº„Å®„Ç≥„É≥„Éî„É•„Éº„ÇøÂà•Ôºâ
    moonTurnCount: { player: 0, computer: 0 },
  // Ë°åÂãï‰∏çËÉΩÁä∂ÊÖã„ÅÆÈßí„ÇíËøΩË∑°
  imprisonedPieces: [],
  // Âë™„ÅÑ„Éû„Çπ„ÅÆ‰ΩçÁΩÆ„ÇíÊ∞∏Á∂öÁöÑ„Å´Ë®òÈå≤ÔºàÁµ∂ÂØæ„Å´Ê∂à„Åà„Å™„ÅÑÔºâ
  permanentCurseTiles: [],
  // Áü¢Âç∞„Éû„Çπ„ÅÆ‰ΩçÁΩÆ„ÇíÊ∞∏Á∂öÁöÑ„Å´Ë®òÈå≤ÔºàÁµ∂ÂØæ„Å´Ê∂à„Åà„Å™„ÅÑÔºâ
  permanentArrowTiles: []
};

// ÁîªÊï∞„ÉÅ„Çß„ÉÉ„ÇØÈñ¢Êï∞Ôºà10Áîª‰ª•‰∏ä„ÅÆÊº¢Â≠ó„ÇíÂà§ÂÆöÔºâ
function hasHighStrokeCount(piece) {
  // 10Áîª‰ª•‰∏ä„ÅÆÊº¢Â≠ó„ÅÆ„É™„Çπ„ÉàÔºà‰∏ªË¶Å„Å™„ÇÇ„ÅÆÔºâ
  const highStrokeChars = [
    'Èõ≤', 'Èõ∑', 'Èõª', 'Èæç', 'È≥≥', 'È≥•', 'È≠ö', 'È¶¨', 'Ë±°', 'Ëôé', 'ÁÜä', 'Áãº', 'Áãê', 'Áå´', 'Áä¨', 'Áâõ', 'Áæä', 'Áå™', 'Èπø', 'Áåø',
    'Ê£Æ', 'Êûó', 'Êú®', 'Á´π', 'Ëçâ', 'Ëä±', 'Ëëâ', 'Ê†π', 'Êûù', 'Êûú', 'ÂÆü', 'Á®Æ', 'ËäΩ', 'Ëïæ', 'È¶ô', 'Ëá≠', 'Âë≥', 'Áîò', 'Ëæõ', 'Ëã¶',
    'Â±±', 'Â∑ù', 'Êµ∑', 'Êπñ', 'Ê±†', 'Ê≤º', 'Â≥∂', 'Â≤∏', 'Â≤©', 'Áü≥', 'Á†Ç', 'Âúü', 'Ê≥•', 'Ê∞¥', 'ÁÅ´', 'È¢®', 'Èõ®', 'Èõ™', 'Ê∞∑', 'Èúú',
    'Èáë', 'ÈäÄ', 'ÈäÖ', 'ÈâÑ', 'Èãº', 'Áéâ', 'Áè†', 'ÂÆù', 'Ë≤°', 'ÂØå', 'Ë≤¥', 'È´ò', 'Â§ß', 'Â∑®', 'Èï∑', 'Â∫É', 'Ê∑±', 'Âéö', 'Èáç', 'ËªΩ',
    'Áæé', 'È∫ó', 'ËèØ', 'Ë±™', 'Â£Æ', 'ÈõÑ', 'Âãá', 'Âº∑', 'Ââõ', 'Á°¨', 'Êüî', 'Ëªü', 'Ê∏©', 'ÂÜ∑', 'ÁÜ±', 'Êöñ', 'Ê∂º', 'ÂØí', 'Êöë', 'Êöñ',
    'Êñ∞', 'Âè§', 'Êóß', 'ËÄÅ', 'Ëã•', 'Â∞ë', 'Â§ö', 'Â∞ë', 'ÂÖ®', 'Âçä', 'ÈÉ®', 'ÂàÜ', 'Âêà', 'Èõ¢', 'Âà•', 'Âêå', 'Áï∞', 'Â§â', 'Âåñ', 'Êàê',
    'Áîü', 'Ê≠ª', 'Ê¥ª', 'Âãï', 'Èùô', 'Ê≠¢', 'ÈÄ≤', 'ÈÄÄ', '‰∏ä', '‰∏ã', 'Â∑¶', 'Âè≥', 'Ââç', 'Âæå', 'ÂÜÖ', 'Â§ñ', '‰∏≠', 'Èñì', 'Âë®', 'Ëæ∫',
    'Âßã', 'ÁµÇ', 'Èñã', 'Èñâ', 'Âá∫', 'ÂÖ•', 'Êù•', 'Âéª', 'Ë°å', 'Êù•', 'Â∏∞', 'Ëøî', 'Âõû', 'Ëª¢', 'Áßª', 'Âãï', 'ÊµÅ', 'È£õ', 'Ëµ∞', 'Ê≠©',
    'Ë¶ã', 'ËÅû', 'Áü•', 'Ë¶ö', 'ÊÄù', 'ËÄÉ', 'ÊÉ≥', 'Âøµ', 'ÊÑü', 'ÊÉÖ', 'ÊÑõ', 'ÊÜé', 'Âñú', 'ÊÇ≤', 'ÊÄí', 'Ê•Ω', 'Ëã¶', 'Áóõ', 'Âø´', 'ÊÖ¢',
    'Ë®Ä', 'Ë™û', 'Ë©±', 'Ë´á', 'Ë´ñ', 'Ë≠∞', 'Ë™¨', 'Ëß£', 'Á≠î', 'Âïè', 'Á≠î', 'Êïô', 'Â≠¶', 'Áøí', 'Á∑¥', '‰øÆ', 'Ê≤ª', 'ÁêÜ', 'Êï¥', 'Ê≠£',
    'Áâ¢', 'Êüµ', 'Â∂∫', 'Â≥∞', 'Â±±', 'Êò†', '„ÅÇ', 'ÁµÇ', 'ÁÑâ'
  ];
  
  return highStrokeChars.includes(piece);
}

// Ë°åÂãï‰∏çËÉΩÁä∂ÊÖã„ÅÆÁÆ°ÁêÜÈñ¢Êï∞
function addImprisonedPiece(row, col, piece, owner, turnsLeft = 2) {
  state.imprisonedPieces.push({
    row: row,
    col: col,
    piece: piece,
    owner: owner,
    turnsLeft: turnsLeft,
    addedAt: state.turnCount
  });
  console.log(`üîí Èßí ${piece} (${owner}) „ÅåË°åÂãï‰∏çËÉΩÁä∂ÊÖã„Å´„Å™„Çä„Åæ„Åó„Åü„ÄÇÊÆã„Çä„Çø„Éº„É≥: ${turnsLeft}`);
}

function updateImprisonedPieces() {
  state.imprisonedPieces = state.imprisonedPieces.filter(imprisoned => {
    imprisoned.turnsLeft--;
    
    if (imprisoned.turnsLeft <= 0) {
      console.log(`üîì Èßí ${imprisoned.piece} (${imprisoned.owner}) „ÅÆË°åÂãï‰∏çËÉΩÁä∂ÊÖã„ÅåËß£Èô§„Åï„Çå„Åæ„Åó„Åü`);
      
      // Ë¶ñË¶öÁöÑ„Ç®„Éï„Çß„ÇØ„Éà„ÇíËß£Èô§
      const cell = document.querySelector(`[data-row="${imprisoned.row}"][data-col="${imprisoned.col}"]`);
      if (cell) {
        cell.classList.remove('imprisoned');
      }
      
      return false; // „É™„Çπ„Éà„Åã„ÇâÂâäÈô§
    }
    
    return true; // „Åæ„Å†Ë°åÂãï‰∏çËÉΩ‰∏≠
  });
}

  function isImprisoned(row, col) {
    return state.imprisonedPieces.some(imprisoned => 
      imprisoned.row === row && imprisoned.col === col
    );
  }

  // Èßí„ÅåÂë™„ÅÑ„Éû„Çπ‰∏ä„Å´„ÅÑ„Çã„Åã„Çí„ÉÅ„Çß„ÉÉ„ÇØ
  function isOnCurseTile(row, col) {
    if (!inBounds(row, col)) return false;
    const tile = state.board[row][col];
    // Áõ¥Êé•Âë™„ÅÑ„Éû„Çπ„Åã„ÄÅÈßí„ÅÆ‰∏ã„Å´Âë™„ÅÑ„Éû„Çπ„Åå„ÅÇ„Çã„Åã„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    return (tile && tile.piece === 'n') || (tile && tile.underTile && tile.underTile.piece === 'n');
  }

  // Èßí„ÅåÂë™„ÅÑ„ÅÆÂΩ±Èüø„ÇíÂèó„Åë„Çã„Åã„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºàÈúä„ÅØÂΩ±Èüø„ÇíÂèó„Åë„Å™„ÅÑÔºâ
  function isAffectedByCurse(row, col) {
    if (!isOnCurseTile(row, col)) return false;
    
    const piece = state.board[row][col];
    if (!piece || !piece.piece) return false;
    
    // ÈúäÈßí„ÅØÂë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„ÇíÂèó„Åë„Å™„ÅÑ
    if (piece.piece === 'Èúä') return false;
    
    return true;
  }

  // ÁâπÊÆä„Éû„ÇπÔºàÂë™„ÅÑ„Éû„Çπ„ÉªÁü¢Âç∞„Éû„ÇπÔºâ„ÅÆ‰ΩçÁΩÆ„ÇíÊ∞∏Á∂öÁöÑ„Å´Ë®òÈå≤
  function recordPermanentTiles() {
    state.permanentCurseTiles = [];
    state.permanentArrowTiles = [];
    
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const tile = state.board[r][c];
        if (tile) {
          // Âë™„ÅÑ„Éû„Çπ„ÅÆË®òÈå≤
          if (tile.piece === 'n') {
            state.permanentCurseTiles.push({ row: r, col: c, tile: { ...tile } });
          }
          // Áü¢Âç∞„Éû„Çπ„ÅÆË®òÈå≤
          if (['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(tile.piece)) {
            state.permanentArrowTiles.push({ row: r, col: c, tile: { ...tile } });
          }
        }
      }
    }
    
    console.log('üîÆ Ê∞∏Á∂öÁöÑ„Å™ÁâπÊÆä„Éû„Çπ„ÇíË®òÈå≤„Åó„Åæ„Åó„Åü:');
    console.log('Âë™„ÅÑ„Éû„Çπ:', state.permanentCurseTiles.length, 'ÂÄã');
    console.log('Áü¢Âç∞„Éû„Çπ:', state.permanentArrowTiles.length, 'ÂÄã');
  }

  // ÁâπÊÆä„Éû„ÇπÔºàÂë™„ÅÑ„Éû„Çπ„ÉªÁü¢Âç∞„Éû„ÇπÔºâ„ÇíÂº∑Âà∂ÁöÑ„Å´Âæ©ÂÖÉ
  function restorePermanentTiles() {
    // Âë™„ÅÑ„Éû„Çπ„ÅÆÂæ©ÂÖÉ
    state.permanentCurseTiles.forEach(curseTile => {
      const currentTile = state.board[curseTile.row][curseTile.col];
      if (currentTile && currentTile.piece !== 'n') {
        // Èßí„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„ÄÅunderTile„Å®„Åó„Å¶Âë™„ÅÑ„Éû„Çπ„Çí‰øùÊåÅ
        currentTile.underTile = { ...curseTile.tile };
      } else if (!currentTile) {
        // Á©∫„ÅÆÂ†¥Âêà„ÅØÂë™„ÅÑ„Éû„Çπ„ÇíÂæ©ÂÖÉ
        state.board[curseTile.row][curseTile.col] = { ...curseTile.tile };
      }
    });
    
    // Áü¢Âç∞„Éû„Çπ„ÅÆÂæ©ÂÖÉ
    state.permanentArrowTiles.forEach(arrowTile => {
      const currentTile = state.board[arrowTile.row][arrowTile.col];
      if (currentTile && !['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(currentTile.piece)) {
        // Èßí„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„ÄÅunderTile„Å®„Åó„Å¶Áü¢Âç∞„Éû„Çπ„Çí‰øùÊåÅ
        currentTile.underTile = { ...arrowTile.tile };
      } else if (!currentTile) {
        // Á©∫„ÅÆÂ†¥Âêà„ÅØÁü¢Âç∞„Éû„Çπ„ÇíÂæ©ÂÖÉ
        state.board[arrowTile.row][arrowTile.col] = { ...arrowTile.tile };
      }
    });
  }

  // Áâ¢„ÅÆ„Çπ„Ç≠„É´Áô∫Âãï
  function triggerPrisonSkill(row, col, owner) {
    const enemyPieces = [];
    
    // Áõ§‰∏ä„ÅÆÊïµÈßí„ÇíÂèéÈõÜÔºàÁâπÊÆä„Éû„Çπ„ÅØÈô§Â§ñÔºâ
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner !== owner && !isImprisoned(r, c)) {
          // ÁâπÊÆä„Éû„ÇπÔºàÂë™„ÅÑ„Éû„Çπ„ÄÅÁü¢Âç∞„Éû„Çπ„ÄÅ„Éñ„É≠„ÉÉ„ÇØ„Éû„ÇπÔºâ„ÅØÈô§Â§ñ
          if (piece.piece !== 'n' && piece.piece !== 'X' && !['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(piece.piece)) {
            enemyPieces.push({ row: r, col: c, piece: piece.piece, owner: piece.owner });
          }
        }
      }
    }
    
    if (enemyPieces.length > 0) {
      // „É©„É≥„ÉÄ„É†„Åß‰∏Ä„Å§ÈÅ∏„Å∂
      const target = enemyPieces[Math.floor(Math.random() * enemyPieces.length)];
      
      // Ë°åÂãï‰∏çËÉΩÁä∂ÊÖã„Å´„Åô„Çã
      addImprisonedPiece(target.row, target.col, target.piece, target.owner, 2);
      
      // Ë¶ñË¶öÁöÑ„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      const cell = document.querySelector(`[data-row="${target.row}"][data-col="${target.col}"]`);
      if (cell) {
        cell.classList.add('imprisoned');
      }
      
      setStatus(`Áâ¢„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ${target.piece}„Çí2„Çø„Éº„É≥Ë°åÂãï‰∏çËÉΩ„Å´„Åó„Åæ„Åó„Åü`, 'success');
    } else {
      setStatus('Áâ¢„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Åó„Åã„ÅóÂØæË±°„Å®„Å™„ÇãÊïµÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü', 'playing');
    }
  }

  // Êüµ„ÅÆ„Çπ„Ç≠„É´Áô∫Âãï
  function triggerFenceSkill(row, col, owner) {
    const enemyPieces = [];
    
    // Áõ§‰∏ä„ÅÆÊïµÈßí„ÇíÂèéÈõÜÔºàÁâπÊÆä„Éû„Çπ„ÅØÈô§Â§ñÔºâ
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner !== owner && !isImprisoned(r, c)) {
          // ÁâπÊÆä„Éû„ÇπÔºàÂë™„ÅÑ„Éû„Çπ„ÄÅÁü¢Âç∞„Éû„Çπ„ÄÅ„Éñ„É≠„ÉÉ„ÇØ„Éû„ÇπÔºâ„ÅØÈô§Â§ñ
          if (piece.piece !== 'n' && piece.piece !== 'X' && !['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(piece.piece)) {
            enemyPieces.push({ row: r, col: c, piece: piece.piece, owner: piece.owner });
          }
        }
      }
    }
    
    if (enemyPieces.length > 0) {
      // „É©„É≥„ÉÄ„É†„Åß‰∏Ä„Å§ÈÅ∏„Å∂
      const target = enemyPieces[Math.floor(Math.random() * enemyPieces.length)];
      
      // Ë°åÂãï‰∏çËÉΩÁä∂ÊÖã„Å´„Åô„Çã
      addImprisonedPiece(target.row, target.col, target.piece, target.owner, 2);
      
      // Ë¶ñË¶öÁöÑ„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      const cell = document.querySelector(`[data-row="${target.row}"][data-col="${target.col}"]`);
      if (cell) {
        cell.classList.add('imprisoned');
      }
      
      setStatus(`Êüµ„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ${target.piece}„Çí2„Çø„Éº„É≥Ë°åÂãï‰∏çËÉΩ„Å´„Åó„Åæ„Åó„Åü`, 'success');
    } else {
      setStatus('Êüµ„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Åó„Åã„ÅóÂØæË±°„Å®„Å™„ÇãÊïµÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü', 'playing');
    }
  }

  // Áâ¢„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà
  function showPrisonEffect(fromRow, fromCol, toRow, toCol) {
    const cell = document.querySelector(`[data-row="${toRow}"][data-col="${toCol}"]`);
    if (cell) {
      cell.style.animation = 'prisonMove 0.8s ease-in-out';
      setTimeout(() => {
        cell.style.animation = '';
      }, 800);
    }
  }

  // Êüµ„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà
  function showFenceEffect(fromRow, fromCol, toRow, toCol) {
    const cell = document.querySelector(`[data-row="${toRow}"][data-col="${toCol}"]`);
    if (cell) {
      cell.style.animation = 'fenceMove 0.8s ease-in-out';
      setTimeout(() => {
        cell.style.animation = '';
      }, 800);
    }
  }

  // Âπª„ÅÆÂõûÈÅø„Ç®„Éï„Çß„ÇØ„Éà
  function showPhantomEvasionEffect(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (cell) {
      cell.style.animation = 'phantomEvasion 1.5s ease-in-out';
      setTimeout(() => {
        cell.style.animation = '';
      }, 1500);
    }
  }

  // Âπª„ÅÆ„Çπ„Ç≠„É´Áô∫Âãï„Ç®„Éï„Çß„ÇØ„Éà
  function showPhantomSkillEffect(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (cell) {
      // „É°„Ç§„É≥„ÅÆ„Çπ„Ç≠„É´Áô∫Âãï„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
      cell.style.animation = 'phantomSkillActivation 2s ease-in-out';
      
      // Ê≥¢Á¥ã„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†
      const ripple = document.createElement('div');
      ripple.style.cssText = `
        position: absolute;
        top: 50%;
        left: 50%;
        width: 20px;
        height: 20px;
        border: 2px solid rgba(147, 112, 219, 0.8);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        animation: phantomSkillRipple 1.5s ease-out;
        pointer-events: none;
        z-index: 10;
      `;
      cell.appendChild(ripple);
      
      // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†
      for (let i = 0; i < 8; i++) {
        const particle = document.createElement('div');
        const angle = (i * 45) * Math.PI / 180;
        const distance = 30;
        const x = Math.cos(angle) * distance;
        const y = Math.sin(angle) * distance;
        
        particle.style.cssText = `
          position: absolute;
          top: 50%;
          left: 50%;
          width: 8px;
          height: 8px;
          background: radial-gradient(circle, rgba(147, 112, 219, 1), rgba(138, 43, 226, 0.8));
          border-radius: 50%;
          transform: translate(${x}px, ${y}px);
          animation: phantomSkillParticles 2s ease-out;
          pointer-events: none;
          z-index: 10;
        `;
        cell.appendChild(particle);
      }
      
      // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÁµÇ‰∫ÜÂæå„ÅÆ„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
      setTimeout(() => {
        cell.style.animation = '';
        // Ê≥¢Á¥ã„Å®„Éë„Éº„ÉÜ„Ç£„ÇØ„É´„ÇíÂâäÈô§
        const effects = cell.querySelectorAll('div[style*="animation: phantomSkill"]');
        effects.forEach(effect => effect.remove());
      }, 2000);
    }
  }

  // Èúß„ÅÆ„Çπ„Ç≠„É´Áô∫Âãï„Ç®„Éï„Çß„ÇØ„Éà
  function showMistSkillEffect(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (cell) {
      // „É°„Ç§„É≥„ÅÆ„Çπ„Ç≠„É´Áô∫Âãï„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
      cell.style.animation = 'mistSkillActivation 2s ease-in-out';
      
      // Èúß„ÅÆÊ≥¢Á¥ã„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†
      const fogRipple = document.createElement('div');
      fogRipple.style.cssText = `
        position: absolute;
        top: 50%;
        left: 50%;
        width: 30px;
        height: 30px;
        border: 3px solid rgba(176, 196, 222, 0.8);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        animation: mistSkillFog 2s ease-out;
        pointer-events: none;
        z-index: 10;
      `;
      cell.appendChild(fogRipple);
      
      // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÁµÇ‰∫ÜÂæå„ÅÆ„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
      setTimeout(() => {
        cell.style.animation = '';
        // Èúß„ÅÆÊ≥¢Á¥ã„ÇíÂâäÈô§
        const effects = cell.querySelectorAll('div[style*="animation: mistSkill"]');
        effects.forEach(effect => effect.remove());
      }, 2000);
    }
  }

  // Èúß„ÅÆÊ∂àÊªÖ„Ç®„Éï„Çß„ÇØ„Éà
  function showMistDisappearEffect(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (cell) {
      cell.style.animation = 'mistSkillDisappear 1s ease-in-out';
      setTimeout(() => {
        cell.style.animation = '';
      }, 1000);
    }
  }

  // Êúà„ÅÆ„Çπ„Ç≠„É´„Ç®„Éï„Çß„ÇØ„Éà
  function showMoonSkillEffect(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (cell) {
      // „É°„Ç§„É≥„ÅÆ„Çπ„Ç≠„É´Áô∫Âãï„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
      cell.style.animation = 'moonSkillActivation 2s ease-in-out';
      
      // ÊúàÂÖâ„ÅÆÊ≥¢Á¥ã„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†
      const ripple = document.createElement('div');
      ripple.style.cssText = `
        position: absolute;
        top: 50%;
        left: 50%;
        width: 25px;
        height: 25px;
        border: 3px solid rgba(255, 215, 0, 0.8);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        animation: moonSkillRipple 1.5s ease-out;
        pointer-events: none;
        z-index: 10;
      `;
      cell.appendChild(ripple);
      
      // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†Ôºà8ÊñπÂêëÔºâ
      for (let i = 0; i < 8; i++) {
        const particle = document.createElement('div');
        const angle = (i * 45) * Math.PI / 180;
        const distance = 35;
        const x = Math.cos(angle) * distance;
        const y = Math.sin(angle) * distance;
        
        particle.style.cssText = `
          position: absolute;
          top: 50%;
          left: 50%;
          width: 10px;
          height: 10px;
          background: radial-gradient(circle, rgba(255, 215, 0, 1), rgba(255, 165, 0, 0.8));
          border-radius: 50%;
          transform: translate(${x}px, ${y}px);
          animation: moonSkillParticles 2s ease-out;
          pointer-events: none;
          z-index: 10;
        `;
        cell.appendChild(particle);
      }
      
      // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÁµÇ‰∫ÜÂæå„ÅÆ„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
      setTimeout(() => {
        cell.style.animation = '';
        const effects = cell.querySelectorAll('div[style*="animation: moonSkill"]');
        effects.forEach(effect => effect.remove());
      }, 2000);
    }
  }

  // Ê©ü„ÅÆ„Çπ„Ç≠„É´Ôºö„Ç≥„Éî„Éº„Åó„Åü„Çπ„Ç≠„É´„ÇíÁô∫Âãï
  function triggerMachineSkill(row, col, copiedSkill) {
    console.log(`ü§ñ Ê©ü„Åå${copiedSkill}„ÅÆ„Çπ„Ç≠„É´„ÇíÁô∫Âãï‰∏≠...`);
    
    switch(copiedSkill) {
      case 'ÁÇé':
      case 'ÁÅ´':
        // ÁÇéÁ≥ª„Çπ„Ç≠„É´ÔºöÂë®Âõ≤„ÅÆÊïµÈßí„ÇíÁÑº„Åè
        triggerFireSkill(row, col);
        break;
      case 'Ê∞¥':
      case 'Ê≥¢':
        // Ê∞¥Á≥ª„Çπ„Ç≠„É´ÔºöÂë®Âõ≤„ÅÆÊïµÈßí„ÇíÊø°„Çâ„Åô
        triggerWaterSkill(row, col);
        break;
      case 'Èõª':
      case 'Èõ∑':
        // ÈõªÊ∞óÁ≥ª„Çπ„Ç≠„É´ÔºöÂë®Âõ≤„ÅÆÊïµÈßí„ÇíÊÑüÈõª„Åï„Åõ„Çã
        triggerElectricSkill(row, col);
        break;
      case 'ÊØí':
        // ÊØíÁ≥ª„Çπ„Ç≠„É´ÔºöÂë®Âõ≤„ÅÆÊïµÈßí„ÇíÊØíÁä∂ÊÖã„Å´„Åô„Çã
        triggerPoisonSkill(row, col);
        break;
      case 'Ê∞∑':
      case 'Èõ™':
        // Ê∞∑Á≥ª„Çπ„Ç≠„É´ÔºöÂë®Âõ≤„ÅÆÊïµÈßí„ÇíÂáç„Çâ„Åõ„Çã
        triggerIceSkill(row, col);
        break;
      case 'Âπª':
        // ÂπªÁ≥ª„Çπ„Ç≠„É´ÔºöÂõûÈÅøÂäπÊûú
        triggerPhantomSkill(row, col);
        break;
      case 'Èúß':
        // ÈúßÁ≥ª„Çπ„Ç≠„É´ÔºöÂë®Âõ≤„ÅÆÊïµÈßí„ÇíÊ∂àÊªÖ
        triggerMistSkill(row, col);
        break;
      case 'Â≤©':
        // Â≤©Á≥ª„Çπ„Ç≠„É´ÔºöÈöúÂÆ≥Áâ©„ÇíÈÖçÁΩÆ
        triggerRockSkill(row, col);
        break;
      case 'Èâ±':
        // Èâ±Á≥ª„Çπ„Ç≠„É´ÔºöÊ≠©„ÇíÈÄ≤Âåñ
        triggerOreSkill(row, col);
        break;
      case 'Â¢ì':
        // Â¢ìÁ≥ª„Çπ„Ç≠„É´ÔºöÈúä„ÇíÂè¨Âñö
        triggerGraveSkill(row, col);
        break;
      case 'Êúà':
        // ÊúàÁ≥ª„Çπ„Ç≠„É´ÔºöÊúàÂÖâÂäπÊûú
        triggerMoonSkill(row, col);
        break;
      case 'Ëàü':
        // ËàüÁ≥ª„Çπ„Ç≠„É´ÔºöËàπÂõ£ÂäπÊûú
        triggerBoatSkill(row, col);
        break;
      case 'ÂÆ∂':
        // ÂÆ∂Á≥ª„Çπ„Ç≠„É´ÔºöÂÆàË≠∑ÂäπÊûú
        triggerHouseSkill(row, col);
        break;
      case 'Áïë':
        // ÁïëÁ≥ª„Çπ„Ç≠„É´ÔºöË±äÁ©£ÂäπÊûú
        triggerFieldSkill(row, col);
        break;
      case 'Ê∞ë':
        // Ê∞ëÁ≥ª„Çπ„Ç≠„É´ÔºöÂπ≥ÂíåÂäπÊûú
        triggerPeopleSkill(row, col);
        break;
      default:
        console.log(`ü§ñ ${copiedSkill}„ÅÆ„Çπ„Ç≠„É´„ÅØÊú™ÂÆüË£Ö„Åß„Åô`);
        break;
    }
  }

  // ÂêÑ„Çπ„Ç≠„É´„ÅÆÁô∫ÂãïÈñ¢Êï∞ÔºàÁ∞°ÊòìÁâàÔºâ
  function triggerFireSkill(row, col) {
    const owner = state.board[row][col].owner;
    const adjacentPositions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    
    adjacentPositions.forEach(([dr, dc]) => {
      const targetRow = row + dr;
      const targetCol = col + dc;
      
      if (inBounds(targetRow, targetCol)) {
        const targetPiece = state.board[targetRow][targetCol];
        if (targetPiece && targetPiece.owner !== owner) {
          // ÊïµÈßí„ÇíÁÑº„ÅèÂäπÊûúÔºàÁ∞°ÊòìÁâàÔºâ
          console.log(`üî• Ê©ü„ÅåÁÇé„ÅÆÂäõ„Åß${targetPiece.piece}„ÇíÁÑº„Åç„Åæ„Åó„Åü`);
        }
      }
    });
  }

  function triggerWaterSkill(row, col) {
    const owner = state.board[row][col].owner;
    const adjacentPositions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    
    adjacentPositions.forEach(([dr, dc]) => {
      const targetRow = row + dr;
      const targetCol = col + dc;
      
      if (inBounds(targetRow, targetCol)) {
        const targetPiece = state.board[targetRow][targetCol];
        if (targetPiece && targetPiece.owner !== owner) {
          // ÊïµÈßí„ÇíÊø°„Çâ„ÅôÂäπÊûúÔºàÁ∞°ÊòìÁâàÔºâ
          console.log(`üíß Ê©ü„ÅåÊ∞¥„ÅÆÂäõ„Åß${targetPiece.piece}„ÇíÊø°„Çâ„Åó„Åæ„Åó„Åü`);
        }
      }
    });
  }

  function triggerElectricSkill(row, col) {
    const owner = state.board[row][col].owner;
    const adjacentPositions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    
    adjacentPositions.forEach(([dr, dc]) => {
      const targetRow = row + dr;
      const targetCol = col + dc;
      
      if (inBounds(targetRow, targetCol)) {
        const targetPiece = state.board[targetRow][targetCol];
        if (targetPiece && targetPiece.owner !== owner) {
          // ÊïµÈßí„ÇíÊÑüÈõª„Åï„Åõ„ÇãÂäπÊûúÔºàÁ∞°ÊòìÁâàÔºâ
          targetPiece.isShocked = true;
          console.log(`‚ö° Ê©ü„ÅåÈõªÊ∞ó„ÅÆÂäõ„Åß${targetPiece.piece}„ÇíÊÑüÈõª„Åï„Åõ„Åæ„Åó„Åü`);
        }
      }
    });
  }

  function triggerPoisonSkill(row, col) {
    const owner = state.board[row][col].owner;
    const adjacentPositions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    
    adjacentPositions.forEach(([dr, dc]) => {
      const targetRow = row + dr;
      const targetCol = col + dc;
      
      if (inBounds(targetRow, targetCol)) {
        const targetPiece = state.board[targetRow][targetCol];
        if (targetPiece && targetPiece.owner !== owner) {
          // ÊïµÈßí„ÇíÊØíÁä∂ÊÖã„Å´„Åô„ÇãÂäπÊûúÔºàÁ∞°ÊòìÁâàÔºâ
          targetPiece.isPoisoned = true;
          console.log(`‚ò†Ô∏è Ê©ü„ÅåÊØí„ÅÆÂäõ„Åß${targetPiece.piece}„ÇíÊØíÁä∂ÊÖã„Å´„Åó„Åæ„Åó„Åü`);
        }
      }
    });
  }

  function triggerIceSkill(row, col) {
    const owner = state.board[row][col].owner;
    const adjacentPositions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    
    adjacentPositions.forEach(([dr, dc]) => {
      const targetRow = row + dr;
      const targetCol = col + dc;
      
      if (inBounds(targetRow, targetCol)) {
        const targetPiece = state.board[targetRow][targetCol];
        if (targetPiece && targetPiece.owner !== owner) {
          // ÊïµÈßí„ÇíÂáç„Çâ„Åõ„ÇãÂäπÊûúÔºàÁ∞°ÊòìÁâàÔºâ
          targetPiece.isFrozen = true;
          console.log(`‚ùÑÔ∏è Ê©ü„ÅåÊ∞∑„ÅÆÂäõ„Åß${targetPiece.piece}„ÇíÂáç„Çâ„Åõ„Åæ„Åó„Åü`);
        }
      }
    });
  }

  function triggerPhantomSkill(row, col) {
    // Âπª„ÅÆÂõûÈÅøÂäπÊûúÔºàÁ∞°ÊòìÁâàÔºâ
    state.board[row][col].hasPhantomEvasion = true;
    console.log(`üëª Ê©ü„ÅåÂπª„ÅÆÂäõ„ÅßÂõûÈÅøÂäπÊûú„ÇíÁç≤Âæó„Åó„Åæ„Åó„Åü`);
  }

  function triggerMistSkill(row, col) {
    const owner = state.board[row][col].owner;
    const adjacentPositions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    
    adjacentPositions.forEach(([dr, dc]) => {
      const targetRow = row + dr;
      const targetCol = col + dc;
      
      if (inBounds(targetRow, targetCol)) {
        const targetPiece = state.board[targetRow][targetCol];
        if (targetPiece && targetPiece.owner !== owner && Math.random() < 0.2) {
          // 20%„ÅÆÁ¢∫Áéá„ÅßÊïµÈßí„ÇíÊ∂àÊªÖÔºàÁ∞°ÊòìÁâàÔºâ
          console.log(`üå´Ô∏è Ê©ü„ÅåÈúß„ÅÆÂäõ„Åß${targetPiece.piece}„ÇíÊ∂àÊªÖ„Åï„Åõ„Åæ„Åó„Åü`);
        }
      }
    });
  }

  function triggerRockSkill(row, col) {
    // Â≤©„ÅÆÈöúÂÆ≥Áâ©ÈÖçÁΩÆÂäπÊûúÔºàÁ∞°ÊòìÁâàÔºâ
    const adjacentPositions = [[0,-1],[0,1]];
    
    adjacentPositions.forEach(([dr, dc]) => {
      const targetRow = row + dr;
      const targetCol = col + dc;
      
      if (inBounds(targetRow, targetCol) && !state.board[targetRow][targetCol]) {
        // Â≤©„ÅÆÈöúÂÆ≥Áâ©„ÇíÈÖçÁΩÆ
        state.rockBarriers.push({row: targetRow, col: targetCol});
        console.log(`üóø Ê©ü„ÅåÂ≤©„ÅÆÂäõ„ÅßÈöúÂÆ≥Áâ©„ÇíÈÖçÁΩÆ„Åó„Åæ„Åó„Åü`);
      }
    });
  }

  function triggerOreSkill(row, col) {
    const owner = state.board[row][col].owner;
    const hands = state.hands[owner];
    
    // 20%„ÅÆÁ¢∫Áéá„ÅßÊ≠©„ÇíÈÄ≤Âåñ
    if (Math.random() < 0.2) {
      const pawnIndex = hands.indexOf('Ê≠©');
      if (pawnIndex !== -1) {
        const upgradedPieces = ['Èáë', 'ÈäÄ', 'ÈäÖ'];
        const randomPiece = upgradedPieces[Math.floor(Math.random() * upgradedPieces.length)];
        hands[pawnIndex] = randomPiece;
        console.log(`‚õèÔ∏è Ê©ü„ÅåÈâ±„ÅÆÂäõ„ÅßÊ≠©„Çí${randomPiece}„Å´ÈÄ≤Âåñ„Åï„Åõ„Åæ„Åó„Åü`);
      }
    }
  }

  function triggerGraveSkill(row, col) {
    const owner = state.board[row][col].owner;
    const adjacentPositions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    
    // 20%„ÅÆÁ¢∫Áéá„ÅßÈúä„ÇíÂè¨Âñö
    if (Math.random() < 0.2) {
      const emptySpaces = [];
      
      adjacentPositions.forEach(([dr, dc]) => {
        const targetRow = row + dr;
        const targetCol = col + dc;
        
        if (inBounds(targetRow, targetCol) && !state.board[targetRow][targetCol]) {
          emptySpaces.push([targetRow, targetCol]);
        }
      });
      
      if (emptySpaces.length > 0) {
        const randomSpace = emptySpaces[Math.floor(Math.random() * emptySpaces.length)];
        state.board[randomSpace[0]][randomSpace[1]] = {piece: 'Èúä', owner: owner};
        console.log(`ü™¶ Ê©ü„ÅåÂ¢ì„ÅÆÂäõ„ÅßÈúä„ÇíÂè¨Âñö„Åó„Åæ„Åó„Åü`);
      }
    }
  }

  function triggerMoonSkill(row, col) {
    // ÊúàÂÖâÂäπÊûúÔºàÁ∞°ÊòìÁâàÔºâ
    state.board[row][col].moonEffect = true;
    console.log(`üåô Ê©ü„ÅåÊúà„ÅÆÂäõ„ÅßÊúàÂÖâÂäπÊûú„ÇíÁç≤Âæó„Åó„Åæ„Åó„Åü`);
  }

  function triggerBoatSkill(row, col) {
    // ËàπÂõ£ÂäπÊûúÔºàÁ∞°ÊòìÁâàÔºâ
    state.board[row][col].fleetEffect = true;
    console.log(`‚õµ Ê©ü„ÅåËàü„ÅÆÂäõ„ÅßËàπÂõ£ÂäπÊûú„ÇíÁç≤Âæó„Åó„Åæ„Åó„Åü`);
  }
  
  function triggerHouseSkill(row, col) {
    // ÂÆ∂„ÅÆ„Çπ„Ç≠„É´ÔºöÊ∞ëÈßí„ÇíËá™Èô£4Ë°å„ÅÆ„É©„É≥„ÉÄ„É†„Å™Á©∫„Åç„Éû„Çπ„Å´Âá∫ÁèæÔºà‰∏äÈôê3‰ΩìÔºâ
    console.log(`üè† ÂÆ∂„ÅÆ„Çπ„Ç≠„É´„ÅåÁô∫Âãï„Åó„Åæ„Åó„Åü`);
    
    const owner = state.board[row][col].owner;
    const targetRows = owner === 'player' ? [5, 6, 7, 8] : [0, 1, 2, 3]; // Ëá™Èô£4Ë°å
    
    // ÁèæÂú®„ÅÆÊ∞ëÈßíÊï∞„Çí„Ç´„Ç¶„É≥„Éà
    let currentPeopleCount = 0;
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.piece === 'Ê∞ë' && piece.owner === owner) {
          currentPeopleCount++;
        }
      }
    }
    
    console.log(`üè† ÁèæÂú®„ÅÆÊ∞ëÈßíÊï∞: ${currentPeopleCount}/5`);
    
    // Ê∞ëÈßí„ÅÆ‰∏äÈôê„ÉÅ„Çß„ÉÉ„ÇØÔºà5‰Ωì„Åæ„ÅßÔºâ
    if (currentPeopleCount >= 5) {
      setStatus('ÂÆ∂„ÅÆÂäõÔºöÊ∞ëÈßí„ÅÆ‰∏äÈôêÔºà5‰ΩìÔºâ„Å´ÈÅî„Åó„Å¶„ÅÑ„Åæ„Åô', 'warning');
      return;
    }
    
    // Á©∫„Åç„Éû„Çπ„ÇíÊé¢„Åô
    const emptyCells = [];
    for (let r of targetRows) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const cell = state.board[r][c];
        if (!cell || !cell.piece || cell.piece === '' || cell.piece === 'Á©∫') {
          emptyCells.push({r, c});
        }
      }
    }
    
    console.log(`üè† Ëá™Èô£4Ë°å„ÅÆÁ©∫„Åç„Éû„ÇπÊï∞: ${emptyCells.length}`);
    console.log(`üè† Á©∫„Åç„Éû„Çπ‰∏ÄË¶ß:`, emptyCells);
    
    if (emptyCells.length === 0) {
      setStatus('ÂÆ∂„ÅÆÂäõÔºöÁ©∫„Åç„Éû„Çπ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì', 'info');
      return;
    }
    
    // „É©„É≥„ÉÄ„É†„Å™Á©∫„Åç„Éû„Çπ„ÇíÈÅ∏Êäû
    const randomIndex = Math.floor(Math.random() * emptyCells.length);
    const targetCell = emptyCells[randomIndex];
    
    // Ê∞ëÈßí„ÇíÈÖçÁΩÆ
    state.board[targetCell.r][targetCell.c] = {
      piece: 'Ê∞ë',
      owner: owner,
      isOriginal: false,
      isDarkened: false,
      isDrowned: false,
      isTimeStopped: false,
      isPoisoned: false,
      isRainbowLimited: false
    };
    
    const newPeopleCount = currentPeopleCount + 1;
    setStatus(`ÂÆ∂„ÅÆÂäõÔºöÊ∞ëÈßí„Çí(${targetCell.r},${targetCell.c})„Å´Âá∫Áèæ„Åï„Åõ„Åæ„Åó„ÅüÔºà${newPeopleCount}/5Ôºâ`, 'info');
    console.log(`üè† Ê∞ëÈßí„Çí(${targetCell.r},${targetCell.c})„Å´Âá∫Áèæ„Åï„Åõ„Åæ„Åó„ÅüÔºà${newPeopleCount}/5Ôºâ`);
    console.log(`üè† ÈÖçÁΩÆÂæå„ÅÆ„Çª„É´Áä∂ÊÖã:`, state.board[targetCell.r][targetCell.c]);
    
    // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
    render();
    
    // „Çπ„Ç≠„É´‰ΩøÁî®Âæå„ÄÅÁõ∏Êâã„ÅÆÊâãÁï™„Å´Âàá„ÇäÊõø„Åà
    setTimeout(() => {
      state.currentPlayer = state.currentPlayer === 'player' ? 'computer' : 'player';
      setStatus(`${state.currentPlayer === 'player' ? '„Éó„É¨„Ç§„É§„Éº' : '„Ç≥„É≥„Éî„É•„Éº„Çø'}„ÅÆ„Çø„Éº„É≥`, 'playing');
      render();
      
      // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆ„Çø„Éº„É≥„ÅÆÂ†¥Âêà„ÄÅAI„ÇíÂÆüË°å
      if (state.currentPlayer === 'computer') {
        setTimeout(() => {
          computerTurn();
        }, 1000);
      }
    }, 1000);
  }
  
  function triggerFieldSkill(row, col) {
    // Áïë„ÅÆË±äÁ©£ÂäπÊûúÔºöÂë≥Êñπ„ÅÆÊ∞ëÈßí„ÅÆÁßªÂãïÁØÑÂõ≤„ÇíÊã°Âºµ
    console.log(`üåæ Áïë„ÅÆË±äÁ©£ÂäπÊûú„ÅåÁô∫Âãï„Åó„Åæ„Åó„Åü`);
    
    const owner = state.board[row][col].owner;
    console.log(`üåæ „Çπ„Ç≠„É´‰ΩøÁî®ËÄÖ: ${owner}`);
    
    // Âë≥Êñπ„ÅÆÊ∞ëÈßí„ÇíÊé¢„Åô
    const peoplePieces = [];
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.piece === 'Ê∞ë' && piece.owner === owner) {
          peoplePieces.push({r, c, piece});
          console.log(`üåæ Ê∞ëÈßíÁô∫Ë¶ã: (${r},${c})`);
        }
      }
    }
    
    console.log(`üåæ Áô∫Ë¶ã„Åï„Çå„ÅüÊ∞ëÈßíÊï∞: ${peoplePieces.length}`);
    
    // Âë≥Êñπ„ÅÆÊ∞ëÈßí„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ„Çπ„Ç≠„É´‰ΩøÁî®‰∏çÂèØ
    if (peoplePieces.length === 0) {
      setStatus('Áïë„ÅÆÂäõÔºöÂë≥Êñπ„ÅÆÊ∞ëÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì', 'warning');
      return;
    }
    
    // Âë≥Êñπ„ÅÆÊ∞ëÈßí„Å´Áïë„ÅÆÂäπÊûú„Çí‰ªò‰∏é
    peoplePieces.forEach(people => {
      state.board[people.r][people.c].fieldEffect = true;
      console.log(`üåæ Ê∞ëÈßí(${people.r},${people.c})„Å´Áïë„ÅÆÂäπÊûú„Çí‰ªò‰∏é`);
    });
    
    setStatus(`Áïë„ÅÆÂäõÔºö${peoplePieces.length}‰Ωì„ÅÆÊ∞ëÈßí„ÅåÊñú„ÇÅÂâçÁßªÂãïÂèØËÉΩ„Å´„Å™„Çä„Åæ„Åó„Åü`, 'info');
    console.log(`üåæ ${peoplePieces.length}‰Ωì„ÅÆÊ∞ëÈßí„Å´Áïë„ÅÆÂäπÊûú„Çí‰ªò‰∏é`);
    
    // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
    render();
    
    // „Çπ„Ç≠„É´‰ΩøÁî®Âæå„ÄÅÁõ∏Êâã„ÅÆÊâãÁï™„Å´Âàá„ÇäÊõø„Åà
    setTimeout(() => {
      state.currentPlayer = state.currentPlayer === 'player' ? 'computer' : 'player';
      setStatus(`${state.currentPlayer === 'player' ? '„Éó„É¨„Ç§„É§„Éº' : '„Ç≥„É≥„Éî„É•„Éº„Çø'}„ÅÆ„Çø„Éº„É≥`, 'playing');
      render();
      
      // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆ„Çø„Éº„É≥„ÅÆÂ†¥Âêà„ÄÅAI„ÇíÂÆüË°å
      if (state.currentPlayer === 'computer') {
        setTimeout(() => {
          computerTurn();
        }, 1000);
      }
    }, 1000);
  }
  
  function triggerPeopleSkill(row, col) {
    // Ê∞ë„ÅÆÂπ≥ÂíåÂäπÊûúÔºàÁ∞°ÊòìÁâàÔºâ
    console.log(`üë• Ê∞ë„ÅÆÂπ≥ÂíåÂäπÊûú„ÅåÁô∫Âãï„Åó„Åæ„Åó„Åü`);
    setStatus('Ê∞ë„ÅÆÂäõÔºöÊùë‰∫∫„Çí‰ª£Ë°®„Åô„ÇãÂπ≥Âíå„ÅÆÂäõ', 'info');
  }

  // Ëàü„ÅÆ„Çπ„Ç≠„É´„Ç®„Éï„Çß„ÇØ„Éà
  function showBoatSkillEffect(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (cell) {
      // „É°„Ç§„É≥„ÅÆ„Çπ„Ç≠„É´Áô∫Âãï„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
      cell.style.animation = 'boatSkillActivation 2s ease-in-out';
      
      // Ê∞¥„ÅÆÊ≥¢Á¥ã„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†
      const ripple = document.createElement('div');
      ripple.style.cssText = `
        position: absolute;
        top: 50%;
        left: 50%;
        width: 30px;
        height: 30px;
        border: 3px solid rgba(135, 206, 235, 0.8);
        border-radius: 15px;
        transform: translate(-50%, -50%);
        animation: boatSkillRipple 1.5s ease-out;
        pointer-events: none;
        z-index: 10;
      `;
      cell.appendChild(ripple);
      
      // Ê≥¢„ÅÆ„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†ÔºàÂâçÂæåÂ∑¶Âè≥Ôºâ
      for (let i = 0; i < 4; i++) {
        const wave = document.createElement('div');
        const directions = [
          { x: 0, y: -40 }, // ‰∏ä
          { x: 40, y: 0 },  // Âè≥
          { x: 0, y: 40 },  // ‰∏ã
          { x: -40, y: 0 }  // Â∑¶
        ];
        const dir = directions[i];
        
        wave.style.cssText = `
          position: absolute;
          top: 50%;
          left: 50%;
          width: 15px;
          height: 8px;
          background: linear-gradient(90deg, rgba(135, 206, 235, 0.8), rgba(70, 130, 180, 0.6));
          border-radius: 50%;
          transform: translate(${dir.x}px, ${dir.y}px);
          animation: boatSkillWaves 2s ease-out;
          pointer-events: none;
          z-index: 10;
        `;
        cell.appendChild(wave);
      }
      
      // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÁµÇ‰∫ÜÂæå„ÅÆ„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
      setTimeout(() => {
        cell.style.animation = '';
        const effects = cell.querySelectorAll('div[style*="animation: boatSkill"]');
        effects.forEach(effect => effect.remove());
      }, 2000);
    }
  }

  // Ëàü„ÅÆ„Çπ„Ç≠„É´ÔºöÂæå„Çç„Å´„ÅÑ„ÇãÂë≥Êñπ„ÅÆÈßí„ÇÇ‰∏ÄÁ∑í„Å´ÁßªÂãï„Åï„Åõ„Çã
  function triggerBoatSkill(fromRow, fromCol, toRow, toCol, owner) {
    const movedPieces = [];
    
    // Ëàü„ÅÆÁßªÂãïÊñπÂêë„ÇíË®àÁÆó
    const rowDiff = toRow - fromRow;
    const colDiff = toCol - fromCol;
    
    // Ëàü„ÅÆÂæå„Çç„ÅÆ‰ΩçÁΩÆÔºàÁßªÂãïÂâç„ÅÆ‰ΩçÁΩÆ„Åã„ÇâÁßªÂãïÊñπÂêë„ÅÆÈÄÜÊñπÂêëÔºâ
    const behindRow = fromRow - rowDiff;
    const behindCol = fromCol - colDiff;
    
    // Ëàü„ÅÆÂæå„Çç„Å´Âë≥Êñπ„ÅÆÈßí„Åå„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    if (inBounds(behindRow, behindCol) && state.board[behindRow][behindCol] && state.board[behindRow][behindCol].owner === owner) {
      const followingPiece = state.board[behindRow][behindCol];
      
      // ÁßªÂãïÂÖà„ÅÆÂæå„Çç„ÅÆ‰ΩçÁΩÆ
      const newBehindRow = toRow - rowDiff;
      const newBehindCol = toCol - colDiff;
      
      // ÁßªÂãïÂÖà„ÅÆÂæå„Çç„ÅåÁ©∫„ÅÑ„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
      if (inBounds(newBehindRow, newBehindCol) && !state.board[newBehindRow][newBehindCol]) {
        // Âë≥Êñπ„ÅÆÈßí„ÇíÁßªÂãï„Åï„Åõ„Çã
        state.board[newBehindRow][newBehindCol] = followingPiece;
        state.board[behindRow][behindCol] = null;
        
        movedPieces.push({
          piece: followingPiece.piece,
          from: { row: behindRow, col: behindCol },
          to: { row: newBehindRow, col: newBehindCol }
        });
        
        // ÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
        showBoatFollowingEffect(behindRow, behindCol, newBehindRow, newBehindCol);
        
        console.log(`‚õµ Ëàü„ÅÆËàπÂõ£ÂäπÊûúÔºÅ${followingPiece.piece}„ÅåËàü„Å´„Å§„ÅÑ„Å¶ÁßªÂãï„Åó„Åæ„Åó„Åü: (${behindRow}, ${behindCol}) ‚Üí (${newBehindRow}, ${newBehindCol})`);
      } else {
        console.log(`‚õµ Ëàü„ÅÆÂæå„Çç„Å´${followingPiece.piece}„Åå„ÅÑ„Åæ„Åô„Åå„ÄÅÁßªÂãïÂÖà„ÅåÂ°û„Åå„Å£„Å¶„ÅÑ„Åæ„Åô`);
      }
    }
    
    if (movedPieces.length > 0) {
      setStatus(`Ëàü„ÅÆËàπÂõ£ÂäπÊûúÔºÅ${movedPieces.length}Âåπ„ÅÆÈßí„Åå‰∏ÄÁ∑í„Å´ÁßªÂãï„Åó„Åæ„Åó„Åü`, 'success');
    } else {
      console.log('‚õµ Ëàü„ÅÆËàπÂõ£ÂäπÊûúÔºÅ„Åó„Åã„ÅóÂæå„Çç„Å´Âë≥Êñπ„ÅÆÈßí„Åå„ÅÑ„Åæ„Åõ„Çì„Åß„Åó„Åü');
      setStatus('Ëàü„ÅÆËàπÂõ£ÂäπÊûúÔºÅ„Åó„Åã„ÅóÂæå„Çç„Å´Âë≥Êñπ„ÅÆÈßí„Åå„ÅÑ„Åæ„Åõ„Çì„Åß„Åó„Åü', 'info');
    }
  }

  // Ëàü„ÅÆÂæåÁ∂öÈßíÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà
  function showBoatFollowingEffect(fromRow, fromCol, toRow, toCol) {
    const fromCell = document.querySelector(`[data-row="${fromRow}"][data-col="${fromCol}"]`);
    const toCell = document.querySelector(`[data-row="${toRow}"][data-col="${toCol}"]`);
    
    if (fromCell && toCell) {
      // ÁßªÂãïÂÖÉ„ÅßÊ∂àÂ§±„Ç®„Éï„Çß„ÇØ„Éà
      fromCell.style.animation = 'boatSkillDisappear 1s ease-in-out';
      
      // ÁßªÂãïÂÖà„ÅßÂá∫Áèæ„Ç®„Éï„Çß„ÇØ„Éà
      setTimeout(() => {
        toCell.style.animation = 'boatSkillAppear 1s ease-in-out';
      }, 500);
      
      // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÁµÇ‰∫ÜÂæå„ÅÆ„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
      setTimeout(() => {
        fromCell.style.animation = '';
        toCell.style.animation = '';
      }, 1500);
    }
  }

  // Â∂∫„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà
  function showRidgeEffect(fromRow, fromCol, toRow, toCol) {
    const cell = document.querySelector(`[data-row="${toRow}"][data-col="${toCol}"]`);
    if (cell) {
      cell.style.animation = 'ridgeMove 0.8s ease-in-out';
      setTimeout(() => {
        cell.style.animation = '';
      }, 800);
    }
  }

  // Â≥∞„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà
  function showPeakEffect(fromRow, fromCol, toRow, toCol) {
    const cell = document.querySelector(`[data-row="${toRow}"][data-col="${toCol}"]`);
    if (cell) {
      cell.style.animation = 'peakMove 0.8s ease-in-out';
      setTimeout(() => {
        cell.style.animation = '';
      }, 800);
    }
  }

  // Â∂∫„ÅÆ„Çπ„Ç≠„É´Áô∫Âãï
  function triggerRidgeSkill(row, col, owner) {
    const emptySpaces = [];
    
    // Âë®Âõ≤8ÊñπÂêë„ÅÆÁ©∫„Éû„Çπ„ÇíÂèéÈõÜ
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = row + d[0], nc = col + d[1];
      if (inBounds(nr, nc) && !state.board[nr][nc]) {
        emptySpaces.push({ row: nr, col: nc });
      }
    });
    
    if (emptySpaces.length > 0) {
      // „É©„É≥„ÉÄ„É†„Åß‰∏Ä„Å§ÈÅ∏„Å∂
      const target = emptySpaces[Math.floor(Math.random() * emptySpaces.length)];
      
      // Â±±Èßí„ÇíÂá∫Áèæ„Åï„Åõ„Çã
      const newMountainPiece = {
        piece: 'Â±±',
        owner: owner,
        isOriginal: true
      };
      state.board[target.row][target.col] = newMountainPiece;
      
      // Â±±„ÅÆÂá∫Áèæ„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      showMountainSpawnEffect(target.row, target.col);
      
      setStatus(`Â∂∫„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÂ±±„ÅåÂá∫Áèæ„Åó„Åæ„Åó„Åü`, 'success');
      console.log(`‚õ∞Ô∏è Â∂∫„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÂ±±Èßí„Åå(${target.row},${target.col})„Å´Âá∫Áèæ„Åó„Åæ„Åó„Åü`);
    } else {
      setStatus('Â∂∫„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Åó„Åã„ÅóÂë®Âõ≤„Å´Á©∫„Åç„Éû„Çπ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü', 'playing');
      console.log('‚õ∞Ô∏è Â∂∫„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Åó„Åã„ÅóÂë®Âõ≤„Å´Á©∫„Åç„Éû„Çπ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
    }
  }

  // Â≥∞„ÅÆ„Çπ„Ç≠„É´ÔºöÁîªÊï∞10Áîª‰ª•‰∏ä„ÅÆÈßí„Åã„ÇâÂèñ„Çâ„Çå„Å™„ÅÑ
  function triggerPeakSkill(row, col, owner) {
    // Â≥∞„ÅÆÂë®Âõ≤8ÊñπÂêë„ÅÆÊïµÈßí„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºàÁâπÊÆä„Éû„Çπ„ÅØÈô§Â§ñÔºâ
    const enemyPieces = [];
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = row + d[0], nc = col + d[1];
      if (inBounds(nr, nc) && state.board[nr][nc] && state.board[nr][nc].owner !== owner) {
        const piece = state.board[nr][nc].piece;
        // ÁâπÊÆä„Éû„ÇπÔºàÂë™„ÅÑ„Éû„Çπ„ÄÅÁü¢Âç∞„Éû„Çπ„ÄÅ„Éñ„É≠„ÉÉ„ÇØ„Éû„ÇπÔºâ„ÅØÈô§Â§ñ
        if (piece !== 'n' && piece !== 'X' && !['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(piece) && hasHighStrokeCount(piece)) {
          enemyPieces.push({ row: nr, col: nc, piece: piece });
        }
      }
    });
    
    if (enemyPieces.length > 0) {
      // ÁîªÊï∞10Áîª‰ª•‰∏ä„ÅÆÊïµÈßí„ÇíÁÑ°ÂäπÂåñÔºàÁßªÂãï„ÉªÊîªÊíÉ‰∏çÂèØÔºâ
      enemyPieces.forEach(enemy => {
        const cell = document.querySelector(`[data-row="${enemy.row}"][data-col="${enemy.col}"]`);
        if (cell) {
          cell.classList.add('peak-protected');
        }
        console.log(`üõ°Ô∏è Â≥∞„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ${enemy.piece}„ÅåÂ≥∞„Åã„Çâ‰øùË≠∑„Åï„Çå„Åæ„Åó„Åü`);
      });
      
      setStatus(`Â≥∞„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÁîªÊï∞10Áîª‰ª•‰∏ä„ÅÆÊïµÈßí${enemyPieces.length}ÂÄã„ÇíÁÑ°ÂäπÂåñ„Åó„Åæ„Åó„Åü`, 'success');
    } else {
      setStatus('Â≥∞„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Åó„Åã„ÅóÂØæË±°„Å®„Å™„ÇãÊïµÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü', 'playing');
    }
  }

  // Â≤©„ÅÆ„Çπ„Ç≠„É´ÔºöÂ∑¶Âè≥1„Éû„Çπ„Å´Â≤©„ÅÆÂΩ¢„ÅÆÈöúÂÆ≥Áâ©„ÇíÈÖçÁΩÆ
  function triggerRockSkill(row, col, owner) {
    const barriers = [];
    
    // Â∑¶Âè≥1„Éû„Çπ„ÅÆ‰ΩçÁΩÆ„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    const leftPos = { row: row, col: col - 1 };
    const rightPos = { row: row, col: col + 1 };
    
    // Â∑¶ÂÅ¥„ÅÆ„Éû„Çπ„Å´ÈöúÂÆ≥Áâ©„ÇíÈÖçÁΩÆ
    if (inBounds(leftPos.row, leftPos.col)) {
      const leftPiece = state.board[leftPos.row][leftPos.col];
      // Èßí„Åå„Å™„ÅÑ„Éû„ÇπÔºàÁ©∫„Éû„ÇπÔºâ„ÅÆÂ†¥Âêà„ÅÆ„ÅøÈöúÂÆ≥Áâ©„ÇíÈÖçÁΩÆ
      if (!leftPiece || leftPiece.piece === 'Á©∫') {
        barriers.push(leftPos);
        console.log(`ü™® Â≤©„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÂ∑¶ÂÅ¥(${leftPos.row},${leftPos.col})„Å´Â≤©„ÅÆÈöúÂÆ≥Áâ©„ÇíÈÖçÁΩÆ`);
      }
    }
    
    // Âè≥ÂÅ¥„ÅÆ„Éû„Çπ„Å´ÈöúÂÆ≥Áâ©„ÇíÈÖçÁΩÆ
    if (inBounds(rightPos.row, rightPos.col)) {
      const rightPiece = state.board[rightPos.row][rightPos.col];
      // Èßí„Åå„Å™„ÅÑ„Éû„ÇπÔºàÁ©∫„Éû„ÇπÔºâ„ÅÆÂ†¥Âêà„ÅÆ„ÅøÈöúÂÆ≥Áâ©„ÇíÈÖçÁΩÆ
      if (!rightPiece || rightPiece.piece === 'Á©∫') {
        barriers.push(rightPos);
        console.log(`ü™® Â≤©„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÂè≥ÂÅ¥(${rightPos.row},${rightPos.col})„Å´Â≤©„ÅÆÈöúÂÆ≥Áâ©„ÇíÈÖçÁΩÆ`);
      }
    }
    
    if (barriers.length > 0) {
      // ÈöúÂÆ≥Áâ©„ÇíÁä∂ÊÖã„Å´ËøΩÂä†
      barriers.forEach(barrier => {
        state.rockBarriers.push({
          row: barrier.row,
          col: barrier.col,
          owner: owner,
          turn: state.turnCount
        });
      });
      
      // ÈöúÂÆ≥Áâ©„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      barriers.forEach(barrier => {
        showRockBarrierEffect(barrier.row, barrier.col);
      });
      
      setStatus(`Â≤©„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÂ∑¶Âè≥„Å´${barriers.length}ÂÄã„ÅÆÂ≤©„ÅÆÈöúÂÆ≥Áâ©„ÇíÈÖçÁΩÆ„Åó„Åæ„Åó„Åü`, 'success');
    } else {
      setStatus('Â≤©„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Åó„Åã„ÅóÂ∑¶Âè≥„Å´ÈöúÂÆ≥Áâ©„ÇíÈÖçÁΩÆ„Åß„Åç„ÇãÁ©∫„Åç„Éû„Çπ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü', 'playing');
    }
  }

  // Èâ±„ÅÆ„Çπ„Ç≠„É´ÔºöÂë≥Êñπ„ÅÆÊ≠©„ÇíÈáë„ÉªÈäÄ„ÉªÈäÖ„Å´Â§âÂåñ„Åï„Åõ„Çã
  function triggerOreSkill(row, col, owner) {
    const allyPawns = [];
    
    // Áõ§‰∏ä„ÅÆÂë≥Êñπ„ÅÆÊ≠©„ÇíÂèéÈõÜ
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === owner && piece.piece === 'Ê≠©') {
          allyPawns.push({ type: 'board', row: r, col: c });
        }
      }
    }
    
    // ÊåÅ„Å°Èßí„ÅÆÂë≥Êñπ„ÅÆÊ≠©„ÇíÂèéÈõÜ
    state.hands[owner].forEach((piece, index) => {
      if (piece === 'Ê≠©') {
        allyPawns.push({ type: 'hand', index: index });
      }
    });
    
    if (allyPawns.length > 0) {
      // „É©„É≥„ÉÄ„É†„Åß1„Å§„ÅÆÊ≠©„ÇíÈÅ∏Êäû
      const target = allyPawns[Math.floor(Math.random() * allyPawns.length)];
      
      // Èáë„ÉªÈäÄ„ÉªÈäÖ„ÅÆ‰∏≠„Åã„Çâ„É©„É≥„ÉÄ„É†„ÅßÈÅ∏Êäû
      const upgradeOptions = ['Èáë', 'ÈäÄ', 'ÈäÖ'];
      const newPiece = upgradeOptions[Math.floor(Math.random() * upgradeOptions.length)];
      
      if (target.type === 'board') {
        // Áõ§‰∏ä„ÅÆÊ≠©„ÇíÊñ∞„Åó„ÅÑÈßí„Å´Â§âÂåñ
        state.board[target.row][target.col] = {
          piece: newPiece,
          owner: owner,
          isOriginal: false
        };
        
        // Â§âÂåñ„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
        showOreUpgradeEffect(target.row, target.col, newPiece);
        
        setStatus(`Èâ±„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÁõ§‰∏ä„ÅÆÊ≠©„Åå${newPiece}„Å´Â§âÂåñ„Åó„Åæ„Åó„Åü`, 'success');
        console.log(`‚õèÔ∏è Èâ±„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÁõ§‰∏ä(${target.row},${target.col})„ÅÆÊ≠©„Åå${newPiece}„Å´Â§âÂåñ`);
      } else if (target.type === 'hand') {
        // ÊåÅ„Å°Èßí„ÅÆÊ≠©„ÇíÊñ∞„Åó„ÅÑÈßí„Å´Â§âÂåñ
        state.hands[owner][target.index] = newPiece;
        
        setStatus(`Èâ±„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÊåÅ„Å°Èßí„ÅÆÊ≠©„Åå${newPiece}„Å´Â§âÂåñ„Åó„Åæ„Åó„Åü`, 'success');
        console.log(`‚õèÔ∏è Èâ±„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÊåÅ„Å°Èßí„ÅÆÊ≠©„Åå${newPiece}„Å´Â§âÂåñ`);
      }
    } else {
      setStatus('Èâ±„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Åó„Åã„ÅóÂë≥Êñπ„ÅÆÊ≠©„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü', 'playing');
      console.log('‚õèÔ∏è Èâ±„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Åó„Åã„ÅóÂë≥Êñπ„ÅÆÊ≠©„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
    }
  }

  // Â¢ì„ÅÆ„Çπ„Ç≠„É´ÔºöÁßªÂãïÊôÇÂë®Âõ≤„É©„É≥„ÉÄ„É†1„Éû„Çπ„ÅÆÁ©∫„ÅÑ„Å¶„ÅÑ„Çã„Éû„Çπ„Å´„ÄåÈúä„Äç„ÇíÂè¨Âñö
  function triggerGraveSkill(row, col, owner) {
    const emptySpaces = [];
    
    // Âë®Âõ≤8ÊñπÂêë„ÅÆÁ©∫„ÅÑ„Å¶„ÅÑ„Çã„Éû„Çπ„ÇíÂèéÈõÜ
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = row + d[0], nc = col + d[1];
      if (inBounds(nr, nc) && !state.board[nr][nc]) {
        // Á©∫„ÅÑ„Å¶„ÅÑ„Çã„Éû„ÇπÔºàÈßí„Åå„Å™„ÅÑ„Éû„ÇπÔºâ
        emptySpaces.push({ row: nr, col: nc });
      }
    });
    
    if (emptySpaces.length > 0) {
      // „É©„É≥„ÉÄ„É†„Åß1„Å§„ÅÆÁ©∫„Åç„Éû„Çπ„ÇíÈÅ∏Êäû
      const target = emptySpaces[Math.floor(Math.random() * emptySpaces.length)];
      
      // „ÄåÈúä„Äç„ÇíÂè¨Âñö
      state.board[target.row][target.col] = {
        piece: 'Èúä',
        owner: owner,
        isSummoned: true
      };
      
      // Âè¨Âñö„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      showSpiritSummonEffect(target.row, target.col);
      
      setStatus(`Â¢ì„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ(${target.row},${target.col})„Å´„ÄåÈúä„Äç„ÇíÂè¨Âñö„Åó„Åæ„Åó„Åü`, 'success');
      console.log(`ü™¶ Â¢ì„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ(${target.row},${target.col})„Å´„ÄåÈúä„Äç„ÇíÂè¨Âñö„Åó„Åæ„Åó„Åü`);
    } else {
      setStatus('Â¢ì„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Åó„Åã„ÅóÂë®Âõ≤„Å´Á©∫„Åç„Éû„Çπ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü', 'playing');
      console.log('ü™¶ Â¢ì„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Åó„Åã„ÅóÂë®Âõ≤„Å´Á©∫„Åç„Éû„Çπ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
    }
  }

  // Èúß„ÅÆ„Çπ„Ç≠„É´ÔºöÂë®Âõ≤„ÅÆÊïµÈßí„Çí1„Å§Ê∂àÊªÖ„Åï„Åõ„Å¶Áõ∏Êâã„ÅÆÊåÅ„Å°Èßí„Å´Âä†„Åà„Çã
  function triggerMistSkill(row, col, owner) {
    const enemyPieces = [];
    const opponent = owner === 'player' ? 'computer' : 'player';
    
    // Âë®Âõ≤8ÊñπÂêë„ÅÆÊïµÈßí„ÇíÂèéÈõÜ
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = row + d[0], nc = col + d[1];
      if (inBounds(nr, nc) && state.board[nr][nc] && state.board[nr][nc].owner === opponent) {
        // ÊïµÈßíÔºàÁéã„ÉªÁéâ„ÅØÈô§Â§ñÔºâ
        const piece = state.board[nr][nc];
        if (piece.piece !== 'Áéã' && piece.piece !== 'Áéâ') {
          enemyPieces.push({ row: nr, col: nc, piece: piece.piece });
        }
      }
    });
    
    if (enemyPieces.length > 0) {
      // „É©„É≥„ÉÄ„É†„Åß1„Å§„ÅÆÊïµÈßí„ÇíÈÅ∏Êäû
      const target = enemyPieces[Math.floor(Math.random() * enemyPieces.length)];
      
      // Ê∂àÊªÖ„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      showMistDisappearEffect(target.row, target.col);
      
      // ÊïµÈßí„ÇíÊ∂àÊªÖ„Åï„Åõ„Å¶Áõ∏Êâã„ÅÆÊåÅ„Å°Èßí„Å´Âä†„Åà„Çã
      const capturedPiece = state.board[target.row][target.col].piece;
      state.board[target.row][target.col] = null;
      state.hands[opponent].push(capturedPiece);
      
      console.log(`üå´Ô∏è Èúß„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÊïµ„ÅÆ${capturedPiece}„ÇíÊ∂àÊªÖ„Åï„Åõ„Å¶Áõ∏Êâã„ÅÆÊåÅ„Å°Èßí„Å´Âä†„Åà„Åæ„Åó„Åü: (${target.row}, ${target.col})`);
      setStatus(`Èúß„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÊïµ„ÅÆ${capturedPiece}„ÇíÊ∂àÊªÖ„Åï„Åõ„Å¶Áõ∏Êâã„ÅÆÊåÅ„Å°Èßí„Å´Âä†„Åà„Åæ„Åó„Åü`, 'success');
    } else {
      console.log('üå´Ô∏è Èúß„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Åó„Åã„ÅóÂë®Âõ≤„Å´ÊïµÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
      setStatus('Èúß„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Åó„Åã„ÅóÂë®Âõ≤„Å´ÊïµÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü', 'playing');
    }
  }

  // Èúä„ÅÆ„Çπ„Ç≠„É´ÔºöÁßªÂãïÊôÇ„Å´Âë®Âõ≤„ÅÆÊïµÈßí„Çí1„Çø„Éº„É≥ÊÜë‰æù„Åï„Åõ„ÇãÔºàË°åÂãï‰∏çËÉΩÔºâ
  function triggerSpiritSkill(row, col, owner) {
    const enemyPieces = [];
    
    // Âë®Âõ≤8ÊñπÂêë„ÅÆÊïµÈßí„ÇíÂèéÈõÜÔºàÁâπÊÆä„Éû„Çπ„ÅØÈô§Â§ñÔºâ
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = row + d[0], nc = col + d[1];
      if (inBounds(nr, nc) && state.board[nr][nc] && state.board[nr][nc].owner !== owner) {
        const piece = state.board[nr][nc];
        // ÁâπÊÆä„Éû„ÇπÔºàÂë™„ÅÑ„Éû„Çπ„ÄÅÁü¢Âç∞„Éû„Çπ„ÄÅ„Éñ„É≠„ÉÉ„ÇØ„Éû„ÇπÔºâ„ÅØÈô§Â§ñ
        if (piece.piece !== 'n' && piece.piece !== 'X' && !['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(piece.piece)) {
          enemyPieces.push({ row: nr, col: nc });
        }
      }
    });
    
    if (enemyPieces.length > 0) {
      // „É©„É≥„ÉÄ„É†„Åß1„Å§„ÅÆÊïµÈßí„ÇíÈÅ∏Êäû
      const target = enemyPieces[Math.floor(Math.random() * enemyPieces.length)];
      
      // ÊïµÈßí„ÇíÊÜë‰æùÁä∂ÊÖã„Å´„Åô„ÇãÔºà2„Çø„Éº„É≥Ë°åÂãï‰∏çËÉΩÔºâ
      addImprisonedPiece(target.row, target.col, state.board[target.row][target.col], state.board[target.row][target.col].owner, 2);
      
      // ÊÜë‰æù„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      showSpiritEffect(row, col, target.row, target.col);
      
      setStatus(`Èúä„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÊïµÈßí„Å´ÊÜë‰æù„Åó„Åæ„Åó„Åü`, 'success');
      console.log(`üëª Èúä„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÊïµÈßí„Å´ÊÜë‰æù„Åó„Åæ„Åó„Åü`);
    } else {
      setStatus('Èúä„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Åó„Åã„ÅóÂë®Âõ≤„Å´ÊïµÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü', 'playing');
    }
  }

  // „ÅÇ„ÅÆ„Çπ„Ç≠„É´ÔºöÂë®Âõ≤„ÅÆÊïµÈßí„ÇíÊ≠©„Å´Â§â„Åà„ÇãÔºà‰∫úÁ©∫Èñì„ÅÆÂäõÔºâ
  function triggerAhSkill(row, col, owner) {
    const enemyPieces = [];
    
    // Âë®Âõ≤8ÊñπÂêë„ÅÆÊïµÈßí„ÇíÂèéÈõÜÔºàÁâπÊÆä„Éû„Çπ„ÅØÈô§Â§ñÔºâ
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = row + d[0], nc = col + d[1];
      if (inBounds(nr, nc) && state.board[nr][nc] && state.board[nr][nc].owner !== owner) {
        const piece = state.board[nr][nc];
        // ÁâπÊÆä„Éû„ÇπÔºàÂë™„ÅÑ„Éû„Çπ„ÄÅÁü¢Âç∞„Éû„Çπ„ÄÅ„Éñ„É≠„ÉÉ„ÇØ„Éû„ÇπÔºâ„ÅØÈô§Â§ñ
        if (piece.piece !== 'n' && piece.piece !== 'X' && !['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(piece.piece)) {
          enemyPieces.push({ row: nr, col: nc, piece: piece });
        }
      }
    });
    
    if (enemyPieces.length > 0) {
      // „É©„É≥„ÉÄ„É†„Åß1„Å§„ÅÆÊïµÈßí„ÇíÈÅ∏Êäû
      const target = enemyPieces[Math.floor(Math.random() * enemyPieces.length)];
      const originalPiece = target.piece.piece;
      
      // ÊïµÈßí„ÇíÊ≠©„Å´Â§â„Åà„Çã
      state.board[target.row][target.col] = {
        piece: 'Ê≠©',
        owner: target.piece.owner,
        isOriginal: false
      };
      
      // ‰∫úÁ©∫ÈñìÂ§âÊèõ„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      showAhTransformEffect(target.row, target.col, originalPiece);
      
      setStatus(`„ÅÇ„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ${originalPiece}„ÇíÊ≠©„Å´Â§â„Åà„Åæ„Åó„Åü`, 'success');
      console.log(`üåå „ÅÇ„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ${originalPiece}„ÇíÊ≠©„Å´Â§â„Åà„Åæ„Åó„Åü`);
    } else {
      setStatus('„ÅÇ„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Åó„Åã„ÅóÂë®Âõ≤„Å´ÊïµÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü', 'playing');
    }
  }

  // „ÅÇ„ÅÆ‰∫úÁ©∫ÈñìÂ§âÊèõ„Ç®„Éï„Çß„ÇØ„Éà
  function showAhTransformEffect(row, col, originalPiece) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (cell) {
      cell.style.animation = 'ahTransform 2s ease-in-out';
      setTimeout(() => {
        cell.style.animation = '';
      }, 2000);
    }
    
    // Â§âÊèõ„ÉÜ„Ç≠„Çπ„Éà„ÇíË°®Á§∫
    const transformText = document.createElement('div');
    transformText.textContent = `${originalPiece}‚ÜíÊ≠©`;
    transformText.style.cssText = `
      position: fixed;
      font-size: 16px;
      font-weight: bold;
      color: #9370db;
      text-shadow: 0 0 10px rgba(147, 112, 219, 0.8);
      z-index: 1000;
      pointer-events: none;
      animation: ahTransformText 2s ease-in-out;
    `;
    
    // „Çª„É´„ÅÆ‰ΩçÁΩÆ„Å´ÈÖçÁΩÆ
    if (cell) {
      const rect = cell.getBoundingClientRect();
      transformText.style.left = (rect.left + rect.width / 2 - 20) + 'px';
      transformText.style.top = (rect.top - 30) + 'px';
    }
    
    document.body.appendChild(transformText);
    
    // 2ÁßíÂæå„Å´„ÉÜ„Ç≠„Çπ„Éà„ÇíÂâäÈô§
    setTimeout(() => {
      if (transformText.parentNode) {
        transformText.parentNode.removeChild(transformText);
      }
    }, 2000);
  }

  // „ÅÇ„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà
  function showAhEffect(fromRow, fromCol, toRow, toCol) {
    const fromCell = document.querySelector(`[data-row="${fromRow}"][data-col="${fromCol}"]`);
    const toCell = document.querySelector(`[data-row="${toRow}"][data-col="${toCol}"]`);
    
    if (fromCell) {
      fromCell.style.animation = 'ahMove 1.5s ease-in-out';
      setTimeout(() => {
        fromCell.style.animation = '';
      }, 1500);
    }
    
    if (toCell) {
      toCell.style.animation = 'ahLanding 1s ease-in-out';
      setTimeout(() => {
        toCell.style.animation = '';
      }, 1000);
    }
  }

  // Â±±„ÅÆÂá∫Áèæ„Ç®„Éï„Çß„ÇØ„Éà
  function showMountainSpawnEffect(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (cell) {
      cell.style.animation = 'mountainSpawn 1s ease-in-out';
      setTimeout(() => {
        cell.style.animation = '';
      }, 1000);
    }
  }

  // Â¢ì„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà
  function showGraveEffect(fromRow, fromCol, toRow, toCol) {
    const fromCell = document.querySelector(`[data-row="${fromRow}"][data-col="${fromCol}"]`);
    const toCell = document.querySelector(`[data-row="${toRow}"][data-col="${toCol}"]`);
    
    if (fromCell) {
      fromCell.style.animation = 'graveMove 1.5s ease-in-out';
      setTimeout(() => {
        fromCell.style.animation = '';
      }, 1500);
    }
    
    if (toCell) {
      toCell.style.animation = 'graveCaptureEffect 2s ease-in-out';
      setTimeout(() => {
        toCell.style.animation = '';
      }, 2000);
    }
  }

  // Èúä„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà
  function showSpiritEffect(fromRow, fromCol, toRow, toCol) {
    const fromCell = document.querySelector(`[data-row="${fromRow}"][data-col="${fromCol}"]`);
    const toCell = document.querySelector(`[data-row="${toRow}"][data-col="${toCol}"]`);
    
    if (fromCell) {
      fromCell.style.animation = 'spiritMove 1.5s ease-in-out';
      setTimeout(() => {
        fromCell.style.animation = '';
      }, 1500);
    }
    
    if (toCell) {
      toCell.style.animation = 'spiritPossessionEffect 2s ease-in-out';
      setTimeout(() => {
        toCell.style.animation = '';
      }, 2000);
    }
  }

  // ÈúäÂè¨Âñö„Ç®„Éï„Çß„ÇØ„Éà
  function showSpiritSummonEffect(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (cell) {
      cell.style.animation = 'spiritSummon 2s ease-in-out';
      setTimeout(() => {
        cell.style.animation = '';
      }, 2000);
    }
  }

  // Â≤©„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà
  function showRockEffect(fromRow, fromCol, toRow, toCol) {
    const cell = document.querySelector(`[data-row="${toRow}"][data-col="${toCol}"]`);
    if (cell) {
      cell.style.animation = 'rockMove 0.8s ease-in-out';
      setTimeout(() => {
        cell.style.animation = '';
      }, 800);
    }
  }

  // Â≤©„ÅÆÈöúÂÆ≥Áâ©„Ç®„Éï„Çß„ÇØ„Éà
  function showRockBarrierEffect(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (cell) {
      cell.style.animation = 'rockBarrierAppear 1s ease-in-out';
      setTimeout(() => {
        cell.style.animation = '';
      }, 1000);
    }
  }

  // Â≤©„ÅÆÈöúÂÆ≥Áâ©„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
  function isRockBarrier(row, col) {
    return state.rockBarriers.some(barrier => barrier.row === row && barrier.col === col);
  }

  // Â≤©„ÅÆÈöúÂÆ≥Áâ©„ÇíÂâäÈô§
  function removeRockBarriers(owner) {
    // ÊåáÂÆö„Åï„Çå„Åü„Ç™„Éº„Éä„Éº„ÅÆÂ≤©„ÅÆÈöúÂÆ≥Áâ©„ÇíÂâäÈô§
    state.rockBarriers = state.rockBarriers.filter(barrier => barrier.owner !== owner);
    console.log(`ü™® „Ç™„Éº„Éä„Éº${owner}„ÅÆÂ≤©„ÅÆÈöúÂÆ≥Áâ©„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü`);
  }

  // Èâ±„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà
  function showOreEffect(fromRow, fromCol, toRow, toCol) {
    const cell = document.querySelector(`[data-row="${toRow}"][data-col="${toCol}"]`);
    if (cell) {
      cell.style.animation = 'oreMove 0.8s ease-in-out';
      setTimeout(() => {
        cell.style.animation = '';
      }, 800);
    }
  }

  // Èâ±„ÅÆÊé°Êéò„Ç®„Éï„Çß„ÇØ„Éà
  function showOreMiningEffect(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (cell) {
      cell.style.animation = 'oreMining 1s ease-in-out';
      setTimeout(() => {
        cell.style.animation = '';
      }, 1000);
    }
  }

  // Èâ±„ÅÆÂ§âÂåñ„Ç®„Éï„Çß„ÇØ„Éà
  function showOreUpgradeEffect(row, col, newPiece) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (cell) {
      cell.style.animation = 'oreUpgrade 1.5s ease-in-out';
      setTimeout(() => {
        cell.style.animation = '';
      }, 1500);
    }
  }

  // ÂàùÊúüÂåñ
  function init(){
    state.stageIndex = 0;
    // Â±•Ê≠¥„Çí„ÇØ„É™„Ç¢
    state.moveHistory = [];
    updateUndoButton();
    
    // ÊØí„Éû„ÇπÈñ¢ÈÄ£„ÅÆÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
    state.poisonSquares = [];
    state.poisonHistory = [];
    state.poisonedPieces = [];
    console.log('‚ò† ÂàùÊúüÂåñÊôÇ„Å´ÊØí„Éû„ÇπÈñ¢ÈÄ£„ÅÆÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü');
    
    loadStage(0);
  }

  function restartStage(){ 
    // Â±•Ê≠¥„Çí„ÇØ„É™„Ç¢
    state.moveHistory = [];
    updateUndoButton();
    
    // ÊØí„Éû„ÇπÈñ¢ÈÄ£„ÅÆÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
    state.poisonSquares = [];
    state.poisonHistory = [];
    state.poisonedPieces = [];
    console.log('‚ò† „Çπ„ÉÜ„Éº„Ç∏ÂÜçÈñãÊôÇ„Å´ÊØí„Éû„ÇπÈñ¢ÈÄ£„ÅÆÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü');
    
    loadStage(state.stageIndex); 
  }
  function nextStage(){
    if (state.stageIndex + 1 < STAGES.length){
      // Â±•Ê≠¥„Çí„ÇØ„É™„Ç¢
      state.moveHistory = [];
      updateUndoButton();
      
      // ÊØí„Éû„ÇπÈñ¢ÈÄ£„ÅÆÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
      state.poisonSquares = [];
      state.poisonHistory = [];
      state.poisonedPieces = [];
      console.log('‚ò† Ê¨°„ÅÆ„Çπ„ÉÜ„Éº„Ç∏„Å´ÈÄ≤„ÇÄÊôÇ„Å´ÊØí„Éû„ÇπÈñ¢ÈÄ£„ÅÆÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü');
      
      loadStage(state.stageIndex + 1);
    } else {
      setStatus('ÂÖ®„Çπ„ÉÜ„Éº„Ç∏„ÇØ„É™„Ç¢ÔºÅ„Åä„ÇÅ„Åß„Å®„ÅÜÔºÅ', 'win');
    }
  }

  // Êâã„ÅÆÂ±•Ê≠¥„Çí‰øùÂ≠ò„Åô„ÇãÈñ¢Êï∞
  function saveMoveToHistory(fromRow, fromCol, toRow, toCol, capturedPiece, handsBefore, turnCountBefore) {
    const moveRecord = {
      fromRow: fromRow,
      fromCol: fromCol,
      toRow: toRow,
      toCol: toCol,
      capturedPiece: capturedPiece,
      handsBefore: JSON.parse(JSON.stringify(handsBefore)),
      turnCountBefore: turnCountBefore,
      timestamp: Date.now()
    };
    
    state.moveHistory.push(moveRecord);
    
    // Â±•Ê≠¥„Çµ„Ç§„Ç∫„ÇíÂà∂Èôê
    if (state.moveHistory.length > state.maxHistorySize) {
      state.moveHistory.shift();
    }
    
    updateUndoButton();
    console.log('üìù Êâã„ÇíÂ±•Ê≠¥„Å´‰øùÂ≠ò:', moveRecord);
  }

  // 1ÊâãÊàª„Åô„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
  function updateUndoButton() {
    const undoBtn = document.getElementById('undo-btn');
    if (undoBtn) {
      if (state.moveHistory.length > 0 && !state.gameOver) {
        undoBtn.disabled = false;
        undoBtn.textContent = `1ÊâãÊàª„Åô (${state.moveHistory.length})`;
      } else {
        undoBtn.disabled = true;
        undoBtn.textContent = '1ÊâãÊàª„Åô';
      }
    }
  }

  // 1ÊâãÊàª„ÅôÊ©üËÉΩ
  function undoMove() {
    if (state.moveHistory.length === 0 || state.gameOver) {
      console.log('‚ùå Êàª„ÅôÊâã„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
      return;
    }
    
    // ÊúÄÂæå„ÅÆÊâã„ÇíÂèñÂæó
    const lastMove = state.moveHistory.pop();
    console.log('‚Ü©Ô∏è 1ÊâãÊàª„Åó„Åæ„Åô:', lastMove);
    
    // Áõ§Èù¢„ÇíÂÖÉ„Å´Êàª„Åô
    const fromPiece = state.board[lastMove.toRow][lastMove.toCol];
    if (fromPiece) {
      // Èßí„ÇíÂÖÉ„ÅÆ‰ΩçÁΩÆ„Å´Êàª„Åô
      state.board[lastMove.fromRow][lastMove.fromCol] = fromPiece;
      state.board[lastMove.toRow][lastMove.toCol] = null;
      
      // Âèñ„Çâ„Çå„ÅüÈßí„Åå„ÅÇ„Çå„Å∞Âæ©ÂÖÉ
      if (lastMove.capturedPiece) {
        state.board[lastMove.toRow][lastMove.toCol] = lastMove.capturedPiece;
      }
    }
    
    // ÊâãÊåÅ„Å°Èßí„ÇíÂÖÉ„Å´Êàª„Åô
    state.hands = JSON.parse(JSON.stringify(lastMove.handsBefore));
    
    // „Çø„Éº„É≥Êï∞„ÇíÂÖÉ„Å´Êàª„Åô
    state.turnCount = lastMove.turnCountBefore;
    
    // „Éó„É¨„Ç§„É§„Éº„Çí‰∫§‰ª£
    state.currentPlayer = state.currentPlayer === 'player' ? 'computer' : 'player';
    
    // ÈÅ∏ÊäûÁä∂ÊÖã„Çí„ÇØ„É™„Ç¢
    state.selected = null;
    state.validMoves = [];
    
    // „Ç≤„Éº„É†„Ç™„Éº„Éê„ÉºÁä∂ÊÖã„Çí„ÇØ„É™„Ç¢
    state.gameOver = false;
    
    // „Éú„Çø„É≥Áä∂ÊÖã„ÇíÊõ¥Êñ∞
    updateUndoButton();
    
    // ÁîªÈù¢„ÇíÂÜçÊèèÁîª
    render();
    
    // „Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÊõ¥Êñ∞
    if (state.currentPlayer === 'player') {
      setStatus('„ÅÇ„Å™„Åü„ÅÆÊâãÁï™', 'playing');
    } else {
      setStatus('Êïµ„ÅÆÊâãÁï™‚Ä¶', 'playing');
      // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÊâãÁï™„ÅÆÂ†¥Âêà„ÅØÂ∞ë„ÅóÂæÖ„Å£„Å¶„Åã„ÇâÂÆüË°å
      setTimeout(computerTurn, 100);
    }
    
    console.log('‚úÖ 1ÊâãÊàª„ÅóÂÆå‰∫Ü');
  }

  function loadStage(idx){
    const stage = STAGES[idx];
    state.stageIndex = idx;
    document.getElementById('stage-label').textContent = (idx+1);
    document.getElementById('stage-total').textContent = STAGES.length;
    
    // Â±•Ê≠¥„Çí„ÇØ„É™„Ç¢
    state.moveHistory = [];
    updateUndoButton();
    
    // Êúà„ÅÆÈßíÂ∞ÇÁî®„Ç´„Ç¶„É≥„Çø„Éº„Çí„É™„Çª„ÉÉ„Éà
    state.moonTurnCount = { player: 0, computer: 0 };
    
    // ÊØí„Éû„ÇπÈñ¢ÈÄ£„ÅÆÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
    state.poisonSquares = [];
    state.poisonHistory = [];
    state.poisonedPieces = [];
    console.log('‚ò† ÊØí„Éû„ÇπÈñ¢ÈÄ£„ÅÆÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü');
    
    // „Çø„Ç§„Éà„É´„Çí„Çπ„ÉÜ„Éº„Ç∏Âêç„Å´Â§âÊõ¥
    document.querySelector('.title').textContent = stage.name;

    // „Éó„É¨„Ç§„É§„Éº„ÅÆÈßí„Çí„Éá„ÉÉ„Ç≠„Å´Âü∫„Å•„ÅÑ„Å¶ÂèñÂæó
    const playerDeck = loadPlayerDeck();
    
    // „Éá„Éê„ÉÉ„Ç∞: ‰øùÂ≠ò„Åï„Çå„Åü„Éá„ÉÉ„Ç≠„ÅÆÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç
    console.log('=== STAGE LOADING DEBUG ===');
    console.log('Stage index:', idx);
    console.log('Stage name:', stage.name);
    console.log('Loaded player deck:', playerDeck);
    console.log('Deck type:', Array.isArray(playerDeck[0]) ? '2D Array' : 'Flat Array');
    if (Array.isArray(playerDeck[0])) {
      console.log('Deck dimensions:', playerDeck.length, 'x', playerDeck[0].length);
      console.log('Deck content by row:');
      playerDeck.forEach((row, i) => {
        console.log(`Row ${i}:`, row);
      });
      
      // „Éá„ÉÉ„Ç≠„ÅÆÂÖ®Ë°å„ÇíÁ¢∫Ë™ç
      if (playerDeck.length > 0) {
        console.log('*** „Éá„ÉÉ„Ç≠„ÅÆÂÖ®Ë°åÁ¢∫Ë™ç ***');
        console.log('„Éá„ÉÉ„Ç≠[0] (6Ë°åÁõÆ):', playerDeck[0]);
        console.log('„Éá„ÉÉ„Ç≠[1] (7Ë°åÁõÆ):', playerDeck[1]);
        console.log('„Éá„ÉÉ„Ç≠[2] (8Ë°åÁõÆ):', playerDeck[2]);
        
        // „Éá„ÉÉ„Ç≠„ÅÆÂÜÖÂÆπ„ÇíË©≥Á¥∞„Å´Á¢∫Ë™ç
        console.log('*** „Éá„ÉÉ„Ç≠„ÅÆË©≥Á¥∞Á¢∫Ë™ç ***');
        for (let row = 0; row < playerDeck.length; row++) {
          for (let col = 0; col < playerDeck[row].length; col++) {
            if (playerDeck[row][col]) {
              console.log(`„Éá„ÉÉ„Ç≠[${row}][${col}] = ${playerDeck[row][col]}`);
            }
          }
        }
        
        // ÁâπÂÆö„ÅÆ‰ΩçÁΩÆ„ÇíÁ¢∫Ë™ç
        console.log('*** ÁâπÂÆö‰ΩçÁΩÆ„ÅÆÁ¢∫Ë™ç ***');
        console.log('„Éá„ÉÉ„Ç≠[1][1] (7Ë°åÁõÆ2ÂàóÁõÆ):', playerDeck[1][1]);
        console.log('„Éá„ÉÉ„Ç≠[1][4] (7Ë°åÁõÆ5ÂàóÁõÆ):', playerDeck[1][4]);
        console.log('„Éá„ÉÉ„Ç≠[1][7] (7Ë°åÁõÆ8ÂàóÁõÆ):', playerDeck[1][7]);
        
        // „Éá„ÉÉ„Ç≠„ÅÆÂÖ®ÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç
        console.log('*** „Éá„ÉÉ„Ç≠„ÅÆÂÖ®ÂÜÖÂÆπÁ¢∫Ë™ç ***');
        for (let row = 0; row < playerDeck.length; row++) {
          console.log(`„Éá„ÉÉ„Ç≠[${row}]:`, playerDeck[row]);
        }
        
        // 8Ë°åÁõÆÔºàÊúÄ‰∏ãÊÆµÔºâ„ÅÆË©≥Á¥∞Á¢∫Ë™ç
        if (playerDeck.length > 2) {
          console.log('*** 8Ë°åÁõÆÔºàÊúÄ‰∏ãÊÆµÔºâ„ÅÆË©≥Á¥∞Á¢∫Ë™ç ***');
          console.log('„Éá„ÉÉ„Ç≠[2][0] (8Ë°åÁõÆ1ÂàóÁõÆ):', playerDeck[2][0]);
          console.log('„Éá„ÉÉ„Ç≠[2][1] (8Ë°åÁõÆ2ÂàóÁõÆ):', playerDeck[2][1]);
          console.log('„Éá„ÉÉ„Ç≠[2][2] (8Ë°åÁõÆ3ÂàóÁõÆ):', playerDeck[2][2]);
          console.log('„Éá„ÉÉ„Ç≠[2][3] (8Ë°åÁõÆ4ÂàóÁõÆ):', playerDeck[2][3]);
          console.log('„Éá„ÉÉ„Ç≠[2][4] (8Ë°åÁõÆ5ÂàóÁõÆ):', playerDeck[2][4]);
          console.log('„Éá„ÉÉ„Ç≠[2][5] (8Ë°åÁõÆ6ÂàóÁõÆ):', playerDeck[2][5]);
          console.log('„Éá„ÉÉ„Ç≠[2][6] (8Ë°åÁõÆ7ÂàóÁõÆ):', playerDeck[2][6]);
          console.log('„Éá„ÉÉ„Ç≠[2][7] (8Ë°åÁõÆ8ÂàóÁõÆ):', playerDeck[2][7]);
          console.log('„Éá„ÉÉ„Ç≠[2][8] (8Ë°åÁõÆ9ÂàóÁõÆ):', playerDeck[2][8]);
        }
      }
    }

    // Áõ§„Çí„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Å∏Â§âÊèõÔºà„Éó„É¨„Ç§„É§„Éº„ÅÆÈßí„ÇíÂÆåÂÖ®„Å´„Éá„ÉÉ„Ç≠„ÅßÁΩÆ„ÅçÊèõ„ÅàÔºâ
    state.board = stage.board.map((row, rowIndex) => row.map((cell, colIndex) => {
      if (cell === 'X') return { piece: 'X', owner: 'blocked', isOriginal: false }; // ÁßªÂãï‰∏çÂèØËÉΩ„Å™„Éû„Çπ
      
      // Áü¢Âç∞„Éû„Çπ„ÅÆÂá¶ÁêÜ
      if (['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(cell)) {
        return { piece: cell, owner: 'arrow', isOriginal: false };
      }
      
      // Âë™„ÅÑ„Éû„Çπ„ÅÆÂá¶ÁêÜ
      if (cell === 'n') {
        return { piece: cell, owner: 'curse', isOriginal: false };
      }
      
      // „Éó„É¨„Ç§„É§„ÉºË°åÔºà6-8Ë°åÁõÆÔºâ„ÅÆÂ†¥Âêà„ÄÅ„Éá„ÉÉ„Ç≠„Åã„ÇâÈßí„ÇíÈÖçÁΩÆ
      if (rowIndex >= 6 && rowIndex <= 8) {
        const deckRow = rowIndex - 6; // 6‚Üí0, 7‚Üí1, 8‚Üí2
        if (deckRow >= 0 && deckRow < playerDeck.length) {
          const deckPiece = playerDeck[deckRow][colIndex];
          if (deckPiece) {
            console.log(`  ‚úì Placed ${deckPiece} at (${rowIndex+1},${colIndex+1}) from deck row ${deckRow}`);
            const customPieces = ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'Á†Ç', 'È¢®', 'ÊØí', 'Ê≤º', '„ÅÇ'];
            const isOriginal = customPieces.includes(deckPiece);
            return { piece: deckPiece, owner: 'player', isOriginal };
          } else {
            console.log(`  ‚úó No piece in deck at row ${deckRow}, col ${colIndex}, making position empty`);
            return null;
          }
        }
      }
      
      // „Éó„É¨„Ç§„É§„ÉºË°å‰ª•Â§ñ„ÅÆÂ†¥Âêà„ÄÅÂÖÉ„ÅÆÂá¶ÁêÜ„ÇíÂÆüË°å
      if (!cell) return null;
      if (cell === '') return null;
      
      const ownerMark = cell[0];
      const owner = ownerMark === 'P' ? 'player' : 'computer';
      let piece = cell.substring(1); // ÊÆã„Çä(Êº¢Â≠ó)
      
      // „Éó„É¨„Ç§„É§„Éº„ÅÆÈßí„ÅÆÂ†¥Âêà„ÄÅ„Éá„ÉÉ„Ç≠„Åã„ÇâÈÅ∏Êäû„Åó„ÅüÈßí„Å´ÂÆåÂÖ®ÁΩÆ„ÅçÊèõ„Åà
      if (owner === 'player') {
        console.log(`Processing player piece at row ${rowIndex}, col ${colIndex}, original piece: ${piece}`);
      }
      
      // „Ç´„Çπ„Çø„É†Èßí„ÅÆÈÖçÂàó„ÇíÊõ¥Êñ∞ÔºàÂÖâ„Çâ„Åõ„ÇãÈßíÔºâ
      const customPieces = ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'Á†Ç', 'È¢®', 'ÊØí', 'Ê≤º', '„ÅÇ'];
      const isOriginal = customPieces.includes(piece);
      
      return { piece, owner, isOriginal };
    }));

    console.log('Final board state:', state.board);
    console.log('=== END STAGE LOADING DEBUG ===');

    // „Çπ„ÉÜ„Éº„Ç∏24ÔºàÂë™„ÅÑ„ÅÆÂ¢ìÂ†¥Ôºâ„ÅÆÂ†¥Âêà„ÄÅÊ≤ºÁä∂ÊÖã„ÇíÂàùÊúüÂåñÔºàÁõ§Èù¢ÂàùÊúüÂåñÂæåÔºâ
    if (idx === 23) { // „Çπ„ÉÜ„Éº„Ç∏24ÔºàÈÖçÂàó„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÅØ23Ôºâ
      resetSwampStates();
      console.log('üåä „Çπ„ÉÜ„Éº„Ç∏24Ë™≠„ÅøËæº„ÅøÊôÇ„Å´Ê≤ºÁä∂ÊÖã„ÇíÂàùÊúüÂåñ„Åó„Åæ„Åó„Åü');
    }

    state.currentPlayer = 'player';
    state.selected = null;
    state.validMoves = [];
    state.hands = { player: [], computer: [] };
    state.gameOver = false;
    
    // Â≤©„ÅÆÈöúÂÆ≥Áâ©„Çí„É™„Çª„ÉÉ„Éà
    state.rockBarriers = [];

    // Âë™„ÅÑ„Éû„Çπ„Å®Áü¢Âç∞„Éû„Çπ„ÅÆ‰ΩçÁΩÆ„ÇíÊ∞∏Á∂öÁöÑ„Å´Ë®òÈå≤
    recordPermanentTiles();

    render();
    
    // KÂçöÂ£´„ÅÆËÄê‰πÖÂäõ„ÇíÂàùÊúüÂåñ
    initializeKDurability();
    
    setStatus('„ÅÇ„Å™„Åü„ÅÆÊâãÁï™ÔºàÊåÅ„Å°Èßí„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÁΩÆ„Åè„Åì„Å®„ÇÇ„Åß„Åç„Åæ„ÅôÔºâ', 'playing');
  }

  function render(){
    const boardEl = document.getElementById('board');
    boardEl.innerHTML = '';

    for (let r=0; r<BOARD_SIZE; r++){
      for (let c=0; c<BOARD_SIZE; c++){
        const cellEl = document.createElement('div');
        cellEl.className = 'cell';
        cellEl.dataset.row = r;
        cellEl.dataset.col = c;
        
        // Êñ∞„Åó„ÅÑ„Çª„É´„ÇØ„É©„ÇπÊõ¥Êñ∞Èñ¢Êï∞„Çí‰ΩøÁî®
        updateCellClass(cellEl, r, c);

        // Â≤©„ÅÆÈöúÂÆ≥Áâ©„ÇíË°®Á§∫
        if (isRockBarrier(r, c)) {
          cellEl.classList.add('rock-barrier');
          cellEl.style.cursor = 'not-allowed';
          boardEl.appendChild(cellEl);
          continue; // Ê¨°„ÅÆ„Çª„É´„Å∏
        }

        const sq = state.board[r]?.[c] ?? null;
        if (sq){
          // ÁßªÂãï‰∏çÂèØËÉΩ„Å™„Éû„Çπ„ÄåX„Äç„ÅÆÂá¶ÁêÜ
          if (sq.piece === 'X' && sq.owner === 'blocked') {
            cellEl.classList.add('blocked');
            cellEl.textContent = 'X';
            cellEl.style.cursor = 'not-allowed';
            boardEl.appendChild(cellEl);
            // ÁßªÂãï‰∏çÂèØËÉΩ„Å™„Éû„Çπ„Å´„ÅØ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„ÇíËøΩÂä†„Åó„Å™„ÅÑ
            continue; // Ê¨°„ÅÆ„Çª„É´„Å∏
          }
          
          const pieceEl = document.createElement('div');
          pieceEl.className = 'piece ' + sq.owner;
          
          // Âπª„ÉªÈúß„ÉªÊúà„ÉªËàü„ÅÆÈßí„Å´ÁâπÊÆä„ÇØ„É©„Çπ„ÇíÈÅ©Áî®
          if (sq.piece === 'Âπª') {
            pieceEl.classList.add('phantom-piece');
          } else if (sq.piece === 'Èúß') {
            pieceEl.classList.add('mist-piece');
          } else if (sq.piece === 'Êúà') {
            pieceEl.classList.add('moon-piece');
          } else if (sq.piece === 'Ëàü') {
            pieceEl.classList.add('boat-piece');
          } else if (sq.piece === 'Ê©ü') {
            pieceEl.classList.add('machine-piece');
          } else if (sq.piece === 'Ê≠Ø') {
            pieceEl.classList.add('gear-piece');
          } else if (sq.piece === 'ÂÆ∂') {
            pieceEl.classList.add('house-piece');
          } else if (sq.piece === 'Ê∞ë') {
            pieceEl.classList.add('people-piece');
          } else if (sq.piece === 'Áïë') {
            pieceEl.classList.add('field-piece');
          } else if (sq.piece === 'Ê≥â') {
            pieceEl.classList.add('spring-piece');
          } else if (sq.piece === 'ÂÆü') {
            pieceEl.classList.add('experiment-piece');
          } else if (sq.piece === 'Áï∞') {
            pieceEl.classList.add('mutant-piece');
          } else if (sq.piece === 'K') {
            pieceEl.classList.add('k-boss-piece');
          }
          
          // Ê≥â„Å´„Çà„Å£„Å¶Âº∑Âåñ„Åï„Çå„ÅüÈßí„ÅÆÂá¶ÁêÜ
          if (sq.springEnhanced) {
            console.log(`üíß Âº∑Âåñ„Åï„Çå„ÅüÈßí„ÇíÁô∫Ë¶ã: ${sq.piece} at (${r},${c}), ÊÆã„Çä„Çø„Éº„É≥: ${sq.springEnhancedTurns}`);
            pieceEl.classList.add('spring-enhanced');
          }
          
          // Èóá„ÅßË¶Ü„Çè„Çå„ÅüÈßí„ÅÆÂá¶ÁêÜ
          if (sq.isDarkened) {
            // Ê¨°„ÅÆËá™ÂàÜ„ÅÆÁï™„ÅåÊù•„Çã„Åæ„ÅßÈóá„ÇíÁ∂ôÁ∂ö
            if (sq.darkenedBy === 'player' && state.currentPlayer === 'player') {
              // „Éó„É¨„Ç§„É§„Éº„ÅåÈóá„ÅßË¶Ü„Å£„ÅüÈßí„Åß„ÄÅ„Éó„É¨„Ç§„É§„Éº„ÅÆÁï™„Å´„Å™„Å£„Åü„ÇâËß£Èô§
              sq.isDarkened = false;
              delete sq.darkenedTurn;
              delete sq.darkenedBy;
            } else if (sq.darkenedBy === 'computer' && state.currentPlayer === 'computer') {
              // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅåÈóá„ÅßË¶Ü„Å£„ÅüÈßí„Åß„ÄÅ„Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁï™„Å´„Å™„Å£„Åü„ÇâËß£Èô§
              sq.isDarkened = false;
              delete sq.darkenedTurn;
              delete sq.darkenedBy;
            } else {
              // Èóá„ÅßË¶Ü„Çè„Çå„ÅüÈßí„ÅØÈªí„ÅÑÂõõËßí„ÅßË°®Á§∫
              pieceEl.style.backgroundColor = '#000';
              pieceEl.style.color = '#000';
              pieceEl.style.border = '2px solid #333';
              pieceEl.style.borderRadius = '4px';
              pieceEl.textContent = '‚ñ†';
              cellEl.appendChild(pieceEl);
              cellEl.addEventListener('click', ()=>onCellClick(r,c));
              boardEl.appendChild(cellEl);
              continue; // Ê¨°„ÅÆ„Çª„É´„Å∏
            }
          }
          
          if (sq.isOriginal) {
            pieceEl.classList.add('original');
          }
          
          // ÊôÇÈñìÂÅúÊ≠¢Áä∂ÊÖã„ÅÆÈßí„ÅÆÂá¶ÁêÜ
          if (sq.isTimeStopped) {
            pieceEl.classList.add('time-stopped');
          }
          // ÁÇé„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'ÁÇé' || sq.piece === 'ÁÅ´') {
            pieceEl.classList.add('fire-piece');
          }
          // Ê∞¥„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Ê∞¥' || sq.piece === 'Ê≥¢') {
            pieceEl.classList.add('water-piece');
          }
          // Êú®„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Êú®' || sq.piece === 'Ëëâ') {
            pieceEl.classList.add('tree-piece');
          }
          // ÈáëÂ±ûÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'ÈäÖ') {
            pieceEl.classList.add('copper-piece');
          } else if (sq.piece === 'ÈâÑ') {
            pieceEl.classList.add('iron-piece');
          } else if (sq.piece === 'Èå´') {
            pieceEl.classList.add('tin-piece');
          } else if (sq.piece === 'Èâõ') {
            pieceEl.classList.add('lead-piece');
          }
          // ÂÆù„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'ÂÆù') {
            pieceEl.classList.add('treasure-piece');
          }
          // Èõª„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Èõª') {
            pieceEl.classList.add('electric-piece');
          }
          // Èõ∑„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Èõ∑') {
            pieceEl.classList.add('thunder-piece');
          }
          // ÊôÇ„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'ÊôÇ') {
            pieceEl.classList.add('time-piece');
          }
          // Èõ™„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Èõ™') {
            pieceEl.classList.add('snow-piece');
          }
          // Á†Ç„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Á†Ç') {
            pieceEl.classList.add('sand-piece');
          }
          // È¢®„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'È¢®') {
            pieceEl.classList.add('wind-piece');
          }
          // Á†≤„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Á†≤') {
            pieceEl.classList.add('cannon-piece');
          }
          // Èóá„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Èóá') {
            pieceEl.classList.add('dark-piece');
          }
          // È≠î„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'È≠î') {
            pieceEl.classList.add('demon-piece');
          }
          // ÂøçËÄÖ„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Âøç') {
            pieceEl.classList.add('ninja-piece');
          }
          // ÂΩ±„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'ÂΩ±') {
            pieceEl.classList.add('shadow-piece');
          }
          // Á´ú„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Á´ú') {
            pieceEl.classList.add('dragon-piece');
          }
          // Ëæ∞„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØË¶öÈÜí„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Ëæ∞') {
            pieceEl.classList.add('dragon-awakened-piece');
          }
          // È≥≥„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'È≥≥') {
            pieceEl.classList.add('phoenix-piece');
          }
          // ÂÖâ„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'ÂÖâ') {
            pieceEl.classList.add('light-piece');
          }
          // Êòü„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Êòü') {
            pieceEl.classList.add('star-piece');
          }
          // È≠ö„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'È≠ö') {
            pieceEl.classList.add('fish-piece');
          }
          // Ëãî„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Ëãî') {
            pieceEl.classList.add('moss-piece');
          }
          // Èõ≤„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Èõ≤') {
            pieceEl.classList.add('cloud-piece');
          }
          // Ëôπ„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Ëôπ') {
            pieceEl.classList.add('rainbow-piece');
          }
          // ÊØí„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'ÊØí') {
            pieceEl.classList.add('poison-piece');
          }
          // Ê≤º„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Ê≤º') {
            pieceEl.classList.add('swamp-piece');
          }
          // Èè°„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Èè°') {
            pieceEl.classList.add('mirror-piece');
          }
          // Êò†„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Êò†') {
            pieceEl.classList.add('reflection-piece');
          }
          // „ÅÇ„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === '„ÅÇ') {
            pieceEl.classList.add('magic-ah-piece');
          }
          // Áâ¢„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Áâ¢') {
            pieceEl.classList.add('prison-piece');
            pieceEl.classList.add(sq.owner);
          }
          // Êüµ„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Êüµ') {
            pieceEl.classList.add('fence-piece');
            pieceEl.classList.add(sq.owner);
          }
          // Â∂∫„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Â∂∫') {
            pieceEl.classList.add('ridge-piece');
            pieceEl.classList.add(sq.owner);
          }
          // Â≥∞„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Â≥∞') {
            pieceEl.classList.add('peak-piece');
            pieceEl.classList.add(sq.owner);
          }
      // Â±±„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'Â±±') {
        pieceEl.classList.add('mountain-piece');
        pieceEl.classList.add(sq.owner);
      }
      // Â≤©„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'Â≤©') {
        pieceEl.classList.add('rock-piece');
        pieceEl.classList.add(sq.owner);
      }
      // Èâ±„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'Èâ±') {
        pieceEl.classList.add('ore-piece');
        pieceEl.classList.add(sq.owner);
      }
      // Â¢ì„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'Â¢ì') {
        pieceEl.classList.add('grave-piece');
        pieceEl.classList.add(sq.owner);
      }
          // Èúä„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Èúä') {
            pieceEl.classList.add('spirit-piece');
            pieceEl.classList.add(sq.owner);
          }
          // ÂàÄ„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'ÂàÄ') {
            pieceEl.classList.add('sword-piece');
          }
          // Èéß„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'Èéß') {
            pieceEl.classList.add('armor-piece');
          }
          // ÈäÉ„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
          if (sq.piece === 'ÈäÉ') {
            pieceEl.classList.add('gun-piece');
          }
          
          // Ê∫∫„ÇåÁä∂ÊÖã„ÅÆÈßí„ÅÆÂá¶ÁêÜ
          if (sq.isDrowned) {
            console.log('üêü Ê∫∫„ÇåÁä∂ÊÖã„ÅÆÈßí„ÇíÊ§úÂá∫:', sq.piece, 'at', r, c);
            pieceEl.classList.add('drowned-piece');
            
            // „ÉÜ„Çπ„ÉàÁî®ÔºöÁõ¥Êé•„Çπ„Çø„Ç§„É´„ÇíÈÅ©Áî®Ôºà„Çà„ÇäÂº∑Âäõ„Å´Ôºâ
            pieceEl.style.backgroundColor = '#00BFFF';
            pieceEl.style.color = '#FFFFFF';
            pieceEl.style.border = '4px solid #0066CC';
            pieceEl.style.boxShadow = '0 0 20px #00BFFF, inset 0 0 10px #00BFFF';
            pieceEl.style.opacity = '0.9';
            pieceEl.style.transform = 'scale(1.1)';
            pieceEl.style.zIndex = '1000';
            pieceEl.style.position = 'relative';
            
            // Ê∫∫„ÇåÁä∂ÊÖã„ÅÆÈßí„ÅÆ‰∏ä„Å´Ê∞¥„Éû„Éº„ÇØ„ÇíËøΩÂä†
            const waterMark = document.createElement('div');
            waterMark.className = 'drowning-water-mark';
            waterMark.textContent = 'üíß';
            waterMark.style.cssText = `
              position: absolute;
              top: -15px;
              right: -15px;
              font-size: 20px;
              color: #00BFFF;
              z-index: 10000;
              pointer-events: none;
              filter: drop-shadow(0 0 8px #00BFFF);
              animation: waterMarkFloat 2s ease-in-out infinite;
              text-shadow: 0 0 10px #00BFFF;
            `;
            
            // Èßí„ÅÆ‰ΩçÁΩÆ„Çírelative„Å´Ë®≠ÂÆö
            pieceEl.style.position = 'relative';
            pieceEl.appendChild(waterMark);
            
            // ËøΩÂä†„ÅÆÊ∞¥„Éû„Éº„ÇØÔºàÂ∑¶‰∏ãÔºâ
            const waterMark2 = document.createElement('div');
            waterMark2.className = 'drowning-water-mark-2';
            waterMark2.textContent = 'üåä';
            waterMark2.style.cssText = `
              position: absolute;
              bottom: -15px;
              left: -15px;
              font-size: 18px;
              color: #1E90FF;
              z-index: 9999;
              pointer-events: none;
              filter: drop-shadow(0 0 6px #1E90FF);
              animation: waterMarkFloat 2.5s ease-in-out infinite reverse;
              text-shadow: 0 0 8px #1E90FF;
            `;
            
            pieceEl.appendChild(waterMark2);
            console.log('üêü Ê∞¥„Éû„Éº„ÇØ„ÇíËøΩÂä†ÂÆå‰∫Ü');
          }
          
          // Â§âÂΩ¢Áä∂ÊÖã„ÅÆÈßí„ÅÆÂá¶ÁêÜ
          if (sq.isTransformed) {
            // Ê¨°„ÅÆËá™ÂàÜ„ÅÆÁï™„ÅåÊù•„Çã„Åæ„ÅßÂ§âÂΩ¢„ÇíÁ∂ôÁ∂ö
            if (sq.transformedBy === 'player' && state.currentPlayer === 'player') {
              // „Éó„É¨„Ç§„É§„Éº„ÅåÂ§âÂΩ¢„Åï„Åõ„ÅüÈßí„Åß„ÄÅ„Éó„É¨„Ç§„É§„Éº„ÅÆÁï™„Å´„Å™„Å£„Åü„ÇâËß£Èô§
              sq.isTransformed = false;
              delete sq.transformedTurn;
              delete sq.transformedBy;
            } else if (sq.transformedBy === 'computer' && state.currentPlayer === 'computer') {
              // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅåÂ§âÂΩ¢„Åï„Åõ„ÅüÈßí„Åß„ÄÅ„Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁï™„Å´„Å™„Å£„Åü„ÇâËß£Èô§
              sq.isTransformed = false;
              delete sq.transformedTurn;
              delete sq.transformedBy;
            } else {
              // Â§âÂΩ¢Áä∂ÊÖã„ÅÆÈßí„ÅØÁÅ∞Ëâ≤„ÅßË°®Á§∫
              pieceEl.style.backgroundColor = '#C0C0C0';
              pieceEl.style.color = '#666';
              pieceEl.style.border = '2px solid #999';
              pieceEl.style.transform = 'rotate(45deg)';
            }
          }
          
          // ËôπËâ≤Âà∂ÈôêÁä∂ÊÖã„ÅÆÈßí„ÅÆË°®Á§∫
          if (sq.isRainbowLimited) {
            console.log(`üåà ËôπËâ≤Âà∂ÈôêÁä∂ÊÖã„ÅÆÈßí„ÇíË°®Á§∫: ${sq.piece} at (${r},${c})`);
            pieceEl.classList.add('rainbow-limited-piece');
            pieceEl.style.background = 'linear-gradient(45deg, #ff0000, #ff8000, #ffff00, #00ff00, #0080ff, #8000ff)';
            pieceEl.style.backgroundSize = '300% 300%';
            pieceEl.style.color = '#FFFFFF';
            pieceEl.style.border = '3px solid #FFD700';
            pieceEl.style.boxShadow = '0 0 20px rgba(255, 215, 0, 0.9), inset 0 0 10px rgba(255, 255, 255, 0.3)';
            pieceEl.style.animation = 'rainbowShimmer 2s ease-in-out infinite';
            pieceEl.style.opacity = '1.0';
            pieceEl.style.fontWeight = 'bold';
            pieceEl.style.textShadow = '2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000';
          }
          
          // ÊØíÁä∂ÊÖã„ÅÆÈßí„ÅÆË°®Á§∫
          if (sq.isPoisoned) {
            console.log(`‚ò† ÊØíÁä∂ÊÖã„ÅÆÈßí„ÇíË°®Á§∫: ${sq.piece} at (${r},${c})`);
            pieceEl.classList.add('poisoned-piece');
            pieceEl.style.background = 'linear-gradient(45deg, #4a0e4e, #8b008b, #ff00ff, #4a0e4e)';
            pieceEl.style.backgroundSize = '200% 200%';
            pieceEl.style.color = '#FFFFFF';
            pieceEl.style.border = '3px solid #8b008b';
            pieceEl.style.boxShadow = '0 0 15px rgba(139, 0, 139, 0.8), inset 0 0 8px rgba(255, 0, 255, 0.3)';
            pieceEl.style.animation = 'poisonPulse 1.5s ease-in-out infinite';
            pieceEl.style.opacity = '0.9';
            pieceEl.style.fontWeight = 'bold';
            pieceEl.style.textShadow = '2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000';
          }
          
          // ÊØíÁä∂ÊÖã„ÅÆÈßí„ÅÆË°®Á§∫ÔºàÊñ∞„Åó„ÅÑ„Ç∑„Çπ„ÉÜ„É†Ôºâ
          if (state.poisonedPieces && state.poisonedPieces.some(pp => pp.row === r && pp.col === c)) {
            console.log(`‚ò† ÊØíÁä∂ÊÖã„ÅÆÈßí„ÇíË°®Á§∫ÔºàÊñ∞„Ç∑„Çπ„ÉÜ„É†Ôºâ: ${sq.piece} at (${r},${c})`);
            pieceEl.classList.add('poisoned-piece');
            pieceEl.style.background = 'linear-gradient(45deg, #4a0e4e, #8b008b, #ff00ff, #4a0e4e)';
            pieceEl.style.backgroundSize = '200% 200%';
            pieceEl.style.color = '#FFFFFF';
            pieceEl.style.border = '3px solid #8b008b';
            pieceEl.style.boxShadow = '0 0 15px rgba(139, 0, 139, 0.8), inset 0 0 8px rgba(255, 0, 255, 0.3)';
            pieceEl.style.animation = 'poisonPulse 1.5s ease-in-out infinite';
            pieceEl.style.opacity = '0.9';
            pieceEl.style.fontWeight = 'bold';
            pieceEl.style.textShadow = '2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000';
          }
          
          // Ê≤ºÁä∂ÊÖã„ÅÆÈßí„ÅÆË°®Á§∫
          if (sq.isSwampTrapped) {
            console.log(`üåä Ê≤ºÁä∂ÊÖã„ÅÆÈßí„ÇíË°®Á§∫: ${sq.piece} at (${r},${c})`);
            pieceEl.classList.add('swamp-trapped-piece');
            pieceEl.style.background = 'linear-gradient(45deg, #2d5016, #4a7c59, #6b8e23, #2d5016)';
            pieceEl.style.backgroundSize = '200% 200%';
            pieceEl.style.color = '#FFFFFF';
            pieceEl.style.border = '3px solid #4a7c59';
            pieceEl.style.boxShadow = '0 0 15px rgba(74, 124, 89, 0.8), inset 0 0 8px rgba(107, 142, 35, 0.3)';
            pieceEl.style.animation = 'swampBubble 2s ease-in-out infinite';
            pieceEl.style.opacity = '0.9';
            pieceEl.style.fontWeight = 'bold';
            pieceEl.style.textShadow = '2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000';
          }
          
          // Êõ∏„ÅÆË±™ËèØ„Å™Ë°®Á§∫ÔºàÂ∏∏ÊôÇÔºâ
          if (sq.piece === 'Êõ∏') {
            console.log(`üìö Êõ∏„ÅÆË±™ËèØ„Å™Ë°®Á§∫: ${sq.piece} at (${r},${c})`);
            pieceEl.classList.add('luxury-book-piece');
            if (sq.owner === 'computer') {
              pieceEl.classList.add('computer');
            }
            pieceEl.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%)';
            pieceEl.style.backgroundSize = '400% 400%';
            pieceEl.style.color = '#FFFFFF';
            pieceEl.style.border = '4px solid #FFD700';
            pieceEl.style.borderRadius = '12px';
            pieceEl.style.boxShadow = `
              0 0 30px rgba(102, 126, 234, 0.8),
              0 0 60px rgba(118, 75, 162, 0.6),
              inset 0 0 20px rgba(255, 215, 0, 0.3),
              inset 0 0 40px rgba(255, 255, 255, 0.1)
            `;
            pieceEl.style.animation = 'luxuryBookGlow 3s ease-in-out infinite';
            pieceEl.style.opacity = '1.0';
            pieceEl.style.fontWeight = '900';
            pieceEl.style.fontSize = '1.2em';
            pieceEl.style.textShadow = `
              0 0 10px rgba(255, 255, 255, 0.8),
              0 0 20px rgba(102, 126, 234, 0.6),
              0 0 30px rgba(118, 75, 162, 0.4),
              2px 2px 4px rgba(0, 0, 0, 0.8)
            `;
            pieceEl.style.position = 'relative';
            pieceEl.style.overflow = 'visible';
            
            // ÊïµÈßí„ÅÆÂ†¥Âêà„ÅØ180Â∫¶ÂõûËª¢„ÇíÈÅ©Áî®
            if (sq.owner === 'computer') {
              pieceEl.style.transform = 'rotate(180deg) !important';
              pieceEl.style.setProperty('transform', 'rotate(180deg)', 'important');
              // „Åï„Çâ„Å´Á¢∫ÂÆü„Å´„Åô„Çã„Åü„ÇÅ„ÄÅ„ÇØ„É©„ÇπÂêç„ÇÇËøΩÂä†
              pieceEl.classList.add('no-rotate');
            }
            
            // Ë£ÖÈ£æÁöÑ„Å™ÂÖâ„ÇãÂäπÊûú„ÇíËøΩÂä†
            const glowEffect = document.createElement('div');
            glowEffect.className = 'book-glow-effect';
            glowEffect.style.cssText = `
              position: absolute;
              top: -5px;
              left: -5px;
              right: -5px;
              bottom: -5px;
              background: linear-gradient(45deg, transparent, rgba(255, 215, 0, 0.3), transparent);
              border-radius: 16px;
              animation: bookGlowRotate 4s linear infinite;
              pointer-events: none;
              z-index: -1;
            `;
            pieceEl.appendChild(glowEffect);
          }
          
          // Êõ∏„ÅÆ„Çπ„Ç≠„É´‰ΩøÁî®‰∏≠„ÅÆË°®Á§∫
          if (sq.piece === 'Êõ∏' && sq.bookSkillUsed) {
            console.log(`üìö Êõ∏„ÅÆ„Çπ„Ç≠„É´‰ΩøÁî®‰∏≠„ÇíË°®Á§∫: ${sq.piece} at (${r},${c})`);
            pieceEl.classList.add('book-skill-active');
            pieceEl.style.background = 'linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c, #4facfe, #667eea)';
            pieceEl.style.backgroundSize = '600% 600%';
            pieceEl.style.border = '5px solid #FFD700';
            pieceEl.style.boxShadow = `
              0 0 40px rgba(102, 126, 234, 1.0),
              0 0 80px rgba(118, 75, 162, 0.8),
              0 0 120px rgba(240, 147, 251, 0.6),
              inset 0 0 30px rgba(255, 215, 0, 0.5),
              inset 0 0 60px rgba(255, 255, 255, 0.2)
            `;
            pieceEl.style.animation = 'luxuryBookSkillPulse 1.5s ease-in-out infinite';
            pieceEl.style.transform = 'scale(1.1)';
            pieceEl.style.zIndex = '10';
          }
          
          // Â∞Å„ÅÆË±™ËèØ„Å™Ë°®Á§∫ÔºàÂ∏∏ÊôÇÔºâ
          if (sq.piece === 'Â∞Å') {
            console.log(`üîí Â∞Å„ÅÆË±™ËèØ„Å™Ë°®Á§∫: ${sq.piece} at (${r},${c})`);
            pieceEl.classList.add('luxury-seal-piece');
            if (sq.owner === 'computer') {
              pieceEl.classList.add('computer');
            }
            pieceEl.style.background = 'linear-gradient(135deg, #2c3e50 0%, #34495e 25%, #4a6741 50%, #5d4e75 75%, #1a252f 100%)';
            pieceEl.style.backgroundSize = '400% 400%';
            pieceEl.style.color = '#FFFFFF';
            pieceEl.style.border = '4px solid #8B4513';
            pieceEl.style.borderRadius = '12px';
            pieceEl.style.boxShadow = `
              0 0 30px rgba(44, 62, 80, 0.8),
              0 0 60px rgba(52, 73, 94, 0.6),
              inset 0 0 20px rgba(139, 69, 19, 0.3),
              inset 0 0 40px rgba(255, 255, 255, 0.1)
            `;
            pieceEl.style.animation = 'luxurySealGlow 3s ease-in-out infinite';
            pieceEl.style.opacity = '1.0';
            pieceEl.style.fontWeight = '900';
            pieceEl.style.fontSize = '1.2em';
            pieceEl.style.textShadow = `
              0 0 10px rgba(255, 255, 255, 0.8),
              0 0 20px rgba(44, 62, 80, 0.6),
              0 0 30px rgba(52, 73, 94, 0.4),
              2px 2px 4px rgba(0, 0, 0, 0.8)
            `;
            pieceEl.style.position = 'relative';
            pieceEl.style.overflow = 'visible';
            
            // ÊïµÈßí„ÅÆÂ†¥Âêà„ÅØ180Â∫¶ÂõûËª¢„ÇíÈÅ©Áî®
            if (sq.owner === 'computer') {
              pieceEl.style.transform = 'rotate(180deg) !important';
              pieceEl.style.setProperty('transform', 'rotate(180deg)', 'important');
              // „Åï„Çâ„Å´Á¢∫ÂÆü„Å´„Åô„Çã„Åü„ÇÅ„ÄÅ„ÇØ„É©„ÇπÂêç„ÇÇËøΩÂä†
              pieceEl.classList.add('no-rotate');
            }
            
            // Ë£ÖÈ£æÁöÑ„Å™ÂÖâ„ÇãÂäπÊûú„ÇíËøΩÂä†
            const glowEffect = document.createElement('div');
            glowEffect.className = 'seal-glow-effect';
            glowEffect.style.cssText = `
              position: absolute;
              top: -5px;
              left: -5px;
              right: -5px;
              bottom: -5px;
              background: linear-gradient(45deg, transparent, rgba(139, 69, 19, 0.3), transparent);
              border-radius: 16px;
              animation: sealGlowRotate 4s linear infinite;
              pointer-events: none;
              z-index: -1;
            `;
            pieceEl.appendChild(glowEffect);
          }
          
          // Â∞Å„ÅÆ„Çπ„Ç≠„É´‰ΩøÁî®‰∏≠„ÅÆË°®Á§∫
          if (sq.piece === 'Â∞Å' && sq.sealSkillUsed) {
            console.log(`üîí Â∞Å„ÅÆ„Çπ„Ç≠„É´‰ΩøÁî®‰∏≠„ÇíË°®Á§∫: ${sq.piece} at (${r},${c})`);
            pieceEl.classList.add('seal-skill-active');
            pieceEl.style.background = 'linear-gradient(45deg, #2c3e50, #34495e, #4a6741, #5d4e75, #1a252f, #2c3e50)';
            pieceEl.style.backgroundSize = '600% 600%';
            pieceEl.style.border = '5px solid #8B4513';
            pieceEl.style.boxShadow = `
              0 0 40px rgba(44, 62, 80, 1.0),
              0 0 80px rgba(52, 73, 94, 0.8),
              0 0 120px rgba(74, 103, 65, 0.6),
              inset 0 0 30px rgba(139, 69, 19, 0.5),
              inset 0 0 60px rgba(255, 255, 255, 0.2)
            `;
            pieceEl.style.animation = 'luxurySealSkillPulse 1.5s ease-in-out infinite';
            pieceEl.style.transform = 'scale(1.1)';
            pieceEl.style.zIndex = '10';
          }
          
          // Â∞ÅÂç∞„Åï„Çå„ÅüÈßí„ÅÆË°®Á§∫
          if (sq.sealed) {
            console.log(`üîí Â∞ÅÂç∞„Åï„Çå„ÅüÈßí„ÇíË°®Á§∫: ${sq.piece} at (${r},${c})`);
            pieceEl.classList.add('sealed-piece');
            pieceEl.style.background = 'linear-gradient(45deg, #2c3e50, #34495e, #2c3e50, #34495e)';
            pieceEl.style.backgroundSize = '200% 200%';
            pieceEl.style.color = '#bdc3c7';
            pieceEl.style.border = '3px solid #7f8c8d';
            pieceEl.style.borderRadius = '8px';
            pieceEl.style.boxShadow = '0 0 15px rgba(44, 62, 80, 0.6), inset 0 0 8px rgba(52, 73, 94, 0.3)';
            pieceEl.style.animation = 'sealedPulse 2s ease-in-out infinite';
            pieceEl.style.opacity = '0.7';
            pieceEl.style.fontWeight = 'bold';
            pieceEl.style.textShadow = '2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000';
          }
          
          // Êõ∏„ÅÆ„Ç≥„Éî„ÉºÂäπÊûú„ÅÆË°®Á§∫
          if (sq.piece === 'Êõ∏' && sq.copiedPiece) {
            console.log(`üìö Êõ∏„ÅÆ„Ç≥„Éî„ÉºÂäπÊûú„ÇíË°®Á§∫: ${sq.piece} „Åå ${sq.copiedPiece} „Çí„Ç≥„Éî„Éº‰∏≠ at (${r},${c})`);
            pieceEl.classList.add('book-copy-effect');
            pieceEl.style.background = 'linear-gradient(45deg, #3498db, #2980b9, #1f618d, #3498db, #2980b9)';
            pieceEl.style.backgroundSize = '400% 400%';
            pieceEl.style.color = '#FFFFFF';
            pieceEl.style.border = '3px solid #3498db';
            pieceEl.style.borderRadius = '8px';
            pieceEl.style.boxShadow = '0 0 25px rgba(52, 152, 219, 0.9), inset 0 0 12px rgba(52, 152, 219, 0.4)';
            pieceEl.style.animation = 'bookCopyEffect 2s ease-in-out infinite';
            pieceEl.style.opacity = '1.0';
            pieceEl.style.fontWeight = 'bold';
            pieceEl.style.textShadow = '2px 2px 4px #000000, -1px -1px 2px #000000, 1px -1px 2px #000000, -1px 1px 2px #000000';
            
            // „Ç≥„Éî„Éº„Åó„ÅüÈßí„ÅÆÊÉÖÂ†±„ÇíË°®Á§∫„Åô„Çã„ÉÑ„Éº„É´„ÉÅ„ÉÉ„ÉóÈ¢®„ÅÆË¶ÅÁ¥†„ÇíËøΩÂä†
            const tooltip = document.createElement('div');
            tooltip.className = 'book-copy-tooltip';
            tooltip.textContent = `„Ç≥„Éî„Éº‰∏≠: ${sq.copiedPiece}`;
            tooltip.style.cssText = `
              position: absolute;
              top: -25px;
              left: 50%;
              transform: translateX(-50%);
              background: rgba(52, 152, 219, 0.9);
              color: white;
              padding: 2px 6px;
              border-radius: 4px;
              font-size: 10px;
              font-weight: bold;
              white-space: nowrap;
              z-index: 1000;
              pointer-events: none;
              animation: tooltipPulse 1.5s ease-in-out infinite;
            `;
            pieceEl.appendChild(tooltip);
          }
          
          // ÊØí„Éû„Çπ„ÅÆË°®Á§∫
          if (isPoisonSquare(r, c)) {
            console.log(`‚ò† ÊØí„Éû„Çπ„ÇíË°®Á§∫: (${r},${c})`);
            console.log(`‚ò† ÊØí„Éû„ÇπË©≥Á¥∞:`, state.poisonSquares);
            console.log(`‚ò† ÁèæÂú®„ÅÆ„Çø„Éº„É≥: ${state.turnCount}`);
            
            // Êó¢Â≠ò„ÅÆ„Çπ„Çø„Ç§„É´„Çí„ÇØ„É™„Ç¢
            cellEl.className = 'board-cell poison-square';
            
            // ÊØí„Éû„Çπ„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÂº∑Âà∂ÁöÑ„Å´ÈÅ©Áî®
            cellEl.style.cssText = `
              background: radial-gradient(circle, rgba(139, 0, 139, 0.9) 0%, rgba(255, 0, 255, 0.5) 50%, rgba(139, 0, 139, 0.3) 100%) !important;
              box-shadow: inset 0 0 25px rgba(139, 0, 139, 1), 0 0 20px rgba(139, 0, 139, 1), 0 0 30px rgba(255, 0, 255, 0.6) !important;
              border: 5px solid rgba(139, 0, 139, 1) !important;
              border-radius: 8px !important;
              position: relative !important;
              z-index: 1000 !important;
              animation: poisonSquarePulse 1.2s ease-in-out infinite !important;
              transform: scale(1.05) !important;
            `;
            
            console.log(`‚ò† ÊØí„Éû„Çπ„Çπ„Çø„Ç§„É´ÈÅ©Áî®ÂÆå‰∫Ü: (${r},${c})`);
            console.log(`‚ò† „Çª„É´Ë¶ÅÁ¥†:`, cellEl);
            console.log(`‚ò† „Çª„É´„ÅÆ„Çπ„Çø„Ç§„É´:`, cellEl.style.cssText);
            
            // ÊØí„Éû„Çπ„Å´„Ç¢„Ç§„Ç≥„É≥„ÇíËøΩÂä†
            let poisonIcon = cellEl.querySelector('.poison-icon');
            if (!poisonIcon) {
              poisonIcon = document.createElement('div');
              poisonIcon.className = 'poison-icon';
              poisonIcon.textContent = '‚ò†';
              poisonIcon.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 24px;
                color: #FFFFFF;
                z-index: 1001;
                pointer-events: none;
                animation: poisonIconPulse 1s ease-in-out infinite alternate;
                text-shadow: 0 0 10px rgba(139, 0, 139, 1);
                font-weight: bold;
              `;
              cellEl.appendChild(poisonIcon);
              console.log(`‚ò† ÊØí„Ç¢„Ç§„Ç≥„É≥ËøΩÂä†ÂÆå‰∫Ü: (${r},${c})`);
            }
          } else {
            // ÊØí„Éû„Çπ„Åß„Å™„ÅÑÂ†¥Âêà„ÅØ„ÇØ„É©„Çπ„Å®„Ç¢„Ç§„Ç≥„É≥„ÇíÂâäÈô§
            cellEl.classList.remove('poison-square');
            const poisonIcon = cellEl.querySelector('.poison-icon');
            if (poisonIcon) {
              poisonIcon.remove();
            }
            // „Éá„Éê„ÉÉ„Ç∞Áî®ÔºöÊØí„Éû„Çπ„Åß„Å™„ÅÑÂ†¥Âêà„ÅÆ„É≠„Ç∞
            if (state.poisonSquares && state.poisonSquares.length > 0) {
              console.log(`‚ò† ÊØí„Éû„Çπ„Åß„ÅØ„Å™„ÅÑ: (${r},${c}), ÁèæÂú®„ÅÆÊØí„Éû„ÇπÊï∞: ${state.poisonSquares.length}`);
              console.log(`‚ò† ÁèæÂú®„ÅÆ„Çø„Éº„É≥: ${state.turnCount}`);
              console.log(`‚ò† ÊØí„Éû„Çπ‰∏ÄË¶ß:`, state.poisonSquares.map(ps => `(${ps.row},${ps.col}) „Çø„Éº„É≥${ps.turn}`));
            }
          }
          
          
          
          // Âë™„ÅÑ„Éû„Çπ„ÄÅÁü¢Âç∞„Éû„Çπ„ÄÅ„Éñ„É≠„ÉÉ„ÇØ„Éû„Çπ„ÅØÊñáÂ≠ó„ÇíË°®Á§∫„Åó„Å™„ÅÑ
          if (sq.piece !== 'n' && !['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(sq.piece) && sq.piece !== 'X') {
          pieceEl.textContent = sq.piece;
          }
          
          // „Éá„Éê„ÉÉ„Ç∞ÔºöÊ∫∫„ÇåÁä∂ÊÖã„ÅÆÁ¢∫Ë™ç
          if (sq.isDrowned) {
            console.log('üêü renderÈñ¢Êï∞ÂÜÖ„ÅßÊ∫∫„ÇåÁä∂ÊÖã„ÇíÁ¢∫Ë™ç:', sq.piece, 'at', r, c, 'isDrowned:', sq.isDrowned);
          }
          
          // ÈÅ∏ÊäûÁä∂ÊÖã„ÅÆÈßí„Å´ÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
          if (state.selected && state.selected.r === r && state.selected.c === c) {
            pieceEl.classList.add('selected');
          }
          
          cellEl.appendChild(pieceEl);
        }

        cellEl.addEventListener('click', ()=>onCellClick(r,c));
        boardEl.appendChild(cellEl);
      }
    }

    // hands Ë°®Á§∫Ôºà„ÇØ„É™„ÉÉ„ÇØÂèØËÉΩÔºâ
    const hp = document.getElementById('hand-player');
    const hc = document.getElementById('hand-computer');
    hp.innerHTML = '';
    hc.innerHTML = '';
    
    // „Éó„É¨„Ç§„É§„Éº„ÅÆÊåÅ„Å°ÈßíÔºà„ÇØ„É™„ÉÉ„ÇØÂèØËÉΩÔºâ
    const availablePieces = getAvailablePiecesForStage(state.stageIndex);
    
    state.hands.player.forEach((p, index)=>{
      // „ÄåÁ©∫„Äç„ÅÆÈßí„ÅØË°®Á§∫„Åó„Å™„ÅÑ
      if (p === 'Á©∫') return;
      
      // „Éú„ÇπÈßí„ÅØË°®Á§∫„Åó„Å™„ÅÑÔºàK„ÄÅÂÆü„ÄÅÁï∞Ôºâ
      if (['K', 'ÂÆü', 'Áï∞'].includes(p)) {
        return;
      }
      
      // „Çπ„ÉÜ„Éº„Ç∏„ÇØ„É™„Ç¢„Å´Âü∫„Å•„ÅÑ„Å¶‰ΩøÁî®ÂèØËÉΩ„Å™Èßí„ÅÆ„Åø„ÇíË°®Á§∫
      if (!availablePieces.includes(p)) {
        // ‰ΩøÁî®„Åß„Åç„Å™„ÅÑÈßí„ÅØËñÑ„ÅèË°®Á§∫Ôºà„Ç∞„É¨„Éº„Ç¢„Ç¶„ÉàÔºâ
        const el = document.createElement('div'); 
        el.className='piece player'; 
        el.textContent=p; 
        el.style.opacity = '0.3';
        el.style.filter = 'grayscale(1)';
        el.style.cursor = 'not-allowed';
        el.title = '„Åì„ÅÆÈßí„ÅØ„Åæ„Å†‰ΩøÁî®„Åß„Åç„Åæ„Åõ„ÇìÔºà„Çπ„ÉÜ„Éº„Ç∏„Çí„ÇØ„É™„Ç¢„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºâ';
        hp.appendChild(el);
        return;
      }
      
      const el = document.createElement('div'); 
      el.className='piece player'; 
      el.textContent=p;
      
      // Âπª„ÉªÈúß„ÉªÊúà„ÉªËàü„ÅÆÈßí„Å´ÁâπÊÆä„ÇØ„É©„Çπ„ÇíÈÅ©Áî®
      if (p === 'Âπª') {
        el.classList.add('phantom-piece');
      } else if (p === 'Èúß') {
        el.classList.add('mist-piece');
      } else if (p === 'Êúà') {
        el.classList.add('moon-piece');
      } else if (p === 'Ëàü') {
        el.classList.add('boat-piece');
      } else if (p === 'Ê©ü') {
        el.classList.add('machine-piece');
      } else if (p === 'Ê≠Ø') {
        el.classList.add('gear-piece');
      } else if (p === 'ÂÆ∂') {
        el.classList.add('house-piece');
      } else if (p === 'Ê∞ë') {
        el.classList.add('people-piece');
      } else if (p === 'Áïë') {
        el.classList.add('field-piece');
      } else if (p === 'Ê≥â') {
        el.classList.add('spring-piece');
      } 
      if (state.dropMode && state.selectedPiece === p) {
        el.style.boxShadow = '0 0 10px #ffd54f';
      }
      // „Ç´„Çπ„Çø„É†Èßí„ÅÆÈÖçÂàó„ÇíÊõ¥Êñ∞ÔºàÂÖâ„Çâ„Åõ„ÇãÈßíÔºâ
      const customPieces = ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™', 'Á†Ç', 'È¢®', 'Ëãî', 'È≠ö', 'Èõ≤', 'Ëôπ', 'ÊØí', 'Ê≤º', '„ÅÇ'];
      if (customPieces.includes(p)) {
        el.classList.add('original');
      }
      // ÊôÇ„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'ÊôÇ') {
        el.classList.add('time-piece');
      }
      // Èõ™„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Èõ™') {
        el.classList.add('snow-piece');
      }
      // Á†Ç„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Á†Ç') {
        el.classList.add('sand-piece');
      }
      // È¢®„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'È¢®') {
        el.classList.add('wind-piece');
      }
      // Á†≤„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Á†≤') {
        el.classList.add('cannon-piece');
      }
      // Èóá„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Èóá') {
        el.classList.add('dark-piece');
      }
      // È≠î„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'È≠î') {
        el.classList.add('demon-piece');
      }
      // ÂøçËÄÖ„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Âøç') {
        el.classList.add('ninja-piece');
      }
      // ÂΩ±„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'ÂΩ±') {
        el.classList.add('shadow-piece');
      }
      // Á´ú„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Á´ú') {
        el.classList.add('dragon-piece');
      }
      // Ëæ∞„ÅÆÈßí„ÅÆË¶öÈÜí„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Ëæ∞') {
        el.classList.add('dragon-awakened-piece');
      }
      // È≥≥„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'È≥≥') {
        el.classList.add('phoenix-piece');
      }
      // ÂÖâ„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'ÂÖâ') {
        el.classList.add('light-piece');
      }
      // Êòü„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Êòü') {
        el.classList.add('star-piece');
      }
      // È≠ö„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'È≠ö') {
        el.classList.add('fish-piece');
      }
      // Ëãî„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Ëãî') {
        el.classList.add('moss-piece');
      }
      // Èõ≤„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Èõ≤') {
        el.classList.add('cloud-piece');
      }
      // Ëôπ„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Ëôπ') {
        el.classList.add('rainbow-piece');
      }
      // „ÅÇ„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === '„ÅÇ') {
        el.classList.add('magic-ah-piece');
      }
      el.addEventListener('click', ()=>onHandClick(p, 'player'));
      hp.appendChild(el);
    });
    
    // „Çπ„ÉÜ„Éº„Ç∏ÊÉÖÂ†±„ÇíË°®Á§∫
    updateStageInfo();
    
    // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÊåÅ„Å°ÈßíÔºàË°®Á§∫„ÅÆ„ÅøÔºâ
    state.hands.computer.forEach(p=>{
      // „ÄåÁ©∫„Äç„ÅÆÈßí„ÅØË°®Á§∫„Åó„Å™„ÅÑ
      if (p === 'Á©∫') return;
      
      const el = document.createElement('div'); 
      el.className='piece computer'; 
      el.textContent=p;
      
      // Âπª„ÉªÈúß„ÉªÊúà„ÉªËàü„ÅÆÈßí„Å´ÁâπÊÆä„ÇØ„É©„Çπ„ÇíÈÅ©Áî®
      if (p === 'Âπª') {
        el.classList.add('phantom-piece');
      } else if (p === 'Èúß') {
        el.classList.add('mist-piece');
      } else if (p === 'Êúà') {
        el.classList.add('moon-piece');
      } else if (p === 'Ëàü') {
        el.classList.add('boat-piece');
      } else if (p === 'ÂÆ∂') {
        el.classList.add('house-piece');
      } else if (p === 'Ê∞ë') {
        el.classList.add('people-piece');
      } else if (p === 'Áïë') {
        el.classList.add('field-piece');
      } else if (p === 'Ê≥â') {
        el.classList.add('spring-piece');
      } 
      
      // „Ç´„Çπ„Çø„É†Èßí„ÅÆÈÖçÂàó„ÇíÊõ¥Êñ∞ÔºàÂÖâ„Çâ„Åõ„ÇãÈßíÔºâ
      const customPieces = ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™', 'Á†Ç', 'È¢®', 'Ëãî', 'È≠ö', 'Èõ≤', 'Ëôπ', 'ÊØí', 'Ê≤º', '„ÅÇ'];
      if (customPieces.includes(p)) {
        el.classList.add('original');
      }
      // ÊôÇ„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'ÊôÇ') {
        el.classList.add('time-piece');
      }
      // Èõ™„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Èõ™') {
        el.classList.add('snow-piece');
      }
      // Á†Ç„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Á†Ç') {
        el.classList.add('sand-piece');
      }
      // È¢®„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'È¢®') {
        el.classList.add('wind-piece');
      }
      // Á†≤„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Á†≤') {
        el.classList.add('cannon-piece');
      }
      // Èóá„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Èóá') {
        el.classList.add('dark-piece');
      }
      // È≠î„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'È≠î') {
        el.classList.add('demon-piece');
      }
      // ÂøçËÄÖ„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Âøç') {
        el.classList.add('ninja-piece');
      }
      // ÂΩ±„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'ÂΩ±') {
        el.classList.add('shadow-piece');
      }
      // Á´ú„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Á´ú') {
        el.classList.add('dragon-piece');
      }
      // Ëæ∞„ÅÆÈßí„ÅÆË¶öÈÜí„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Ëæ∞') {
        el.classList.add('dragon-awakened-piece');
      }
      // È≥≥„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'È≥≥') {
        el.classList.add('phoenix-piece');
      }
      // ÂÖâ„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'ÂÖâ') {
        el.classList.add('light-piece');
      }
      // Êòü„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Êòü') {
        el.classList.add('star-piece');
      }
      // È≠ö„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'È≠ö') {
        el.classList.add('fish-piece');
      }
      // Ëãî„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Ëãî') {
        el.classList.add('moss-piece');
      }
      // Èõ≤„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Èõ≤') {
        el.classList.add('cloud-piece');
      }
      // Ëôπ„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === 'Ëôπ') {
        el.classList.add('rainbow-piece');
      }
      // „ÅÇ„ÅÆÈßí„ÅÆÁâπÊÆä„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
      if (p === '„ÅÇ') {
        el.classList.add('magic-ah-piece');
      }
      
      hc.appendChild(el);
    });
    
    // ÊØéÂõû„É¨„É≥„ÉÄ„É™„É≥„Ç∞ÊôÇ„Å´ÁâπÊÆä„Éû„Çπ„ÇíÂº∑Âà∂Âæ©ÂÖÉ
    if (state.permanentCurseTiles && state.permanentCurseTiles.length > 0) {
      restorePermanentTiles();
    }
  }

  function setStatus(text, kind){
    const s = document.getElementById('status');
    s.textContent = text;
    s.className = 'status ' + kind;
  }

  function onHandClick(piece, owner) {
    if (state.gameOver || owner !== 'player' || state.currentPlayer !== 'player') return;
    
    // „Éú„ÇπÈßí„ÅØ‰ΩøÁî®‰∏çÂèØ
    if (['K', 'ÂÆü', 'Áï∞'].includes(piece)) {
      setStatus('„Åì„ÅÆÈßí„ÅØ„Éú„ÇπÈßí„ÅÆ„Åü„ÇÅ‰ΩøÁî®„Åß„Åç„Åæ„Åõ„Çì', 'playing');
      return;
    }
    
    // „ÄåÁïë„ÄçÈßí„ÅØÂõ∫ÂÆöÈßí„Å†„Åå„ÄÅ„Éâ„É≠„ÉÉ„Éó„ÅØÂèØËÉΩ
    // ÁßªÂãï„ÅØ„Åß„Åç„Å™„ÅÑ„Åå„ÄÅÁõ§Èù¢„Å´ÈÖçÁΩÆ„Åô„Çã„Åì„Å®„ÅØ„Åß„Åç„Çã
    
    // ‰ΩøÁî®ÂèØËÉΩ„Å™Èßí„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    const availablePieces = getAvailablePiecesForStage(state.stageIndex);
    if (!availablePieces.includes(piece)) {
      setStatus('„Åì„ÅÆÈßí„ÅØ„Åæ„Å†‰ΩøÁî®„Åß„Åç„Åæ„Åõ„ÇìÔºà„Çπ„ÉÜ„Éº„Ç∏„Çí„ÇØ„É™„Ç¢„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºâ', 'playing');
      return;
    }
    
    if (state.dropMode && state.selectedPiece === piece) {
      // „Éâ„É≠„ÉÉ„Éó„É¢„Éº„Éâ„ÇíËß£Èô§
      state.dropMode = false;
      state.selectedPiece = null;
      state.validMoves = [];
    } else {
      // „Éâ„É≠„ÉÉ„Éó„É¢„Éº„Éâ„ÇíÈñãÂßã
      state.dropMode = true;
      state.selectedPiece = piece;
      state.selected = null;
      state.validMoves = getValidDropMoves(piece);
    }
    render();
  }

  function onCellClick(r,c){
    if (state.gameOver) return;
    
    // „Éó„É¨„Ç§„É§„Éº„ÅÆ„Çø„Éº„É≥„Åß„Å™„ÅÑÂ†¥Âêà„ÅØÊìç‰Ωú„ÇíÁÑ°ÂäπÂåñ
    if (state.currentPlayer !== 'player') return;
    
    // „Çπ„Ç≠„É´‰ΩøÁî®‰∏≠„ÅØÊìç‰Ωú„ÇíÁÑ°ÂäπÂåñ
    if (state.timeSkillActive || state.bookSkillActive || state.sealSkillActive) return;
    
    const sq = state.board[r][c];

    if (state.dropMode) {
      // ÊåÅ„Å°Èßí„ÇíÁΩÆ„Åè
      const isValid = state.validMoves.some(m=>m.r===r && m.c===c);
      if (isValid){
        dropPiece(r, c);
        return;
      }
      // „Éâ„É≠„ÉÉ„Éó„É¢„Éº„Éâ„ÇíËß£Èô§
      state.dropMode = false;
      state.selectedPiece = null;
      state.validMoves = [];
      render();
      return;
    }

    if (state.selected){
      // Âãï„Åã„Åô
      const isValid = state.validMoves.some(m=>m.r===r && m.c===c);
      if (isValid){
        makeMove(state.selected.r, state.selected.c, r, c);
        return;
      }
      // ÈÅ∏„Å≥Áõ¥„Åó or Ëß£Èô§
      state.selected = null; state.validMoves = [];
      if (sq && sq.owner === state.currentPlayer){
        state.selected = {r,c};
        state.validMoves = getValidMoves(r,c);
      }
      render();
    } else {
      if (sq && sq.owner === state.currentPlayer){
        // „ÄåÂÆ∂„ÄçÈßí„ÅÆÂ†¥Âêà„ÄÅ„Çπ„Ç≠„É´ÈÅ∏ÊäûËÇ¢„ÇíË°®Á§∫
        if (sq.piece === 'ÂÆ∂') {
          showHouseSkillOptions(r, c);
          return;
        }
        
        // „ÄåÁïë„ÄçÈßí„ÅÆÂ†¥Âêà„ÄÅ„Çπ„Ç≠„É´ÈÅ∏ÊäûËÇ¢„ÇíË°®Á§∫
        if (sq.piece === 'Áïë') {
          showFieldSkillOptions(r, c);
          return;
        }
        
        // „ÄåÊôÇ„Äç„ÅÆÈßí„ÅÆÂ†¥Âêà„ÄÅ„Çπ„Ç≠„É´Áô∫Âãï„ÅÆÈÅ∏ÊäûËÇ¢„ÇíË°®Á§∫
        if (sq.piece === 'ÊôÇ' && sq.owner === 'player') {
          showTimeSkillOptions(r, c);
          return;
        }
        
        // „ÄåÊõ∏„Äç„ÅÆÈßí„ÅÆÂ†¥Âêà„ÄÅ„Çπ„Ç≠„É´Áô∫Âãï„ÅÆÈÅ∏ÊäûËÇ¢„ÇíË°®Á§∫
        if (sq.piece === 'Êõ∏' && sq.owner === 'player') {
          showBookSkillOptions(r, c);
          return;
        }
        
        // „ÄåÂ∞Å„Äç„ÅÆÈßí„ÅÆÂ†¥Âêà„ÄÅ„Çπ„Ç≠„É´Áô∫Âãï„ÅÆÈÅ∏ÊäûËÇ¢„ÇíË°®Á§∫
        if (sq.piece === 'Â∞Å' && sq.owner === 'player') {
          showSealSkillOptions(r, c);
          return;
        }
        
        // ÈÄöÂ∏∏„ÅÆÈßíÈÅ∏ÊäûÂá¶ÁêÜ
        state.selected = {r,c};
        state.validMoves = getValidMoves(r,c);
        render();
      }
    }
  }

  function dropPiece(r, c) {
    // √ó„Éû„ÇπÔºàÁßªÂãï‰∏çÂèØËÉΩ„Å™„Éû„ÇπÔºâ„Å´„ÅØÁΩÆ„Åë„Å™„ÅÑ
    const targetSquare = state.board[r][c];
    if (targetSquare && targetSquare.piece === 'X' && targetSquare.owner === 'blocked') {
      setStatus('ÁßªÂãï‰∏çÂèØËÉΩ„Å™„Éû„Çπ„Å´„ÅØÈßí„ÇíÁΩÆ„Åë„Åæ„Åõ„Çì', 'playing');
      return;
    }
    
    // ÊåÅ„Å°Èßí„ÇíÁõ§„Å´ÁΩÆ„Åè
    state.board[r][c] = { 
      piece: state.selectedPiece, 
      owner: 'player',
      isOriginal: false,
      isDarkened: false,
      isDrowned: false,
      isTimeStopped: false,
      isPoisoned: false,
      isRainbowLimited: false
    };
    
    // ÊåÅ„Å°Èßí„Åã„ÇâÂâäÈô§
    const index = state.hands.player.indexOf(state.selectedPiece);
    if (index > -1) {
      state.hands.player.splice(index, 1);
    }
    
    // „Éâ„É≠„ÉÉ„Éó„É¢„Éº„Éâ„ÇíËß£Èô§
    state.dropMode = false;
    state.selectedPiece = null;
    state.validMoves = [];
    
    // „Çø„Éº„É≥„Ç´„Ç¶„É≥„Éà„ÇíÂ¢óÂä†
    state.turnCount++;
    
    // Áõ∏Êâã„Çø„Éº„É≥„Å∏
    state.currentPlayer = 'computer';
    
    // ÂáçÁµêÂäπÊûú„ÅÆÊõ¥Êñ∞Âá¶ÁêÜ
    updateFrozenEffects();
    
    // ÊÑüÈõªÂäπÊûú„ÅÆËß£Èô§Âá¶ÁêÜÔºà‰∏ÄÊôÇÁöÑ„Å´ÁÑ°ÂäπÂåñÔºâ
    // clearShockEffects();
    
    // ÁéãÊâãÁ©ç„ÅøÂà§ÂÆöÔºàÂâäÈô§Ê∏à„ÅøÔºâ
    
    render();
    
    if (!state.gameOver){
      setStatus('Êïµ„ÅÆÊâãÁï™‚Ä¶', 'playing');
      setTimeout(computerTurn, 100);
    }
  }

  function getValidDropMoves(piece) {
    const moves = [];
    
    // Á©∫„ÅÑ„Å¶„ÅÑ„Çã„Éû„Çπ„Å´ÁΩÆ„Åë„Çã
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const square = state.board[r][c];
        // √ó„Éû„ÇπÔºàÁßªÂãï‰∏çÂèØËÉΩ„Å™„Éû„ÇπÔºâ„Å´„ÅØÁΩÆ„Åë„Å™„ÅÑ
        if (square && square.piece === 'X' && square.owner === 'blocked') {
          continue;
        }
        if (!square) {
          // Ê≠©„ÅØÊúÄ‰∏ãÊÆµ„Å´„ÅØÁΩÆ„Åë„Å™„ÅÑ
          if (piece === 'Ê≠©' && r === 0) continue;
          // È¶ôËªä„ÅØÊúÄ‰∏ãÊÆµ„Å´„ÅØÁΩÆ„Åë„Å™„ÅÑ
          if (piece === 'È¶ô' && r === 0) continue;
          // Ê°ÇÈ¶¨„ÅØÊúÄ‰∏ãÊÆµ„Å®„Åù„ÅÆÊâãÂâç„Å´„ÅØÁΩÆ„Åë„Å™„ÅÑ
          if (piece === 'Ê°Ç' && (r === 0 || r === 1)) continue;
          
          // ‰∫åÊ≠©„ÅÆ„É´„Éº„É´: Ê≠©„ÇíÁΩÆ„ÅèÂ†¥Âêà„ÄÅÂêå„ÅòÂàó„Å´‰ªñ„ÅÆÊ≠©„Åå„Å™„ÅÑ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
          if (piece === 'Ê≠©') {
            let hasPawnInColumn = false;
            for (let checkRow = 0; checkRow < BOARD_SIZE; checkRow++) {
              const square = state.board[checkRow][c];
              if (square && square.piece === 'Ê≠©' && square.owner === 'player') {
                hasPawnInColumn = true;
                break;
              }
            }
            if (hasPawnInColumn) continue; // ‰∫åÊ≠©„Å´„Å™„Çã„ÅÆ„Åß„Çπ„Ç≠„ÉÉ„Éó
          }
          
          moves.push({r, c});
        }
      }
    }
    
    return moves;
  }

  function makeMove(fr, fc, tr, tc){
    const from = state.board[fr][fc];
    const to = state.board[tr][tc];

    // Êâã„ÅÆÂ±•Ê≠¥„Çí‰øùÂ≠òÔºàÁßªÂãïÂâç„ÅÆÁä∂ÊÖãÔºâ
    const handsBefore = JSON.parse(JSON.stringify(state.hands));
    const turnCountBefore = state.turnCount;
    saveMoveToHistory(fr, fc, tr, tc, to, handsBefore, turnCountBefore);

    // ÁßªÂãïÂÖà„Åå√ó„Éû„ÇπÔºàÁßªÂãï‰∏çÂèØËÉΩ„Å™„Éû„ÇπÔºâ„ÅÆÂ†¥Âêà„ÅØÁßªÂãï„ÇíÈò≤„Åê
    if (to && to.piece === 'X' && to.owner === 'blocked') {
      setStatus('ÁßªÂãï‰∏çÂèØËÉΩ„Å™„Éû„Çπ„Å´„ÅØÁßªÂãï„Åß„Åç„Åæ„Åõ„Çì', 'playing');
      return;
    }

    // Áü¢Âç∞„Éû„Çπ„ÅÆÂá¶ÁêÜÔºàÈßí„ÅÆ‰∏ã„Å´„ÅÇ„ÇãÁü¢Âç∞„Éû„Çπ„ÇÇÂê´„ÇÄÔºâ
    const arrowPiece = (to && ['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(to.piece)) ? to.piece : 
                      (to && to.underTile && ['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(to.underTile.piece)) ? to.underTile.piece : null;
    
    if (arrowPiece) {
      // Áü¢Âç∞„ÅÆÊñπÂêë„Å´1„Éû„ÇπÁßªÂãï
      let newRow = tr, newCol = tc;
      switch (arrowPiece) {
        case '‚Üë': newRow = tr - 1; break;
        case '‚Üê': newCol = tc - 1; break;
        case '‚Üì': newRow = tr + 1; break;
        case '‚Üí': newCol = tc + 1; break;
      }
      
      // ÁßªÂãïÂÖà„ÅåÁõ§ÂÜÖ„Åß„ÄÅÁ©∫„ÅÑ„Å¶„ÅÑ„Çã„ÅãÊïµÈßí„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„ÅøÁßªÂãï
      if (inBounds(newRow, newCol)) {
        const targetPiece = state.board[newRow][newCol];
        
        // ÁßªÂãïÂÖà„Å´Èßí„Åå„ÅÇ„ÇãÂ†¥Âêà„ÄÅÂèñ„ÇãÂá¶ÁêÜ
        if (targetPiece) {
          if (targetPiece.owner !== from.owner) {
            // ÊïµÈßí„ÇíÂèñ„Çã
            state.board[newRow][newCol] = from;
            state.board[fr][fc] = null;
            
            // Âèñ„Å£„ÅüÈßí„ÇíÊâãÈßí„Å´ËøΩÂä†ÔºàÁâπÊÆä„Éû„Çπ„Å®„ÄåÈúä„ÄçÈßí„ÅØÈô§Â§ñÔºâ
            if (targetPiece.piece !== 'n' && targetPiece.piece !== 'X' && targetPiece.piece !== 'Èúä' && !['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(targetPiece.piece)) {
              // Ëæ∞„ÅåÂèñ„Çâ„Çå„ÅüÂ†¥Âêà„ÅØÁ´ú„Å®„Åó„Å¶ÊåÅ„Å°Èßí„Å´ËøΩÂä†
              const pieceToAdd = targetPiece.piece === 'Ëæ∞' ? 'Á´ú' : targetPiece.piece;
              if (from.owner === 'player') {
                state.hands.player.push(pieceToAdd);
              } else {
                state.hands.computer.push(pieceToAdd);
              }
            }
            
            setStatus(`${to.piece}„Éû„Çπ„Åß${targetPiece.piece}„ÇíÂèñ„Å£„Å¶${to.piece}ÊñπÂêë„Å´ÁßªÂãï„Åó„Åæ„Åó„Åü`, 'success');
            console.log(`üèπ Áü¢Âç∞„Éû„Çπ${to.piece}„Åß${targetPiece.piece}„ÇíÂèñ„Å£„Å¶ÁßªÂãï: (${fr},${fc}) ‚Üí (${newRow},${newCol})`);
          } else {
            // Ëá™ÂàÜ„ÅÆÈßí„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØÁßªÂãï„Åß„Åç„Å™„ÅÑ
            setStatus(`${to.piece}„Éû„Çπ„ÅßËá™ÂàÜ„ÅÆÈßí„Åå„ÅÇ„Çã„Åü„ÇÅÁßªÂãï„Åß„Åç„Åæ„Åõ„Çì`, 'warning');
            return;
          }
        } else {
          // Á©∫„ÅÑ„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÁßªÂãï
          state.board[newRow][newCol] = from;
          state.board[fr][fc] = null;
          
          setStatus(`${to.piece}„Éû„Çπ„Åß${to.piece}ÊñπÂêë„Å´ÁßªÂãï„Åó„Åæ„Åó„Åü`, 'success');
          console.log(`üèπ Áü¢Âç∞„Éû„Çπ${to.piece}„ÅßÁßªÂãï: (${fr},${fc}) ‚Üí (${newRow},${newCol})`);
        }
        
        // Áü¢Âç∞„Éû„Çπ„ÇíÂÖÉ„Å´Êàª„Åô
        state.board[tr][tc] = to;
        
        state.selected = null;
        state.validMoves = [];
        render();
        return;
      } else {
        setStatus(`${to.piece}„Éû„Çπ„Åß${to.piece}ÊñπÂêë„Å´ÁßªÂãï„Åß„Åç„Åæ„Åõ„ÇìÔºàÁõ§Â§ñÔºâ`, 'warning');
        return;
      }
    }

    // ÂãùÊïóÂà§ÂÆöÔºàÁéã„ÇíÂèñ„Å£„Åü„ÇâÂãù„Å°Ôºâ
    if (to && (to.piece === 'Áéã' || to.piece === 'Áéâ')){
      // Ëá™ÂàÜ„ÅÆÁéã„ÇíÂèñ„Çç„ÅÜ„Å®„Åó„ÅüÂ†¥Âêà„ÅØÁÑ°Âäπ„Å™Êâã„Å®„Åó„Å¶Âá¶ÁêÜ
      if (from.owner === to.owner) {
        console.log('‚ùå Ëá™ÂàÜ„ÅÆÁéã„ÇíÂèñ„Çç„ÅÜ„Å®„Åó„Åæ„Åó„Åü„ÄÇÁÑ°Âäπ„Å™Êâã„Åß„Åô„ÄÇ');
        setStatus('Ëá™ÂàÜ„ÅÆÁéã„ÇíÂèñ„Çã„Åì„Å®„ÅØ„Åß„Åç„Åæ„Åõ„Çì', 'warning');
        return;
      }
      
      // ÁßªÂãïÂÖà„ÅåÂë™„ÅÑ„Éû„Çπ„ÇÑÁü¢Âç∞„Éû„Çπ„ÅÆÂ†¥Âêà„ÄÅ„Åù„Çå„Çâ„Çí‰øùÊåÅ
      const targetTile = state.board[tr][tc];
      if (targetTile && (targetTile.piece === 'n' || ['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(targetTile.piece))) {
        // ÁâπÊÆä„Éû„Çπ„ÅØ‰øùÊåÅ„Åó„ÄÅÈßí„ÅØ‰∏ä„Å´ÈÖçÁΩÆ
        state.board[tr][tc] = { ...from, underTile: targetTile };
      } else {
        state.board[tr][tc] = from;
      }
      state.board[fr][fc] = null;
      state.selected = null; state.validMoves = [];
      
      // ËôπËâ≤Âà∂ÈôêÁä∂ÊÖã„Çí‰øùÊåÅÔºàÁßªÂãï„Åó„Å¶„ÇÇÂà∂ÈôêÁä∂ÊÖã„ÅØÁ∂ôÁ∂öÔºâ
      if (from.isRainbowLimited) {
        console.log(`üåà ËôπËâ≤Âà∂ÈôêÁä∂ÊÖã„Çí‰øùÊåÅ: ${from.piece} ÁßªÂãïÂæå„ÇÇÂà∂ÈôêÁ∂ôÁ∂ö`);
      }
      
      render();
      
      // „Éó„É¨„Ç§„É§„Éº„Åå„Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéã„ÇíÂèñ„Å£„ÅüÂ†¥Âêà
      if (from.owner === 'player' && to.owner === 'computer') {
        console.log('üëë „Éó„É¨„Ç§„É§„Éº„Åå„Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéã„ÇíÂèñ„Å£„ÅüÔºÅ„Éó„É¨„Ç§„É§„Éº„ÅÆÂãùÂà©');
        setStatus('ÂãùÂà©ÔºÅ Áéã„ÇíÊçïÁç≤„Åó„Åæ„Åó„Åü', 'win');
        state.gameOver = true;
        
        // „Çπ„ÉÜ„Éº„Ç∏„ÇØ„É™„Ç¢„ÇíË®òÈå≤
        saveStageClear();
      }
      // „Ç≥„É≥„Éî„É•„Éº„Çø„Åå„Éó„É¨„Ç§„É§„Éº„ÅÆÁéã„ÇíÂèñ„Å£„ÅüÂ†¥Âêà
      else if (from.owner === 'computer' && to.owner === 'player') {
        console.log('üíÄ „Ç≥„É≥„Éî„É•„Éº„Çø„Åå„Éó„É¨„Ç§„É§„Éº„ÅÆÁéã„ÇíÂèñ„Å£„ÅüÔºÅ„Éó„É¨„Ç§„É§„Éº„ÅÆË≤†„Åë');
        setStatus('„Éó„É¨„Ç§„É§„Éº„ÅÆË≤†„Åë„Åß„Åô', 'lose');
        state.gameOver = true;
      }
      
      return;
    }

    // ÁÇé„ÅÆÈßí„ÅÆÁßªÂãïÂäπÊûú„ÇíË°®Á§∫
    if (from && (from.piece === 'ÁÇé' || from.piece === 'ÁÅ´')) {
      showFireEffect(from.piece, fr, fc, tr, tc);
      // ÁßªÂãïÂÖà„ÅÆ„Çª„É´„Å´„ÇÇ„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†
      setTimeout(() => {
        enhanceFirePieceMove(from.piece, tr, tc);
      }, 100);
      
      // ÁÇé„ÅÆÈßí„ÅÆÁßªÂãïÊôÇ„Å´Á¢∫Áéá„ÇíË°®Á§∫
      if (from.piece === 'ÁÇé') {
        setStatus('ÁÇé„ÅÆ‰ºùÊí≠ÂäπÊûúÁô∫ÂãïÔºÅ10%„ÅÆÁ¢∫Áéá„ÅßÊïµÈßí„ÅåÊ∂àÊªÖ„Åó„Åæ„Åô', 'playing');
      }
      // ÁÅ´„ÅÆÈßí„ÅÆÁßªÂãïÊôÇ„Å´Áõ∏Êâã„ÅÆÊâãÊåÅ„Å°Èßí„ÇíÁáÉ„ÇÑ„Åô„Çπ„Ç≠„É´
      if (from.piece === 'ÁÅ´') {
        triggerFireBurnSkill(from.owner);
      }
    }
    
    // Ê∞¥„ÅÆÈßí„ÅÆÁßªÂãïÂäπÊûú„ÇíË°®Á§∫
    if (from && (from.piece === 'Ê∞¥' || from.piece === 'Ê≥¢')) {
      if (from.piece === 'Ê∞¥') {
        showWaterFlowEffect(fr, fc, tr, tc);
        setStatus('Ê∞¥„ÅÆÊµÅ„ÇåÂäπÊûúÁô∫ÂãïÔºÅÊïµÈßí„Çí1„Éû„ÇπÊäº„ÅóÊµÅ„Åó„Åæ„Åô', 'playing');
      } else if (from.piece === 'Ê≥¢') {
        showWavePropagationEffect(fr, fc, tr, tc);
        setStatus('Ê≥¢„ÅÆ‰ºùÊí≠ÂäπÊûúÁô∫ÂãïÔºÅÊïµÈßí„ÇíÁ´Ø„Åæ„ÅßÊäº„ÅóÊµÅ„Åó„Åæ„Åô', 'playing');
      }
      
      // ÁßªÂãïÂÖà„ÅÆ„Çª„É´„Å´„ÇÇ„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†
      setTimeout(() => {
        enhanceWaterPieceMove(from.piece, tr, tc);
      }, 100);
    }
    
    // Êú®„ÅÆÈßí„ÅÆÁßªÂãïÂäπÊûú„ÇíË°®Á§∫
    if (from && from.piece === 'Êú®') {
      showTreeGrowthEffect(fr, fc, tr, tc);
      
      // ÁßªÂãïÂÖà„ÅÆ„Çª„É´„Å´„ÇÇ„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†
      setTimeout(() => {
        enhanceTreePieceMove(tr, tc);
      }, 100);
    }
    
    // Ëëâ„ÅÆÈßí„ÅÆÁßªÂãïÂäπÊûú„ÇíË°®Á§∫
    if (from && from.piece === 'Ëëâ') {
      showLeafScatteringEffect(fr, fc, tr, tc);
      
      // ÁßªÂãïÂÖà„ÅÆ„Çª„É´„Å´„ÇÇ„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†
      setTimeout(() => {
        enhanceLeafPieceMove(tr, tc);
      }, 100);
    }
    
    // Êòü„ÅÆÈßí„ÅÆÁßªÂãïÂäπÊûú„ÇíË°®Á§∫
    if (from && from.piece === 'Êòü') {
      showStarTrajectoryEffect(fr, fc, tr, tc);
      
      // ÁßªÂãïÂÖà„ÅÆ„Çª„É´„Å´„ÇÇ„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†
      setTimeout(() => {
        enhanceStarPieceMove(tr, tc);
      }, 100);
    }
    
    // Èóá„ÅÆÈßí„ÅÆÁßªÂãïÂäπÊûú„ÇíË°®Á§∫
    if (from && from.piece === 'Èóá') {
      showDarkAbsorptionEffect(fr, fc, tr, tc);
      
      // ÁßªÂãïÂÖà„ÅÆ„Çª„É´„Å´„ÇÇ„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†
      setTimeout(() => {
        enhanceDarkPieceMove(tr, tc);
      }, 100);
    }
    
    // È≠î„ÅÆÈßí„ÅÆÁßªÂãïÂäπÊûú„ÇíË°®Á§∫
    if (from && from.piece === 'È≠î') {
      showDemonDestructionEffect(fr, fc, tr, tc);
      
      // ÁßªÂãïÂÖà„ÅÆ„Çª„É´„Å´„ÇÇ„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†
      setTimeout(() => {
        enhanceDemonPieceMove(tr, tc);
      }, 100);
    }
    
    // Èå´„ÅÆÈßí„ÅÆÂ§âÂΩ¢ÂäπÊûú„ÇíË°®Á§∫
    if (from && from.piece === 'Èå´') {
      showTinTransformationEffect(tr, tc);
      
      // ÁßªÂãïÂÖà„ÅÆ„Çª„É´„Å´„ÇÇ„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†
      setTimeout(() => {
        enhanceTinPieceMove(tr, tc);
      }, 100);
    }
    
    // Ê∞∑„ÅÆÈßí„ÅÆÂáçÁµêÂäπÊûú„ÇíË°®Á§∫
    if (from && from.piece === 'Ê∞∑') {
      showIceFreezeEffect(fr, fc, tr, tc);
      
      // ÁßªÂãïÂÖà„ÅÆ„Çª„É´„Å´„ÇÇ„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†
      setTimeout(() => {
        enhanceIcePieceMove(tr, tc);
      }, 100);
    }
    
    // ÈâÑ„ÅÆÈßí„ÅÆÁ£ÅÂäõÂäπÊûú„ÇíË°®Á§∫
    if (from && from.piece === 'ÈâÑ') {
      showIronMagneticEffect(tr, tc);
      
      // ÁßªÂãïÂÖà„ÅÆ„Çª„É´„Å´„ÇÇ„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†
      setTimeout(() => {
        enhanceIronPieceMove(tr, tc);
      }, 100);
    }
    
    // ÂÆù„ÅÆÈßí„ÅÆËºù„ÅçÂäπÊûú„ÇíË°®Á§∫
    if (from && from.piece === 'ÂÆù') {
      showTreasureGlowEffect(tr, tc);
      
      // ÁßªÂãïÂÖà„ÅÆ„Çª„É´„Å´„ÇÇ„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†
      setTimeout(() => {
        enhanceTreasurePieceMove(tr, tc);
      }, 100);
    }
    
    // Èõª„ÅÆÈßí„ÅÆÂ∞éÈõªÂäπÊûú„ÇíË°®Á§∫
    if (from && from.piece === 'Èõª') {
      showElectricConductionEffect(tr, tc);
      
      // ÁßªÂãïÂÖà„ÅÆ„Çª„É´„Å´„ÇÇ„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†
      setTimeout(() => {
        enhanceElectricPieceMove(tr, tc);
      }, 100);
    }
    
    // Èõ∑„ÅÆÈßí„ÅÆÊîæÈõªÂäπÊûú„ÇíË°®Á§∫
    if (from && from.piece === 'Èõ∑') {
      showThunderDischargeEffect(tr, tc);
      
      // ÁßªÂãïÂÖà„ÅÆ„Çª„É´„Å´„ÇÇ„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†
      setTimeout(() => {
        enhanceThunderPieceMove(tr, tc);
      }, 100);
    }
    
    // Èõ™„ÅÆÈßí„ÅÆÊ∞∑ÂÖ•ÊâãÂäπÊûú„ÇíË°®Á§∫
    if (from && from.piece === 'Èõ™') {
      showSnowIceEffect(fr, fc, tr, tc);
      
      // ÁßªÂãïÂÖà„ÅÆ„Çª„É´„Å´„ÇÇ„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†
      setTimeout(() => {
        enhanceSnowPieceMove(tr, tc);
      }, 100);
    }

    // Âπª„ÅÆÂõûÈÅø„Çπ„Ç≠„É´„ÉÅ„Çß„ÉÉ„ÇØ
    if (to && to.piece === 'Âπª' && to.owner !== from.owner) {
      // 50%„ÅÆÁ¢∫Áéá„ÅßÂõûÈÅø
      if (Math.random() < 0.5) {
        console.log('‚ú® Âπª„ÅÆÂõûÈÅø„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÂèñ„Çâ„Çå„Çã„ÅÆ„ÇíÂõûÈÅø„Åó„Åæ„Åó„Åü');
        setStatus('Âπª„ÅÆÂõûÈÅø„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÂèñ„Çâ„Çå„Çã„ÅÆ„ÇíÂõûÈÅø„Åó„Åæ„Åó„Åü', 'success');
        
        // ÊîªÊíÉÂÅ¥„ÅÆÈßí„ÇíÂÖÉ„ÅÆ‰ΩçÁΩÆ„Å´Êàª„Åô
        state.board[fr][fc] = from;
        state.board[tr][tc] = to;
        
        // ÂõûÈÅø„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
        showPhantomEvasionEffect(tr, tc);
        
        // „Çπ„Ç≠„É´Áô∫Âãï„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
        showPhantomSkillEffect(tr, tc);
        
        // ÊâãÁï™„Çí„ÄåÂπª„ÄçÈßí„ÅÆÊâÄÊúâËÄÖ„Å´Ë®≠ÂÆö
        const phantomOwner = to.owner;
        state.currentPlayer = phantomOwner;
        console.log(`üîÑ Âπª„ÅÆÂõûÈÅø„Å´„Çà„ÇäÊâãÁï™„Åå${phantomOwner === 'player' ? '„Éó„É¨„Ç§„É§„Éº' : '„Ç≥„É≥„Éî„É•„Éº„Çø'}„Å´Áßª„Çä„Åæ„Åó„Åü: ${state.currentPlayer}„ÅÆ„Çø„Éº„É≥`);
        
        state.selected = null;
        state.validMoves = [];
        
        // ÊâãÁï™ÈñãÂßãÂá¶ÁêÜ
        if (phantomOwner === 'player') {
          console.log('üë§ „Éó„É¨„Ç§„É§„Éº„ÅÆÊâãÁï™„ÇíÈñãÂßã„Åó„Åæ„Åô');
          // „Éó„É¨„Ç§„É§„Éº„ÅÆ„Çø„Éº„É≥ÈñãÂßãÊôÇ„Å´ÊôÇÈñìÂÅúÊ≠¢ÂäπÊûú„ÇíËß£Èô§
          clearTimeStopEffects();
          setStatus('„ÅÇ„Å™„Åü„ÅÆÊâãÁï™', 'playing');
        } else {
          console.log('ü§ñ „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÊâãÁï™„ÇíÈñãÂßã„Åó„Åæ„Åô');
          setStatus('Êïµ„ÅÆÊâãÁï™‚Ä¶', 'playing');
          // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÊâãÁï™„ÇíÈñãÂßã
          setTimeout(computerTurn, 100);
        }
        render();
        return;
      } else {
        console.log('‚ú® Âπª„ÅÆÂõûÈÅø„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Åó„Åã„ÅóÂõûÈÅø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
        setStatus('Âπª„ÅÆÂõûÈÅø„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Åó„Åã„ÅóÂõûÈÅø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'warning');
      }
    }
    
    // ÊçïÁç≤ÔºàÊåÅ„Å°Èßí„Å´ËøΩÂä†Ôºâ- ÁâπÊÆä„Éû„Çπ„Å®„ÄåÈúä„ÄçÈßí„ÅØÈô§Â§ñ„ÄÅÊ≥â„ÅßÂº∑Âåñ„Åï„Çå„ÅüÈßí„ÅØÂèñ„Çå„Å™„ÅÑ
    if (to && to.piece !== 'Á©∫' && to.piece !== 'n' && to.piece !== 'X' && to.piece !== 'Èúä' && !['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(to.piece)){ 
      if (to.springEnhanced) {
        console.log(`üíß Âº∑Âåñ„Åï„Çå„ÅüÈßí„Äå${to.piece}„Äç„ÅØÂèñ„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åõ„Çì`);
        setStatus(`Ê≥â„ÅßÂº∑Âåñ„Åï„Çå„ÅüÈßí„ÅØÂèñ„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åõ„Çì`, 'warning');
        return; // ÁßªÂãï„ÇíÁÑ°Âäπ„Å´„Åô„Çã
      }
      
      // KÂçöÂ£´„ÅÆËÄê‰πÖÂäõÂá¶ÁêÜ
      if (to.piece === 'K') {
        if (to.kDurability > 1) {
          // 1ÂõûÁõÆÔºöËÄê‰πÖÂäõ„ÇíÊ∏õ„Çâ„Åó„ÄÅÊîªÊíÉÈßí„ÇíÂàó„ÅÆÊúÄÂæå„Å´ÁßªÂãï
          to.kDurability--;
          console.log(`üëë KÂçöÂ£´„ÅÆËÄê‰πÖÂäõ: ${to.kDurability}ÂõûÊÆã„Çä`);
          setStatus(`KÂçöÂ£´„ÅÆËÄê‰πÖÂäõÔºÅÊîªÊíÉÈßí„ÇíÂàó„ÅÆÊúÄÂæå„Å´ÁßªÂãï„Åï„Åõ„Åæ„Åó„Åü`, 'playing');
          
          // ÊîªÊíÉÈßí„ÇíÂàó„ÅÆÊúÄÂæå„Å´ÁßªÂãï
          moveAttackerToBack(fr, fc, tr, tc);
          
          // ÊâãÁï™„ÇíÂàá„ÇäÊõø„Åà„Çã
          state.currentPlayer = state.currentPlayer === 'player' ? 'computer' : 'player';
          render();
          
          // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÊâãÁï™„ÅÆÂ†¥Âêà„ÅØÂ∞ë„ÅóÂæÖ„Å£„Å¶„Åã„ÇâÂÆüË°å
          if (state.currentPlayer === 'computer') {
            setTimeout(computerTurn, 100);
          }
          
          return; // ÁßªÂãï„ÇíÁÑ°Âäπ„Å´„Åô„Çã
        } else {
          // 2ÂõûÁõÆÔºöÂÆåÂÖ®„Å´Âèñ„Çâ„Çå„Çã
          console.log(`üëë KÂçöÂ£´„ÅåÂÆåÂÖ®„Å´Âèñ„Çâ„Çå„Åæ„Åó„Åü`);
          state.hands[state.currentPlayer].push('K');
        }
      }
      // ÂÆü„ÅÆÁâπÊÆäÂá¶ÁêÜÔºöÁõ∏ÊâãÈßí„ÇíÁï∞„Å´Â§âÂåñ„Åï„Åõ„Çã
      if (from.piece === 'ÂÆü') {
        // Áõ§Èù¢„Å´Áï∞„ÅåÊó¢„Å´„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
        let hasMutantOnBoard = false;
        for (let r = 0; r < BOARD_SIZE; r++) {
          for (let c = 0; c < BOARD_SIZE; c++) {
            const piece = state.board[r][c];
            if (piece && piece.piece === 'Áï∞' && piece.owner === from.owner) {
              hasMutantOnBoard = true;
              break;
            }
          }
          if (hasMutantOnBoard) break;
        }
        
        if (!hasMutantOnBoard) {
          // Áï∞„ÅåÁõ§Èù¢„Å´„Å™„ÅÑÂ†¥ÂêàÔºöÁõ∏ÊâãÈßí„ÇíÁï∞„Å´Â§âÂåñ„Åï„Åõ„ÄÅÂÆü„ÇíÂÖÉ„ÅÆÂ†¥ÊâÄ„Å´Êàª„Åô
          console.log(`üß™ ÂÆü„ÅÆÂÆüÈ®ìÔºö${to.piece}„ÇíÁï∞„Å´Â§âÂåñ„Åï„Åõ„ÄÅÂÆü„ÇíÂÖÉ„ÅÆÂ†¥ÊâÄ„Å´Êàª„Åó„Åæ„Åó„Åü`);
          setStatus(`ÂÆü„ÅÆÂÆüÈ®ìÔºÅ${to.piece}„ÅåÁï∞„Å´Â§âÂåñ„Åó„ÄÅÂÆü„ÅåÂÖÉ„ÅÆÂ†¥ÊâÄ„Å´Êàª„Çä„Åæ„Åó„Åü`, 'playing');
          
          // Â§âÂåñÂâç„ÅÆÈßí„ÅÆÁßªÂãïÁØÑÂõ≤„Å®„Çπ„Ç≠„É´„ÇíÂèñÂæó
          const mutatedMoves = getMutatedMoves(to.piece);
          const mutatedSkills = getMutatedSkills(to.piece);
          console.log(`üß™ Â§âÂåñÂâç„ÅÆÈßí: ${to.piece}, ÁßªÂãïÁØÑÂõ≤: ${mutatedMoves}, „Çπ„Ç≠„É´: ${mutatedSkills}`);
          
          // Áõ∏ÊâãÈßí„ÇíÁï∞„Å´Â§âÂåñ„Åï„Åõ„Çã
          state.board[tr][tc] = {
            piece: 'Áï∞',
            owner: from.owner,
            isAwakened: false,
            originalPiece: null,
            isTimeStopped: false,
            isRainbowLimited: false,
            isPoisoned: false,
            isSwampTrapped: false,
            isDrowned: false,
            isFrozen: false,
            isSpringEnhanced: false,
            springEnhancedTurns: 0,
            isDragonAwakened: false,
            isHouseSkillUsed: false,
            isFieldSkillUsed: false,
            isKSkillUsed: false,
            mutatedFrom: to.piece, // Â§âÂåñÂâç„ÅÆÈßí„ÇíË®òÈå≤
            mutatedMoves: mutatedMoves, // Â§âÂåñÂâç„ÅÆÈßí„ÅÆÁßªÂãïÁØÑÂõ≤„ÇíË®òÈå≤
            mutatedSkills: mutatedSkills // Â§âÂåñÂâç„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´„ÇíË®òÈå≤
          };
          
          // ÂÆü„ÇíÂÖÉ„ÅÆÂ†¥ÊâÄ„Å´Êàª„Åô
          state.board[fr][fc] = from;
          
          // Â§âÂåñ„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
          showExperimentMutationEffect(tr, tc);
          
          // ÂÆü„ÅÆÊàª„Çä„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
          showExperimentReturnEffect(fr, fc);
          
          return; // ÁßªÂãï„ÇíÁÑ°Âäπ„Å´„Åô„ÇãÔºàÂÆü„ÅØÂÖÉ„ÅÆÂ†¥ÊâÄ„Å´Êàª„Çã„Åü„ÇÅÔºâ
        } else {
          // Áï∞„ÅåÁõ§Èù¢„Å´„ÅÇ„ÇãÂ†¥ÂêàÔºöÈÄöÂ∏∏ÈÄö„ÇäÊåÅ„Å°Èßí„Å´ËøΩÂä†
          console.log(`üß™ ÂÆü„ÅÆÂÆüÈ®ìÔºöÁõ§Èù¢„Å´Áï∞„Åå„ÅÇ„Çã„Åü„ÇÅÈÄöÂ∏∏ÈÄö„ÇäÊåÅ„Å°Èßí„Å´ËøΩÂä†`);
          state.hands[state.currentPlayer].push(to.piece);
        }
      }
      // Ëæ∞„ÅåÂèñ„Çâ„Çå„ÅüÂ†¥Âêà„ÅØÁ´ú„Å®„Åó„Å¶ÊåÅ„Å°Èßí„Å´ËøΩÂä†
      else if (to.piece === 'Ëæ∞') {
        console.log(`üêâ Ëæ∞„ÅåÂèñ„Çâ„Çå„Åæ„Åó„Åü„ÄÇÁ´ú„Å®„Åó„Å¶ÊåÅ„Å°Èßí„Å´ËøΩÂä†„Åó„Åæ„Åô`);
        state.hands[state.currentPlayer].push('Á´ú');
      } 
      // Êòü„ÅåÂèñ„Çâ„Çå„ÅüÂ†¥Âêà„ÅØ40%„ÅÆÁ¢∫Áéá„ÅßËá™ÂàÜ„ÅÆÊâãÊåÅ„Å°Èßí„Å´„ÇÇÊòü„ÇíËøΩÂä†
      else if (to.piece === 'Êòü') {
        console.log(`‚ú® Êòü„ÅåÂèñ„Çâ„Çå„Åæ„Åó„Åü„ÄÇÈÄöÂ∏∏ÈÄö„ÇäÊåÅ„Å°Èßí„Å´ËøΩÂä†„Åó„Åæ„Åô`);
        state.hands[state.currentPlayer].push('Êòü');
        
        // 40%„ÅÆÁ¢∫Áéá„ÅßËá™ÂàÜ„ÅÆÊâãÊåÅ„Å°Èßí„Å´„ÇÇÊòü„ÇíËøΩÂä†
        if (Math.random() < 0.4) {
          console.log(`‚ú® Êòü„ÅÆÂæ©Ê¥ª„Çπ„Ç≠„É´Áô∫ÂãïÔºÅËá™ÂàÜ„ÅÆÊâãÊåÅ„Å°Èßí„Å´„ÇÇÊòü„ÇíËøΩÂä†„Åó„Åæ„Åô`);
          state.hands[to.owner].push('Êòü');
          setStatus('Êòü„ÅÆÂæ©Ê¥ª„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÊòü„ÅåÂæ©Ê¥ª„Åó„Åæ„Åó„Åü', 'success');
        }
      } else {
        state.hands[state.currentPlayer].push(to.piece);
      }
    }
    
    // „Çø„Éº„É≥„Ç´„Ç¶„É≥„Éà„ÇíÂ¢óÂä†
    state.turnCount++;

    // Ëæ∞„ÅÆ„Çπ„Ç≠„É´ÔºöÁßªÂãïÊôÇ10ÔºÖ„ÅÆÁ¢∫Áéá„ÅßÂë®Âõ≤8„Éû„Çπ„ÅÆÊïµÈßí„Çí„É©„É≥„ÉÄ„É†„Å´1„Å§Ê∂àÊªÖ
    if (from.piece === 'Ëæ∞') {
      triggerDragonAwakenedSkill(tr, tc, from.owner);
    }
    
    // KÂçöÂ£´„ÅÆ„Çπ„Ç≠„É´ÔºöÁßªÂãïÊôÇ40ÔºÖ„ÅÆÁ¢∫Áéá„ÅßÂÆüÈ®ì‰Ωì„ÇíÂè¨Âñö
    if (from.piece === 'K') {
      triggerKSkill(tr, tc, from.owner);
    }

    // ÊÑüÈõªÂäπÊûú„ÅÆËß£Èô§Âá¶ÁêÜÔºà‰∏ÄÊôÇÁöÑ„Å´ÁÑ°ÂäπÂåñÔºâ
    // clearShockEffects();

    // ÁßªÂãïÂÖà„ÅåÂë™„ÅÑ„Éû„Çπ„ÇÑÁü¢Âç∞„Éû„Çπ„ÅÆÂ†¥Âêà„ÄÅ„Åù„Çå„Çâ„Çí‰øùÊåÅ
    const targetTile = state.board[tr][tc];
    if (targetTile && (targetTile.piece === 'n' || ['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(targetTile.piece))) {
      // ÁâπÊÆä„Éû„Çπ„ÅØ‰øùÊåÅ„Åó„ÄÅÈßí„ÅØ‰∏ä„Å´ÈÖçÁΩÆ
      state.board[tr][tc] = { ...from, underTile: targetTile };
    } else {
      state.board[tr][tc] = from;
    }
    state.board[fr][fc] = null;
    state.selected = null; state.validMoves = [];
    
    // ËôπËâ≤Âà∂ÈôêÁä∂ÊÖã„Çí‰øùÊåÅÔºàÁßªÂãï„Åó„Å¶„ÇÇÂà∂ÈôêÁä∂ÊÖã„ÅØÁ∂ôÁ∂öÔºâ
    if (from.isRainbowLimited) {
      console.log(`üåà ËôπËâ≤Âà∂ÈôêÁä∂ÊÖã„Çí‰øùÊåÅ: ${from.piece} ÁßªÂãïÂæå„ÇÇÂà∂ÈôêÁ∂ôÁ∂ö`);
    }

    // Á†Ç„ÅÆÈßí„ÅÆÈÄ£ÂãïÁßªÂãïÂá¶ÁêÜ
    if (from && from.piece === 'Á†Ç') {
      triggerSandChainMove(fr, fc, tr, tc);
      // ÈÄ£ÂãïÁßªÂãïÂæå„Å´ÂÜçÊèèÁîª
      render();
    }
    
    // È¢®„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´Âá¶ÁêÜ
    if (from && from.piece === 'È¢®') {
      triggerWindSkill(fr, fc, tr, tc);
      // „Çπ„Ç≠„É´Áô∫ÂãïÂæå„Å´ÂÜçÊèèÁîª
      render();
    }
    
    // Ê≥â„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´Âá¶ÁêÜ: ÁßªÂãïÊôÇ„Å´„É©„É≥„ÉÄ„É†„Å™Âë≥Êñπ1„Å§„ÇíÂº∑Âåñ
    if (from && from.piece === 'Ê≥â') {
      triggerSpringSkill(tr, tc, from.owner);
    }
    
    // ÂàÄ„ÅÆ„Çπ„Ç≠„É´: Áõ∏ÊâãÈßí„ÇíÂèñ„Å£„ÅüÊôÇ„ÄÅ„Åù„ÅÆ‰∏°Èö£„ÅÆÈßí„ÇÇ„Åæ„Å®„ÇÅ„Å¶Âèñ„Çã
    if (from && from.piece === 'ÂàÄ' && to && to.owner !== from.owner) {
      console.log('‚öîÔ∏è ÂàÄ„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ‰∏°Èö£„ÅÆÈßí„ÇÇ„Åæ„Å®„ÇÅ„Å¶Âèñ„Çä„Åæ„Åô');
      triggerSwordSkill(tr, tc, from.owner);
    }

    // Èéß„ÅÆÈò≤Âæ°ÂäπÊûú: Áõ∏ÊâãÈßí„Åã„ÇâÂèñ„Çâ„Çå„Å™„ÅÑ
    if (to && to.piece === 'Èéß' && from.owner !== to.owner) {
      console.log('üõ°Ô∏è Èéß„ÅÆÈò≤Âæ°ÂäπÊûúÔºÅÂèñ„Çâ„Çå„Åæ„Åõ„Çì');
      setStatus('Èéß„ÅÆÈò≤Âæ°ÔºöÂèñ„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åõ„Çì', 'info');
      
      // ÁßªÂãï„ÇíÁÑ°ÂäπÂåñÔºàÂÖÉ„ÅÆ‰ΩçÁΩÆ„Å´Êàª„ÅôÔºâ
      state.board[fr][fc] = from;
      state.board[tr][tc] = to;
      state.selected = null;
      state.validMoves = [];
      render();
      return;
    }

    // ÈäÉ„ÅÆË≤´ÈÄöÂäπÊûú: ÁßªÂãïÊñπÂêë„ÅÆÈÄ£Á∂ö„Åó„ÅüÊïµÈßí„ÇíË≤´ÈÄö„Åó„Å¶Âèñ„Çã
    if (from && from.piece === 'ÈäÉ' && to && to.owner !== from.owner) {
      console.log('üî´ ÈäÉ„ÅÆË≤´ÈÄöÂäπÊûúÁô∫ÂãïÔºÅ');
      triggerGunPenetrationSkill(fr, fc, tr, tc, from.owner);
    }

    // È≠ö„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´: ÁßªÂãïÂæå„Å´Âë®Âõ≤„ÅÆÊïµÈßí„ÇíÊ∫∫„Çå„Åï„Åõ„Çã
    if (from && from.piece === 'È≠ö') {
      console.log('üêü È≠ö„ÅÆÈßí„ÅåÁßªÂãï„Åï„Çå„Åæ„Åó„Åü„ÄÇ„Çπ„Ç≠„É´Áô∫ÂãïÂá¶ÁêÜ„ÇíÈñãÂßã„Åó„Åæ„Åô...');
      console.log('üêü ÁßªÂãïÊÉÖÂ†±:', { from: fr, fc, to: tr, tc, owner: from.owner });
      
      showFishSwimEffect(fr, fc, tr, tc);
      // ÁßªÂãïÂÖà„ÅÆ„Çª„É´„Å´„ÇÇ„Ç®„Éï„Çß„ÇØ„Éà„ÇíËøΩÂä†
      setTimeout(() => {
        enhanceFishPieceMove(tr, tc);
      }, 100);
      
      // È≠ö„ÅÆÊ∫∫„Çå„Çπ„Ç≠„É´„ÇíÁô∫Âãï
      console.log('üêü È≠ö„ÅÆÊ∫∫„Çå„Çπ„Ç≠„É´„ÇíÂëº„Å≥Âá∫„Åó„Åæ„Åô...');
      triggerFishDrowningSkill(tr, tc, from.owner);
      console.log('üêü È≠ö„ÅÆÊ∫∫„Çå„Çπ„Ç≠„É´Âëº„Å≥Âá∫„ÅóÂÆå‰∫Ü');
    }
    


    // Ëãî„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´: ÁßªÂãïÂâç„Å´„ÅÑ„Åü„Éû„Çπ„Å´10%„ÅÆÁ¢∫Áéá„ÅßËãî„ÅåÂá∫Áèæ
    if (from && from.piece === 'Ëãî') {
      console.log('üåø Ëãî„ÅÆÈßí„ÅåÁßªÂãï„Åï„Çå„Åæ„Åó„Åü„ÄÇ„Çπ„Ç≠„É´Áô∫ÂãïÂà§ÂÆö‰∏≠...');
      
      // 10%„ÅÆÁ¢∫Áéá„ÅßÁßªÂãïÂâç„Å´„ÅÑ„Åü„Éû„Çπ„Å´Ëãî„ÅåÂá∫Áèæ
      if (Math.random() < 0.1) {
        const newMossPiece = {
          piece: 'Ëãî',
          owner: from.owner,
          isOriginal: true
        };
        state.board[fr][fc] = newMossPiece;
        
        // Ëãî„ÅÆÂá∫Áèæ„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
        showMossSpawnEffect(fr, fc);
        
        console.log(`üåø Ëãî„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÁßªÂãïÂâç„Å´„ÅÑ„Åü„Éû„Çπ(${fr},${fc})„Å´Ëãî„ÅåÂá∫Áèæ„Åó„Åæ„Åó„Åü`);
        setStatus('Ëãî„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÁßªÂãïÂâç„Å´„ÅÑ„Åü„Éû„Çπ„Å´Ëãî„ÅåÂá∫Áèæ', 'playing');
      } else {
        console.log('üåø Ëãî„ÅÆ„Çπ„Ç≠„É´„ÅØÁô∫Âãï„Åó„Åæ„Åõ„Çì„Åß„Åó„Åü');
      }
    }
    
    // Ëôπ„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´: ÁßªÂãïÂæå„Å´Âë®Âõ≤„ÅÆÊïµÈßí„ÇíËôπËâ≤„Å´Êüì„ÇÅ„ÇãÔºà1„Çø„Éº„É≥ÁßªÂãïÂà∂ÈôêÔºâ
    if (from && from.piece === 'Ëôπ') {
      console.log('üåà Ëôπ„ÅÆÈßí„ÅåÁßªÂãï„Åï„Çå„Åæ„Åó„Åü„ÄÇ„Çπ„Ç≠„É´Áô∫ÂãïÂá¶ÁêÜ„ÇíÈñãÂßã„Åó„Åæ„Åô...');
      
      showRainbowEffect(fr, fc, tr, tc);
      
      // Ëôπ„ÅÆÊüìËâ≤„Çπ„Ç≠„É´„ÇíÁô∫Âãï
      setTimeout(() => {
        triggerRainbowSkill(tr, tc, from.owner);
        // „Çπ„Ç≠„É´Áô∫ÂãïÂæå„Å´ÂÜçÊèèÁîª
        render();
      }, 100);
    }

    // ÊØí„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´: ÁßªÂãïÂæå„Å´Âë®Âõ≤„ÅÆÊïµÈßí„Å´ÊØíÁä∂ÊÖã„Çí‰ªò‰∏é
    if (from && from.piece === 'ÊØí') {
      console.log('‚ò† ÊØí„ÅÆÈßí„ÅåÁßªÂãï„Åï„Çå„Åæ„Åó„Åü„ÄÇ„Çπ„Ç≠„É´Áô∫ÂãïÂá¶ÁêÜ„ÇíÈñãÂßã„Åó„Åæ„Åô...');
      
      // ÊØí„ÅÆÈßí„ÅÆÁßªÂãïÂ±•Ê≠¥„ÇíËøΩÂä†
      addPoisonHistory(fr, fc, state.turnCount);
      
      // ÊØí„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      showPoisonEffect(fr, fc, tr, tc);
      
      // ÊØí„ÅÆ„Çπ„Ç≠„É´„ÇíÁô∫ÂãïÔºà100%„ÅÆÁ¢∫Áéá„ÅßÊØí„Éû„Çπ„ÇíË®≠ÁΩÆÔºâ
      setTimeout(() => {
        triggerPoisonSkill(fr, fc, from.owner);
        // „Çπ„Ç≠„É´Áô∫ÂãïÂæå„Å´ÂÜçÊèèÁîª
        render();
      }, 100);
    }

    // ÊØí„Éû„Çπ„Å´ÁßªÂãï„Åó„ÅüÈßí„Å´ÊØíÁä∂ÊÖã„Çí‰ªò‰∏é
    if (isPoisonSquare(tr, tc) && from && from.owner !== 'player') {
      console.log(`‚ò† Áõ∏Êâã„ÅÆÈßí„ÅåÊØí„Éû„Çπ„Å´ÁßªÂãï: ${from.piece} at (${tr},${tc})`);
      addPoisonedPiece(tr, tc, from.piece, from.owner);
    }

    // Ê≤º„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´: ÁßªÂãïÂæå„Å´Âë®Âõ≤„ÅÆÊïµÈßí„ÇíÊ≤º„Å´Êçï„Çâ„Åà„Çã
    if (from && from.piece === 'Ê≤º') {
      console.log('üåä Ê≤º„ÅÆÈßí„ÅåÁßªÂãï„Åï„Çå„Åæ„Åó„Åü„ÄÇ„Çπ„Ç≠„É´Áô∫ÂãïÂá¶ÁêÜ„ÇíÈñãÂßã„Åó„Åæ„Åô...');
      
      // Ê≤º„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      showSwampEffect(fr, fc, tr, tc);
      
      // Ê≤º„ÅÆ„Çπ„Ç≠„É´„ÇíÁô∫Âãï
      setTimeout(() => {
        triggerSwampSkill(tr, tc, from.owner);
        // „Çπ„Ç≠„É´Áô∫ÂãïÂæå„Å´ÂÜçÊèèÁîª
        render();
      }, 100);
    }

    // Èè°„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´: ÁßªÂãïÂæå„Å´ÂèçÂ∞ÑÊîªÊíÉ„ÇíÁô∫Âãï
    if (from && from.piece === 'Èè°') {
      console.log('ü™û Èè°„ÅÆÈßí„ÅåÁßªÂãï„Åï„Çå„Åæ„Åó„Åü„ÄÇ„Çπ„Ç≠„É´Áô∫ÂãïÂá¶ÁêÜ„ÇíÈñãÂßã„Åó„Åæ„Åô...');
      
      // Èè°„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      showMirrorEffect(fr, fc, tr, tc);
      
      // Èè°„ÅÆ„Çπ„Ç≠„É´„ÇíÁô∫Âãï
      setTimeout(() => {
        triggerMirrorSkill(tr, tc, from.owner);
        // „Çπ„Ç≠„É´Áô∫ÂãïÂæå„Å´ÂÜçÊèèÁîª
        render();
      }, 100);
    }

    // Êò†„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´: ÁßªÂãïÂæå„Å´Èè°Èù¢ÂèçÂ∞Ñ„ÇíÁô∫Âãï
    if (from && from.piece === 'Êò†') {
      console.log('‚ú® Êò†„ÅÆÈßí„ÅåÁßªÂãï„Åï„Çå„Åæ„Åó„Åü„ÄÇ„Çπ„Ç≠„É´Áô∫ÂãïÂá¶ÁêÜ„ÇíÈñãÂßã„Åó„Åæ„Åô...');
      
      // Êò†„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      showReflectionEffect(fr, fc, tr, tc);
      
      // Êò†„ÅÆ„Çπ„Ç≠„É´„ÇíÁô∫Âãï
      setTimeout(() => {
        triggerReflectionSkill(tr, tc, from.owner);
        // „Çπ„Ç≠„É´Áô∫ÂãïÂæå„Å´ÂÜçÊèèÁîª
        render();
      }, 100);
    }

    // Áâ¢„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´: ÁßªÂãïÂæå„Å´Áõ∏Êâã„ÅÆÈßí„Çí‰∏Ä„Å§„É©„É≥„ÉÄ„É†„Åß2„Çø„Éº„É≥Ë°åÂãï‰∏çËÉΩ„Å´„Åô„Çã
    if (from && from.piece === 'Áâ¢') {
      console.log('üîí Áâ¢„ÅÆÈßí„ÅåÁßªÂãï„Åï„Çå„Åæ„Åó„Åü„ÄÇ„Çπ„Ç≠„É´Áô∫ÂãïÂá¶ÁêÜ„ÇíÈñãÂßã„Åó„Åæ„Åô...');
      
      // Áâ¢„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      showPrisonEffect(fr, fc, tr, tc);
      
      // Âë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„Çí„ÉÅ„Çß„ÉÉ„ÇØ
      if (!isAffectedByCurse(tr, tc)) {
        // Áâ¢„ÅÆ„Çπ„Ç≠„É´„ÇíÁô∫Âãï
        setTimeout(() => {
          triggerPrisonSkill(tr, tc, from.owner);
          // „Çπ„Ç≠„É´Áô∫ÂãïÂæå„Å´ÂÜçÊèèÁîª
          render();
        }, 100);
      } else {
        console.log('üîí Áâ¢„ÅØÂë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„Åß„Çπ„Ç≠„É´„ÇíÁô∫Âãï„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü');
        setStatus('Âë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„ÅßÁâ¢„ÅÆ„Çπ„Ç≠„É´„ÅåÂ∞ÅÂç∞„Åï„Çå„Åæ„Åó„Åü', 'warning');
      }
    }

    // Êüµ„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´: ÁßªÂãïÂæå„Å´Áõ∏Êâã„ÅÆÈßí„Çí‰∏Ä„Å§„É©„É≥„ÉÄ„É†„Åß2„Çø„Éº„É≥Ë°åÂãï‰∏çËÉΩ„Å´„Åô„Çã
    if (from && from.piece === 'Êüµ') {
      console.log('üöß Êüµ„ÅÆÈßí„ÅåÁßªÂãï„Åï„Çå„Åæ„Åó„Åü„ÄÇ„Çπ„Ç≠„É´Áô∫ÂãïÂá¶ÁêÜ„ÇíÈñãÂßã„Åó„Åæ„Åô...');
      
      // Êüµ„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      showFenceEffect(fr, fc, tr, tc);
      
      // Âë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„Çí„ÉÅ„Çß„ÉÉ„ÇØ
      if (!isAffectedByCurse(tr, tc)) {
        // Êüµ„ÅÆ„Çπ„Ç≠„É´„ÇíÁô∫Âãï
        setTimeout(() => {
          triggerFenceSkill(tr, tc, from.owner);
          // „Çπ„Ç≠„É´Áô∫ÂãïÂæå„Å´ÂÜçÊèèÁîª
          render();
        }, 100);
      } else {
        console.log('üöß Êüµ„ÅØÂë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„Åß„Çπ„Ç≠„É´„ÇíÁô∫Âãï„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü');
        setStatus('Âë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„ÅßÊüµ„ÅÆ„Çπ„Ç≠„É´„ÅåÂ∞ÅÂç∞„Åï„Çå„Åæ„Åó„Åü', 'warning');
      }
    }

    // Â∂∫„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´: ÁßªÂãïÊôÇ„Å´20%„ÅÆÁ¢∫Áéá„ÅßÂë®Âõ≤„ÅÆ„É©„É≥„ÉÄ„É†1„Éû„Çπ„Å´Â±±Èßí„ÇíÂá∫Áèæ
    if (from && from.piece === 'Â∂∫') {
      console.log('‚õ∞Ô∏è Â∂∫„ÅÆÈßí„ÅåÁßªÂãï„Åï„Çå„Åæ„Åó„Åü„ÄÇ„Çπ„Ç≠„É´Áô∫ÂãïÂà§ÂÆö‰∏≠...');
      
      // Â∂∫„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      showRidgeEffect(fr, fc, tr, tc);
      
      // Âë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„Çí„ÉÅ„Çß„ÉÉ„ÇØ
      if (!isAffectedByCurse(tr, tc)) {
        // 20%„ÅÆÁ¢∫Áéá„ÅßÂ±±Èßí„ÇíÂá∫Áèæ
        if (Math.random() < 0.2) {
          setTimeout(() => {
            triggerRidgeSkill(tr, tc, from.owner);
            // „Çπ„Ç≠„É´Áô∫ÂãïÂæå„Å´ÂÜçÊèèÁîª
            render();
          }, 100);
        } else {
          console.log('‚õ∞Ô∏è Â∂∫„ÅÆ„Çπ„Ç≠„É´„ÅØÁô∫Âãï„Åó„Åæ„Åõ„Çì„Åß„Åó„Åü');
        }
      } else {
        console.log('‚õ∞Ô∏è Â∂∫„ÅØÂë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„Åß„Çπ„Ç≠„É´„ÇíÁô∫Âãï„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü');
        setStatus('Âë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„ÅßÂ∂∫„ÅÆ„Çπ„Ç≠„É´„ÅåÂ∞ÅÂç∞„Åï„Çå„Åæ„Åó„Åü', 'warning');
      }
    }

    // Â≥∞„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´: ÁßªÂãïÊôÇ„Å´ÁîªÊï∞10Áîª‰ª•‰∏ä„ÅÆÊïµÈßí„ÇíÁÑ°ÂäπÂåñ
    if (from && from.piece === 'Â≥∞') {
      console.log('üèîÔ∏è Â≥∞„ÅÆÈßí„ÅåÁßªÂãï„Åï„Çå„Åæ„Åó„Åü„ÄÇ„Çπ„Ç≠„É´Áô∫Âãï‰∏≠...');
      
      // Â≥∞„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      showPeakEffect(fr, fc, tr, tc);
      
      // Âë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„Çí„ÉÅ„Çß„ÉÉ„ÇØ
      if (!isAffectedByCurse(tr, tc)) {
        // Â≥∞„ÅÆ„Çπ„Ç≠„É´„ÇíÁô∫Âãï
        setTimeout(() => {
          triggerPeakSkill(tr, tc, from.owner);
          // „Çπ„Ç≠„É´Áô∫ÂãïÂæå„Å´ÂÜçÊèèÁîª
          render();
        }, 100);
      } else {
        console.log('üèîÔ∏è Â≥∞„ÅØÂë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„Åß„Çπ„Ç≠„É´„ÇíÁô∫Âãï„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü');
        setStatus('Âë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„ÅßÂ≥∞„ÅÆ„Çπ„Ç≠„É´„ÅåÂ∞ÅÂç∞„Åï„Çå„Åæ„Åó„Åü', 'warning');
      }
    }

    // Â≤©„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´: ÁßªÂãïÊôÇ„Å´Â∑¶Âè≥„Å´ÈöúÂÆ≥Áâ©„ÇíÈÖçÁΩÆ
    if (from && from.piece === 'Â≤©') {
      console.log('ü™® Â≤©„ÅÆÈßí„ÅåÁßªÂãï„Åï„Çå„Åæ„Åó„Åü„ÄÇÂè§„ÅÑÈöúÂÆ≥Áâ©„ÇíÂâäÈô§„Åó„ÄÅÊñ∞„Åó„ÅÑ„Çπ„Ç≠„É´Áô∫Âãï‰∏≠...');
      
      // ÁßªÂãïÂâç„Å´Âè§„ÅÑÂ≤©„ÅÆÈöúÂÆ≥Áâ©„ÇíÂâäÈô§
      removeRockBarriers(from.owner);
      
      // Â≤©„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      showRockEffect(fr, fc, tr, tc);
      
      // Âë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„Çí„ÉÅ„Çß„ÉÉ„ÇØ
      if (!isAffectedByCurse(tr, tc)) {
        // Â≤©„ÅÆ„Çπ„Ç≠„É´„ÇíÁô∫Âãï
        setTimeout(() => {
          triggerRockSkill(tr, tc, from.owner);
          // „Çπ„Ç≠„É´Áô∫ÂãïÂæå„Å´ÂÜçÊèèÁîª
          render();
        }, 100);
      } else {
        console.log('ü™® Â≤©„ÅØÂë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„Åß„Çπ„Ç≠„É´„ÇíÁô∫Âãï„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü');
        setStatus('Âë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„ÅßÂ≤©„ÅÆ„Çπ„Ç≠„É´„ÅåÂ∞ÅÂç∞„Åï„Çå„Åæ„Åó„Åü', 'warning');
      }
    }

    // Èâ±„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´: ÁßªÂãïÊôÇ„Å´20%„ÅÆÁ¢∫Áéá„ÅßÂë≥Êñπ„ÅÆÊ≠©„ÇíÈáë„ÉªÈäÄ„ÉªÈäÖ„Å´Â§âÂåñ
    if (from && from.piece === 'Èâ±') {
      console.log('‚õèÔ∏è Èâ±„ÅÆÈßí„ÅåÁßªÂãï„Åï„Çå„Åæ„Åó„Åü„ÄÇ„Çπ„Ç≠„É´Áô∫ÂãïÂà§ÂÆö‰∏≠...');
      
      // Èâ±„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      showOreEffect(fr, fc, tr, tc);
      
      // Âë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„Çí„ÉÅ„Çß„ÉÉ„ÇØ
      if (!isAffectedByCurse(tr, tc)) {
        // 20%„ÅÆÁ¢∫Áéá„Åß„Çπ„Ç≠„É´„ÇíÁô∫Âãï
        if (Math.random() < 0.2) {
          setTimeout(() => {
            triggerOreSkill(tr, tc, from.owner);
            // „Çπ„Ç≠„É´Áô∫ÂãïÂæå„Å´ÂÜçÊèèÁîª
            render();
          }, 100);
        } else {
          console.log('‚õèÔ∏è Èâ±„ÅÆ„Çπ„Ç≠„É´„ÅØÁô∫Âãï„Åó„Åæ„Åõ„Çì„Åß„Åó„Åü');
        }
      } else {
        console.log('‚õèÔ∏è Èâ±„ÅØÂë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„Åß„Çπ„Ç≠„É´„ÇíÁô∫Âãï„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü');
        setStatus('Âë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„ÅßÈâ±„ÅÆ„Çπ„Ç≠„É´„ÅåÂ∞ÅÂç∞„Åï„Çå„Åæ„Åó„Åü', 'warning');
      }
    }

    // Â¢ì„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´: ÁßªÂãïÊôÇ„Å´20%„ÅÆÁ¢∫Áéá„ÅßÂë®Âõ≤„Å´„ÄåÈúä„Äç„ÇíÂè¨Âñö
    if (from && from.piece === 'Â¢ì') {
      console.log('ü™¶ Â¢ì„ÅÆÈßí„ÅåÁßªÂãï„Åï„Çå„Åæ„Åó„Åü„ÄÇ„Çπ„Ç≠„É´Áô∫ÂãïÂà§ÂÆö‰∏≠...');
      
      // Âë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„Çí„ÉÅ„Çß„ÉÉ„ÇØ
      if (!isAffectedByCurse(tr, tc)) {
        // 20%„ÅÆÁ¢∫Áéá„Åß„Çπ„Ç≠„É´„ÇíÁô∫Âãï
        if (Math.random() < 0.2) {
          setTimeout(() => {
            triggerGraveSkill(tr, tc, from.owner);
            // „Çπ„Ç≠„É´Áô∫ÂãïÂæå„Å´ÂÜçÊèèÁîª
            render();
          }, 100);
        } else {
          console.log('ü™¶ Â¢ì„ÅÆ„Çπ„Ç≠„É´„ÅØÁô∫Âãï„Åó„Åæ„Åõ„Çì„Åß„Åó„Åü');
        }
      } else {
        console.log('ü™¶ Â¢ì„ÅØÂë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„Åß„Çπ„Ç≠„É´„ÇíÁô∫Âãï„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü');
        setStatus('Âë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„ÅßÂ¢ì„ÅÆ„Çπ„Ç≠„É´„ÅåÂ∞ÅÂç∞„Åï„Çå„Åæ„Åó„Åü', 'warning');
      }
    }

    // Èúß„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´: ÁßªÂãïÊôÇ„Å´20%„ÅÆÁ¢∫Áéá„ÅßÂë®Âõ≤„ÅÆÊïµÈßí„Çí1„Å§Ê∂àÊªÖ„Åï„Åõ„Å¶Áõ∏Êâã„ÅÆÊåÅ„Å°Èßí„Å´Âä†„Åà„Çã
    if (from && from.piece === 'Èúß') {
      console.log('üå´Ô∏è Èúß„ÅÆÈßí„ÅåÁßªÂãï„Åï„Çå„Åæ„Åó„Åü„ÄÇ„Çπ„Ç≠„É´Áô∫ÂãïÂà§ÂÆö‰∏≠...');
      
      // Èúß„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      showMistSkillEffect(tr, tc);
      
      // Âë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„Çí„ÉÅ„Çß„ÉÉ„ÇØ
      if (!isAffectedByCurse(tr, tc)) {
        // 20%„ÅÆÁ¢∫Áéá„Åß„Çπ„Ç≠„É´„ÇíÁô∫Âãï
        if (Math.random() < 0.2) {
          setTimeout(() => {
            triggerMistSkill(tr, tc, from.owner);
            // „Çπ„Ç≠„É´Áô∫ÂãïÂæå„Å´ÂÜçÊèèÁîª
            render();
          }, 100);
        } else {
          console.log('üå´Ô∏è Èúß„ÅÆ„Çπ„Ç≠„É´„ÅØÁô∫Âãï„Åó„Åæ„Åõ„Çì„Åß„Åó„Åü');
        }
      } else {
        console.log('üå´Ô∏è Èúß„ÅØÂë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„Åß„Çπ„Ç≠„É´„ÇíÁô∫Âãï„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü');
        setStatus('Âë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„ÅßÈúß„ÅÆ„Çπ„Ç≠„É´„ÅåÂ∞ÅÂç∞„Åï„Çå„Åæ„Åó„Åü', 'warning');
      }
    }

    // Èúä„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´Áô∫Âãï„ÇíÂâäÈô§ÔºàÈÄöÂ∏∏„ÅÆÁßªÂãï„ÅÆ„ÅøÔºâ

    // Êúà„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´: „Çø„Éº„É≥Êï∞„Å´Âøú„Åò„ÅüÁßªÂãïÁØÑÂõ≤Â§âÂåñ„ÅÆÊÉÖÂ†±Ë°®Á§∫
    if (from && from.piece === 'Êúà') {
      console.log('üåô Êúà„ÅÆÈßí„ÅåÁßªÂãï„Åï„Çå„Åæ„Åó„Åü„ÄÇÊúàÂÖâ„ÅÆÂäπÊûúÁô∫Âãï‰∏≠...');
      
      // ÊúàÂÖâ„ÅÆ„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      showMoonSkillEffect(tr, tc);
      
      // Êúà„ÅÆÈßíÂ∞ÇÁî®„Ç´„Ç¶„É≥„Çø„Éº„ÇíÂ¢óÂä†ÔºàËá™ÂàÜ„ÅÆÊâãÁï™„ÅÆ„Åø„Ç´„Ç¶„É≥„ÉàÔºâ
      state.moonTurnCount[from.owner]++;
      
      // „Çø„Éº„É≥Êï∞„Å´Âøú„Åò„ÅüÁßªÂãïÁØÑÂõ≤„ÅÆÊÉÖÂ†±„ÇíË°®Á§∫
      const currentTurnCount = state.moonTurnCount[from.owner];
      const isEvenTurn = currentTurnCount % 2 === 0;
      
      // Âë™„ÅÑ„Éû„Çπ„Å´„ÅÑ„ÇãÂ†¥Âêà„ÅØÁßªÂãïÁØÑÂõ≤„ÅåÂà∂Èôê„Åï„Çå„Çã„Åì„Å®„ÇíË°®Á§∫
      if (isAffectedByCurse(tr, tc)) {
        console.log(`üåô Êúà„ÅÆÈßí„ÅåÂë™„ÅÑ„Éû„Çπ„Å´ÁßªÂãï„Åó„Åæ„Åó„Åü„ÄÇÁßªÂãïÁØÑÂõ≤„Åå1„Éû„Çπ„Å´Âà∂Èôê„Åï„Çå„Åæ„Åô`);
        setStatus(`Êúà„ÅÆÂäõ„ÅåÂë™„ÅÑ„Éû„Çπ„ÅßÂ∞ÅÂç∞„Åï„Çå„Åæ„Åó„Åü`, 'warning');
      } else {
        if (isEvenTurn) {
          console.log(`üåô ${from.owner}„ÅÆÂÅ∂Êï∞ÂõûÁõÆ„ÅÆ„Çø„Éº„É≥ÔºöÊ¨°Âõû„ÅØÂÖ®Êñπ‰ΩçÊúÄÂ§ß3„Éû„ÇπÁßªÂãïÂèØËÉΩ`);
          setStatus(`Êúà„ÅÆÂäõÔºöÊ¨°Âõû„ÅØÂÖ®Êñπ‰ΩçÊúÄÂ§ß3„Éû„ÇπÁßªÂãïÂèØËÉΩ`, 'info');
        } else {
          console.log(`üåô ${from.owner}„ÅÆÂ•áÊï∞ÂõûÁõÆ„ÅÆ„Çø„Éº„É≥ÔºöÊ¨°Âõû„ÅØÂÖ®Êñπ‰Ωç1„Éû„ÇπÁßªÂãï`);
          setStatus(`Êúà„ÅÆÂäõÔºöÊ¨°Âõû„ÅØÂÖ®Êñπ‰Ωç1„Éû„ÇπÁßªÂãï`, 'info');
        }
      }
    }

    // Ëàü„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´: ÁßªÂãïÊôÇ„Å´Âæå„Çç„Å´„ÅÑ„ÇãÂë≥Êñπ„ÅÆÈßí„ÇÇ‰∏ÄÁ∑í„Å´ÁßªÂãï„Åï„Åõ„Çã
    if (from && from.piece === 'Ëàü') {
      console.log('‚õµ Ëàü„ÅÆÈßí„ÅåÁßªÂãï„Åï„Çå„Åæ„Åó„Åü„ÄÇËàπÂõ£ÂäπÊûú„ÇíÁô∫Âãï‰∏≠...');
      
      // Ëàü„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      showBoatSkillEffect(tr, tc);
      
      // Âë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„Çí„ÉÅ„Çß„ÉÉ„ÇØ
      if (!isAffectedByCurse(tr, tc)) {
        // Ëàü„ÅÆ„Çπ„Ç≠„É´Áô∫Âãï
        setTimeout(() => {
          triggerBoatSkill(fr, fc, tr, tc, from.owner);
          // „Çπ„Ç≠„É´Áô∫ÂãïÂæå„Å´ÂÜçÊèèÁîª
          render();
        }, 100);
      } else {
        console.log('‚õµ Ëàü„ÅØÂë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„Åß„Çπ„Ç≠„É´„ÇíÁô∫Âãï„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü');
        setStatus('Âë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„ÅßËàü„ÅÆ„Çπ„Ç≠„É´„ÅåÂ∞ÅÂç∞„Åï„Çå„Åæ„Åó„Åü', 'warning');
      }
    }

    // Ê©ü„ÅÆ„Çπ„Ç≠„É´ÔºöÂè≥Èö£„Åæ„Åü„ÅØÂ∑¶Èö£„Å´„ÅÇ„ÇãÂë≥ÊñπÈßí„ÅÆ„Çπ„Ç≠„É´„Å®Âêå„Åò„Å´„Å™„Çã
    if (from && from.piece === 'Ê©ü') {
      console.log('ü§ñ Ê©ü„ÅÆÈßí„ÅåÁßªÂãï„Åï„Çå„Åæ„Åó„Åü„ÄÇÈö£Êé•Èßí„Çπ„Ç≠„É´„Ç≥„Éî„ÉºÂäπÊûú„ÇíÁô∫Âãï‰∏≠...');
      
      // Â∑¶Âè≥„ÅÆÈö£Êé•„Åô„ÇãÂë≥ÊñπÈßí„Çí„ÉÅ„Çß„ÉÉ„ÇØ
      const leftPiece = state.board[tr][tc - 1];
      const rightPiece = state.board[tr][tc + 1];
      
      let copiedSkill = null;
      let copiedPiece = null;
      
      // Â∑¶Èö£„ÅÆÈßí„Çí„ÉÅ„Çß„ÉÉ„ÇØ
      if (inBounds(tr, tc - 1) && leftPiece && leftPiece.owner === from.owner) {
        copiedSkill = leftPiece.piece;
        copiedPiece = leftPiece;
        console.log(`ü§ñ Â∑¶Èö£„ÅÆ${leftPiece.piece}„ÅÆ„Çπ„Ç≠„É´„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü`);
      }
      // Âè≥Èö£„ÅÆÈßí„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºàÂ∑¶Èö£„Å´Èßí„Åå„Å™„ÅÑÂ†¥ÂêàÔºâ
      else if (inBounds(tr, tc + 1) && rightPiece && rightPiece.owner === from.owner) {
        copiedSkill = rightPiece.piece;
        copiedPiece = rightPiece;
        console.log(`ü§ñ Âè≥Èö£„ÅÆ${rightPiece.piece}„ÅÆ„Çπ„Ç≠„É´„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü`);
      }
      
      if (copiedSkill) {
        // Ê©ü„ÅÆÈßí„Å´„Çπ„Ç≠„É´ÊÉÖÂ†±„Çí‰øùÂ≠ò
        state.board[tr][tc].copiedSkill = copiedSkill;
        state.board[tr][tc].copiedPiece = copiedPiece;
        
        setStatus(`Ê©ü„Åå${copiedSkill}„ÅÆ„Çπ„Ç≠„É´„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü`, 'success');
        
        // „Ç≥„Éî„Éº„Åó„Åü„Çπ„Ç≠„É´„Å´Âøú„Åò„Å¶ËøΩÂä†„ÅÆÂäπÊûú„ÇíÁô∫Âãï
        setTimeout(() => {
          triggerMachineSkill(tr, tc, copiedSkill);
        }, 100);
      }
    }

    // Ê≠Ø„ÅÆ„Çπ„Ç≠„É´ÔºöÈö£Êé•„Åô„ÇãÂë≥ÊñπÈßí„ÅåÂãï„ÅÑ„Åü„Å®„Åç„ÄÅ„Åù„ÅÆÈßí„Å´„Åè„Å£„Å§„ÅÑ„Å¶ÁßªÂãï„Åô„Çã
    if (from && from.piece !== 'Ê≠Ø') {
      // ÁßªÂãï„Åó„ÅüÈßí„ÅÆÊñπÂêë„ÇíË®àÁÆó
      const rowDiff = tr - fr;
      const colDiff = tc - fc;
      
      // ÁßªÂãïÂâç„ÅÆ‰ΩçÁΩÆ„Å´Èö£Êé•„Åô„Çã‰∏ä‰∏ãÂ∑¶Âè≥4ÊñπÂêë„ÅÆ„ÄåÊ≠Ø„ÄçÈßí„Çí„ÉÅ„Çß„ÉÉ„ÇØ
      const adjacentPositions = [
        [-1, 0],  // ‰∏ä
        [0, -1],  // Â∑¶
        [0, 1],   // Âè≥
        [1, 0]    // ‰∏ã
      ];
      
      const movedGears = [];
      
      adjacentPositions.forEach(([dr, dc]) => {
        const gearRow = fr + dr;
        const gearCol = fc + dc;
        
        // Áõ§ÂÜÖ„Åã„Å§Âë≥Êñπ„ÅÆ„ÄåÊ≠Ø„ÄçÈßí„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
        if (inBounds(gearRow, gearCol)) {
          const adjacentPiece = state.board[gearRow][gearCol];
          if (adjacentPiece && adjacentPiece.piece === 'Ê≠Ø' && adjacentPiece.owner === from.owner) {
            // Ê≠ØÈßí„ÅÆÁßªÂãïÂÖà„ÅåÁ©∫„ÅÑ„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÁßªÂãï„Åó„ÅüÈßí„Å®Âêå„ÅòÊñπÂêëÔºâ
            const targetRow = gearRow + rowDiff;
            const targetCol = gearCol + colDiff;
            
            if (inBounds(targetRow, targetCol) && !state.board[targetRow][targetCol]) {
              // Ê≠ØÈßí„ÇíÁßªÂãï
              state.board[targetRow][targetCol] = adjacentPiece;
              state.board[gearRow][gearCol] = null;
              movedGears.push({ from: [gearRow, gearCol], to: [targetRow, targetCol] });
              console.log(`‚öôÔ∏è Ê≠ØÈßí„ÅåÈÄ£ÂãïÁßªÂãï: (${gearRow},${gearCol}) ‚Üí (${targetRow},${targetCol})`);
            }
          }
        }
      });
      
      if (movedGears.length > 0) {
        setStatus(`${movedGears.length}ÂÄã„ÅÆÊ≠ØÈßí„ÅåÈÄ£Âãï„Åó„Å¶ÁßªÂãï„Åó„Åæ„Åó„Åü`, 'success');
      }
    }

    // „ÅÇ„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´ÔºöÂë®Âõ≤„ÅÆÊïµÈßí„ÇíÊ≠©„Å´Â§â„Åà„ÇãÔºà„Éú„ÇπÈßí„ÅÆÂäõÔºâ
    if (from && from.piece === '„ÅÇ') {
      console.log('üåå „ÅÇ„ÅÆÈßí„ÅåÁßªÂãï„Åï„Çå„Åæ„Åó„Åü„ÄÇ„Çπ„Ç≠„É´Áô∫Âãï‰∏≠...');
      
      // „ÅÇ„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      showAhEffect(fr, fc, tr, tc);
      
      // Âë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„Çí„ÉÅ„Çß„ÉÉ„ÇØ
      if (!isAffectedByCurse(tr, tc)) {
        setTimeout(() => {
          triggerAhSkill(tr, tc, from.owner);
          // „Çπ„Ç≠„É´Áô∫ÂãïÂæå„Å´ÂÜçÊèèÁîª
          render();
        }, 100);
      } else {
        console.log('üåå „ÅÇ„ÅØÂë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„Åß„Çπ„Ç≠„É´„ÇíÁô∫Âãï„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü');
        setStatus('Âë™„ÅÑ„Éû„Çπ„ÅÆÂΩ±Èüø„Åß„ÅÇ„ÅÆ„Çπ„Ç≠„É´„ÅåÂ∞ÅÂç∞„Åï„Çå„Åæ„Åó„Åü', 'warning');
      }
    }

    // „Éó„É¨„Ç§„É§„Éº„ÅåÁéãÊâã„Çí„Åã„Åë„ÅüÂ†¥Âêà„ÅÆÁéãÊâãÁ©ç„ÅøÂà§ÂÆöÔºà„Çø„Éº„É≥Â§âÊõ¥ÂâçÔºâ
    if (state.currentPlayer === 'player') {
      // „Éó„É¨„Ç§„É§„Éº„ÅåÁéãÊâã„Çí„Åã„Åë„Åü„Åã„ÉÅ„Çß„ÉÉ„ÇØ
      const isPlayerCheck = isPlayerGivingCheck();
      if (isPlayerCheck) {
        console.log('üéØ „Éó„É¨„Ç§„É§„Éº„ÅåÁéãÊâã„Çí„Åã„Åë„Åæ„Åó„Åü');
        // ÁéãÊâãÁ©ç„ÅøÂà§ÂÆöÔºàÂâäÈô§Ê∏à„ÅøÔºâ
      }
    }
    
    // „Ç≤„Éº„É†„ÅåÁµÇ‰∫Ü„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÊâãÁï™‰∫§‰ª£„Çí„Çπ„Ç≠„ÉÉ„Éó
    if (state.gameOver) {
      return;
    }
    
    // Ê∫∫„ÇåÁä∂ÊÖã„ÅÆËß£Èô§Âá¶ÁêÜ
    clearDrowningEffects();
    
    // ËôπËâ≤ÊüìËâ≤Áä∂ÊÖã„ÅÆËß£Èô§Âá¶ÁêÜ
    clearRainbowColoringEffects();
    
    // ÊØíÁä∂ÊÖã„ÅÆËß£Èô§Âá¶ÁêÜ
    clearPoisonEffects();
    
    // Ê≤ºÁä∂ÊÖã„ÅÆËß£Èô§Âá¶ÁêÜ
    clearSwampEffects();
    
    // Ë°åÂãï‰∏çËÉΩÁä∂ÊÖã„ÅÆÊõ¥Êñ∞Âá¶ÁêÜ
    updateImprisonedPieces();
    
    // ÁâπÊÆä„Éû„ÇπÔºàÂë™„ÅÑ„Éû„Çπ„ÉªÁü¢Âç∞„Éû„ÇπÔºâ„ÇíÂº∑Âà∂ÁöÑ„Å´Âæ©ÂÖÉ
    restorePermanentTiles();
    
    // „Éó„É¨„Ç§„É§„Éº‰∫§‰ª£ÔºàÁéãÊâãÁ©ç„Åø„Åß„Å™„ÅÑÂ†¥Âêà„ÅÆ„ÅøÔºâ
    console.log(`üîÑ ÊâãÁï™‰∫§‰ª£Âá¶ÁêÜ: ÁèæÂú®„ÅÆ„Éó„É¨„Ç§„É§„Éº: ${state.currentPlayer}`);
    state.currentPlayer = state.currentPlayer === 'player' ? 'computer' : 'player';
    console.log(`üîÑ ÊâãÁï™‰∫§‰ª£Âæå: Êñ∞„Åó„ÅÑ„Éó„É¨„Ç§„É§„Éº: ${state.currentPlayer}`);
    
    // Ê≥â„ÅÆÂº∑ÂåñÂäπÊûú„ÅÆ„Çø„Éº„É≥Êï∞„ÇíÊ∏õ„Çâ„Åô
    updateSpringEnhancementTurns();
    
    // Á´ú„ÅÆË¶öÈÜí„ÉÅ„Çß„ÉÉ„ÇØ
    checkDragonAwakening();
    
    render();

    if (state.currentPlayer === 'computer' && !state.gameOver){
      console.log('ü§ñ „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÊâãÁï™„ÇíÈñãÂßã„Åó„Åæ„Åô');
      setStatus('Êïµ„ÅÆÊâãÁï™‚Ä¶', 'playing');
      setTimeout(computerTurn, 100);
    } else if (!state.gameOver){
      console.log('üë§ „Éó„É¨„Ç§„É§„Éº„ÅÆÊâãÁï™„ÇíÈñãÂßã„Åó„Åæ„Åô');
      // „Éó„É¨„Ç§„É§„Éº„ÅÆ„Çø„Éº„É≥ÈñãÂßãÊôÇ„Å´ÊôÇÈñìÂÅúÊ≠¢ÂäπÊûú„ÇíËß£Èô§
      clearTimeStopEffects();
      
      if (state.dropMode) {
        setStatus(`ÊåÅ„Å°Èßí„Äå${state.selectedPiece}„Äç„ÇíÁΩÆ„ÅèÂ†¥ÊâÄ„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ`, 'playing');
      } else {
      setStatus('„ÅÇ„Å™„Åü„ÅÆÊâãÁï™', 'playing');
      }
    }
  }

  // ÁßªÂãïÁîüÊàê
  function getValidMoves(r,c){
    const stage = STAGES[state.stageIndex];
    const sq = state.board[r][c]; if (!sq) return [];
    
    // Â§âÂΩ¢Áä∂ÊÖã„ÄÅÊÑüÈõªÁä∂ÊÖã„ÅÆÈßí„ÅØÁßªÂãï„Åß„Åç„Å™„ÅÑ
    if (sq.isTransformed) return [];
    // if (sq.isShocked) return []; // ‰∏ÄÊôÇÁöÑ„Å´ÁÑ°ÂäπÂåñ
    
    // ÊôÇÈñìÂÅúÊ≠¢Áä∂ÊÖã„ÅÆÈßí„ÅØÁßªÂãï„Åß„Åç„Å™„ÅÑ
    if (sq.isTimeStopped) return [];
    
    // ËôπËâ≤Âà∂ÈôêÁä∂ÊÖã„ÅÆÈßí„ÅØÁßªÂãïÁØÑÂõ≤„ÅåÂà∂Èôê„Åï„Çå„Çã
    if (sq.isRainbowLimited) {
      return getRainbowLimitedMoves(r, c);
    }
    
    // Ê≤º„Å´Êçï„Çâ„Åà„Çâ„Çå„ÅüÈßí„ÅØÁßªÂãïÁØÑÂõ≤„ÅåÂà∂Èôê„Åï„Çå„Çã
    if (sq.isSwampTrapped) {
      return getSwampTrappedMoves(r, c);
    }
    
    // ÂáçÁµêÁä∂ÊÖã„ÅÆÈßí„ÅØÁßªÂãï„Åß„Åç„Å™„ÅÑ
    if (state.frozenPieces && state.frozenPieces.some(frozen => frozen.row === r && frozen.col === c)) return [];
    
    // Ê∫∫„ÇåÁä∂ÊÖã„ÅÆÈßí„ÅØÁßªÂãï„Åß„Åç„Å™„ÅÑ
    if (sq.isDrowned) return [];
    
    // Ë°åÂãï‰∏çËÉΩÁä∂ÊÖã„ÅÆÈßí„ÅØÁßªÂãï„Åß„Åç„Å™„ÅÑ
    if (isImprisoned(r, c)) return [];
    
    // Â≤©„ÅÆÈöúÂÆ≥Áâ©„ÉÅ„Çß„ÉÉ„ÇØÈñ¢Êï∞„ÇíÂÆöÁæ©
    function isBlockedByRockBarrier(row, col) {
      return isRockBarrier(row, col);
    }
    
    const type = stage.pieces[sq.piece] || 'pawn';
    console.log(`üîç Èßí„ÅÆÁ®ÆÈ°ûÂà§ÂÆö: Èßí=${sq.piece}, „Çø„Ç§„Éó=${type}, ‰ΩçÁΩÆ=(${r},${c})`);
    if (sq.piece === 'Ëæ∞') {
      console.log(`üêâ Ëæ∞Èßí„ÅåÊ§úÂá∫„Åï„Çå„Åæ„Åó„ÅüÔºÅ„Çø„Ç§„Éó=${type}`);
      console.log(`üêâ Ëæ∞Èßí„ÅÆÁä∂ÊÖã: isTransformed=${sq.isTransformed}, isTimeStopped=${sq.isTimeStopped}, isRainbowLimited=${sq.isRainbowLimited}, isSwampTrapped=${sq.isSwampTrapped}, isDrowned=${sq.isDrowned}`);
      console.log(`üêâ ÂáçÁµêÁä∂ÊÖã„ÉÅ„Çß„ÉÉ„ÇØ: ${state.frozenPieces && state.frozenPieces.some(frozen => frozen.row === r && frozen.col === c)}`);
      console.log(`üêâ Ë°åÂãï‰∏çËÉΩÁä∂ÊÖã„ÉÅ„Çß„ÉÉ„ÇØ: ${isImprisoned(r, c)}`);
    }
    let moves = [];
    switch(type){
      case 'king': moves = kingMoves(r,c); break;
      case 'rook': moves = rookMoves(r,c); break;
      case 'bishop': moves = bishopMoves(r,c); break;
      case 'gold': moves = goldMoves(r,c); break;
      case 'silver': moves = silverMoves(r,c); break;
      case 'knight': moves = knightMoves(r,c); break;
      case 'lance': moves = lanceMoves(r,c); break;
      case 'pawn': moves = pawnMoves(r,c); break;
      case 'ninja': moves = ninjaMoves(r,c); break;
      case 'shadow': moves = shadowMoves(r,c); break;
      case 'cannon': moves = cannonMoves(r,c); break;
      case 'dragon': moves = dragonMoves(r,c); break;
      case 'dragonAwakened': 
        console.log(`üêâ Ëæ∞Èßí„ÅÆÁßªÂãïÁØÑÂõ≤„ÇíË®àÁÆó‰∏≠: ‰ΩçÁΩÆ=(${r},${c})`);
        moves = dragonAwakenedMoves(r,c); 
        console.log(`üêâ Ëæ∞Èßí„ÅÆÁßªÂãïÁØÑÂõ≤ÁµêÊûú: ${moves.length}ÂÄã„ÅÆÁßªÂãïÂÖà`);
        break;
      case 'Ëæ∞': 
        console.log(`üêâ Ëæ∞Èßí„ÅÆÁßªÂãïÁØÑÂõ≤„ÇíË®àÁÆó‰∏≠: ‰ΩçÁΩÆ=(${r},${c})`);
        moves = dragonAwakenedMoves(r,c); 
        console.log(`üêâ Ëæ∞Èßí„ÅÆÁßªÂãïÁØÑÂõ≤ÁµêÊûú: ${moves.length}ÂÄã„ÅÆÁßªÂãïÂÖà`);
        break;
      case 'phoenix': moves = phoenixMoves(r,c); break;
      case 'flame': moves = flameMoves(r,c); break;
      case 'fire': moves = fireMoves(r,c); break;
      case 'water': moves = waterMoves(r,c); break;
      case 'wave': moves = waveMoves(r,c); break;
      case 'tree': moves = treeMoves(r,c); break;
      case 'leaf': moves = leafMoves(r,c); break;
      case 'light': moves = lightMoves(r,c); break;
      case 'star': moves = starMoves(r,c); break;
      case 'dark': moves = darkMoves(r,c); break;
      case 'demon': moves = demonMoves(r,c); break;
      case 'copper': moves = copperMoves(r,c); break;
      case 'iron': moves = ironMoves(r,c); break;
      case 'tin': moves = tinMoves(r,c); break;
      case 'lead': moves = leadMoves(r,c); break;
      case 'treasure': moves = treasureMoves(r,c); break;
      case 'electric': moves = electricMoves(r,c); break;
      case 'thunder': moves = thunderMoves(r,c); break;
      case 'time': moves = timeMoves(r,c); break;
      case 'ice': moves = iceMoves(r,c); break;
      case 'snow': moves = snowMoves(r,c); break;
      case 'sand': moves = sandMoves(r,c); break;
      case 'wind': moves = windMoves(r,c); break;
      case 'ocean': moves = oceanMoves(r,c); break;
      case 'fish': moves = fishMoves(r,c); break;
      case 'moss': moves = mossMoves(r,c); break;
      case 'cloud': moves = cloudMoves(r,c); break;
      case 'rainbow': moves = rainbowMoves(r,c); break;
      case 'rock': moves = rockMoves(r,c); break;
      case 'ore': moves = oreMoves(r,c); break;
      case 'mineral': moves = mineralMoves(r,c); break;
      case 'phantom': moves = phantomMoves(r,c); break;
      case 'mist': moves = mistMoves(r,c); break;
      case 'end': moves = endMoves(r,c); break;
      case 'destiny': moves = destinyMoves(r,c); break;
      case 'ah': moves = ahMoves(r,c); break;
      case 'prison': moves = prisonMoves(r,c); break;
      case 'fence': moves = fenceMoves(r,c); break;
      case 'ridge': moves = ridgeMoves(r,c); break;
      case 'peak': moves = peakMoves(r,c); break;
      case 'mountain': moves = mountainMoves(r,c); break;
      case 'poison': 
        console.log(`‚ò† ÊØí„ÅÆÈßí„ÅÆÁßªÂãïË®àÁÆó„ÇíÈñãÂßã: (${r},${c})`);
        moves = poisonMoves(r,c); 
        console.log(`‚ò† ÊØí„ÅÆÈßí„ÅÆÁßªÂãïÁµêÊûú: ${moves.length}ÂÄã`, moves);
        break;
      case 'swamp': moves = swampMoves(r,c); break;
      case 'grave': moves = graveMoves(r,c); break;
      case 'spirit': moves = spiritMoves(r,c); break;
      case 'machine': moves = machineMoves(r,c); break;
      case 'gear': moves = gearMoves(r,c); break;
      case 'moon': moves = moonMoves(r,c); break;
      case 'boat': moves = boatMoves(r,c); break;
      case 'mirror': moves = mirrorMoves(r,c); break;
      case 'reflection': moves = reflectionMoves(r,c); break;
      case 'curse': moves = curseMoves(r,c); break;
      case 'field': moves = fieldMoves(r,c); break;
      case 'house': moves = houseMoves(r,c); break;
      case 'people': moves = peopleMoves(r,c); break;
      case 'spring': moves = springMoves(r,c); break;
      case 'experiment': moves = experimentMoves(r,c); break;
      case 'mutant': moves = mutantMoves(r,c); break;
      case 'holy': moves = holyMoves(r,c); break;
      case 'k': moves = kMoves(r,c); break;
      case 'sword': moves = swordMoves(r,c); break;
      case 'armor': moves = armorMoves(r,c); break;
      case 'gun': moves = gunMoves(r,c); break;
      case 'book': moves = bookMoves(r,c); break;
      case 'seal': 
        console.log(`üîí sealMovesÈñ¢Êï∞„ÇíÂëº„Å≥Âá∫„Åó: (${r},${c})`);
        moves = sealMoves(r,c);
        console.log(`üîí sealMovesÈñ¢Êï∞„ÅÆÁµêÊûú:`, moves);
        break;
      default: return [];
    }
    
    // moves„Ååundefined„ÅÆÂ†¥Âêà„ÅØÁ©∫ÈÖçÂàó„ÇíËøî„Åô
    if (!moves) {
      console.error(`‚ùå moves„Ååundefined: Èßí=${sq.piece}, „Çø„Ç§„Éó=${type}, ‰ΩçÁΩÆ=(${r},${c})`);
      return [];
    }
    
    // moves„ÅåÈÖçÂàó„Åß„Å™„ÅÑÂ†¥Âêà„ÇÇ„Ç®„É©„Éº
    if (!Array.isArray(moves)) {
      console.error(`‚ùå moves„ÅåÈÖçÂàó„Åß„Å™„ÅÑ: Èßí=${sq.piece}, „Çø„Ç§„Éó=${type}, ‰ΩçÁΩÆ=(${r},${c}), moves=${moves}, Âûã=${typeof moves}`);
      return [];
    }
    
    // Ëá™ÂàÜ„ÅÆÁéã„ÇíÂèñ„ÇãÊâã„ÇíÈô§Â§ñ
    moves = moves.filter(move => {
      const targetPiece = state.board[move.r][move.c];
      if (targetPiece && (targetPiece.piece === 'Áéã' || targetPiece.piece === 'Áéâ')) {
        // Ëá™ÂàÜ„ÅÆÁéã„ÇíÂèñ„Çç„ÅÜ„Å®„Åô„ÇãÊâã„ÅØÈô§Â§ñ
        if (targetPiece.owner === sq.owner) {
          return false;
        }
      }
      return true;
    });
    
    // Âë™„ÅÑ„Éû„Çπ„ÅÆÂäπÊûúÔºöÁßªÂãï‰ª•Â§ñ„ÅÆ„Çπ„Ç≠„É´„ÇíÂ§±„ÅÜÔºàÁßªÂãïÁØÑÂõ≤„ÅØÂà∂Èôê„Åï„Çå„Å™„ÅÑÔºâ
    // „Çπ„Ç≠„É´„ÅÆÂ∞ÅÂç∞„ÅØÂêÑ„Çπ„Ç≠„É´Áô∫ÂãïÊôÇ„Å´isAffectedByCurse()„Åß„ÉÅ„Çß„ÉÉ„ÇØ„Åï„Çå„Çã
    
    // Â≤©„ÅÆÈöúÂÆ≥Áâ©„Åå„ÅÇ„Çã„Éû„Çπ„ÅØÁßªÂãï‰∏çÂèØ
    moves = moves.filter(move => !isBlockedByRockBarrier(move.r, move.c));
    
    return moves;
  }

  function inBounds(r,c){ return r>=0 && r<BOARD_SIZE && c>=0 && c<BOARD_SIZE; }
  function isOwn(r,c,owner){ const t=state.board[r][c]; return t && t.owner===owner; }
  function pushIfEnemyOrEmpty(moves, r,c, owner){
    if (!inBounds(r,c)) return false;
    
    // ÊØí„Éû„Çπ„Å∏„ÅÆÁßªÂãïÂà∂ÈôêÔºàÁõ∏Êâã„ÅÆÈßí„ÅÆ„ÅøÔºâ
    if (isPoisonSquare(r, c) && owner !== state.currentPlayer) {
      return false;
    }
    
    const t = state.board[r][c];
    if (!t){ moves.push({r,c}); return true; }
    // √ó„Éû„ÇπÔºà'X'Ôºâ„Å∏„ÅÆÁßªÂãï„ÅØÂÆåÂÖ®„Å´Á¶ÅÊ≠¢
    if (t.piece === 'X'){ return false; }
    // Âë™„ÅÑ„Éû„ÇπÔºà'n'Ôºâ„ÄÅÁü¢Âç∞„Éû„ÇπÔºà'‚Üë','‚Üê','‚Üì','‚Üí'Ôºâ„Å∏„ÅÆÁßªÂãïÊôÇ„ÅØÂèñ„Çã„Åì„Å®„Åå„Åß„Åç„Å™„ÅÑ
    if (t.piece === 'n' || ['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(t.piece)){ 
      moves.push({r,c}); 
      return true; 
    }
    if (t.owner !== owner){ moves.push({r,c}); return false; }
    return false;
  }

  function slide(moves, r,c, owner, dr,dc, maxSteps=99){
    for (let i=1;i<=maxSteps;i++){
      const nr=r+dr*i, nc=c+dc*i; if (!inBounds(nr,nc)) break;
      const t=state.board[nr][nc];
      if (!t){ moves.push({r:nr,c:nc}); continue; }
      // √ó„Éû„ÇπÔºà'X'Ôºâ„Å∏„ÅÆÁßªÂãï„ÅØÂÆåÂÖ®„Å´Á¶ÅÊ≠¢
      if (t.piece === 'X'){ break; }
      // Âë™„ÅÑ„Éû„ÇπÔºà'n'Ôºâ„ÄÅÁü¢Âç∞„Éû„ÇπÔºà'‚Üë','‚Üê','‚Üì','‚Üí'Ôºâ„ÅØÂèñ„Çå„Å™„ÅÑ„ÅåÁßªÂãï„ÅØÂèØËÉΩ
      if (t.piece === 'n' || ['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(t.piece)){ 
        moves.push({r:nr,c:nc}); 
        continue; 
      }
      if (t.owner!==owner){ moves.push({r:nr,c:nc}); }
      break;
    }
  }

  function kingMoves(r,c){
    const owner = state.board[r][c].owner;
    const dirs=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    const m=[]; dirs.forEach(([dr,dc])=>pushIfEnemyOrEmpty(m, r+dr, c+dc, owner));
    return m;
  }
  function rookMoves(r,c){ const o=state.board[r][c].owner, m=[]; [[-1,0],[1,0],[0,-1],[0,1]].forEach(d=>slide(m,r,c,o,d[0],d[1])); return m; }
  function bishopMoves(r,c){ const o=state.board[r][c].owner, m=[]; [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d=>slide(m,r,c,o,d[0],d[1])); return m; }
  function goldMoves(r,c){
    const o=state.board[r][c].owner; const f = o==='player'?-1:1; const m=[];
    [[f,-1],[f,0],[f,1],[0,-1],[0,1],[-f,0]].forEach(([dr,dc])=>pushIfEnemyOrEmpty(m,r+dr,c+dc,o));
    return m;
  }
  function silverMoves(r,c){
    const o=state.board[r][c].owner; const f = o==='player'?-1:1; const m=[];
    [[f,-1],[f,0],[f,1],[-f,-1],[-f,1]].forEach(([dr,dc])=>pushIfEnemyOrEmpty(m,r+dr,c+dc,o));
    return m;
  }
  function knightMoves(r,c){
    const o=state.board[r][c].owner; const f = o==='player'?-1:1; const m=[];
    [[2*f,-1],[2*f,1]].forEach(([dr,dc])=>{ pushIfEnemyOrEmpty(m,r+dr,c+dc,o); });
    return m;
  }
  function lanceMoves(r,c){ const o=state.board[r][c].owner; const f=o==='player'?-1:1; const m=[]; slide(m,r,c,o,f,0); return m; }
  function pawnMoves(r,c){ const o=state.board[r][c].owner; const f=o==='player'?-1:1; const m=[]; pushIfEnemyOrEmpty(m,r+f,c,o); return m; }

  // „Ç™„É™„Ç∏„Éä„É´Èßí
  // Âøç: Áéã„ÅÆ1Ê≠© + ÂâçÊñπ„Éä„Ç§„Éà
  function ninjaMoves(r,c){
    const o=state.board[r][c].owner; const f=o==='player'?-1:1; const m=[];
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(([dr,dc])=>pushIfEnemyOrEmpty(m,r+dr,c+dc,o));
    [[2*f,-1],[2*f,1]].forEach(([dr,dc])=>pushIfEnemyOrEmpty(m,r+dr,c+dc,o));
    return m;
  }
  // ÂΩ±: Êñú„ÇÅ„Å´ÊúÄÂ§ß2„Éû„Çπ„Åæ„Åß„Çπ„É©„Ç§„Éâ + „Åù„ÅÆÂ†¥„ÅÆ¬±1Ê®™ÁßªÂãï
  function shadowMoves(r,c){
    const o=state.board[r][c].owner; const m=[];
    [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(([dr,dc])=>slide(m,r,c,o,dr,dc,2));
    [[0,-1],[0,1]].forEach(([dr,dc])=>pushIfEnemyOrEmpty(m,r+dr,c+dc,o));
    return m;
  }
  // Á†≤: ‰∏≠ÂõΩË±°Ê£ã„ÅÆÁ†≤„Å´È°û‰ºº
  // ÈùûÊçïÁç≤: „É´„Éº„ÇØ„ÅÆ„Çà„ÅÜ„Å´ÈöúÂÆ≥Áâ©„Å™„Åó„Åß„Çπ„É©„Ç§„Éâ
  // ÊçïÁç≤: ÂøÖ„ÅöÈñì„Å´1Êûö„Å†„ÅëÊåü„Çì„Åß„ÄÅ„Åù„ÅÆÂÖà„ÅÆÊïµÈßí„ÇíÂèñ„Çå„Çã
  function cannonMoves(r,c){
    const o = state.board[r][c].owner;
    const m = [];
    
    // Á∏¶Ê®™„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÁßªÂãï
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => slide(m,r,c,o,d[0],d[1]));
    
    // Êåü„ÅøÂèñ„Çä: ÊïµÈßí„ÇíÊåü„Çì„ÅßÂèñ„Çã
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => {
      const nr = r + d[0], nc = c + d[1];
      if (inBounds(nr,nc) && state.board[nr][nc] && state.board[nr][nc].owner !== o) {
        const nnr = nr + d[0], nnc = nc + d[1];
        if (inBounds(nnr,nnc) && state.board[nnr][nc] && state.board[nnr][nc].owner === o) {
          m.push({r:nr,c:nc});
        }
      }
    });
    
    return m;
  }
  
  function dragonMoves(r,c){
    const o = state.board[r][c].owner;
    const m = [];
    
    // Èæç„ÅÆÂãï„Åç: Êñú„ÇÅ„Å´‰Ωï„Éû„Çπ„Åß„ÇÇ + ÂâçÂæåÂ∑¶Âè≥„Å´1„Éû„Çπ
    [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d => slide(m,r,c,o,d[0],d[1]));
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => pushIfEnemyOrEmpty(m,r+d[0],c+d[1],o));
    
    return m;
  }
  
  function phoenixMoves(r,c){
    const o = state.board[r][c].owner;
    const m = [];
    
    // È≥≥„ÅÆÂãï„Åç: ÂâçÂæåÂ∑¶Âè≥„Å´‰Ωï„Éû„Çπ„Åß„ÇÇ + Êñú„ÇÅ„Å´1„Éû„Çπ
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => slide(m,r,c,o,d[0],d[1]));
    [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d => pushIfEnemyOrEmpty(m,r+d[0],c+d[1],o));
    
    return m;
  }
  
  function flameMoves(r,c){
    const o = state.board[r][c].owner;
    const m = [];
    
    // ÁÇé„ÅÆÂãï„Åç: Âë®Âõ≤8ÊñπÂêë„Å´1„Éû„Çπ + ÁÇé„ÅÆ‰ºùÊí≠ÔºàÈö£Êé•„Åô„ÇãÊïµÈßí„ÇíÁáÉ„ÇÑ„ÅôÔºâ
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = r + d[0], nc = c + d[1];
      if (inBounds(nr,nc)) {
        const target = state.board[nr][nc];
        if (!target) {
          m.push({r:nr,c:nc}); // Á©∫„Éû„Çπ„Å´ÁßªÂãïÂèØËÉΩ
        } else if (target.owner !== o) {
          m.push({r:nr,c:nc}); // ÊïµÈßí„ÇíÂèñ„Çã
          // ÁÇé„ÅÆ‰ºùÊí≠: Èö£Êé•„Åô„ÇãÊïµÈßí„ÇÇÁáÉ„ÇÑ„Åô
          [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d2 => {
            const nr2 = nr + d2[0], nc2 = nc + d2[1];
            if (inBounds(nr2,nc2) && state.board[nr2][nc2] && state.board[nr2][nc2].owner !== o) {
              // Èö£Êé•„Åô„ÇãÊïµÈßí„ÇÇÁáÉ„ÇÑ„ÅôÔºàË¶ñË¶öÁöÑ„Å™ÂäπÊûúÔºâ
            }
          });
        }
      }
    });
    
    return m;
  }
  
  function fireMoves(r,c){
    const o = state.board[r][c].owner;
    const m = [];
    
    // ÁÅ´„ÅÆÂãï„Åç: ÂâçÂæå1„Éû„Çπ + Êñú„ÇÅ4ÊñπÂêë„Å´1„Éû„Çπ
    // ÂâçÂæå1„Éû„Çπ
    [[-1,0],[1,0]].forEach(d => pushIfEnemyOrEmpty(m,r+d[0],c+d[1],o));
    
    // Êñú„ÇÅ4ÊñπÂêë„Å´1„Éû„Çπ
    [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d => pushIfEnemyOrEmpty(m,r+d[0],c+d[1],o));
    
    return m;
  }
  
  function waterMoves(r,c){
    const o = state.board[r][c].owner;
    const m = [];
    
    // Ê∞¥„ÅÆÂãï„Åç: Êñú„ÇÅ„Å´‰Ωï„Éû„Çπ„Åß„ÇÇ + Ê∞¥„ÅÆÊµÅ„ÇåÔºàÁßªÂãïÁµåË∑Ø„Å´Ê∞¥„ÅÆÊµÅ„Çå„Çí‰Ωú„ÇãÔºâ
    [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d => {
      let steps = 0;
      let nr = r + d[0], nc = c + d[1];
      
      while (inBounds(nr,nc) && steps < 2) { // ÊúÄÂ§ß2„Éû„Çπ„Åæ„Åß
        const target = state.board[nr][nc];
        if (!target) {
          m.push({r:nr,c:nc});
        } else if (target.owner !== o) {
          m.push({r:nr,c:nc}); // ÊïµÈßí„ÇíÂèñ„Çã
          break;
        } else {
          break; // Âë≥ÊñπÈßí„ÅßÊ≠¢„Åæ„Çã
        }
        nr += d[0];
        nc += d[1];
        steps++;
      }
    });
    
    // Ê∞¥„ÅÆÊµÅ„Çå: ÂâçÂæåÂ∑¶Âè≥„Å´1„Éû„ÇπÁßªÂãïÂèØËÉΩ
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => pushIfEnemyOrEmpty(m,r+d[0],c+d[1],o));
    
    return m;
  }
  
  function waveMoves(r,c){
    const o = state.board[r][c].owner;
    const m = [];
    
    // Ê≥¢„ÅÆÂãï„Åç: ÂâçÂæåÂ∑¶Âè≥„Å´‰Ωï„Éû„Çπ„Åß„ÇÇ + Ê≥¢„ÅÆ‰ºùÊí≠ÔºàÈö£Êé•„Åô„ÇãÊïµÈßí„ÇíÊäº„ÅóÊµÅ„ÅôÔºâ
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => {
      let steps = 0;
      let nr = r + d[0], nc = c + d[1];
      
      while (inBounds(nr,nc) && steps < 2) { // ÊúÄÂ§ß2„Éû„Çπ„Åæ„Åß
        const target = state.board[nr][nc];
        if (!target) {
          m.push({r:nr,c:nc});
        } else if (target.owner !== o) {
          m.push({r:nr,c:nc}); // ÊïµÈßí„ÇíÂèñ„Çã
          break;
        } else {
          break; // Âë≥ÊñπÈßí„ÅßÊ≠¢„Åæ„Çã
        }
        nr += d[0];
        nc += d[1];
        steps++;
      }
    });
    
    // Ê≥¢„ÅÆ‰ºùÊí≠: Êñú„ÇÅ„Å´1„Éû„ÇπÁßªÂãïÂèØËÉΩ
    [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d => pushIfEnemyOrEmpty(m,r+d[0],c+d[1],o));
    
    return m;
  }
  
  function treeMoves(r,c){
    const o = state.board[r][c].owner;
    const m = [];
    
    // Êú®„ÅÆÂãï„Åç: Âë®Âõ≤8ÊñπÂêë„Å´1„Éû„Çπ + Êú®„ÅÆÊàêÈï∑ÔºàÁßªÂãïÁµåË∑Ø„Å´Êú®„ÅÆÊ†π„ÇíÂºµ„ÇãÔºâ
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = r + d[0], nc = c + d[1];
      if (inBounds(nr,nc)) {
        const target = state.board[nr][nc];
        if (!target) {
          m.push({r:nr,c:nc});
        } else if (target.owner !== o) {
          m.push({r:nr,c:nc}); // ÊïµÈßí„ÇíÂèñ„Çã
        }
      }
    });
    
    // Êú®„ÅÆÊàêÈï∑: ÂâçÂæåÂ∑¶Âè≥„Å´2„Éû„ÇπÁßªÂãïÂèØËÉΩ
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => {
      let steps = 0;
      let nr = r + d[0], nc = c + d[1];
      
      while (inBounds(nr,nc) && steps < 2) { // ÊúÄÂ§ß2„Éû„Çπ„Åæ„Åß
        const target = state.board[nr][nc];
        if (!target) {
          m.push({r:nr,c:nc});
        } else if (target.owner !== o) {
          m.push({r:nr,c:nc}); // ÊïµÈßí„ÇíÂèñ„Çã
          break;
        } else {
          break; // Âë≥ÊñπÈßí„ÅßÊ≠¢„Åæ„Çã
        }
        nr += d[0];
        nc += d[1];
        steps++;
      }
    });
    
    return m;
  }
  
  function leafMoves(r,c){
    const o = state.board[r][c].owner;
    const m = [];
    
    // Ëëâ„ÅÆÂãï„Åç: Êñú„ÇÅ„Å´‰Ωï„Éû„Çπ„Åß„ÇÇ + Ëëâ„ÅÆËàû„ÅÑÊï£„ÇäÔºàÁßªÂãïÁµåË∑Ø„Å´Ëëâ„ÇíÊï£„Çâ„ÅôÔºâ
    [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d => {
      let steps = 0;
      let nr = r + d[0], nc = c + d[1];
      
      while (inBounds(nr,nc) && steps < 2) { // ÊúÄÂ§ß2„Éû„Çπ„Åæ„Åß
        const target = state.board[nr][nc];
        if (!target) {
          m.push({r:nr,c:nc});
        } else if (target.owner !== o) {
          m.push({r:nr,c:nc}); // ÊïµÈßí„ÇíÂèñ„Çã
          break;
        } else {
          break; // Âë≥ÊñπÈßí„ÅßÊ≠¢„Åæ„Çã
        }
        nr += d[0];
        nc += d[1];
        steps++;
      }
    });
    
    // Ëëâ„ÅÆËàû„ÅÑÊï£„Çä: ÂâçÂæåÂ∑¶Âè≥„Å´1„Éû„ÇπÁßªÂãïÂèØËÉΩ
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => pushIfEnemyOrEmpty(m,r+d[0],c+d[1],o));
    
    return m;
  }

  // ÂàÄ„ÅÆÁßªÂãï: Ââç1„Éû„Çπ„ÅÆ„Åø
  function swordMoves(r,c){
    const o = state.board[r][c].owner;
    const m = [];
    const f = o === 'player' ? -1 : 1; // „Éó„É¨„Ç§„É§„Éº„ÅØ‰∏äÂêë„Åç„ÄÅ„Ç≥„É≥„Éî„É•„Éº„Çø„ÅØ‰∏ãÂêë„Åç
    
    // Ââç1„Éû„Çπ„ÅÆ„ÅøÁßªÂãïÂèØËÉΩ
    pushIfEnemyOrEmpty(m, r + f, c, o);
    
    return m;
  }

  // Èéß„ÅÆÁßªÂãï: ÂâçÂæåÂ∑¶Âè≥1„Éû„ÇπÔºàÊïµÈßí„ÅØÂèñ„Çå„Å™„ÅÑ„ÄÅÁ©∫„Åç„Éû„Çπ„ÅÆ„ÅøÁßªÂãïÂèØËÉΩÔºâ
  function armorMoves(r,c){
    const o = state.board[r][c].owner;
    const m = [];
    
    // ÂâçÂæåÂ∑¶Âè≥1„Éû„ÇπÁßªÂãïÂèØËÉΩÔºàÁ©∫„Åç„Éû„Çπ„ÅÆ„Åø„ÄÅÊïµÈßí„ÅØÂèñ„Çå„Å™„ÅÑÔºâ
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => {
      const nr = r + d[0];
      const nc = c + d[1];
      
      if (inBounds(nr, nc)) {
        const target = state.board[nr][nc];
        if (!target) {
          // Á©∫„Åç„Éû„Çπ„ÅÆ„ÅøÁßªÂãïÂèØËÉΩ
          m.push({r: nr, c: nc});
        }
        // ÊïµÈßí„ÅØÂèñ„Çå„Å™„ÅÑÔºàÂë≥ÊñπÈßí„ÇÇÁßªÂãï‰∏çÂèØÔºâ
      }
    });
    
    return m;
  }

  // ÈäÉ„ÅÆÁßªÂãï: Ââç2„Éû„Çπ„Åæ„Åß + Êñú„ÇÅÂæå„Çç2„Éû„Çπ„Åæ„ÅßÔºàÈÄ£Á∂ö„Åó„ÅüÊïµÈßí„ÇíË≤´ÈÄö„Åó„Å¶Âèñ„ÇãÔºâ
  function gunMoves(r,c){
    const o = state.board[r][c].owner;
    const m = [];
    const f = o === 'player' ? -1 : 1; // „Éó„É¨„Ç§„É§„Éº„ÅØ‰∏äÂêë„Åç„ÄÅ„Ç≥„É≥„Éî„É•„Éº„Çø„ÅØ‰∏ãÂêë„Åç
    
    // Ââç2„Éû„Çπ„Åæ„ÅßÁßªÂãïÂèØËÉΩÔºàÈÄ£Á∂ö„Åó„ÅüÊïµÈßí„ÇíË≤´ÈÄöÔºâ
    for (let i = 1; i <= 2; i++) {
      const nr = r + (f * i);
      const nc = c;
      
      if (inBounds(nr, nc)) {
        const target = state.board[nr][nc];
        if (!target) {
          m.push({r: nr, c: nc});
        } else if (target.owner !== o) {
          m.push({r: nr, c: nc}); // ÊïµÈßí„ÇíÂèñ„ÇãÔºàË≤´ÈÄöÔºâ
        } else {
          break; // Âë≥ÊñπÈßí„ÅßÊ≠¢„Åæ„Çã
        }
      } else {
        break; // Áõ§Â§ñ„ÅßÊ≠¢„Åæ„Çã
      }
    }
    
    // Êñú„ÇÅÂæå„Çç2„Éû„Çπ„Åæ„ÅßÁßªÂãïÂèØËÉΩÔºàÈÄ£Á∂ö„Åó„ÅüÊïµÈßí„ÇíË≤´ÈÄöÔºâ
    const backDirections = o === 'player' ? 
      [[1, -1], [1, 1]] : // „Éó„É¨„Ç§„É§„Éº„ÅØ‰∏ãÂêë„Åç„ÅÆÊñú„ÇÅÂæå„Çç
      [[-1, -1], [-1, 1]]; // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅØ‰∏äÂêë„Åç„ÅÆÊñú„ÇÅÂæå„Çç
    
    backDirections.forEach(d => {
      for (let i = 1; i <= 2; i++) {
        const nr = r + (d[0] * i);
        const nc = c + (d[1] * i);
        
        if (inBounds(nr, nc)) {
          const target = state.board[nr][nc];
          if (!target) {
            m.push({r: nr, c: nc});
          } else if (target.owner !== o) {
            m.push({r: nr, c: nc}); // ÊïµÈßí„ÇíÂèñ„ÇãÔºàË≤´ÈÄöÔºâ
          } else {
            break; // Âë≥ÊñπÈßí„ÅßÊ≠¢„Åæ„Çã
          }
        } else {
          break; // Áõ§Â§ñ„ÅßÊ≠¢„Åæ„Çã
        }
      }
    });
    
    return m;
  }

  // Êõ∏„ÅÆÁßªÂãï: Á∏¶Ê®™ÁÑ°ÈôêÁßªÂãï„Å®Êñú„ÇÅ4ÊñπÂêë„Å´1„Éû„ÇπÔºà„Çπ„Ç≠„É´‰ΩøÁî®ÊôÇ„ÅØ„Ç≥„Éî„Éº„Åó„ÅüÈßí„ÅÆÁßªÂãïÁØÑÂõ≤Ôºâ
  function bookMoves(r,c){
    try {
      const o = state.board[r][c].owner;
      const m = [];
    
    // „Çπ„Ç≠„É´‰ΩøÁî®‰∏≠„Åß„Ç≥„Éî„Éº„Åó„ÅüÈßí„Åå„ÅÇ„ÇãÂ†¥Âêà„ÄÅ„Åù„ÅÆÈßí„ÅÆÁßªÂãïÁØÑÂõ≤„Çí‰ΩøÁî®
    if (state.board[r][c].copiedPiece) {
      const copiedPiece = state.board[r][c].copiedPiece;
      const copiedOwner = state.board[r][c].copiedOwner;
      
      // „Ç≥„Éî„Éº„Åó„ÅüÈßí„ÅÆÁßªÂãïÁØÑÂõ≤„ÇíÂèñÂæó
      switch (getPieceType(copiedPiece)) {
        case 'king':
        // Áéã„ÅÆÁßªÂãïÁØÑÂõ≤
        [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
          const nr = r + d[0];
          const nc = c + d[1];
          if (inBounds(nr,nc) && (!state.board[nr][nc] || state.board[nr][nc] === '' || state.board[nr][nc].owner !== o)) {
            m.push({r: nr, c: nc});
          }
        });
          break;
        case 'rook':
          // È£õËªä„ÅÆÁßªÂãïÁØÑÂõ≤
          [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => slide(m,r,c,o,d[0],d[1]));
          break;
        case 'bishop':
          // Ëßí„ÅÆÁßªÂãïÁØÑÂõ≤
          [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d => slide(m,r,c,o,d[0],d[1]));
          break;
        case 'gold':
          // Èáë„ÅÆÁßªÂãïÁØÑÂõ≤
          [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,0]].forEach(d => {
            const nr = r + d[0];
            const nc = c + d[1];
            if (inBounds(nr,nc) && (!state.board[nr][nc] || state.board[nr][nc] === '' || state.board[nr][nc].owner !== o)) {
              m.push({r: nr, c: nc});
            }
          });
          break;
        case 'silver':
          // ÈäÄ„ÅÆÁßªÂãïÁØÑÂõ≤
          [[-1,-1],[-1,0],[-1,1],[1,-1],[1,1]].forEach(d => {
            const nr = r + d[0];
            const nc = c + d[1];
            if (inBounds(nr,nc) && (!state.board[nr][nc] || state.board[nr][nc] === '' || state.board[nr][nc].owner !== o)) {
              m.push({r: nr, c: nc});
            }
          });
          break;
        case 'knight':
          // Ê°ÇÈ¶¨„ÅÆÁßªÂãïÁØÑÂõ≤
          [[-2,-1],[-2,1]].forEach(d => {
            const nr = r + d[0];
            const nc = c + d[1];
            if (inBounds(nr,nc) && (!state.board[nr][nc] || state.board[nr][nc] === '' || state.board[nr][nc].owner !== o)) {
              m.push({r: nr, c: nc});
            }
          });
          break;
        case 'lance':
          // È¶ôËªä„ÅÆÁßªÂãïÁØÑÂõ≤
          [[-1,0]].forEach(d => slide(m,r,c,o,d[0],d[1]));
          break;
        case 'pawn':
          // Ê≠©„ÅÆÁßªÂãïÁØÑÂõ≤
          [[-1,0]].forEach(d => {
            const nr = r + d[0];
            const nc = c + d[1];
            if (inBounds(nr,nc) && (!state.board[nr][nc] || state.board[nr][nc] === '' || state.board[nr][nc].owner !== o)) {
              m.push({r: nr, c: nc});
            }
          });
          break;
        default:
          // „Éá„Éï„Ç©„É´„Éà„ÅØÂÖÉ„ÅÆÁßªÂãïÁØÑÂõ≤
          [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => slide(m,r,c,o,d[0],d[1]));
          [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d => {
            const nr = r + d[0];
            const nc = c + d[1];
            if (inBounds(nr,nc) && (!state.board[nr][nc] || state.board[nr][nc] === '' || state.board[nr][nc].owner !== o)) {
              m.push({r: nr, c: nc});
            }
          });
      }
    } else {
      // ÈÄöÂ∏∏„ÅÆÁßªÂãïÁØÑÂõ≤: Á∏¶Ê®™ÁÑ°ÈôêÁßªÂãï„Å®Êñú„ÇÅ4ÊñπÂêë„Å´1„Éû„Çπ
      [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => slide(m,r,c,o,d[0],d[1]));
      [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d => {
        const nr = r + d[0];
        const nc = c + d[1];
        if (inBounds(nr,nc) && (!state.board[nr][nc] || state.board[nr][nc] === '' || state.board[nr][nc].owner !== o)) {
          m.push({r: nr, c: nc});
        }
      });
    }
    return m;
    } catch (error) {
      console.error(`‚ùå bookMovesÈñ¢Êï∞„Ç®„É©„Éº: (${r},${c})`, error);
      return [];
    }
  }

  // Â∞Å„ÅÆÁßªÂãï: ÂâçÂæåÂ∑¶Âè≥1„Éû„Çπ
  function sealMoves(r,c){
    try {
      console.log(`üîí sealMovesÈñ¢Êï∞ÈñãÂßã: (${r},${c})`);
      const o = state.board[r][c].owner;
      console.log(`üîí ÊâÄÊúâËÄÖ: ${o}`);
      const m = [];
      // Â∞Å„ÅÆÂãï„Åç: ÂâçÂæåÂ∑¶Âè≥1„Éû„Çπ
      [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => {
        const nr = r + d[0];
        const nc = c + d[1];
        console.log(`üîí „ÉÅ„Çß„ÉÉ„ÇØ‰∏≠: (${nr},${nc})`);
        if (inBounds(nr,nc) && (!state.board[nr][nc] || state.board[nr][nc] === '' || state.board[nr][nc].owner !== o)) {
          m.push({r: nr, c: nc});
          console.log(`üîí ÁßªÂãïÂèØËÉΩ: (${nr},${nc})`);
        }
      });
      console.log(`üîí sealMovesÈñ¢Êï∞ÁµÇ‰∫Ü: ÁµêÊûú=${m.length}ÂÄã„ÅÆÁßªÂãï`);
      return m;
    } catch (error) {
      console.error(`‚ùå sealMovesÈñ¢Êï∞„Ç®„É©„Éº: (${r},${c})`, error);
      return [];
    }
  }

  // Ê∞∑„ÅÆÂáçÁµêÂäπÊûú: Âë®Âõ≤„ÅÆÊïµÈßí„Çí1„Çø„Éº„É≥Âáç„Çâ„Åõ„Çã
  function showIceFreezeEffect(fromRow, fromCol, toRow, toCol) {
    const iceMarks = [];
    const frozenPieces = [];
    
    // ÁßªÂãïÂÖà„ÅÆÂë®Âõ≤„ÅÆÊïµÈßí„ÇíÂáç„Çâ„Åõ„Çã
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = toRow + d[0], nc = toCol + d[1];
      if (inBounds(nr, nc) && state.board[nr][nc] && state.board[nr][nc].owner !== state.currentPlayer && 
          state.board[nr][nc].piece !== 'X') {
        
        // ÊïµÈßí„ÇíÂáç„Çâ„Åõ„ÇãÔºà5%„ÅÆÁ¢∫ÁéáÔºâ
        if (Math.random() < 0.05) {
          const frozenPiece = state.board[nr][nc];
          
          // ÂáçÁµêÁä∂ÊÖã„ÇíË®òÈå≤
          if (!state.frozenPieces) state.frozenPieces = [];
          state.frozenPieces.push({
            row: nr,
            col: nc,
            piece: frozenPiece.piece,
            owner: frozenPiece.owner,
            turnsLeft: 3 // 3„Çø„Éº„É≥ÂáçÁµê
          });
          
          // ÂáçÁµê„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
          const iceMark = createIceMark(nr, nc);
          iceMarks.push(iceMark);
          document.body.appendChild(iceMark);
          
          frozenPieces.push({
            row: nr,
            col: nc,
            piece: frozenPiece.piece
          });
          
          // ÂáçÁµêÁä∂ÊÖã„ÇíË¶ñË¶öÁöÑ„Å´Ë°®Á§∫
          const cell = document.querySelector(`[data-row="${nr}"][data-col="${nc}"]`);
          if (cell) {
            cell.classList.add('frozen');
          }
        }
      }
    });
    
    // ÂáçÁµê„Åï„Çå„ÅüÈßí„ÅÆÊÉÖÂ†±„Çí„É≠„Ç∞„Å´Âá∫Âäõ
    if (frozenPieces.length > 0) {
      console.log('‚ùÑÔ∏è Ê∞∑„ÅÆÂáçÁµê„ÅßÂáç„Çâ„Åï„Çå„ÅüÈßí:', frozenPieces);
      setStatus(`Ê∞∑„ÅÆÂäõ„Åß${frozenPieces.length}ÂÄã„ÅÆÊïµÈßí„ÇíÂáç„Çâ„Åó„Åæ„Åó„ÅüÔºÅ`, 'playing');
    }
    
    // 2ÁßíÂæå„Å´Ê∞∑„Éû„Éº„ÇØ„ÇíÂâäÈô§
    setTimeout(() => {
      iceMarks.forEach(mark => {
        if (mark.parentNode) {
          mark.parentNode.removeChild(mark);
        }
      });
      
      // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
      render();
    }, 2000);
  }

  // ÂáçÁµêÂäπÊûú„ÅÆÊõ¥Êñ∞Âá¶ÁêÜ
  function updateFrozenEffects() {
    if (!state.frozenPieces) return;
    
    // ÂáçÁµê„Çø„Éº„É≥Êï∞„ÇíÊ∏õ„Çâ„Åô
    state.frozenPieces = state.frozenPieces.filter(frozen => {
      frozen.turnsLeft--;
      
      // ÂáçÁµê„ÅåËß£Èô§„Åï„Çå„ÅüÂ†¥Âêà
      if (frozen.turnsLeft <= 0) {
        // ÂáçÁµêÁä∂ÊÖã„ÅÆË¶ñË¶öÁöÑË°®Á§∫„ÇíÂâäÈô§
        const cell = document.querySelector(`[data-row="${frozen.row}"][data-col="${frozen.col}"]`);
        if (cell) {
          cell.classList.remove('frozen');
        }
        return false; // „É™„Çπ„Éà„Åã„ÇâÂâäÈô§
      }
      
      return true; // „Åæ„Å†ÂáçÁµê‰∏≠
    });
    
    console.log('‚ùÑÔ∏è ÂáçÁµêÁä∂ÊÖã„ÅÆÊõ¥Êñ∞:', state.frozenPieces);
  }

  // Ê∞∑„Éû„Éº„ÇØ„Çí‰ΩúÊàê
  function createIceMark(row, col) {
    const mark = document.createElement('div');
    mark.className = 'ice-mark';
    mark.style.cssText = `
      position: absolute;
      left: ${col * 60 + 200}px;
      top: ${row * 60 + 100}px;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, rgba(173, 216, 230, 0.8), rgba(135, 206, 235, 0.6));
      border: 2px solid rgba(0, 191, 255, 0.8);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: white;
      text-shadow: 0 1px 3px rgba(0,0,0,0.8);
      z-index: 1000;
      animation: iceFreezeEffect 2s ease-in-out;
      pointer-events: none;
    `;
    mark.textContent = '‚ùÑÔ∏è';
    return mark;
  }

  // Ê∞¥„ÅÆÊµÅ„ÇåÂäπÊûú: ÊïµÈßí„Çí1„Éû„ÇπÊäº„ÅóÊµÅ„Åô
  function showWaterFlowEffect(fromRow, fromCol, toRow, toCol) {
    const waterMarks = [];
    const pushedPieces = [];
    
    // ÁßªÂãïÁµåË∑Ø„ÇíË®àÁÆó
    const dr = toRow - fromRow;
    const dc = toCol - fromCol;
    
    if (dr === 0) { // Ê®™ÁßªÂãï
      const start = Math.min(fromCol, toCol);
      const end = Math.max(fromCol, toCol);
      for (let c = start; c <= end; c++) {
        if (c !== fromCol) { // ÈñãÂßã‰ΩçÁΩÆ„ÅØÈô§Â§ñ
          const waterMark = createWaterMark(fromRow, c);
          waterMarks.push(waterMark);
          document.body.appendChild(waterMark);
        }
      }
    } else if (dc === 0) { // Á∏¶ÁßªÂãï
      const start = Math.min(fromRow, toRow);
      const end = Math.max(fromRow, toRow);
      for (let r = start; r <= end; r++) {
        if (r !== fromRow) { // ÈñãÂßã‰ΩçÁΩÆ„ÅØÈô§Â§ñ
          const waterMark = createWaterMark(r, fromCol);
          waterMarks.push(waterMark);
          document.body.appendChild(waterMark);
        }
      }
    }
    
    // ÁßªÂãïÂÖà„ÅÆÂë®Âõ≤„ÅÆÊïµÈßí„Çí1„Éû„ÇπÊäº„ÅóÊµÅ„Åô
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = toRow + d[0], nc = toCol + d[1];
      if (inBounds(nr, nc) && state.board[nr][nc] && state.board[nr][nc].owner !== state.currentPlayer && 
          state.board[nr][nc].piece !== 'X') {
        // ÊïµÈßí„Çí1„Éû„ÇπÊäº„ÅóÊµÅ„Åô
        const pushRow = nr + d[0], pushCol = nc + d[1];
        if (inBounds(pushRow, pushCol) && !state.board[pushRow][pushCol]) {
          const pushedPiece = state.board[nr][nc];
          state.board[pushRow][pushCol] = pushedPiece;
          state.board[nr][nc] = null;
          
          pushedPieces.push({
            from: {row: nr, col: nc},
            to: {row: pushRow, col: pushCol},
            piece: pushedPiece.piece
          });
          
          // Êäº„ÅóÊµÅ„Åó„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
          showPushEffect(nr, nc, pushRow, pushCol, pushedPiece.piece);
        }
      }
    });
    
    // Êäº„ÅóÊµÅ„Åï„Çå„ÅüÈßí„ÅÆÊÉÖÂ†±„Çí„É≠„Ç∞„Å´Âá∫Âäõ
    if (pushedPieces.length > 0) {
      console.log('üíß Ê∞¥„ÅÆÊµÅ„Çå„ÅßÊäº„ÅóÊµÅ„Åï„Çå„ÅüÈßí:', pushedPieces);
      setStatus(`Ê∞¥„ÅÆÊµÅ„Çå„Åß${pushedPieces.length}ÂÄã„ÅÆÊïµÈßí„ÇíÊäº„ÅóÊµÅ„Åó„Åæ„Åó„ÅüÔºÅ`, 'playing');
    }
    
    // 1ÁßíÂæå„Å´Ê∞¥„Éû„Éº„ÇØ„ÇíÂâäÈô§
    setTimeout(() => {
      waterMarks.forEach(mark => {
        if (mark.parentNode) {
          mark.parentNode.removeChild(mark);
        }
      });
      
      // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
      render();
    }, 1000);
  }

  // Ê≥¢„ÅÆ‰ºùÊí≠ÂäπÊûú: ÊïµÈßí„ÇíÁ´Ø„Åæ„ÅßÊäº„ÅóÊµÅ„Åô
  function showWavePropagationEffect(fromRow, fromCol, toRow, toCol) {
    const waveMarks = [];
    const pushedPieces = [];
    
    // ÁßªÂãïÁµåË∑Ø„ÇíË®àÁÆó
    const dr = toRow - fromRow;
    const dc = toCol - fromCol;
    
    if (dr === 0) { // Ê®™ÁßªÂãï
      const start = Math.min(fromCol, toCol);
      const end = Math.max(fromCol, toCol);
      for (let c = start; c <= end; c++) {
        if (c !== fromCol) { // ÈñãÂßã‰ΩçÁΩÆ„ÅØÈô§Â§ñ
          const waveMark = createWaveMark(fromRow, c);
          waveMarks.push(waveMark);
          document.body.appendChild(waveMark);
        }
      }
    } else if (dc === 0) { // Á∏¶ÁßªÂãï
      const start = Math.min(fromRow, toRow);
      const end = Math.max(fromRow, toRow);
      for (let r = start; r <= end; r++) {
        if (r !== fromRow) { // ÈñãÂßã‰ΩçÁΩÆ„ÅØÈô§Â§ñ
          const waveMark = createWaveMark(r, fromCol);
          waveMarks.push(waveMark);
          document.body.appendChild(waveMark);
        }
      }
    }
    
    // ÁßªÂãïÂÖà„ÅÆÂë®Âõ≤„ÅÆÊïµÈßí„ÇíÁ´Ø„Åæ„ÅßÊäº„ÅóÊµÅ„Åô
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = toRow + d[0], nc = toCol + d[1];
      if (inBounds(nr, nc) && state.board[nr][nc] && state.board[nr][nc].owner !== state.currentPlayer && 
          state.board[nr][nc].piece !== 'X') {
        // ÊïµÈßí„ÇíÁ´Ø„Åæ„ÅßÊäº„ÅóÊµÅ„Åô
        let pushRow = nr, pushCol = nc;
        let steps = 0;
        
        while (inBounds(pushRow + d[0], pushCol + d[1]) && !state.board[pushRow + d[0]][pushCol + d[1]] && steps < 8) {
          pushRow += d[0];
          pushCol += d[1];
          steps++;
        }
        
        if (steps > 0) {
          const pushedPiece = state.board[nr][nc];
          state.board[pushRow][pushCol] = pushedPiece;
          state.board[nr][nc] = null;
          
          pushedPieces.push({
            from: {row: nr, col: nc},
            to: {row: pushRow, col: pushCol},
            piece: pushedPiece.piece,
            distance: steps
          });
          
          // Êäº„ÅóÊµÅ„Åó„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
          showPushEffect(nr, nc, pushRow, pushCol, pushedPiece.piece);
        }
      }
    });
    
    // Êäº„ÅóÊµÅ„Åï„Çå„ÅüÈßí„ÅÆÊÉÖÂ†±„Çí„É≠„Ç∞„Å´Âá∫Âäõ
    if (pushedPieces.length > 0) {
      console.log('üåä Ê≥¢„ÅÆ‰ºùÊí≠„ÅßÊäº„ÅóÊµÅ„Åï„Çå„ÅüÈßí:', pushedPieces);
      setStatus(`Ê≥¢„ÅÆ‰ºùÊí≠„Åß${pushedPieces.length}ÂÄã„ÅÆÊïµÈßí„ÇíÁ´Ø„Åæ„ÅßÊäº„ÅóÊµÅ„Åó„Åæ„Åó„ÅüÔºÅ`, 'playing');
    }
    
    // 1ÁßíÂæå„Å´Ê≥¢„Éû„Éº„ÇØ„ÇíÂâäÈô§
    setTimeout(() => {
      waveMarks.forEach(mark => {
        if (mark.parentNode) {
          mark.parentNode.removeChild(mark);
        }
      });
      
      // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
      render();
    }, 1000);
  }

  // Ê∞¥„Éû„Éº„ÇØË¶ÅÁ¥†„Çí‰ΩúÊàê
  function createWaterMark(row, col) {
    const waterMark = document.createElement('div');
    waterMark.className = 'water-mark';
    waterMark.textContent = 'üíß';
    waterMark.style.cssText = `
      position: fixed;
      font-size: 24px;
      z-index: 1000;
      pointer-events: none;
      animation: waterFlow 1s ease-in-out;
      filter: drop-shadow(0 0 8px #0066cc);
    `;
    
    // „Éú„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„Å´Âêà„Çè„Åõ„Å¶ÈÖçÁΩÆ
    const boardElement = document.querySelector('.board');
    if (boardElement) {
      const boardRect = boardElement.getBoundingClientRect();
      const cellSize = boardRect.width / 9;
      const left = boardRect.left + col * cellSize + cellSize / 2 - 12;
      const top = boardRect.top + row * cellSize + cellSize / 2 - 12;
      waterMark.style.left = left + 'px';
      waterMark.style.top = top + 'px';
    }
    
    return waterMark;
  }

  // Ê≥¢„Éû„Éº„ÇØË¶ÅÁ¥†„Çí‰ΩúÊàê
  function createWaveMark(row, col) {
    const waveMark = document.createElement('div');
    waveMark.className = 'wave-mark';
    waveMark.textContent = 'üåä';
    waveMark.style.cssText = `
      position: fixed;
      font-size: 24px;
      z-index: 1000;
      pointer-events: none;
      animation: waveFlow 1s ease-in-out;
      filter: drop-shadow(0 0 8px #0099cc);
    `;
    
    // „Éú„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„Å´Âêà„Çè„Åõ„Å¶ÈÖçÁΩÆ
    const boardElement = document.querySelector('.board');
    if (boardElement) {
      const boardRect = boardElement.getBoundingClientRect();
      const cellSize = boardRect.width / 9;
      const left = boardRect.left + col * cellSize + cellSize / 2 - 12;
      const top = boardRect.top + row * cellSize + cellSize / 2 - 12;
      waveMark.style.left = left + 'px';
      waveMark.style.top = top + 'px';
    }
    
    return waveMark;
  }

  // Êäº„ÅóÊµÅ„Åó„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
  function showPushEffect(fromRow, fromCol, toRow, toCol, pieceName) {
    const pushMark = document.createElement('div');
    pushMark.className = 'push-mark';
    pushMark.textContent = '‚û°Ô∏è';
    pushMark.style.cssText = `
      position: fixed;
      font-size: 20px;
      z-index: 1002;
      pointer-events: none;
      animation: pushEffect 0.8s ease-in-out;
      filter: drop-shadow(0 0 6px #00cc00);
    `;
    
    // Êäº„ÅóÊµÅ„Åó„ÅÆÊñπÂêë„Å´Áü¢Âç∞„ÇíÈÖçÁΩÆ
    const boardElement = document.querySelector('.board');
    if (boardElement) {
      const boardRect = boardElement.getBoundingClientRect();
      const cellSize = boardRect.width / 9;
      const left = boardRect.left + fromCol * cellSize + cellSize / 2 - 10;
      const top = boardRect.top + fromRow * cellSize + cellSize / 2 - 10;
      pushMark.style.left = left + 'px';
      pushMark.style.top = top + 'px';
    }
    
    document.body.appendChild(pushMark);
    
    // 0.8ÁßíÂæå„Å´Êäº„ÅóÊµÅ„Åó„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂâäÈô§
    setTimeout(() => {
      if (pushMark.parentNode) {
        pushMark.parentNode.removeChild(pushMark);
      }
    }, 800);
  }

  function computerTurn(){
    if (state.gameOver || state.currentPlayer !== 'computer') return;
    
    // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆ„Çø„Éº„É≥ÈñãÂßãÊôÇ„Å´ÊôÇÈñìÂÅúÊ≠¢ÂäπÊûú„ÇíËß£Èô§
    clearTimeStopEffects();
    
    console.log('ü§ñ „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆ„Çø„Éº„É≥ÈñãÂßã');
    
    // „Çπ„ÉÜ„Éº„Ç∏28„ÅÆÂ†¥Âêà„ÄÅÂÆöÊúüÁöÑ„Å´„ÄåÂÆ∂„ÄçÈßí„ÅÆ„Çπ„Ç≠„É´„Çí‰ΩøÁî®
    if (state.stageIndex === 27) { // „Çπ„ÉÜ„Éº„Ç∏28 (0-indexed)
      const housePieces = findComputerHousePieces();
      if (housePieces.length > 0) {
        const shouldUseHouseSkill = shouldComputerUseHouseSkillPeriodically();
        if (shouldUseHouseSkill) {
          const randomHouse = housePieces[Math.floor(Math.random() * housePieces.length)];
          console.log(`üè† „Çπ„ÉÜ„Éº„Ç∏28: ÂÆöÊúüÁöÑ„Å´ÂÆ∂„ÅÆ„Çπ„Ç≠„É´„Çí‰ΩøÁî®„Åó„Åæ„Åô`);
          triggerHouseSkill(randomHouse.r, randomHouse.c);
          return;
        }
      }
    }
    

    
    // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéã„Å´ÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÁ∞°ÊòìÁâàÔºâ
    const isComputerInCheck = isComputerKingInCheckFast();
    if (isComputerInCheck) {
      console.log('‚ö†Ô∏è „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéã„Å´ÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Åæ„Åô');
      
      // ÁéãÊâãÂõûÈÅøÊâã„ÇíÂç≥Â∫ß„Å´Êé¢Á¥¢„Åó„Å¶ÂÆüË°å
      const defenseMove = findComputerCheckmateDefenseMove();
      
      if (!defenseMove) {
        console.log('üíÄ „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéãÊâãÁ©ç„Åø„Åß„ÅôÔºÅ');
        setStatus('ÁéãÊâãÁ©ç„ÅøÔºÅ„Ç≥„É≥„Éî„É•„Éº„Çø„ÅåÈôçÂèÇ„Åó„Åæ„Åó„Åü', 'win');
        state.gameOver = true;
        
        // „Çπ„ÉÜ„Éº„Ç∏„ÇØ„É™„Ç¢„ÇíË®òÈå≤
        saveStageClear();
        
        render();
        return;
      } else {
        console.log(`üõ°Ô∏è ÁéãÊâãÂõûÈÅøÊâã„ÇíÂç≥Â∫ß„Å´ÂÆüË°å: ${defenseMove.piece} at [${defenseMove.r}][${defenseMove.c}] ‚Üí [${defenseMove.move.r}][${defenseMove.move.c}]`);
        makeMove(defenseMove.r, defenseMove.c, defenseMove.move.r, defenseMove.move.c);
        
        // Ëæ∞„ÅÆ„Çπ„Ç≠„É´ÔºöÁßªÂãïÊôÇ10ÔºÖ„ÅÆÁ¢∫Áéá„ÅßÂë®Âõ≤8„Éû„Çπ„ÅÆÊïµÈßí„Çí„É©„É≥„ÉÄ„É†„Å´1„Å§Ê∂àÊªÖ
        if (defenseMove.piece === 'Ëæ∞') {
          triggerDragonAwakenedSkill(defenseMove.move.r, defenseMove.move.c, 'computer');
        }
        
        // KÂçöÂ£´„ÅÆ„Çπ„Ç≠„É´ÔºöÁßªÂãïÊôÇ40ÔºÖ„ÅÆÁ¢∫Áéá„ÅßÂÆüÈ®ì‰Ωì„ÇíÂè¨Âñö
        if (defenseMove.piece === 'K') {
          triggerKSkill(defenseMove.move.r, defenseMove.move.c, 'computer');
        }
        return;
      }
    }
    
    // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÈßí„ÇíÊé¢„ÅôÔºàÈ´òÈÄüÂåñÔºâ
    const computerPieces = [];
    let totalComputerPieces = 0;
    let timeStoppedPieces = 0;
    
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'computer') {
          totalComputerPieces++;
          
          // ÊôÇÈñìÂÅúÊ≠¢Áä∂ÊÖã„ÅÆÈßí„ÅØÈô§Â§ñ
          if (piece.isTimeStopped) {
            timeStoppedPieces++;
            console.log(`‚è∞ ÊôÇÈñìÂÅúÊ≠¢Áä∂ÊÖã„ÅÆÈßí: ${piece.piece} at [${r}][${c}]`);
            continue;
          }
          
          const moves = getValidMoves(r, c);
          if (moves.length > 0) {
            computerPieces.push({r, c, moves, piece: piece.piece});
            console.log(`‚úÖ Âãï„Åã„Åõ„ÇãÈßí: ${piece.piece} at [${r}][${c}] (${moves.length}Êâã)`);
          } else {
            console.log(`‚ùå ÁßªÂãï„Åß„Åç„Å™„ÅÑÈßí: ${piece.piece} at [${r}][${c}]`);
          }
        }
      }
    }
    
    console.log(`üìä „Ç≥„É≥„Éî„É•„Éº„ÇøÈßíÁä∂Ê≥Å: Á∑èÊï∞${totalComputerPieces}, ÊôÇÈñìÂÅúÊ≠¢${timeStoppedPieces}, Âãï„Åã„Åõ„Çã${computerPieces.length}`);
    
    if (computerPieces.length === 0) {
      // Âãï„Åã„Åõ„ÇãÈßí„Åå„Å™„ÅÑÂ†¥ÂêàÔºàÂÖ®„Å¶„ÅÆÈßí„ÅåÊôÇÈñìÂÅúÊ≠¢Áä∂ÊÖã„Å™„Å©Ôºâ
      console.log('‚ùå „Ç≥„É≥„Éî„É•„Éº„Çø„ÅåÂãï„Åã„Åõ„ÇãÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
      state.currentPlayer = 'player';
      setStatus('„ÅÇ„Å™„Åü„ÅÆÊâãÁï™', 'playing');
      render();
      return;
    }
    
    // È´òÈÄüÂåñ„Åï„Çå„ÅüÊà¶Áï•ÁöÑ„Å™Êâã„ÇíÈÅ∏Êäû
    const bestMove = selectBestMoveFast(computerPieces, 100); // 100ms„ÅßÂà§ÂÆö
    
    if (!bestMove) {
      console.log('‚ùå ÊúÄÈÅ©„Å™Êâã„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
      // „É©„É≥„ÉÄ„É†„Å´Èßí„ÇíÂãï„Åã„Åô
      if (computerPieces.length > 0) {
        const randomPiece = computerPieces[Math.floor(Math.random() * computerPieces.length)];
        const randomMove = randomPiece.moves[Math.floor(Math.random() * randomPiece.moves.length)];
        console.log(`üé≤ „É©„É≥„ÉÄ„É†ÊâãÈÅ∏Êäû: ${randomPiece.piece} at [${randomPiece.r}][${randomPiece.c}] ‚Üí [${randomMove.r}][${randomMove.c}]`);
        makeMove(randomPiece.r, randomPiece.c, randomMove.r, randomMove.c);
        
        // ÁßªÂãïÂæå„Å´ÁéãÊâãÂà§ÂÆöÔºàÁéãÊâãÁ©ç„Åø„Åß„Å™„ÅÑÂ†¥Âêà„ÅØ„Éó„É¨„Ç§„É§„Éº„ÅÆÁï™„Å´Âõû„ÅôÔºâ
        setTimeout(() => {
          // „Ç≤„Éº„É†„ÅåÊó¢„Å´ÁµÇ‰∫Ü„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
          if (state.gameOver) {
            return;
          }
          
          // ÁéãÊâãÁ©ç„ÅøÂà§ÂÆöÔºàÂâäÈô§Ê∏à„ÅøÔºâ
          if (isKingInDangerFast()) {
            // ÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Çã„ÅåÁéãÊâãÁ©ç„Åø„Åß„ÅØ„Å™„ÅÑÂ†¥Âêà
            setStatus('ÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Åæ„ÅôÔºÅ„ÅÇ„Å™„Åü„ÅÆÁï™„Åß„Åô', 'warning');
            state.currentPlayer = 'player';
            render();
          } else {
            // ÈÄöÂ∏∏„ÅÆÊâãÁï™‰∫§‰ª£
            state.currentPlayer = 'player';
            setStatus('„ÅÇ„Å™„Åü„ÅÆÊâãÁï™', 'playing');
            render();
          }
        }, 100);
      } else {
        console.log('‚ùå Âãï„Åã„Åõ„ÇãÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
        state.currentPlayer = 'player';
        setStatus('„ÅÇ„Å™„Åü„ÅÆÊâãÁï™', 'playing');
        render();
      }
      return;
    }
    
    console.log(`üéØ ÈÅ∏Êäû„Åï„Çå„ÅüÊâã: ${bestMove.piece} at [${bestMove.r}][${bestMove.c}] ‚Üí [${bestMove.move.r}][${bestMove.move.c}]`);
    
    // „ÄåÊôÇ„Äç„ÅÆÈßí„ÅÆÂ†¥Âêà„ÄÅ„Çπ„Ç≠„É´‰ΩøÁî®„ÇíÊ§úË®é
    if (bestMove && state.board[bestMove.r][bestMove.c].piece === 'ÊôÇ') {
      const shouldUseSkill = shouldComputerUseTimeSkill(bestMove.r, bestMove.c);
      if (shouldUseSkill) {
        // „Ç≥„É≥„Éî„É•„Éº„Çø„Åå„ÄåÊôÇ„Äç„ÅÆ„Çπ„Ç≠„É´„Çí‰ΩøÁî®
        activateComputerTimeSkill(bestMove.r, bestMove.c);
        return;
      }
    }
    
    // „ÄåÊõ∏„Äç„ÅÆÈßí„ÅÆÂ†¥Âêà„ÄÅ„Çπ„Ç≠„É´‰ΩøÁî®„ÇíÊ§úË®é
    if (bestMove && state.board[bestMove.r][bestMove.c].piece === 'Êõ∏') {
      console.log('üìö Êõ∏„ÅÆÈßí„ÇíÈÅ∏Êäû„ÄÅ„Çπ„Ç≠„É´‰ΩøÁî®„ÇíÊ§úË®é‰∏≠...');
      const shouldUseSkill = shouldComputerUseBookSkill(bestMove.r, bestMove.c);
      if (shouldUseSkill) {
        console.log('üìö Êõ∏„ÅÆ„Çπ„Ç≠„É´„Çí‰ΩøÁî®„Åó„Åæ„Åô');
        // „Ç≥„É≥„Éî„É•„Éº„Çø„Åå„ÄåÊõ∏„Äç„ÅÆ„Çπ„Ç≠„É´„Çí‰ΩøÁî®
        activateComputerBookSkill(bestMove.r, bestMove.c);
        // „Çπ„Ç≠„É´‰ΩøÁî®Âæå„ÅØÊâãÁï™ÁßªË°åÂá¶ÁêÜ„ÅåÈñ¢Êï∞ÂÜÖ„ÅßË°å„Çè„Çå„Çã„Åü„ÇÅ„ÄÅ„Åì„Åì„ÅßÁµÇ‰∫Ü
        return;
      } else {
        console.log('üìö Êõ∏„ÅÆ„Çπ„Ç≠„É´„Çí‰ΩøÁî®„Åó„Åæ„Åõ„Çì');
      }
    }
    
    // „ÄåÂ∞Å„Äç„ÅÆÈßí„ÅÆÂ†¥Âêà„ÄÅ„Çπ„Ç≠„É´‰ΩøÁî®„ÇíÊ§úË®é
    if (bestMove && state.board[bestMove.r][bestMove.c].piece === 'Â∞Å') {
      console.log('üîí Â∞Å„ÅÆÈßí„ÇíÈÅ∏Êäû„ÄÅ„Çπ„Ç≠„É´‰ΩøÁî®„ÇíÊ§úË®é‰∏≠...');
      const shouldUseSkill = shouldComputerUseSealSkill(bestMove.r, bestMove.c);
      if (shouldUseSkill) {
        console.log('üîí Â∞Å„ÅÆ„Çπ„Ç≠„É´„Çí‰ΩøÁî®„Åó„Åæ„Åô');
        // „Ç≥„É≥„Éî„É•„Éº„Çø„Åå„ÄåÂ∞Å„Äç„ÅÆ„Çπ„Ç≠„É´„Çí‰ΩøÁî®
        activateComputerSealSkill(bestMove.r, bestMove.c);
        // „Çπ„Ç≠„É´‰ΩøÁî®Âæå„ÅØÊâãÁï™ÁßªË°åÂá¶ÁêÜ„ÅåÈñ¢Êï∞ÂÜÖ„ÅßË°å„Çè„Çå„Çã„Åü„ÇÅ„ÄÅ„Åì„Åì„ÅßÁµÇ‰∫Ü
        return;
      } else {
        console.log('üîí Â∞Å„ÅÆ„Çπ„Ç≠„É´„Çí‰ΩøÁî®„Åó„Åæ„Åõ„Çì');
      }
    }
    
    // „ÄåÂÆ∂„Äç„ÅÆÈßí„ÅÆÂ†¥Âêà„ÄÅ„Çπ„Ç≠„É´‰ΩøÁî®„ÇíÊ§úË®é
    if (bestMove && state.board[bestMove.r][bestMove.c].piece === 'ÂÆ∂') {
      const shouldUseSkill = shouldComputerUseHouseSkill(bestMove.r, bestMove.c);
      if (shouldUseSkill) {
        // „Ç≥„É≥„Éî„É•„Éº„Çø„Åå„ÄåÂÆ∂„Äç„ÅÆ„Çπ„Ç≠„É´„Çí‰ΩøÁî®
        triggerHouseSkill(bestMove.r, bestMove.c);
        return;
      }
    }
    
    // „ÄåÁïë„Äç„ÅÆÈßí„ÅÆÂ†¥Âêà„ÄÅ„Çπ„Ç≠„É´‰ΩøÁî®„ÇíÊ§úË®é
    if (bestMove && state.board[bestMove.r][bestMove.c].piece === 'Áïë') {
      const shouldUseSkill = shouldComputerUseFieldSkill(bestMove.r, bestMove.c);
      if (shouldUseSkill) {
        // „Ç≥„É≥„Éî„É•„Éº„Çø„Åå„ÄåÁïë„Äç„ÅÆ„Çπ„Ç≠„É´„Çí‰ΩøÁî®
        triggerFieldSkill(bestMove.r, bestMove.c);
        return;
      }
    }
    
    // ÁßªÂãï„ÇíÂÆüË°å
    makeMove(bestMove.r, bestMove.c, bestMove.move.r, bestMove.move.c);
    
    // Ëæ∞„ÅÆ„Çπ„Ç≠„É´ÔºöÁßªÂãïÊôÇ10ÔºÖ„ÅÆÁ¢∫Áéá„ÅßÂë®Âõ≤8„Éû„Çπ„ÅÆÊïµÈßí„Çí„É©„É≥„ÉÄ„É†„Å´1„Å§Ê∂àÊªÖ
    if (bestMove.piece === 'Ëæ∞') {
      triggerDragonAwakenedSkill(bestMove.move.r, bestMove.move.c, 'computer');
    }
    
    // KÂçöÂ£´„ÅÆ„Çπ„Ç≠„É´ÔºöÁßªÂãïÊôÇ40ÔºÖ„ÅÆÁ¢∫Áéá„ÅßÂÆüÈ®ì‰Ωì„ÇíÂè¨Âñö
    if (bestMove.piece === 'K') {
      triggerKSkill(bestMove.move.r, bestMove.move.c, 'computer');
    }
    
    // ÁßªÂãïÂæå„Å´ÁéãÊâãÂà§ÂÆöÔºàÁéãÊâãÁ©ç„Åø„Åß„Å™„ÅÑÂ†¥Âêà„ÅØ„Éó„É¨„Ç§„É§„Éº„ÅÆÁï™„Å´Âõû„ÅôÔºâ
    setTimeout(() => {
      // „Ç≤„Éº„É†„ÅåÊó¢„Å´ÁµÇ‰∫Ü„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
      if (state.gameOver) {
        return;
      }
      
      // ÁéãÊâãÁ©ç„ÅøÂà§ÂÆöÔºàÂâäÈô§Ê∏à„ÅøÔºâ
      if (isKingInDangerFast()) {
        // ÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Çã„ÅåÁéãÊâãÁ©ç„Åø„Åß„ÅØ„Å™„ÅÑÂ†¥Âêà
        setStatus('ÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Åæ„ÅôÔºÅ„ÅÇ„Å™„Åü„ÅÆÁï™„Åß„Åô', 'warning');
        state.currentPlayer = 'player';
        render();
      } else {
        // ÈÄöÂ∏∏„ÅÆÊâãÁï™‰∫§‰ª£
        state.currentPlayer = 'player';
        setStatus('„ÅÇ„Å™„Åü„ÅÆÊâãÁï™', 'playing');
        render();
      }
    }, 100);
  }

  // ÊúÄÈÅ©„Å™Êâã„ÇíÈÅ∏Êäû„Åô„ÇãÈñ¢Êï∞ÔºàË∂ÖÈ´òÈÄüÂåñÁâà„ÉªÁéã„ÅÆÁßªÂãïÊúÄÂÑ™ÂÖàÂ∫¶ÊúÄ‰ΩéÂåñ„ÉªÁéãÊâãÂõûÈÅøÊúÄÂÑ™ÂÖàÔºâ
  function selectBestMoveFast(computerPieces, remainingTime) {
    const startTime = Date.now();
    const maxThinkingTime = Math.max(remainingTime, 100); // ÊúÄ‰Ωé100ms„ÅØÊÄùËÄÉÊôÇÈñì„ÇíÁ¢∫‰øù
    
    let bestScore = -Infinity;
    let bestMove = null;
    let kingMoveScore = -Infinity;
    let kingMove = null;
    let checkmateDefenseScore = -Infinity;
    let checkmateDefenseMove = null;
    // Âèñ„ÇäÊúÄÂÑ™ÂÖàÁî®„ÅÆ‰∏ÄÊôÇË®òÈå≤
    let bestCapture = null;
    let bestCaptureValue = -Infinity;
    let bestKingCapture = null;
    let bestKingCaptureValue = -Infinity;
    
    // ÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÊúÄÂÑ™ÂÖàÔºâ
    const isInCheck = isKingInDangerFast();
    console.log(`üëë ÁéãÊâã„ÉÅ„Çß„ÉÉ„ÇØ: ${isInCheck ? 'ÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Åæ„Åô' : 'ÁéãÊâã„ÅØ„Åã„Åã„Å£„Å¶„ÅÑ„Åæ„Åõ„Çì'}`);
    
    // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÊúÄÂÑ™ÂÖà„ÉªÈ´òÈÄüÁâàÔºâ
    const isComputerInCheck = isComputerKingInCheckFast();
    console.log(`ü§ñ „Ç≥„É≥„Éî„É•„Éº„ÇøÁéãÊâã„ÉÅ„Çß„ÉÉ„ÇØ: ${isComputerInCheck ? 'ÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Åæ„Åô' : 'ÁéãÊâã„ÅØ„Åã„Åã„Å£„Å¶„ÅÑ„Åæ„Åõ„Çì'}`);
    
    // ÂêÑÈßí„ÅÆÂêÑÁßªÂãï„Å´„Å§„ÅÑ„Å¶Ë©ï‰æ°ÔºàÊôÇÈñìÂà∂Èôê‰ªò„Åç„ÉªÁéã„ÅÆÁßªÂãïÂàÜÈõ¢„ÉªÁéãÊâãÂõûÈÅøÊúÄÂÑ™ÂÖàÔºâ
    for (const piece of computerPieces) {
      for (const move of piece.moves) {
        let score = 0;
        try {
          score = evaluateMoveFast(piece, move);
        } catch (error) {
          console.error(`‚ùå ÁßªÂãïË©ï‰æ°„Ç®„É©„Éº: ${piece.piece} at [${piece.r}][${piece.c}] ‚Üí [${move.r}][${move.c}]`, error);
          score = 0; // „Ç®„É©„ÉºÊôÇ„ÅØ„Çπ„Ç≥„Ç¢0„ÅßÁ∂öË°å
        }
        
        // Âèñ„ÇäÊâã„ÇíÂèéÈõÜÔºàÁéã„ÅØÂà•Êâ±„ÅÑ„ÉªÂπª„ÅÆÂõûÈÅø„Çπ„Ç≠„É´ËÄÉÊÖÆÔºâ
        const target = state.board[move.r][move.c];
        if (target && target.piece !== 'X' && target.owner === 'player') {
          let value = getPieceValue(target.piece);
          
          // Âπª„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÂõûÈÅø„Çπ„Ç≠„É´„ÇíËÄÉÊÖÆÔºà50%„ÅÆÁ¢∫Áéá„ÅßÂ§±ÊïóÔºâ
          if (target.piece === 'Âπª') {
            value = value * 0.5; // ÂõûÈÅø„Çπ„Ç≠„É´„ÇíËÄÉÊÖÆ„Åó„Å¶‰æ°ÂÄ§„ÇíÂçäÂàÜ„Å´
            console.log(`‚ú® Âπª„ÅÆÈßíÂèñ„ÇäÊâã: ÂõûÈÅø„Çπ„Ç≠„É´ËÄÉÊÖÆ„Åß‰æ°ÂÄ§„Çí${value}„Å´Ë™øÊï¥`);
          }
          
          if (piece.piece === 'Áéã' || piece.piece === 'Áéâ') {
            if (value > bestKingCaptureValue) {
              bestKingCaptureValue = value;
              bestKingCapture = { r: piece.r, c: piece.c, move: move, piece: piece.piece };
            }
          } else {
            if (value > bestCaptureValue) {
              bestCaptureValue = value;
              bestCapture = { r: piece.r, c: piece.c, move: move, piece: piece.piece };
            }
          }
        }
        
        // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéãÊâãÂõûÈÅø„ÅÆÁßªÂãï„ÇíÊúÄÂÑ™ÂÖà„ÅßË®òÈå≤ÔºàÈ´òÈÄüÁâàÔºâ
        if (isComputerInCheck && canComputerPreventCheckmateFast(piece.r, piece.c, move)) {
          console.log(`üõ°Ô∏è „Ç≥„É≥„Éî„É•„Éº„ÇøÁéãÊâãÂõûÈÅøÊâãÁô∫Ë¶ã: ${piece.piece} at [${piece.r}][${piece.c}] ‚Üí [${move.r}][${move.c}]`);
          // ÁéãÊâãÂõûÈÅøÊâã„ÅØÊúÄÈ´òÂÑ™ÂÖàÂ∫¶Ôºà100000ÁÇπÔºâ
          const defenseScore = 100000 + score;
          if (defenseScore > checkmateDefenseScore) {
            checkmateDefenseScore = defenseScore;
            checkmateDefenseMove = { r: piece.r, c: piece.c, move: move };
          }
          continue; // ÁéãÊâãÂõûÈÅø„ÅåË¶ã„Å§„Åã„Å£„Åü„Çâ‰ªñ„ÅÆË©ï‰æ°„Çí„Çπ„Ç≠„ÉÉ„Éó
        }
        
        // „Éó„É¨„Ç§„É§„Éº„ÅÆÁéãÊâãÂõûÈÅø„ÅÆÁßªÂãï„ÇíË®òÈå≤
        if (isInCheck && preventsCheckFast(piece, move)) {
          console.log(`üõ°Ô∏è ÁéãÊâãÂõûÈÅøÊâãÁô∫Ë¶ã: ${piece.piece} at [${piece.r}][${piece.c}] ‚Üí [${move.r}][${move.c}]`);
          if (score > checkmateDefenseScore) {
            checkmateDefenseScore = score;
            checkmateDefenseMove = { r: piece.r, c: piece.c, move: move };
          }
          continue; // ÁéãÊâãÂõûÈÅø„ÅåË¶ã„Å§„Åã„Å£„Åü„Çâ‰ªñ„ÅÆË©ï‰æ°„Çí„Çπ„Ç≠„ÉÉ„Éó
        }
        
        // Áéã„ÅÆÁßªÂãï„Å®‰ªñ„ÅÆÈßí„ÅÆÁßªÂãï„ÇíÂàÜÈõ¢
        if (piece.piece === 'Áéã' || piece.piece === 'Áéâ') {
          // Áéã„ÅÆÁßªÂãï„ÅØÂà•ÈÄîË®òÈå≤ÔºàÊúÄÂÑ™ÂÖàÂ∫¶ÊúÄ‰ΩéÔºâ
          if (score > kingMoveScore) {
            kingMoveScore = score;
            kingMove = { r: piece.r, c: piece.c, move: move };
          }
        } else {
          // ‰ªñ„ÅÆÈßí„ÅÆÁßªÂãï„ÅØÈÄöÂ∏∏Ë©ï‰æ°
          if (score > bestScore) {
            bestScore = score;
            bestMove = { r: piece.r, c: piece.c, move: move };
          }
        }
      }
      
      // ÊÄùËÄÉÊôÇÈñì„ÉÅ„Çß„ÉÉ„ÇØ
      if (Date.now() - startTime > maxThinkingTime) {
        break; // ÊôÇÈñìÂàá„Çå
      }
    }
    
    // 1. „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéãÊâãÂõûÈÅø„ÅÆÁßªÂãï„ÇíÊúÄÂÑ™ÂÖà„ÅßÈÅ∏Êäû
    if (checkmateDefenseMove && isComputerInCheck) {
      console.log(`üõ°Ô∏è „Ç≥„É≥„Éî„É•„Éº„ÇøÁéãÊâãÂõûÈÅøÊâã„ÇíÈÅ∏Êäû: ${checkmateDefenseMove.piece} at [${checkmateDefenseMove.r}][${checkmateDefenseMove.c}] ‚Üí [${checkmateDefenseMove.move.r}][${checkmateDefenseMove.move.c}]`);
      return checkmateDefenseMove;
    }

    // 1.5 Âèñ„ÇäÊâã„ÇíÊúÄÂÑ™ÂÖà„ÅßÈÅ∏ÊäûÔºàÁéã‰ª•Â§ñ‚ÜíÁéã„ÅÆÈ†ÜÔºâ
    if (bestCapture) {
      console.log(`‚öîÔ∏è Âèñ„ÇäÊâã„ÇíÈÅ∏Êäû: ${bestCapture.piece} at [${bestCapture.r}][${bestCapture.c}] ‚Üí [${bestCapture.move.r}][${bestCapture.move.c}]`);
      return bestCapture;
    }
    if (bestKingCapture) {
      console.log(`üëë‚öîÔ∏è Áéã„ÅÆÂèñ„ÇäÊâã„ÇíÈÅ∏Êäû: ${bestKingCapture.piece} at [${bestKingCapture.r}][${bestKingCapture.c}] ‚Üí [${bestKingCapture.move.r}][${bestKingCapture.move.c}]`);
      return bestKingCapture;
    }
    
    // 2. ‰ªñ„ÅÆÈßí„ÅÆÁßªÂãï„ÅåÂèØËÉΩ„Å™Â†¥Âêà„ÅØ„ÄÅÁéã„ÅÆÁßªÂãï„ÇíÈô§Â§ñ
    if (bestMove) {
      console.log(`‚úÖ ÈÄöÂ∏∏Êâã„ÇíÈÅ∏Êäû: ${bestMove.piece} at [${bestMove.r}][${bestMove.c}] ‚Üí [${bestMove.move.r}][${bestMove.move.c}]`);
      return bestMove;
    }
    
    // 3. ‰ªñ„ÅÆÈßí„ÅÆÁßªÂãï„Åå‰∏çÂèØËÉΩ„Å™Â†¥Âêà„ÅÆ„Åø„ÄÅÁéã„ÅÆÁßªÂãï„ÇíÈÅ∏Êäû
    if (kingMove) {
      console.log(`üëë Áéã„ÅÆÁßªÂãï„ÇíÈÅ∏Êäû: ${kingMove.piece} at [${kingMove.r}][${kingMove.c}] ‚Üí [${kingMove.move.r}][${kingMove.move.c}]`);
      return kingMove;
    }
    
    // ÊúÄÈÅ©„Å™Êâã„ÅåË¶ã„Å§„Åã„Çâ„Å™„ÅÑÂ†¥Âêà„ÅØ„É©„É≥„ÉÄ„É†ÈÅ∏ÊäûÔºàÁéã‰ª•Â§ñ„ÇíÂÑ™ÂÖàÔºâ
    if (computerPieces.length > 0) {
      console.log('üé≤ „É©„É≥„ÉÄ„É†ÈÅ∏Êäû„Å´„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ');
      // Áéã‰ª•Â§ñ„ÅÆÈßí„ÇíÂÑ™ÂÖàÁöÑ„Å´ÈÅ∏Êäû
      const nonKingPieces = computerPieces.filter(p => p.piece !== 'Áéã' && p.piece !== 'Áéâ');
      if (nonKingPieces.length > 0) {
        const randomPiece = nonKingPieces[Math.floor(Math.random() * nonKingPieces.length)];
        const randomMove = randomPiece.moves[Math.floor(Math.random() * randomPiece.moves.length)];
        return { r: randomPiece.r, c: randomPiece.c, move: randomMove, piece: randomPiece.piece };
      }
      
      // Áéã„Åó„ÅãÂãï„Åã„Åõ„Å™„ÅÑÂ†¥Âêà„ÅØÁéã„ÇíÈÅ∏Êäû
      const randomPiece = computerPieces[Math.floor(Math.random() * computerPieces.length)];
      const randomMove = randomPiece.moves[Math.floor(Math.random() * randomPiece.moves.length)];
      return { r: randomPiece.r, c: randomPiece.c, move: randomMove, piece: randomPiece.piece };
    }
    
    console.log('‚ùå ÈÅ∏ÊäûÂèØËÉΩ„Å™Êâã„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
    console.log(`üìä „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±: computerPieces.length=${computerPieces.length}, bestMove=${bestMove}, kingMove=${kingMove}, checkmateDefenseMove=${checkmateDefenseMove}`);
    return null;
  }

  // È´òÈÄüÂåñ„Åï„Çå„ÅüÁßªÂãïË©ï‰æ°ÔºàÊîªÂÆà„Éê„É©„É≥„ÇπÁâàÔºâ
  function evaluateMoveFast(piece, move) {
    let score = 0;
    
    // 0. Áéã„ÅÆÂÆâÂÖ®Á¢∫‰øùÔºàÊúÄÂÑ™ÂÖà„ÉªË∂ÖÈ´òÈÄüÂåñÔºâ
    if (isKingInDangerFast()) {
      score += evaluateKingSafetyFast(piece, move);
      if (score > 0) return score;
    }
    
    // 1. ÁéãÊâã„ÅÆË©ï‰æ°ÔºàÊúÄÈ´òÁÇπ„ÉªÂ§ßÂπÖÂº∑ÂåñÔºâ
    if (isCheck(move.r, move.c)) {
      score += 50000; // 15000„Åã„Çâ50000„Å´Â§ßÂπÖÂº∑Âåñ
      console.log(`üëë ÁéãÊâãÊâãÁô∫Ë¶ã: ${piece.piece} at [${piece.r}][${piece.c}] ‚Üí [${move.r}][${move.c}] („Çπ„Ç≥„Ç¢: +50000)`);
    }
    
    // 2. Èßí„ÇíÂèñ„ÇãË©ï‰æ°ÔºàÈ´òÈÄüÂåñ„ÉªÂº∑Âåñ„ÉªÂπª„ÅÆÂõûÈÅø„Çπ„Ç≠„É´ËÄÉÊÖÆÔºâ
    const targetPiece = state.board[move.r][move.c];
    if (targetPiece) {
      let pieceValue = getPieceValue(targetPiece.piece);
      
      // Âπª„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÂõûÈÅø„Çπ„Ç≠„É´„ÇíËÄÉÊÖÆÔºà50%„ÅÆÁ¢∫Áéá„ÅßÂ§±ÊïóÔºâ
      if (targetPiece.piece === 'Âπª') {
        pieceValue = pieceValue * 0.5; // ÂõûÈÅø„Çπ„Ç≠„É´„ÇíËÄÉÊÖÆ„Åó„Å¶‰æ°ÂÄ§„ÇíÂçäÂàÜ„Å´
        console.log(`‚ú® Âπª„ÅÆÈßí„ÇíÂèñ„ÇãÊâã: ÂõûÈÅø„Çπ„Ç≠„É´ËÄÉÊÖÆ„Åß‰æ°ÂÄ§„Çí${pieceValue}„Å´Ë™øÊï¥`);
      }
      
      score += pieceValue * 100; // 50„Åã„Çâ100„Å´Âº∑Âåñ
    }
    
    // 3. Èßí„ÅÆ‰æ°ÂÄ§„Å´„Çà„ÇãË©ï‰æ°ÔºàÁéã„ÅÆÈÅéÂ∫¶ÁßªÂãïÈò≤Ê≠¢Ôºâ
    if (piece.piece === 'Áéã' || piece.piece === 'Áéâ') {
      score += getPieceValue(piece.piece) * 0.5; // Áéã„ÅÆÁßªÂãï„ÇíÊäëÂà∂
    } else {
      score += getPieceValue(piece.piece);
    }
    
    // 4. ‰ΩçÁΩÆ„Å´„Çà„ÇãË©ï‰æ°ÔºàË∂ÖÈ´òÈÄüÂåñ„ÉªÊîªÊíÉÈáçË¶ñ„ÉªÂ§ßÂπÖÂº∑ÂåñÔºâ
    score += evaluatePositionAttackFocused(move.r, move.c, piece.piece) * 10; // 5„Åã„Çâ10„Å´Âº∑Âåñ
    
    // 5. ÂÆâÂÖ®„Å™‰ΩçÁΩÆ„ÅÆË©ï‰æ°ÔºàÂÆàÂÇôÈáçË¶ñ„ÉªÁéã„ÅÆÁßªÂãïÊäëÂà∂Ôºâ
    if (isSafePositionFast(move.r, move.c)) {
      if (piece.piece === 'Áéã' || piece.piece === 'Áéâ') {
        score += 10; // Áéã„ÅÆÂÆâÂÖ®ÁßªÂãï„ÅØ‰ΩéË©ï‰æ°
      } else {
        score += 30; // ‰ªñ„ÅÆÈßí„ÅÆÂÆâÂÖ®ÁßªÂãï„ÅØÈ´òË©ï‰æ°
      }
    }
    
    // 6. ÊîªÊíÉÁöÑ„Å™‰ΩçÁΩÆ„ÅÆË©ï‰æ°ÔºàÂ§ßÂπÖÂº∑Âåñ„ÉªÁéã„ÅÆÁßªÂãïÊäëÂà∂Ôºâ
    if (isAttackingPosition(move.r, move.c)) {
      if (piece.piece === 'Áéã' || piece.piece === 'Áéâ') {
        score += 2; // Áéã„ÅÆÊîªÊíÉÁßªÂãï„ÅØÂ§ßÂπÖ‰ΩéË©ï‰æ°
      } else {
        score += 150; // 80„Åã„Çâ150„Å´Â§ßÂπÖÂº∑Âåñ
      }
    }
    
    // 7. ÊïµÁéã„Å∏„ÅÆÊé•ËøëË©ï‰æ°ÔºàÂ§ßÂπÖÂº∑Âåñ„ÉªÊîªÊíÉÈáçË¶ñ„ÉªÁéã„ÅÆÁßªÂãïÊäëÂà∂Ôºâ
    if (piece.piece === 'Áéã' || piece.piece === 'Áéâ') {
      score += evaluateKingApproachFast(move.r, move.c) * 0.1; // Áéã„ÅÆÊé•Ëøë„ÅØÂ§ßÂπÖ‰ΩéË©ï‰æ°
    } else {
      score += evaluateKingApproachFast(move.r, move.c) * 20; // 10„Åã„Çâ20„Å´Â§ßÂπÖÂº∑Âåñ
    }
    
    // 8. Âë≥ÊñπÈßí„ÅÆ‰øùË≠∑Ë©ï‰æ°ÔºàÊñ∞Ë¶èËøΩÂä†„ÉªÂÆàÂÇôÈáçË¶ñ„ÉªÁéã„ÅÆÁßªÂãïÊäëÂà∂Ôºâ
    if (piece.piece === 'Áéã' || piece.piece === 'Áéâ') {
      score += evaluateProtectionFast(move.r, move.c) * 2; // Áéã„ÅÆ‰øùË≠∑„ÅØÈ´òË©ï‰æ°ÔºàÂÆàÂÇôÊôÇÔºâ
    } else {
      score += evaluateProtectionFast(move.r, move.c) * 2; // ‰ªñ„ÅÆÈßí„ÅÆ‰øùË≠∑„ÅØÈ´òË©ï‰æ°
    }
    
    // 9. Êïµ„ÅÆÈáçË¶ÅÈßí„Å∏„ÅÆËÑÖÂ®ÅË©ï‰æ°ÔºàÂ§ßÂπÖÂº∑Âåñ„ÉªÊîªÊíÉÈáçË¶ñ„ÉªÁéã„ÅÆÁßªÂãïÊäëÂà∂„ÉªÂπª„ÅÆÂõûÈÅø„Çπ„Ç≠„É´ËÄÉÊÖÆÔºâ
    if (piece.piece === 'Áéã' || piece.piece === 'Áéâ') {
      score += evaluateThreatToEnemyFast(move.r, move.c) * 0.1; // Áéã„ÅÆËÑÖÂ®Å„ÅØÂ§ßÂπÖ‰ΩéË©ï‰æ°
    } else {
      let threatScore = evaluateThreatToEnemyFast(move.r, move.c) * 15; // 8„Åã„Çâ15„Å´Â§ßÂπÖÂº∑Âåñ
      
      // Âπª„ÅÆÈßí„Å∏„ÅÆËÑÖÂ®Å„ÅØÂõûÈÅø„Çπ„Ç≠„É´„ÇíËÄÉÊÖÆ„Åó„Å¶‰ΩéË©ï‰æ°
      const targetPiece = state.board[move.r][move.c];
      if (targetPiece && targetPiece.piece === 'Âπª') {
        threatScore = threatScore * 0.3; // Âπª„Å∏„ÅÆËÑÖÂ®Å„ÅØÂ§ßÂπÖ„Å´‰ΩéË©ï‰æ°
        console.log(`‚ú® Âπª„Å∏„ÅÆËÑÖÂ®ÅË©ï‰æ°: ÂõûÈÅø„Çπ„Ç≠„É´ËÄÉÊÖÆ„Åß${threatScore}„Å´Ë™øÊï¥`);
      }
      
      score += threatScore;
    }
    
    // 10. Áéã„ÅÆÁßªÂãïÊäëÂà∂ÔºàÊúÄÂÑ™ÂÖàÂ∫¶ÊúÄ‰ΩéÂåñÔºâ
    if (piece.piece === 'Áéã' || piece.piece === 'Áéâ') {
      score -= 1000; // Áéã„ÅÆÁßªÂãï„Å´Â§ßÂπÖ„Éö„Éä„É´„ÉÜ„Ç£
      
      // ÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅÆËøΩÂä†ÊäëÂà∂
      if (!isCheck(move.r, move.c)) {
        score -= 2000; // ÈÄöÂ∏∏ÊôÇ„ÅØ„Åï„Çâ„Å´Â§ßÂπÖÊäëÂà∂
      }
      
      // Ëá™Èô£ÂÜÖ„Åß„ÅÆÁßªÂãïÊäëÂà∂
      if (move.r > 5) {
        score -= 500; // Ëá™Èô£ÂÜÖ„Åß„ÅÆÁßªÂãï„ÅØ„Åï„Çâ„Å´ÊäëÂà∂
      }
      
      // ‰∏≠Â§ÆÈÉ®„Åß„ÅÆÁßªÂãïÊäëÂà∂
      if (move.r >= 3 && move.r <= 5 && move.c >= 3 && move.c <= 5) {
        score -= 300; // ‰∏≠Â§ÆÈÉ®„Åß„ÅÆÁßªÂãï„ÅØÊäëÂà∂
      }
    }
    
    return score;
  }

  // ÊîªÊíÉÈáçË¶ñ„ÅÆ‰ΩçÁΩÆË©ï‰æ°ÔºàÊîªÂÆà„Éê„É©„É≥„ÇπÁâàÔºâ
  function evaluatePositionAttackFocused(row, col, pieceType) {
    let score = 0;
    
    // ‰∏≠Â§ÆÈÉ®„ÅÆÂà∂Âæ°ÔºàÂ∞ÜÊ£ã„ÅÆÂü∫Êú¨„ÉªÂº∑ÂåñÔºâ
    if (row >= 3 && row <= 5 && col >= 3 && col <= 5) {
      score += 25; // 15„Åã„Çâ25„Å´Âº∑Âåñ
    }
    
    // ÊîªÊíÉÈßí„ÅÆÂâçÈÄ≤ÔºàÊ≠©„ÉªÈ¶ô„ÉªÊ°Ç„ÉªÂ§ßÂπÖÂº∑ÂåñÔºâ
    if (pieceType === 'Ê≠©' || pieceType === 'È¶ô' || pieceType === 'Ê°Ç') {
      if (row < 3) { // ÊïµÈô£ÂÜÖ
        score += 100; // 50„Åã„Çâ100„Å´Â§ßÂπÖÂº∑Âåñ
      } else if (row < 4) { // ÊïµÈô£„Å´Ëøë„ÅÑ
        score += 70; // 35„Åã„Çâ70„Å´Â§ßÂπÖÂº∑Âåñ
      } else if (row < 5) { // ‰∏≠Áõ§„Åß„ÅÆÂâçÈÄ≤
        score += 40; // 20„Åã„Çâ40„Å´Â§ßÂπÖÂº∑Âåñ
      }
    }
    
    // ÂÆàÂÇôÈßí„ÅÆÈÖçÁΩÆÔºàÈáë„ÉªÈäÄ„ÉªÂº∑ÂåñÔºâ
    if (pieceType === 'Èáë' || pieceType === 'ÈäÄ') {
      if (row > 6) { // Ëá™Èô£ÂÜÖ
        score += 30; // 20„Åã„Çâ30„Å´Âº∑Âåñ
      } else if (row > 5) { // Ëá™Èô£„Å´Ëøë„ÅÑ
        score += 25; // 15„Åã„Çâ25„Å´Âº∑Âåñ
      }
    }
    
    // È£õËªä„ÉªËßíË°å„ÅÆÈÖçÁΩÆÔºàÂ§ßÂπÖÂº∑ÂåñÔºâ
    if (pieceType === 'È£õ' || pieceType === 'Ëßí') {
      if (row >= 3 && row <= 5) { // ‰∏≠Â§ÆÈÉ®
        score += 100; // 50„Åã„Çâ100„Å´Â§ßÂπÖÂº∑Âåñ
      } else if (row < 4) { // ÊïµÈô£„Å´Ëøë„ÅÑ
        score += 80; // 40„Åã„Çâ80„Å´Â§ßÂπÖÂº∑Âåñ
      }
    }
    
    // ÁâπÊÆäÈßí„ÅÆÊîªÊíÉÈÖçÁΩÆÔºàÊñ∞Ë¶èËøΩÂä†Ôºâ
    if (pieceType === 'Èõª' || pieceType === 'Èõ∑') {
      if (row < 4) { // ÊïµÈô£„Å´Ëøë„ÅÑ‰ΩçÁΩÆ
        score += 45; // 30„Åã„Çâ45„Å´Âº∑Âåñ
      }
    }
    
    if (pieceType === 'ÁÇé' || pieceType === 'ÁÅ´') {
      if (row < 4) { // ÊïµÈô£„Åß„ÅÆÂäπÊûú
        score += 40; // 20„Åã„Çâ40„Å´Âº∑Âåñ
      }
    }
    
    if (pieceType === 'Á´ú' || pieceType === 'È≥≥') {
      if (row < 4) { // ÊïµÈô£„Åß„ÅÆÊ¥ªÁî®
        score += 45; // Êñ∞Ë¶èËøΩÂä†
      }
    }
    
    return score;
  }

  // ÁßªÂãï„ÅÆË©ï‰æ°„ÇíË°å„ÅÜÈñ¢Êï∞ÔºàÈ´òÈÄüÂåñÁâàÔºâ
  function evaluateMove(piece, move) {
    let score = 0;
    
    // 0. Áéã„ÅÆÂÆâÂÖ®Á¢∫‰øùÔºàÊúÄÂÑ™ÂÖà„ÉªÈ´òÈÄüÂåñÔºâ
    if (isKingInDangerFast()) {
      score += evaluateKingSafetyFast(piece, move);
      if (score > 0) return score;
    }
    
    // 1. ÁéãÊâã„ÅÆË©ï‰æ°ÔºàÊúÄÈ´òÁÇπÔºâ
    if (isCheck(move.r, move.c)) {
      score += 5000;
    }
    
    // 2. Èßí„ÇíÂèñ„ÇãË©ï‰æ°ÔºàÈ´òÈÄüÂåñÔºâ
    const targetPiece = state.board[move.r][move.c];
    if (targetPiece) {
      score += getPieceValue(targetPiece.piece) * 50;
    }
    
    // 3. Èßí„ÅÆ‰æ°ÂÄ§„Å´„Çà„ÇãË©ï‰æ°
    score += getPieceValue(piece.piece);
    
    // 4. ‰ΩçÁΩÆ„Å´„Çà„ÇãË©ï‰æ°ÔºàÈ´òÈÄüÂåñÔºâ
    score += evaluatePositionFast(move.r, move.c, piece.piece) * 3;
    
    // 5. ÂÆâÂÖ®„Å™‰ΩçÁΩÆ„ÅÆË©ï‰æ°
    if (isSafePositionFast(move.r, move.c)) {
      score += 20;
    }
    
    // 6. ÊîªÊíÉÁöÑ„Å™‰ΩçÁΩÆ„ÅÆË©ï‰æ°
    if (isAttackingPosition(move.r, move.c)) {
      score += 15;
    }
    
    // 7. ÁâπÊÆäÈßí„ÅÆ„Çπ„Ç≠„É´Ê¥ªÁî®Ë©ï‰æ°ÔºàÈ´òÈÄüÂåñÔºâ
    score += evaluateSpecialPieceSkillFast(piece, move) * 2;
    
    // 8. ÊïµÁéã„Å∏„ÅÆÊé•ËøëË©ï‰æ°ÔºàÈ´òÈÄüÂåñÔºâ
    score += evaluateKingApproachFast(move.r, move.c);
    
    // 9. Âë≥ÊñπÈßí„ÅÆ‰øùË≠∑Ë©ï‰æ°ÔºàÈ´òÈÄüÂåñÔºâ
    score += evaluateProtectionFast(move.r, move.c);
    
    // 10. Êïµ„ÅÆÈáçË¶ÅÈßí„Å∏„ÅÆËÑÖÂ®ÅË©ï‰æ°ÔºàÈ´òÈÄüÂåñÔºâ
    score += evaluateThreatToEnemyFast(move.r, move.c);
    
    return score;
  }

  // ÁéãÊâã„Åã„Å©„ÅÜ„Åã„ÇíÂà§ÂÆö
  function isCheck(row, col) {
    // „Éó„É¨„Ç§„É§„Éº„ÅÆÁéã„ÅÆ‰ΩçÁΩÆ„ÇíÊé¢„Åô
    let playerKingRow = -1, playerKingCol = -1;
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'player' && (piece.piece === 'Áéã' || piece.piece === 'Áéâ')) {
          playerKingRow = r;
          playerKingCol = c;
          break;
        }
      }
      if (playerKingRow !== -1) break;
    }
    
    if (playerKingRow === -1) return false;
    
    // „Åì„ÅÆ‰ΩçÁΩÆ„Åã„ÇâÁéã„Å´ÊîªÊíÉ„Åß„Åç„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÁéãÊâãÂà§ÂÆöÂ∞ÇÁî®Ôºâ
    const moves = getValidMovesForCheck(row, col);
    for (const move of moves) {
      if (move.r === playerKingRow && move.c === playerKingCol) {
        return true;
      }
    }
    
    return false;
  }

  // ÁéãÊâãÂà§ÂÆöÂ∞ÇÁî®„ÅÆÁßªÂãïÁØÑÂõ≤ÂèñÂæóÈñ¢Êï∞
  function getValidMovesForCheck(row, col) {
    const stage = STAGES[state.stageIndex];
    const sq = state.board[row][col]; 
    if (!sq) return [];
    
    // Â§âÂΩ¢Áä∂ÊÖã„ÄÅÊÑüÈõªÁä∂ÊÖã„ÅÆÈßí„ÅØÁßªÂãï„Åß„Åç„Å™„ÅÑ
    if (sq.isTransformed) return [];
    if (sq.isTimeStopped) return [];
    
    // ËôπËâ≤Âà∂ÈôêÁä∂ÊÖã„ÅÆÈßí„ÅØÁßªÂãïÁØÑÂõ≤„ÅåÂà∂Èôê„Åï„Çå„Çã
    if (sq.isRainbowLimited) {
      return getRainbowLimitedMoves(row, col);
    }
    
    // Ê≤º„Å´Êçï„Çâ„Åà„Çâ„Çå„ÅüÈßí„ÅØÁßªÂãïÁØÑÂõ≤„ÅåÂà∂Èôê„Åï„Çå„Çã
    if (sq.isSwampTrapped) {
      return getSwampTrappedMoves(row, col);
    }
    
    // ÂáçÁµêÁä∂ÊÖã„ÅÆÈßí„ÅØÁßªÂãï„Åß„Åç„Å™„ÅÑ
    if (state.frozenPieces && state.frozenPieces.some(frozen => frozen.row === row && frozen.col === col)) return [];
    
    const type = stage.pieces[sq.piece] || 'pawn';
    let moves = [];
    switch(type){
      case 'king': moves = kingMovesForCheck(row, col); break;
      case 'rook': moves = rookMovesForCheck(row, col); break;
      case 'bishop': moves = bishopMovesForCheck(row, col); break;
      case 'gold': moves = goldMovesForCheck(row, col); break;
      case 'silver': moves = silverMovesForCheck(row, col); break;
      case 'knight': moves = knightMovesForCheck(row, col); break;
      case 'lance': moves = lanceMovesForCheck(row, col); break;
      case 'pawn': moves = pawnMovesForCheck(row, col); break;
      case 'ninja': moves = ninjaMovesForCheck(row, col); break;
      case 'shadow': moves = shadowMovesForCheck(row, col); break;
      case 'cannon': moves = cannonMovesForCheck(row, col); break;
      case 'dragon': moves = dragonMovesForCheck(row, col); break;
      case 'Ëæ∞': moves = dragonAwakenedMovesForCheck(row, col); break;
      case 'phoenix': moves = phoenixMovesForCheck(row, col); break;
      case 'flame': moves = flameMovesForCheck(row, col); break;
      case 'fire': moves = fireMovesForCheck(row, col); break;
      case 'water': moves = waterMovesForCheck(row, col); break;
      case 'wave': moves = waveMovesForCheck(row, col); break;
      case 'tree': moves = treeMovesForCheck(row, col); break;
      case 'leaf': moves = leafMovesForCheck(row, col); break;
      case 'light': moves = lightMovesForCheck(row, col); break;
      case 'star': moves = starMovesForCheck(row, col); break;
      case 'dark': moves = darkMovesForCheck(row, col); break;
      case 'demon': moves = demonMovesForCheck(row, col); break;
      case 'copper': moves = copperMovesForCheck(row, col); break;
      case 'iron': moves = ironMovesForCheck(row, col); break;
      case 'tin': moves = tinMovesForCheck(row, col); break;
      case 'lead': moves = leadMovesForCheck(row, col); break;
      case 'treasure': moves = treasureMovesForCheck(row, col); break;
      case 'electric': moves = electricMovesForCheck(row, col); break;
      case 'thunder': moves = thunderMovesForCheck(row, col); break;
      case 'time': moves = timeMovesForCheck(row, col); break;
      case 'ice': moves = iceMovesForCheck(row, col); break;
      case 'snow': moves = snowMovesForCheck(row, col); break;
      case 'sand': moves = sandMovesForCheck(row, col); break;
      case 'wind': moves = windMovesForCheck(row, col); break;
      case 'ocean': moves = oceanMovesForCheck(row, col); break;
      case 'fish': moves = fishMovesForCheck(row, col); break;
      case 'moss': moves = mossMovesForCheck(row, col); break;
      case 'cloud': moves = cloudMovesForCheck(row, col); break;
      case 'rainbow': moves = rainbowMovesForCheck(row, col); break;
      case 'rock': moves = rockMovesForCheck(row, col); break;
      case 'ore': moves = oreMovesForCheck(row, col); break;
      case 'mineral': moves = mineralMovesForCheck(row, col); break;
      case 'phantom': moves = phantomMovesForCheck(row, col); break;
      case 'mist': moves = mistMovesForCheck(row, col); break;
      case 'end': moves = endMovesForCheck(row, col); break;
      case 'destiny': moves = destinyMovesForCheck(row, col); break;
      case 'ah': moves = ahMovesForCheck(row, col); break;
      case 'prison': moves = prisonMovesForCheck(row, col); break;
      case 'fence': moves = fenceMovesForCheck(row, col); break;
      case 'ridge': moves = ridgeMovesForCheck(row, col); break;
      case 'peak': moves = peakMovesForCheck(row, col); break;
      case 'mountain': moves = mountainMovesForCheck(row, col); break;
      case 'poison': moves = poisonMovesForCheck(row, col); break;
      case 'swamp': moves = swampMovesForCheck(row, col); break;
      case 'grave': moves = graveMovesForCheck(row, col); break;
      case 'spirit': moves = spiritMovesForCheck(row, col); break;
      case 'machine': moves = machineMovesForCheck(row, col); break;
      case 'gear': moves = gearMovesForCheck(row, col); break;
      case 'moon': moves = moonMovesForCheck(row, col); break;
      case 'boat': moves = boatMovesForCheck(row, col); break;
      case 'mirror': moves = mirrorMovesForCheck(row, col); break;
      case 'reflection': moves = reflectionMovesForCheck(row, col); break;
      case 'curse': moves = curseMovesForCheck(row, col); break;
      case 'field': moves = fieldMovesForCheck(row, col); break;
      case 'house': moves = houseMovesForCheck(row, col); break;
      case 'people': moves = peopleMovesForCheck(row, col); break;
      case 'spring': moves = springMovesForCheck(row, col); break;
      case 'experiment': moves = experimentMovesForCheck(row, col); break;
      case 'mutant': moves = mutantMovesForCheck(row, col); break;
      case 'holy': moves = holyMovesForCheck(row, col); break;
      case 'k': moves = kMovesForCheck(row, col); break;
      default: return [];
    }
    
    // Ëá™ÂàÜ„ÅÆÁéã„ÇíÂèñ„ÇãÊâã„ÇíÈô§Â§ñ
    moves = moves.filter(move => {
      const targetPiece = state.board[move.r][move.c];
      if (targetPiece && (targetPiece.piece === 'Áéã' || targetPiece.piece === 'Áéâ')) {
        // Ëá™ÂàÜ„ÅÆÁéã„ÇíÂèñ„Çç„ÅÜ„Å®„Åô„ÇãÊâã„ÅØÈô§Â§ñ
        if (targetPiece.owner === sq.owner) {
          return false;
        }
      }
      return true;
    });
    
    return moves;
  }

  // ÁéãÊâãÂà§ÂÆöÂ∞ÇÁî®„ÅÆÂêÑÈßí„ÅÆÁßªÂãïÈñ¢Êï∞
  function kingMovesForCheck(row, col) {
    const owner = state.board[row][col].owner;
    const dirs=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    const m=[]; dirs.forEach(([dr,dc])=>pushIfEnemyOrEmptyForCheck(m, row+dr, col+dc, owner));
    return m;
  }
  
  function pushIfEnemyOrEmptyForCheck(moves, r, c, owner) {
    if (!inBounds(r,c)) return false;
    
    // ÊØí„Éû„Çπ„Å∏„ÅÆÁßªÂãïÂà∂ÈôêÔºàÁõ∏Êâã„ÅÆÈßí„ÅÆ„ÅøÔºâ
    if (isPoisonSquare(r, c) && owner !== state.currentPlayer) {
      return false;
    }
    
    const t = state.board[r][c];
    if (!t){ moves.push({r,c}); return true; }
    // √ó„Éû„ÇπÔºà'X'Ôºâ„Å∏„ÅÆÁßªÂãï„ÅØÂÆåÂÖ®„Å´Á¶ÅÊ≠¢
    if (t.piece === 'X'){ return false; }
    // Âë™„ÅÑ„Éû„ÇπÔºà'n'Ôºâ„ÄÅÁü¢Âç∞„Éû„ÇπÔºà'‚Üë','‚Üê','‚Üì','‚Üí'Ôºâ„Å∏„ÅÆÁßªÂãïÊôÇ„ÅØÂèñ„Çã„Åì„Å®„Åå„Åß„Åç„Å™„ÅÑ
    if (t.piece === 'n' || ['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(t.piece)){ 
      moves.push({r,c}); 
      return true; 
    }
    if (t.owner !== owner){ moves.push({r,c}); return false; }
    return false;
  }
  
  function rookMovesForCheck(row, col) { 
    const o=state.board[row][col].owner, m=[]; 
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(d=>slideForCheck(m,row,col,o,d[0],d[1])); 
    return m; 
  }
  
  function slideForCheck(moves, r, c, owner, dr, dc, maxSteps=99) {
    for (let i=1;i<=maxSteps;i++){
      const nr=r+dr*i, nc=c+dc*i; if (!inBounds(nr,nc)) break;
      const t=state.board[nr][nc];
      if (!t){ moves.push({r:nr,c:nc}); continue; }
      // √ó„Éû„ÇπÔºà'X'Ôºâ„Å∏„ÅÆÁßªÂãï„ÅØÂÆåÂÖ®„Å´Á¶ÅÊ≠¢
      if (t.piece === 'X'){ break; }
      // Âë™„ÅÑ„Éû„ÇπÔºà'n'Ôºâ„ÄÅÁü¢Âç∞„Éû„ÇπÔºà'‚Üë','‚Üê','‚Üì','‚Üí'Ôºâ„ÅØÂèñ„Çå„Å™„ÅÑ„ÅåÁßªÂãï„ÅØÂèØËÉΩ
      if (t.piece === 'n' || ['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(t.piece)){ 
        moves.push({r:nr,c:nc}); 
        continue; 
      }
      if (t.owner!==owner){ moves.push({r:nr,c:nc}); }
      break;
    }
  }
  
  // ‰ªñ„ÅÆÈßí„ÅÆÁßªÂãïÈñ¢Êï∞„ÅØÊó¢Â≠ò„ÅÆÈñ¢Êï∞„ÇíÊµÅÁî®ÔºàÁ∞°Áï•ÂåñÔºâ
  function bishopMovesForCheck(row, col) { return bishopMoves(row, col); }
  function goldMovesForCheck(row, col) { return goldMoves(row, col); }
  function silverMovesForCheck(row, col) { return silverMoves(row, col); }
  function knightMovesForCheck(row, col) { return knightMoves(row, col); }
  function lanceMovesForCheck(row, col) { return lanceMoves(row, col); }
  function pawnMovesForCheck(row, col) { return pawnMoves(row, col); }
  function ninjaMovesForCheck(row, col) { return ninjaMoves(row, col); }
  function shadowMovesForCheck(row, col) { return shadowMoves(row, col); }
  function cannonMovesForCheck(row, col) { return cannonMoves(row, col); }
  function dragonMovesForCheck(row, col) { return dragonMoves(row, col); }
  function phoenixMovesForCheck(row, col) { return phoenixMoves(row, col); }
  function flameMovesForCheck(row, col) { return flameMoves(row, col); }
  function fireMovesForCheck(row, col) { return fireMoves(row, col); }
  function waterMovesForCheck(row, col) { return waterMoves(row, col); }
  function waveMovesForCheck(row, col) { return waveMoves(row, col); }
  function treeMovesForCheck(row, col) { return treeMoves(row, col); }
  function leafMovesForCheck(row, col) { return leafMoves(row, col); }
  function lightMovesForCheck(row, col) { return lightMoves(row, col); }
  function starMovesForCheck(row, col) { return starMoves(row, col); }
  function darkMovesForCheck(row, col) { return darkMoves(row, col); }
  function demonMovesForCheck(row, col) { return demonMoves(row, col); }
  function copperMovesForCheck(row, col) { return copperMoves(row, col); }
  function ironMovesForCheck(row, col) { return ironMoves(row, col); }
  function tinMovesForCheck(row, col) { return tinMoves(row, col); }
  function leadMovesForCheck(row, col) { return leadMoves(row, col); }
  function treasureMovesForCheck(row, col) { return treasureMoves(row, col); }
  function electricMovesForCheck(row, col) { return electricMoves(row, col); }
  function thunderMovesForCheck(row, col) { return thunderMoves(row, col); }
  function timeMovesForCheck(row, col) { return timeMoves(row, col); }
    function iceMovesForCheck(row, col) { return iceMoves(row, col); }
  function snowMovesForCheck(row, col) { return snowMoves(row, col); }
  function sandMovesForCheck(row, col) { return sandMoves(row, col); }
  function windMovesForCheck(row, col) { return windMoves(row, col); }
  function mossMovesForCheck(row, col) { return mossMoves(row, col); }
  function oceanMovesForCheck(row, col) { return oceanMoves(row, col); }
  function fishMovesForCheck(row, col) { return fishMoves(row, col); }
  function cloudMovesForCheck(row, col) { return cloudMoves(row, col); }
  function rainbowMovesForCheck(row, col) { return rainbowMoves(row, col); }
  function rockMovesForCheck(row, col) { return rockMoves(row, col); }
  function mineralMovesForCheck(row, col) { return mineralMoves(row, col); }
  function phantomMovesForCheck(row, col) { return phantomMoves(row, col); }
  function mistMovesForCheck(row, col) { return mistMoves(row, col); }
  function endMovesForCheck(row, col) { return endMoves(row, col); }
  function destinyMovesForCheck(row, col) { return destinyMoves(row, col); }
  function ahMovesForCheck(row, col) { return ahMoves(row, col); }
  function prisonMovesForCheck(row, col) { return prisonMoves(row, col); }
  function fenceMovesForCheck(row, col) { return fenceMoves(row, col); }
  function ridgeMovesForCheck(row, col) { return ridgeMoves(row, col); }
  function peakMovesForCheck(row, col) { return peakMoves(row, col); }
  function rockMovesForCheck(row, col) { return rockMoves(row, col); }
  function oreMovesForCheck(row, col) { return oreMoves(row, col); }
  function mountainMovesForCheck(row, col) { return mountainMoves(row, col); }
  function poisonMovesForCheck(row, col) { return poisonMoves(row, col); }
  function swampMovesForCheck(row, col) { return swampMoves(row, col); }
  function graveMovesForCheck(row, col) { return graveMoves(row, col); }
  function spiritMovesForCheck(row, col) { return spiritMoves(row, col); }
  function machineMovesForCheck(row, col) { return machineMoves(row, col); }
  function gearMovesForCheck(row, col) { return gearMoves(row, col); }
  function moonMovesForCheck(row, col) { return moonMoves(row, col); }
  function boatMovesForCheck(row, col) { return boatMoves(row, col); }
  function mirrorMovesForCheck(row, col) { return mirrorMoves(row, col); }
  function reflectionMovesForCheck(row, col) { return reflectionMoves(row, col); }
  function curseMovesForCheck(row, col) { return curseMoves(row, col); }
  function fieldMovesForCheck(row, col) { return fieldMoves(row, col); }
  function houseMovesForCheck(row, col) { return houseMoves(row, col); }
  function peopleMovesForCheck(row, col) { return peopleMoves(row, col); }
  function springMovesForCheck(row, col) { return springMoves(row, col); }
  function experimentMovesForCheck(row, col) { return experimentMoves(row, col); }
  function mutantMovesForCheck(row, col) { return mutantMoves(row, col); }
  function dragonAwakenedMovesForCheck(row, col) { return dragonAwakenedMoves(row, col); }
  function holyMovesForCheck(row, col) { return holyMoves(row, col); }
  function kMovesForCheck(row, col) { return kMoves(row, col); }
  function swordMovesForCheck(row, col) { return swordMoves(row, col); }
  function armorMovesForCheck(row, col) { return armorMoves(row, col); }
  function gunMovesForCheck(row, col) { return gunMoves(row, col); }
  function bookMovesForCheck(row, col) { return bookMoves(row, col); }
  function sealMovesForCheck(row, col) { return sealMoves(row, col); }

  // „Éó„É¨„Ç§„É§„Éº„ÅåÁéãÊâã„Çí„Åã„Åë„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
  function isPlayerGivingCheck() {
    // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéã„ÅÆ‰ΩçÁΩÆ„ÇíÊé¢„Åô
    let computerKingRow = -1, computerKingCol = -1;
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'computer' && (piece.piece === 'Áéã' || piece.piece === 'Áéâ')) {
          computerKingRow = r;
          computerKingCol = c;
          break;
        }
      }
      if (computerKingRow !== -1) break;
    }
    
    if (computerKingRow === -1) return false;
    
    // „Éó„É¨„Ç§„É§„Éº„ÅÆÈßí„Åã„ÇâÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'player') {
          const moves = getValidMovesForCheck(r, c);
          for (const move of moves) {
            if (move.r === computerKingRow && move.c === computerKingCol) {
              return true;
            }
          }
        }
      }
    }
    
    return false;
  }
  
  // ÁéãÊâãÁ©ç„ÅøÔºà„ÉÅ„Çß„ÉÉ„ÇØ„É°„Ç§„ÉàÔºâ„Åã„Å©„ÅÜ„Åã„ÇíÂà§ÂÆöÔºàÂÆåÂÖ®ÁÑ°ÂäπÂåñÔºâ
  function isCheckmate() {
    // ÁéãÊâãË©∞„ÅøÊ©üËÉΩ„ÇíÂÆåÂÖ®„Å´ÂâäÈô§ - Â∏∏„Å´false„ÇíËøî„Åô
    console.log('üîç ÁéãÊâãË©∞„ÅøÂà§ÂÆö„ÅØÁÑ°ÂäπÂåñ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô');
    return false;
  }

  // „Éó„É¨„Ç§„É§„Éº„ÅÆÁéã„Å´ÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
  function isKingInCheck() {
    // „Éó„É¨„Ç§„É§„Éº„ÅÆÁéã„ÅÆ‰ΩçÁΩÆ„ÇíÊé¢„Åô
    let playerKingRow = -1, playerKingCol = -1;
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'player' && (piece.piece === 'Áéã' || piece.piece === 'Áéâ')) {
          playerKingRow = r;
          playerKingCol = c;
          break;
        }
      }
      if (playerKingRow !== -1) break;
    }
    
    if (playerKingRow === -1) return false;
    
    // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÈßí„Åã„ÇâÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÁ∞°ÊòìÁâàÔºâ
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'computer') {
          // Á∞°ÊòìÁöÑ„Å™ÁéãÊâã„ÉÅ„Çß„ÉÉ„ÇØÔºàÁõ¥Êé•ÊîªÊíÉ„ÅÆ„ÅøÔºâ
          const directions = getPieceAttackDirections(piece.piece);
          for (const [dr, dc] of directions) {
            let nr = r + dr, nc = c + dc;
            while (nr >= 0 && nr < BOARD_SIZE && nc >= 0 && nc < BOARD_SIZE) {
              const target = state.board[nr][nc];
              if (target) {
                if (target.owner === 'player' && (target.piece === 'Áéã' || target.piece === 'Áéâ') && 
                    nr === playerKingRow && nc === playerKingCol) {
                  console.log(`‚ö†Ô∏è ÁéãÊâãÊ§úÂá∫: ${piece.piece} at [${r}][${c}] ‚Üí [${playerKingRow}][${playerKingCol}]`);
              return true;
            }
                break; // Èßí„Å´ÂΩì„Åü„Å£„Åü„ÇâÂÅúÊ≠¢
              }
              nr += dr;
              nc += dc;
            }
          }
        }
      }
    }
    
    return false;
  }

  // ÁéãÊâãÂõûÈÅø„ÅÆÊâã„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÁÑ°ÂäπÂåñÔºâ
  function hasCheckmateDefense() {
    console.log('üîç ÁéãÊâãÂõûÈÅøÊâãÊé¢Á¥¢„ÅØÁÑ°ÂäπÂåñ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô');
    return true; // Â∏∏„Å´ÂõûÈÅøÊâã„Åå„ÅÇ„Çã„Å®Âà§ÂÆö
  }

  // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéã„Å´ÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
  function isComputerKingInCheck() {
    // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéã„ÅÆ‰ΩçÁΩÆ„ÇíÊé¢„Åô
    let computerKingRow = -1, computerKingCol = -1;
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'computer' && (piece.piece === 'Áéã' || piece.piece === 'Áéâ')) {
          computerKingRow = r;
          computerKingCol = c;
          break;
        }
      }
      if (computerKingRow !== -1) break;
    }
    
    if (computerKingRow === -1) return false;
    
    // „Éó„É¨„Ç§„É§„Éº„ÅÆÈßí„Åã„ÇâÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'player') {
          const moves = getValidMovesForCheck(r, c);
          for (const move of moves) {
            if (move.r === computerKingRow && move.c === computerKingCol) {
              return true;
            }
          }
        }
      }
    }
    
    return false;
  }

  // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéã„Å´ÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÈ´òÈÄüÁâàÔºâ
  function isComputerKingInCheckFast() {
    // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéã„ÅÆ‰ΩçÁΩÆ„ÇíÊé¢„Åô
    let computerKingRow = -1, computerKingCol = -1;
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'computer' && (piece.piece === 'Áéã' || piece.piece === 'Áéâ')) {
          computerKingRow = r;
          computerKingCol = c;
          break;
        }
      }
      if (computerKingRow !== -1) break;
    }
    
    if (computerKingRow === -1) return false;
    
    // „Éó„É¨„Ç§„É§„Éº„ÅÆÈßí„Åã„ÇâÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÁ∞°ÊòìÁâàÔºâ
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'player') {
          // Á∞°ÊòìÁöÑ„Å™ÁéãÊâã„ÉÅ„Çß„ÉÉ„ÇØÔºàÁõ¥Êé•ÊîªÊíÉ„ÅÆ„ÅøÔºâ
          const directions = getPieceAttackDirections(piece.piece);
          for (const [dr, dc] of directions) {
            let nr = r + dr, nc = c + dc;
            while (nr >= 0 && nr < BOARD_SIZE && nc >= 0 && nc < BOARD_SIZE) {
              const target = state.board[nr][nc];
              if (target) {
                if (target.owner === 'computer' && (target.piece === 'Áéã' || target.piece === 'Áéâ') && 
                    nr === computerKingRow && nc === computerKingCol) {
                  return true;
                }
                break; // Èßí„Å´ÂΩì„Åü„Å£„Åü„ÇâÂÅúÊ≠¢
              }
              nr += dr;
              nc += dc;
            }
          }
        }
      }
    }
    
    return false;
  }

  // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéãÊâãÂõûÈÅø„ÅÆÊâã„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
  function hasComputerCheckmateDefense() {
    // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÂÖ®Èßí„Å´„Å§„ÅÑ„Å¶ÁéãÊâãÂõûÈÅø„ÅÆÊâã„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'computer') {
          const moves = getValidMoves(r, c);
          for (const move of moves) {
            if (canComputerPreventCheckmate(r, c, move)) {
              console.log(`üõ°Ô∏è „Ç≥„É≥„Éî„É•„Éº„ÇøÁéãÊâãÂõûÈÅøÊâãÁô∫Ë¶ã: ${piece.piece} at [${r}][${c}] ‚Üí [${move.r}][${move.c}]`);
              return true;
            }
          }
        }
      }
    }
    
    console.log('‚ùå „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéãÊâãÂõûÈÅøÊâã„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì - ÁéãÊâãÁ©ç„Åø„Åß„Åô');
    return false;
  }

  // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéãÊâãÂõûÈÅø„ÅÆÊâã„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÈ´òÈÄüÁâàÔºâ
  function hasComputerCheckmateDefenseFast(timeout) {
    console.log('üîç „Ç≥„É≥„Éî„É•„Éº„ÇøÁéãÊâãÂõûÈÅøÊâã„ÇíÊé¢Á¥¢‰∏≠...');
    let defenseCount = 0;
    
    // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÂÖ®Èßí„Å´„Å§„ÅÑ„Å¶ÁéãÊâãÂõûÈÅø„ÅÆÊâã„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'computer') {
          const moves = getValidMoves(r, c);
          console.log(`üìã „Ç≥„É≥„Éî„É•„Éº„Çø${piece.piece} at [${r}][${c}]: ${moves.length}Êâã`);
          
          for (const move of moves) {
            if (canComputerPreventCheckmateFast(r, c, move)) {
              console.log(`üõ°Ô∏è „Ç≥„É≥„Éî„É•„Éº„ÇøÁéãÊâãÂõûÈÅøÊâãÁô∫Ë¶ã: ${piece.piece} at [${r}][${c}] ‚Üí [${move.r}][${move.c}]`);
              defenseCount++;
              // ÊúÄÂàù„ÅÆÂõûÈÅøÊâã„ÅåË¶ã„Å§„Åã„Å£„Åü„ÇâÂç≥Â∫ß„Å´Ëøî„Åô
              return true;
            }
          }
        }
      }
    }
    
    console.log(`‚ùå „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéãÊâãÂõûÈÅøÊâã„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì - ÁéãÊâãÁ©ç„Åø„Åß„Åô (Êé¢Á¥¢„Åó„ÅüÂõûÈÅøÊâãÊï∞: ${defenseCount})`);
    return false;
  }

  // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéãÊâãÂõûÈÅøÊâã„ÇíÂç≥Â∫ß„Å´Ë¶ã„Å§„Åë„ÇãÈñ¢Êï∞
  function findComputerCheckmateDefenseMove() {
    console.log('üîç „Ç≥„É≥„Éî„É•„Éº„ÇøÁéãÊâãÂõûÈÅøÊâã„ÇíÂç≥Â∫ß„Å´Êé¢Á¥¢‰∏≠...');
    
    // ÁéãÊâã„Çí„Åã„Åë„Å¶„ÅÑ„ÇãÊïµÈßí„ÇíÊé¢„Åô
    const attackingPiece = findComputerKingAttackingPiece();
    let bestDefenseMove = null;
    let bestDefenseScore = -1;
    
    // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÂÖ®Èßí„Å´„Å§„ÅÑ„Å¶ÁéãÊâãÂõûÈÅø„ÅÆÊâã„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'computer') {
          const moves = getValidMoves(r, c);
          
          for (const move of moves) {
            if (canComputerPreventCheckmateFast(r, c, move)) {
              // ÁéãÊâãÂõûÈÅøÊâã„ÅÆÂÑ™ÂÖàÈ†Ü‰Ωç„ÇíË®àÁÆó
              let score = 0;
              
              // ÁéãÊâã„Çí„Åã„Åë„Å¶„ÅÑ„ÇãÊïµÈßí„ÇíÂèñ„ÇãÊâã„ÅØÊúÄÈ´òÂÑ™ÂÖàÂ∫¶
              if (attackingPiece && move.r === attackingPiece.row && move.c === attackingPiece.col) {
                score = 1000;
              }
              // ÊïµÈßí„ÇíÂèñ„ÇãÊâã„ÅØÈ´òÂÑ™ÂÖàÂ∫¶
              else if (state.board[move.r][move.c] && state.board[move.r][move.c].owner === 'player') {
                score = 500 + getPieceValue(state.board[move.r][move.c].piece);
              }
              // „Åù„ÅÆ‰ªñ„ÅÆÁéãÊâãÂõûÈÅøÊâã
              else {
                score = 100;
              }
              
              if (score > bestDefenseScore) {
                bestDefenseScore = score;
                bestDefenseMove = { r: r, c: c, move: move, piece: piece.piece };
              }
              
              // ÊúÄÈ´òÂÑ™ÂÖàÂ∫¶„ÅÆÊâã„ÅåË¶ã„Å§„Åã„Å£„Åü„ÇâÂç≥Â∫ß„Å´Ëøî„Åô
              if (score >= 1000) {
                console.log(`üõ°Ô∏è ÊúÄÈ´òÂÑ™ÂÖàÂ∫¶„ÅÆÁéãÊâãÂõûÈÅøÊâãÁô∫Ë¶ã: ${piece.piece} at [${r}][${c}] ‚Üí [${move.r}][${move.c}] (ÊïµÈßí„ÇíÂèñ„Çã)`);
                return bestDefenseMove;
              }
            }
          }
        }
      }
    }
    
    if (bestDefenseMove) {
      console.log(`üõ°Ô∏è ÁéãÊâãÂõûÈÅøÊâãÁô∫Ë¶ã: ${bestDefenseMove.piece} at [${bestDefenseMove.r}][${bestDefenseMove.c}] ‚Üí [${bestDefenseMove.move.r}][${bestDefenseMove.move.c}] („Çπ„Ç≥„Ç¢: ${bestDefenseScore})`);
      return bestDefenseMove;
    }
    
    console.log('‚ùå „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéãÊâãÂõûÈÅøÊâã„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì - ÁéãÊâãÁ©ç„Åø„Åß„Åô');
    return null;
  }

  // Èßí„ÅÆÊîªÊíÉÊñπÂêë„ÇíÂèñÂæó„Åô„ÇãÈñ¢Êï∞
  function getPieceAttackDirections(piece) {
    const stage = STAGES[state.stageIndex];
    const type = stage.pieces[piece] || 'pawn';
    
    switch(type) {
      case 'king': return [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
      case 'rook': return [[-1,0],[1,0],[0,-1],[0,1]];
      case 'bishop': return [[-1,-1],[-1,1],[1,-1],[1,1]];
      case 'gold': return [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,0]];
      case 'silver': return [[-1,-1],[-1,0],[-1,1],[1,-1],[1,1]];
      case 'knight': return [[-2,-1],[-2,1]];
      case 'lance': return [[-1,0]];
      case 'pawn': return [[-1,0]];
      default: return [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]]; // „Éá„Éï„Ç©„É´„Éà„ÅØÁéã„ÅÆÂãï„Åç
    }
  }

  // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéãÊâã„Çí„Åã„Åë„Å¶„ÅÑ„ÇãÊïµÈßí„ÇíÊé¢„Åô
  function findComputerKingAttackingPiece() {
    // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéã„ÅÆ‰ΩçÁΩÆ„ÇíÊé¢„Åô
    let computerKingRow = -1, computerKingCol = -1;
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'computer' && (piece.piece === 'Áéã' || piece.piece === 'Áéâ')) {
          computerKingRow = r;
          computerKingCol = c;
          break;
        }
      }
      if (computerKingRow !== -1) break;
    }
    
    if (computerKingRow === -1) return null;
    
    // „Éó„É¨„Ç§„É§„Éº„ÅÆÈßí„Åã„ÇâÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'player') {
          const moves = getValidMovesForCheck(r, c);
          for (const move of moves) {
            if (move.r === computerKingRow && move.c === computerKingCol) {
              return { row: r, col: c, piece: piece.piece };
            }
          }
        }
      }
    }
    
    return null;
  }

  // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéã„ÅÆ‰ΩçÁΩÆ„ÇíË¶ã„Å§„Åë„ÇãÈñ¢Êï∞
  function findComputerKingPosition() {
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'computer' && (piece.piece === 'Áéã' || piece.piece === 'Áéâ')) {
          return { row: r, col: c };
        }
      }
    }
    return null;
  }

  // ÊåáÂÆö‰ΩçÁΩÆ„Åå„Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéã„Å∏„ÅÆÊîªÊíÉÁµåË∑Ø‰∏ä„Å´„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
  function isOnComputerKingAttackPath(row, col, attackingPiece) {
    // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéã„ÅÆ‰ΩçÁΩÆ„ÇíÊé¢„Åô
    let computerKingRow = -1, computerKingCol = -1;
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'computer' && (piece.piece === 'Áéã' || piece.piece === 'Áéâ')) {
          computerKingRow = r;
          computerKingCol = c;
          break;
        }
      }
      if (computerKingRow !== -1) break;
    }
    
    if (computerKingRow === -1) return false;
    
    // ÊîªÊíÉÈßí„Åã„ÇâÁéã„Å∏„ÅÆÁµåË∑Ø‰∏ä„Å´„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    const dr = computerKingRow - attackingPiece.row;
    const dc = computerKingCol - attackingPiece.col;
    
    // Áõ¥Á∑öÁöÑ„Å™ÊîªÊíÉÔºàÈ£õËªä„ÄÅËßíË°å„Å™„Å©Ôºâ„ÅÆÂ†¥Âêà„ÅÆ„ÅøÁµåË∑Ø„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    if (Math.abs(dr) === Math.abs(dc) || dr === 0 || dc === 0) {
      const stepR = dr === 0 ? 0 : dr / Math.abs(dr);
      const stepC = dc === 0 ? 0 : dc / Math.abs(dc);
      
      let currentR = attackingPiece.row + stepR;
      let currentC = attackingPiece.col + stepC;
      
      while (currentR !== computerKingRow || currentC !== computerKingCol) {
        if (currentR === row && currentC === col) {
          return true;
        }
        currentR += stepR;
        currentC += stepC;
      }
    }
    
    return false;
  }

  // „Åì„ÅÆÁßªÂãï„ÅßÁéãÊâãÁ©ç„Åø„ÇíÂõûÈÅø„Åß„Åç„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
  function canPreventCheckmate(fromRow, fromCol, move) {
    // ÁèæÂú®„ÅÆÁõ§Èù¢„Çí„Ç≥„Éî„Éº
    const currentBoard = JSON.parse(JSON.stringify(state.board));
    
    // ÁßªÂãï„Çí„Ç∑„Éü„É•„É¨„Éº„Éà
    const fromPiece = currentBoard[fromRow][fromCol];
    currentBoard[move.r][move.c] = fromPiece;
    currentBoard[fromRow][fromCol] = null;
    
    // ÁßªÂãïÂæå„Å´ÁéãÊâã„ÅåÊÆã„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    const stillInCheck = isKingInCheckAfterMove(currentBoard);
    
    // „Éá„Éê„ÉÉ„Ç∞Áî®„É≠„Ç∞
    console.log(`üõ°Ô∏è ÁéãÊâãÂõûÈÅø„ÉÅ„Çß„ÉÉ„ÇØ: ${fromPiece.piece} [${fromRow}][${fromCol}] ‚Üí [${move.r}][${move.c}] - ÁéãÊâãÊÆãÂ≠ò: ${stillInCheck}`);
    
    return !stillInCheck;
  }

  // „Åì„ÅÆÁßªÂãï„Åß„Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéãÊâãÁ©ç„Åø„ÇíÂõûÈÅø„Åß„Åç„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÁÑ°ÂäπÂåñÔºâ
  function canComputerPreventCheckmate(fromRow, fromCol, move) {
    // ÁéãÊâãË©∞„ÅøÂõûÈÅøÊ©üËÉΩ„ÅØÁÑ°ÂäπÂåñ - Â∏∏„Å´true„ÇíËøî„Åô
    return true;
  }

  // „Åì„ÅÆÁßªÂãï„Åß„Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéãÊâãÁ©ç„Åø„ÇíÂõûÈÅø„Åß„Åç„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÁÑ°ÂäπÂåñÔºâ
  function canComputerPreventCheckmateFast(fromRow, fromCol, move) {
    // ÁéãÊâãË©∞„ÅøÂõûÈÅøÊ©üËÉΩ„ÅØÁÑ°ÂäπÂåñ - Â∏∏„Å´true„ÇíËøî„Åô
    return true;
  }

  // ÁßªÂãïÂæå„Å´ÁéãÊâã„ÅåÊÆã„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
  function isKingInCheckAfterMove(board) {
    // „Éó„É¨„Ç§„É§„Éº„ÅÆÁéã„ÅÆ‰ΩçÁΩÆ„ÇíÊé¢„Åô
    let playerKingRow = -1, playerKingCol = -1;
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = board[r][c];
        if (piece && piece.owner === 'player' && (piece.piece === 'Áéã' || piece.piece === 'Áéâ')) {
          playerKingRow = r;
          playerKingCol = c;
          break;
        }
      }
      if (playerKingRow !== -1) break;
    }
    
    if (playerKingRow === -1) return false;
    
    // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÈßí„Åã„ÇâÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÁ∞°ÊòìÁâàÔºâ
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = board[r][c];
        if (piece && piece.owner === 'computer') {
          // Á∞°ÊòìÁöÑ„Å™ÁéãÊâã„ÉÅ„Çß„ÉÉ„ÇØÔºàÁõ¥Êé•ÊîªÊíÉ„ÅÆ„ÅøÔºâ
          const directions = getPieceAttackDirections(piece.piece);
          for (const [dr, dc] of directions) {
            let nr = r + dr, nc = c + dc;
            while (nr >= 0 && nr < BOARD_SIZE && nc >= 0 && nc < BOARD_SIZE) {
              const target = board[nr][nc];
              if (target) {
                if (target.owner === 'player' && (target.piece === 'Áéã' || target.piece === 'Áéâ') && 
                    nr === playerKingRow && nc === playerKingCol) {
                  console.log(`‚ö†Ô∏è ÁéãÊâãÊÆãÂ≠ò: ${piece.piece} at [${r}][${c}] ‚Üí [${playerKingRow}][${playerKingCol}]`);
              return true;
            }
                break; // Èßí„Å´ÂΩì„Åü„Å£„Åü„ÇâÂÅúÊ≠¢
              }
              nr += dr;
              nc += dc;
            }
          }
        }
      }
    }
    
    return false;
  }

  // ÁßªÂãïÂæå„Å´„Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéãÊâã„ÅåÊÆã„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
  function isComputerKingInCheckAfterMove(board) {
    // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéã„ÅÆ‰ΩçÁΩÆ„ÇíÊé¢„Åô
    let computerKingRow = -1, computerKingCol = -1;
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = board[r][c];
        if (piece && piece.owner === 'computer' && (piece.piece === 'Áéã' || piece.piece === 'Áéâ')) {
          computerKingRow = r;
          computerKingCol = c;
          break;
        }
      }
      if (computerKingRow !== -1) break;
    }
    
    if (computerKingRow === -1) return false;
    
    // „Éó„É¨„Ç§„É§„Éº„ÅÆÈßí„Åã„ÇâÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÁ∞°ÊòìÁâàÔºâ
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = board[r][c];
        if (piece && piece.owner === 'player') {
          // Á∞°ÊòìÁöÑ„Å™ÁéãÊâã„ÉÅ„Çß„ÉÉ„ÇØÔºàÁõ¥Êé•ÊîªÊíÉ„ÅÆ„ÅøÔºâ
          const directions = getPieceAttackDirections(piece.piece);
          for (const [dr, dc] of directions) {
            let nr = r + dr, nc = c + dc;
            while (nr >= 0 && nr < BOARD_SIZE && nc >= 0 && nc < BOARD_SIZE) {
              const target = board[nr][nc];
              if (target) {
                if (target.owner === 'computer' && (target.piece === 'Áéã' || target.piece === 'Áéâ') && 
                    nr === computerKingRow && nc === computerKingCol) {
                  console.log(`‚ö†Ô∏è „Ç≥„É≥„Éî„É•„Éº„ÇøÁéãÊâãÊÆãÂ≠ò: ${piece.piece} at [${r}][${c}] ‚Üí [${computerKingRow}][${computerKingCol}]`);
                  return true;
                }
                break; // Èßí„Å´ÂΩì„Åü„Å£„Åü„ÇâÂÅúÊ≠¢
              }
              nr += dr;
              nc += dc;
            }
          }
        }
      }
    }
    
    return false;
  }

  // ÊåáÂÆö„Åï„Çå„ÅüÁõ§Èù¢„Åß„ÅÆÊúâÂäπÁßªÂãï„ÇíÂèñÂæó
  function getValidMovesForBoard(board, r, c) {
    const stage = STAGES[state.stageIndex];
    const sq = board[r][c]; 
    if (!sq) return [];
    
    // Â§âÂΩ¢Áä∂ÊÖã„ÄÅÊÑüÈõªÁä∂ÊÖã„ÅÆÈßí„ÅØÁßªÂãï„Åß„Åç„Å™„ÅÑ
    if (sq.isTransformed) return [];
    if (sq.isTimeStopped) return [];
    
    // ËôπËâ≤Âà∂ÈôêÁä∂ÊÖã„ÅÆÈßí„ÅØÁßªÂãïÁØÑÂõ≤„ÅåÂà∂Èôê„Åï„Çå„Çã
    if (sq.isRainbowLimited) {
      return getRainbowLimitedMoves(r, c);
    }
    
    // Ê≤º„Å´Êçï„Çâ„Åà„Çâ„Çå„ÅüÈßí„ÅØÁßªÂãïÁØÑÂõ≤„ÅåÂà∂Èôê„Åï„Çå„Çã
    if (sq.isSwampTrapped) {
      return getSwampTrappedMoves(r, c);
    }
    
    // ÂáçÁµêÁä∂ÊÖã„ÅÆÈßí„ÅØÁßªÂãï„Åß„Åç„Å™„ÅÑ
    if (state.frozenPieces && state.frozenPieces.some(frozen => frozen.row === r && frozen.col === c)) return [];
    
    const type = stage.pieces[sq.piece] || 'pawn';
    let moves = [];
    switch(type){
      case 'king': moves = kingMovesForBoard(board, r, c); break;
      case 'rook': moves = rookMovesForBoard(board, r, c); break;
      case 'bishop': moves = bishopMovesForBoard(board, r, c); break;
      case 'gold': moves = goldMovesForBoard(board, r, c); break;
      case 'silver': moves = silverMovesForBoard(board, r, c); break;
      case 'knight': moves = knightMovesForBoard(board, r, c); break;
      case 'lance': moves = lanceMovesForBoard(board, r, c); break;
      case 'pawn': moves = pawnMovesForBoard(board, r, c); break;
      case 'ninja': moves = ninjaMovesForBoard(board, r, c); break;
      case 'shadow': moves = shadowMovesForBoard(board, r, c); break;
      case 'cannon': moves = cannonMovesForBoard(board, r, c); break;
      case 'dragon': moves = dragonMovesForBoard(board, r, c); break;
      case 'Ëæ∞': moves = dragonAwakenedMovesForBoard(board, r, c); break;
      case 'phoenix': moves = phoenixMovesForBoard(board, r, c); break;
      case 'flame': moves = flameMovesForBoard(board, r, c); break;
      case 'fire': moves = fireMovesForBoard(board, r, c); break;
      case 'water': moves = waterMovesForBoard(board, r, c); break;
      case 'wave': moves = waveMovesForBoard(board, r, c); break;
      case 'tree': moves = treeMovesForBoard(board, r, c); break;
      case 'leaf': moves = leafMovesForBoard(board, r, c); break;
      case 'light': moves = lightMovesForBoard(board, r, c); break;
      case 'star': moves = starMovesForBoard(board, r, c); break;
      case 'dark': moves = darkMovesForBoard(board, r, c); break;
      case 'demon': moves = demonMovesForBoard(board, r, c); break;
      case 'copper': moves = copperMovesForBoard(board, r, c); break;
      case 'iron': moves = ironMovesForBoard(board, r, c); break;
      case 'tin': moves = tinMovesForBoard(board, r, c); break;
      case 'lead': moves = leadMovesForBoard(board, r, c); break;
      case 'treasure': moves = treasureMovesForBoard(board, r, c); break;
      case 'electric': moves = electricMovesForBoard(board, r, c); break;
      case 'thunder': moves = thunderMovesForBoard(board, r, c); break;
      case 'time': moves = timeMovesForBoard(board, r, c); break;
      case 'ice': moves = iceMovesForBoard(board, r, c); break;
      case 'snow': moves = snowMovesForBoard(board, r, c); break;
      case 'sand': moves = sandMovesForBoard(board, r, c); break;
      case 'wind': moves = windMovesForBoard(board, r, c); break;
      case 'ocean': moves = oceanMovesForBoard(board, r, c); break;
      case 'fish': moves = fishMovesForBoard(board, r, c); break;
      case 'moss': moves = mossMovesForBoard(board, r, c); break;
      case 'cloud': moves = cloudMovesForBoard(board, r, c); break;
      case 'rainbow': moves = rainbowMovesForBoard(board, r, c); break;
      case 'rock': moves = rockMovesForBoard(board, r, c); break;
      case 'ore': moves = oreMovesForBoard(board, r, c); break;
      case 'mineral': moves = mineralMovesForBoard(board, r, c); break;
      case 'phantom': moves = phantomMovesForBoard(board, r, c); break;
      case 'mist': moves = mistMovesForBoard(board, r, c); break;
      case 'end': moves = endMovesForBoard(board, r, c); break;
      case 'destiny': moves = destinyMovesForBoard(board, r, c); break;
      case 'ah': moves = ahMovesForBoard(board, r, c); break;
      case 'prison': moves = prisonMovesForBoard(board, r, c); break;
      case 'fence': moves = fenceMovesForBoard(board, r, c); break;
      case 'ridge': moves = ridgeMovesForBoard(board, r, c); break;
      case 'peak': moves = peakMovesForBoard(board, r, c); break;
      case 'mountain': moves = mountainMovesForBoard(board, r, c); break;
      case 'poison': moves = poisonMovesForBoard(board, r, c); break;
      case 'swamp': moves = swampMovesForBoard(board, r, c); break;
      case 'grave': moves = graveMovesForBoard(board, r, c); break;
      case 'spirit': moves = spiritMovesForBoard(board, r, c); break;
      case 'machine': moves = machineMovesForBoard(board, r, c); break;
      case 'gear': moves = gearMovesForBoard(board, r, c); break;
      case 'moon': moves = moonMovesForBoard(board, r, c); break;
      case 'boat': moves = boatMovesForBoard(board, r, c); break;
      case 'mirror': moves = mirrorMovesForBoard(board, r, c); break;
      case 'reflection': moves = reflectionMovesForBoard(board, r, c); break;
      case 'curse': moves = curseMovesForBoard(board, r, c); break;
      case 'field': moves = fieldMovesForBoard(board, r, c); break;
      case 'house': moves = houseMovesForBoard(board, r, c); break;
      case 'people': moves = peopleMovesForBoard(board, r, c); break;
      case 'spring': moves = springMovesForBoard(board, r, c); break;
      case 'experiment': moves = experimentMovesForBoard(board, r, c); break;
      case 'mutant': moves = mutantMovesForBoard(board, r, c); break;
      case 'holy': moves = holyMovesForBoard(board, r, c); break;
      case 'k': moves = kMovesForBoard(board, r, c); break;
      default: return [];
    }
    
    // Ëá™ÂàÜ„ÅÆÁéã„ÇíÂèñ„ÇãÊâã„ÇíÈô§Â§ñ
    moves = moves.filter(move => {
      const targetPiece = board[move.r][move.c];
      if (targetPiece && (targetPiece.piece === 'Áéã' || targetPiece.piece === 'Áéâ')) {
        // Ëá™ÂàÜ„ÅÆÁéã„ÇíÂèñ„Çç„ÅÜ„Å®„Åô„ÇãÊâã„ÅØÈô§Â§ñ
        if (targetPiece.owner === sq.owner) {
          return false;
        }
      }
      return true;
    });
    
    return moves;
  }

  // ÂêÑÈßí„ÅÆÁßªÂãïÈñ¢Êï∞ÔºàÁõ§Èù¢ÊåáÂÆöÁâàÔºâ
  function kingMovesForBoard(board, r, c) {
    const owner = board[r][c].owner;
    const dirs=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    const m=[]; dirs.forEach(([dr,dc])=>pushIfEnemyOrEmptyForBoard(m, board, r+dr, c+dc, owner));
    return m;
  }
  
  function pushIfEnemyOrEmptyForBoard(moves, board, r, c, owner) {
    if (!inBounds(r,c)) return false;
    
    // ÊØí„Éû„Çπ„Å∏„ÅÆÁßªÂãïÂà∂ÈôêÔºàÁõ∏Êâã„ÅÆÈßí„ÅÆ„ÅøÔºâ
    if (isPoisonSquare(r, c) && owner !== state.currentPlayer) {
      return false;
    }
    
    const t = board[r][c];
    if (!t){ moves.push({r,c}); return true; }
    // √ó„Éû„ÇπÔºà'X'Ôºâ„Å∏„ÅÆÁßªÂãï„ÅØÂÆåÂÖ®„Å´Á¶ÅÊ≠¢
    if (t.piece === 'X'){ return false; }
    // Âë™„ÅÑ„Éû„ÇπÔºà'n'Ôºâ„ÄÅÁü¢Âç∞„Éû„ÇπÔºà'‚Üë','‚Üê','‚Üì','‚Üí'Ôºâ„Å∏„ÅÆÁßªÂãïÊôÇ„ÅØÂèñ„Çã„Åì„Å®„Åå„Åß„Åç„Å™„ÅÑ
    if (t.piece === 'n' || ['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(t.piece)){ 
      moves.push({r,c}); 
      return true; 
    }
    if (t.owner !== owner){ moves.push({r,c}); return false; }
    return false;
  }
  
  // ‰ªñ„ÅÆÈßí„ÅÆÁßªÂãïÈñ¢Êï∞„ÇÇÂêåÊßò„Å´ÂÆüË£ÖÔºàÁ∞°Áï•Âåñ„ÅÆ„Åü„ÇÅ‰∏ªË¶Å„Å™„ÇÇ„ÅÆ„ÅÆ„ÅøÔºâ
  function rookMovesForBoard(board, r, c) { 
    const o=board[r][c].owner, m=[]; 
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(d=>slideForBoard(m,board,r,c,o,d[0],d[1])); 
    return m; 
  }
  
  function slideForBoard(moves, board, r, c, owner, dr, dc, maxSteps=99) {
    for (let i=1;i<=maxSteps;i++){
      const nr=r+dr*i, nc=c+dc*i; if (!inBounds(nr,nc)) break;
      const t=board[nr][nc];
      if (!t){ moves.push({r:nr,c:nc}); continue; }
      // √ó„Éû„ÇπÔºà'X'Ôºâ„Å∏„ÅÆÁßªÂãï„ÅØÂÆåÂÖ®„Å´Á¶ÅÊ≠¢
      if (t.piece === 'X'){ break; }
      // Âë™„ÅÑ„Éû„ÇπÔºà'n'Ôºâ„ÄÅÁü¢Âç∞„Éû„ÇπÔºà'‚Üë','‚Üê','‚Üì','‚Üí'Ôºâ„ÅØÂèñ„Çå„Å™„ÅÑ„ÅåÁßªÂãï„ÅØÂèØËÉΩ
      if (t.piece === 'n' || ['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(t.piece)){ 
        moves.push({r:nr,c:nc}); 
        continue; 
      }
      if (t.owner!==owner){ moves.push({r:nr,c:nc}); }
      break;
    }
  }
  
  // ‰ªñ„ÅÆÈßí„ÅÆÁßªÂãïÈñ¢Êï∞„ÅØÊó¢Â≠ò„ÅÆÈñ¢Êï∞„ÇíÊµÅÁî®ÔºàÁ∞°Áï•ÂåñÔºâ
  function bishopMovesForBoard(board, r, c) { return bishopMoves(r, c); }
  function goldMovesForBoard(board, r, c) { return goldMoves(r, c); }
  function silverMovesForBoard(board, r, c) { return silverMoves(r, c); }
  function knightMovesForBoard(board, r, c) { return knightMoves(r, c); }
  function lanceMovesForBoard(board, r, c) { return lanceMoves(r, c); }
  function pawnMovesForBoard(board, r, c) { return pawnMoves(r, c); }
  function ninjaMovesForBoard(board, r, c) { return ninjaMoves(r, c); }
  function shadowMovesForBoard(board, r, c) { return shadowMoves(r, c); }
  function cannonMovesForBoard(board, r, c) { return cannonMoves(r, c); }
  function dragonMovesForBoard(board, r, c) { return dragonMoves(r, c); }
  function dragonAwakenedMovesForBoard(board, r, c) { return dragonAwakenedMoves(r, c); }
  function phoenixMovesForBoard(board, r, c) { return phoenixMoves(r, c); }
  function flameMovesForBoard(board, r, c) { return flameMoves(r, c); }
  function fireMovesForBoard(board, r, c) { return fireMoves(r, c); }
  function waterMovesForBoard(board, r, c) { return waterMoves(r, c); }
  function waveMovesForBoard(board, r, c) { return waveMoves(r, c); }
  function treeMovesForBoard(board, r, c) { return treeMoves(r, c); }
  function leafMovesForBoard(board, r, c) { return leafMoves(r, c); }
  function lightMovesForBoard(board, r, c) { return lightMoves(r, c); }
  function starMovesForBoard(board, r, c) { return starMoves(r, c); }
  function darkMovesForBoard(board, r, c) { return darkMoves(r, c); }
  function demonMovesForBoard(board, r, c) { return demonMoves(r, c); }
  function copperMovesForBoard(board, r, c) { return copperMoves(r, c); }
  function ironMovesForBoard(board, r, c) { return ironMoves(r, c); }
  function tinMovesForBoard(board, r, c) { return tinMoves(r, c); }
  function leadMovesForBoard(board, r, c) { return leadMoves(r, c); }
  function treasureMovesForBoard(board, r, c) { return treasureMoves(r, c); }
  function electricMovesForBoard(board, r, c) { return electricMoves(r, c); }
  function thunderMovesForBoard(board, r, c) { return thunderMoves(r, c); }
  function timeMovesForBoard(board, r, c) { return timeMoves(r, c); }
  function iceMovesForBoard(board, r, c) { return iceMoves(r, c); }
  function snowMovesForBoard(board, r, c) { return snowMoves(r, c); }
  function sandMovesForBoard(board, r, c) { return sandMoves(r, c); }
  function windMovesForBoard(board, r, c) { return windMoves(r, c); }
  function mossMovesForBoard(board, r, c) { return mossMoves(r, c); }
  function oceanMovesForBoard(board, r, c) { return oceanMoves(r, c); }
  function fishMovesForBoard(board, r, c) { return fishMoves(r, c); }
  function cloudMovesForBoard(board, r, c) { return cloudMoves(r, c); }
  function rainbowMovesForBoard(board, r, c) { return rainbowMoves(r, c); }
  function rockMovesForBoard(board, r, c) { return rockMoves(r, c); }
  function mineralMovesForBoard(board, r, c) { return mineralMoves(r, c); }
  function phantomMovesForBoard(board, r, c) { return phantomMoves(r, c); }
  function mistMovesForBoard(board, r, c) { return mistMoves(r, c); }
  function endMovesForBoard(board, r, c) { return endMoves(r, c); }
  function destinyMovesForBoard(board, r, c) { return destinyMoves(r, c); }
  function ahMovesForBoard(board, r, c) { return ahMoves(r, c); }
  function prisonMovesForBoard(board, r, c) { return prisonMoves(r, c); }
  function fenceMovesForBoard(board, r, c) { return fenceMoves(r, c); }
  function ridgeMovesForBoard(board, r, c) { return ridgeMoves(r, c); }
  function peakMovesForBoard(board, r, c) { return peakMoves(r, c); }
  function rockMovesForBoard(board, r, c) { return rockMoves(r, c); }
  function oreMovesForBoard(board, r, c) { return oreMoves(r, c); }
  function mountainMovesForBoard(board, r, c) { return mountainMoves(r, c); }
  function poisonMovesForBoard(board, r, c) { return poisonMoves(r, c); }
  function swampMovesForBoard(board, r, c) { return swampMoves(r, c); }
  function graveMovesForBoard(board, r, c) { return graveMoves(r, c); }
  function spiritMovesForBoard(board, r, c) { return spiritMoves(r, c); }
  function machineMovesForBoard(board, r, c) { return machineMoves(r, c); }
  function gearMovesForBoard(board, r, c) { return gearMoves(r, c); }
  function moonMovesForBoard(board, r, c) { return moonMoves(r, c); }
  function boatMovesForBoard(board, r, c) { return boatMoves(r, c); }
  function mirrorMovesForBoard(board, r, c) { return mirrorMoves(r, c); }
  function reflectionMovesForBoard(board, r, c) { return reflectionMoves(r, c); }
  function curseMovesForBoard(board, r, c) { return curseMoves(r, c); }
  function fieldMovesForBoard(board, r, c) { return fieldMoves(r, c); }
  function houseMovesForBoard(board, r, c) { return houseMoves(r, c); }
  function peopleMovesForBoard(board, r, c) { return peopleMoves(r, c); }
  function springMovesForBoard(board, r, c) { return springMoves(r, c); }
  function experimentMovesForBoard(board, r, c) { return experimentMoves(r, c); }
  function mutantMovesForBoard(board, r, c) { return mutantMoves(r, c); }
  function holyMovesForBoard(board, r, c) { return holyMoves(r, c); }
  function kMovesForBoard(board, r, c) { return kMoves(r, c); }
  function swordMovesForBoard(board, r, c) { return swordMoves(r, c); }
  function armorMovesForBoard(board, r, c) { return armorMoves(r, c); }
  function gunMovesForBoard(board, r, c) { return gunMoves(r, c); }
  function bookMovesForBoard(board, r, c) { return bookMoves(r, c); }
  function sealMovesForBoard(board, r, c) { return sealMoves(r, c); }

  // Èßí„ÅÆ‰æ°ÂÄ§„ÇíÂèñÂæó
  function getPieceValue(piece) {
    const values = {
      'Áéã': 10000, 'Áéâ': 10000,
      'È£õ': 500, 'Ëßí': 500,
      'Èáë': 300, 'ÈäÄ': 200,
      'Ê°Ç': 150, 'È¶ô': 100,
      'Ê≠©': 50,
      'Âøç': 400, 'ÂΩ±': 350, 'Á†≤': 450,
      'Á´ú': 600, 'È≥≥': 600,
      'ÁÇé': 400, 'ÁÅ´': 350,
      'Ê∞¥': 300, 'Ê≥¢': 250,
      'Êú®': 300, 'Ëëâ': 200,
      'ÂÖâ': 450, 'Êòü': 400,
      'Èóá': 350, 'È≠î': 450,
      'ÈäÖ': 250, 'ÈâÑ': 200, 'Èå´': 200, 'Èâõ': 200,
      'ÂÆù': 800, 'Èõª': 450, 'Èõ∑': 450,
      'ÊôÇ': 500, 'Ê∞∑': 300, 'Èõ™': 250, 'Á†Ç': 200, 'È¢®': 200,
      'Ëãî': 150, 'È≠ö': 200, 'Èõ≤': 300, 'Ëôπ': 350,
      'Â≤©': 200, 'Èâ±': 250, 'Âπª': 400, 'Èúß': 300,
      'ÁµÇ': 600, 'ÁÑâ': 500, '„ÅÇ': 700,
      'Áâ¢': 300, 'Êüµ': 200, 'Â∂∫': 400, 'Â≥∞': 450,
      'ÊØí': 350, 'Ê≤º': 300, 'Â¢ì': 400, 'Èúä': 450,
      'Ê©ü': 500, 'Êúà': 600, 'Èè°': 400, 'Êò†': 350,
      'Âë™': 300, 'Áïë': 200, 'ÂÆ∂': 250, 'Ê∞ë': 200, 'Ê≥â': 500, 'ËÅñ': 600, 'K': 800
    };
    return values[piece] || 100;
  }

  // ‰ΩçÁΩÆ„ÅÆË©ï‰æ°ÔºàÈ´òÈÄüÂåñÁâàÔºâ
  function evaluatePositionFast(row, col, pieceType) {
    let score = 0;
    
    // 1. Âü∫Êú¨ÁöÑ‰ΩçÁΩÆË©ï‰æ°ÔºàÈ´òÈÄüÂåñÔºâ
    score += evaluateBasicPositionFast(row, col, pieceType);
    
    // 2. ÁâπÊÆäÈßí„ÅÆ‰ΩçÁΩÆË©ï‰æ°ÔºàÈ´òÈÄüÂåñÔºâ
    score += evaluateSpecialPiecePositionFast(row, col, pieceType);
    
    return score;
  }

  // Âü∫Êú¨ÁöÑ‰ΩçÁΩÆË©ï‰æ°ÔºàÈ´òÈÄüÂåñÁâàÔºâ
  function evaluateBasicPositionFast(row, col, pieceType) {
    let score = 0;
    
    // ‰∏≠Â§ÆÈÉ®„ÅÆÂà∂Âæ°ÔºàÂ∞ÜÊ£ã„ÅÆÂü∫Êú¨Ôºâ
    if (row >= 3 && row <= 5 && col >= 3 && col <= 5) {
      score += 15;
    }
    
    // ÊîªÊíÉÈßí„ÅÆÂâçÈÄ≤ÔºàÊ≠©„ÉªÈ¶ô„ÉªÊ°ÇÔºâ
    if (pieceType === 'Ê≠©' || pieceType === 'È¶ô' || pieceType === 'Ê°Ç') {
      if (row < 3) {
        score += 25;
      } else if (row < 4) {
        score += 20;
      }
    }
    
    // ÂÆàÂÇôÈßí„ÅÆÈÖçÁΩÆÔºàÈáë„ÉªÈäÄÔºâ
    if (pieceType === 'Èáë' || pieceType === 'ÈäÄ') {
      if (row > 6) {
        score += 20;
      } else if (row > 5) {
        score += 15;
      }
    }
    
    // È£õËªä„ÉªËßíË°å„ÅÆÈÖçÁΩÆ
    if (pieceType === 'È£õ' || pieceType === 'Ëßí') {
      if (row >= 3 && row <= 5) {
        score += 30;
      }
    }
    
    return score;
  }

  // ÁâπÊÆäÈßí„ÅÆ‰ΩçÁΩÆË©ï‰æ°ÔºàÈ´òÈÄüÂåñÁâàÔºâ
  function evaluateSpecialPiecePositionFast(row, col, pieceType) {
    let score = 0;
    
    // Èõª„ÉªÈõ∑„ÅÆÈßí
    if (pieceType === 'Èõª' || pieceType === 'Èõ∑') {
      if (row < 4) {
        score += 30;
      }
    }
    
    // ÂÆù„ÅÆÈßí
    if (pieceType === 'ÂÆù') {
      if (row > 5) {
        score += 25;
      }
    }
    
    // ÁÇé„ÉªÁÅ´„ÅÆÈßí
    if (pieceType === 'ÁÇé' || pieceType === 'ÁÅ´') {
      if (row < 4) {
        score += 20;
      }
    }
    
    return score;
  }

  // Âü∫Êú¨ÁöÑ‰ΩçÁΩÆË©ï‰æ°ÔºàÂ∞ÜÊ£ã„Çª„Ç™„É™„ÉºÔºâ
  function evaluateBasicPosition(row, col, pieceType) {
    let score = 0;
    
    // ‰∏≠Â§ÆÈÉ®„ÅÆÂà∂Âæ°ÔºàÂ∞ÜÊ£ã„ÅÆÂü∫Êú¨Ôºâ
    if (row >= 3 && row <= 5 && col >= 3 && col <= 5) {
      score += 15; // ‰∏≠Â§ÆÈÉ®„ÅÆÈáçË¶ÅÊÄß
    }
    
    // ÊîªÊíÉÈßí„ÅÆÂâçÈÄ≤ÔºàÊ≠©„ÉªÈ¶ô„ÉªÊ°ÇÔºâ
    if (pieceType === 'Ê≠©' || pieceType === 'È¶ô' || pieceType === 'Ê°Ç') {
      if (row < 3) { // ÊïµÈô£ÂÜÖ
        score += 25; // ÊïµÈô£„Åß„ÅÆ‰æ°ÂÄ§
      } else if (row < 4) { // ÊïµÈô£„Å´Ëøë„ÅÑ
        score += 20; // ÂâçÈÄ≤„ÅÆ‰æ°ÂÄ§
      }
    }
    
    // ÂÆàÂÇôÈßí„ÅÆÈÖçÁΩÆÔºàÈáë„ÉªÈäÄÔºâ
    if (pieceType === 'Èáë' || pieceType === 'ÈäÄ') {
      if (row > 6) { // Ëá™Èô£ÂÜÖ
        score += 20; // ÂÆàÂÇô„ÅÆ‰æ°ÂÄ§
      } else if (row > 5) { // Ëá™Èô£„Å´Ëøë„ÅÑ
        score += 15; // ÂÆàÂÇôÊ∫ñÂÇô
      }
    }
    
    // È£õËªä„ÉªËßíË°å„ÅÆÈÖçÁΩÆ
    if (pieceType === 'È£õ' || pieceType === 'Ëßí') {
      if (row >= 3 && row <= 5) { // ‰∏≠Â§ÆÈÉ®
        score += 30; // ‰∏≠Â§Æ„Åß„ÅÆÂ®ÅÂäõ
      }
    }
    
    return score;
  }

  // Êà¶Ë°ìÁöÑ‰ΩçÁΩÆË©ï‰æ°
  function evaluateTacticalPosition(row, col, pieceType) {
    let score = 0;
    
    // Èßí„ÅÆÈÄ£Êê∫
    score += evaluatePieceCoordination(row, col, pieceType);
    
    // Èßí„ÅÆÊ©üÂãïÊÄß
    score += evaluatePieceMobility(row, col, pieceType);
    
    // Èßí„ÅÆÂÆàÂÇôÂäõ
    score += evaluatePieceDefense(row, col, pieceType);
    
    return score;
  }

  // Êà¶Áï•ÁöÑ‰ΩçÁΩÆË©ï‰æ°
  function evaluateStrategicPosition(row, col, pieceType) {
    let score = 0;
    
    // Â±ÄÈù¢„ÅÆ‰∏ªÂ∞éÊ®©
    score += evaluatePositionalControl(row, col, pieceType);
    
    // Èßí„ÅÆ‰æ°ÂÄ§„ÅÆÂêë‰∏ä
    score += evaluatePieceValueEnhancement(row, col, pieceType);
    
    // ÁµÇÁõ§„Å∏„ÅÆÊ∫ñÂÇô
    score += evaluateEndgamePreparation(row, col, pieceType);
    
    return score;
  }

  // ÁâπÊÆäÈßí„ÅÆ‰ΩçÁΩÆË©ï‰æ°
  function evaluateSpecialPiecePosition(row, col, pieceType) {
    let score = 0;
    
    // Èõª„ÉªÈõ∑„ÅÆÈßí
    if (pieceType === 'Èõª' || pieceType === 'Èõ∑') {
      if (row < 4) { // ÊïµÈô£„Å´Ëøë„ÅÑ‰ΩçÁΩÆ
        score += 30;
      }
    }
    
    // ÂÆù„ÅÆÈßí
    if (pieceType === 'ÂÆù') {
      if (row > 5) { // Ëá™Èô£ÂÜÖ„ÅßÂë≥ÊñπÈßí„Çí‰øùË≠∑
        score += 25;
      }
    }
    
    // ÁÇé„ÉªÁÅ´„ÅÆÈßí
    if (pieceType === 'ÁÇé' || pieceType === 'ÁÅ´') {
      if (row < 4) { // ÊïµÈô£„Åß„ÅÆÂäπÊûú
        score += 20;
      }
    }
    
    return score;
  }

  // Èßí„ÅÆÈÄ£Êê∫Ë©ï‰æ°
  function evaluatePieceCoordination(row, col, pieceType) {
    let score = 0;
    
    // ÈáëÈäÄ„ÅÆÈÄ£Êê∫
    if (pieceType === 'Èáë' || pieceType === 'ÈäÄ') {
      const nearbyGoldSilver = countNearbyPieces(row, col, ['Èáë', 'ÈäÄ']);
      score += nearbyGoldSilver * 10;
    }
    
    // Ê≠©„ÅÆÈÄ£Êê∫ÔºàÊ≠©„ÅÆÂ£ÅÔºâ
    if (pieceType === 'Ê≠©') {
      const nearbyPawns = countNearbyPieces(row, col, ['Ê≠©']);
      score += nearbyPawns * 5;
    }
    
    // È¶ôËªä„ÅÆÈÄ£Êê∫
    if (pieceType === 'È¶ô') {
      const nearbyLances = countNearbyPieces(row, col, ['È¶ô']);
      score += nearbyLances * 8;
    }
    
    return score;
  }

  // Èßí„ÅÆÊ©üÂãïÊÄßË©ï‰æ°
  function evaluatePieceMobility(row, col, pieceType) {
    let score = 0;
    
    // ‰∏≠Â§ÆÈÉ®„Åß„ÅÆÊ©üÂãïÊÄß
    if (row >= 3 && row <= 5 && col >= 3 && col <= 5) {
      if (pieceType === 'È£õ' || pieceType === 'Ëßí') {
        score += 20; // ‰∏≠Â§Æ„Åß„ÅÆÊ©üÂãïÊÄß
      }
    }
    
    // ÊïµÈô£„Åß„ÅÆÊ©üÂãïÊÄß
    if (row < 4) {
      if (pieceType === 'Ê°Ç' || pieceType === 'È¶ô') {
        score += 15; // ÊïµÈô£„Åß„ÅÆÊ©üÂãïÊÄß
      }
    }
    
    return score;
  }

  // Èßí„ÅÆÂÆàÂÇôÂäõË©ï‰æ°
  function evaluatePieceDefense(row, col, pieceType) {
    let score = 0;
    
    // Ëá™Èô£„Åß„ÅÆÂÆàÂÇôÂäõ
    if (row > 5) {
      if (pieceType === 'Èáë' || pieceType === 'ÈäÄ') {
        score += 15; // Ëá™Èô£„Åß„ÅÆÂÆàÂÇôÂäõ
      }
    }
    
    // Áéã„ÅÆÂë®Âõ≤„Åß„ÅÆÂÆàÂÇôÂäõ
    const computerKing = findComputerKing();
    if (computerKing) {
      const distance = Math.abs(row - computerKing.row) + Math.abs(col - computerKing.col);
      if (distance <= 2) {
        score += 20; // Áéã„ÅÆËøë„Åè„Åß„ÅÆÂÆàÂÇôÂäõ
      }
    }
    
    return score;
  }

  // Â±ÄÈù¢„ÅÆ‰∏ªÂ∞éÊ®©Ë©ï‰æ°
  function evaluatePositionalControl(row, col, pieceType) {
    let score = 0;
    
    // ‰∏≠Â§ÆÈÉ®„ÅÆÂà∂Âæ°
    if (row >= 3 && row <= 5 && col >= 3 && col <= 5) {
      score += 10;
    }
    
    // ÊïµÈô£„Å∏„ÅÆÈÄ≤Âá∫
    if (row < 4) {
      score += 15;
    }
    
    // ÈáçË¶Å„Å™Á∏¶Á∑ö„ÉªÊ®™Á∑ö„ÅÆÂà∂Âæ°
    if (col === 4) { // ‰∏≠Â§ÆÁ∏¶Á∑ö
      score += 10;
    }
    if (row === 4) { // ‰∏≠Â§ÆÊ®™Á∑ö
      score += 10;
    }
    
    return score;
  }

  // Èßí„ÅÆ‰æ°ÂÄ§Âêë‰∏äË©ï‰æ°
  function evaluatePieceValueEnhancement(row, col, pieceType) {
    let score = 0;
    
    // ÊïµÈô£„Åß„ÅÆ‰æ°ÂÄ§Âêë‰∏ä
    if (row < 3) {
      if (pieceType === 'Ê≠©') {
        score += 20; // ÊïµÈô£„Åß„ÅÆÊ≠©„ÅÆ‰æ°ÂÄ§
      } else if (pieceType === 'È¶ô') {
        score += 25; // ÊïµÈô£„Åß„ÅÆÈ¶ô„ÅÆ‰æ°ÂÄ§
      }
    }
    
    // ‰∏≠Â§ÆÈÉ®„Åß„ÅÆ‰æ°ÂÄ§Âêë‰∏ä
    if (row >= 3 && row <= 5 && col >= 3 && col <= 5) {
      if (pieceType === 'Ê°Ç') {
        score += 15; // ‰∏≠Â§Æ„Åß„ÅÆÊ°Ç„ÅÆ‰æ°ÂÄ§
      }
    }
    
    return score;
  }

  // ÁµÇÁõ§„Å∏„ÅÆÊ∫ñÂÇôË©ï‰æ°
  function evaluateEndgamePreparation(row, col, pieceType) {
    let score = 0;
    
    // ÊïµÁéã„Å∏„ÅÆÊé•Ëøë
    const playerKing = findPlayerKing();
    if (playerKing) {
      const distance = Math.abs(row - playerKing.row) + Math.abs(col - playerKing.col);
      if (distance <= 3) {
        score += 20; // ÊïµÁéã„Å∏„ÅÆÊé•Ëøë
      }
    }
    
    // ÁµÇÁõ§„Åß„ÅÆÈßí„ÅÆ‰æ°ÂÄ§
    if (pieceType === 'Ê≠©' || pieceType === 'È¶ô') {
      if (row < 3) {
        score += 15; // ÁµÇÁõ§„Åß„ÅÆÂâçÈÄ≤Èßí„ÅÆ‰æ°ÂÄ§
      }
    }
    
    return score;
  }

  // Âë®Âõ≤„ÅÆÁâπÂÆö„ÅÆÈßí„ÅÆÊï∞„Çí„Ç´„Ç¶„É≥„Éà
  function countNearbyPieces(row, col, pieceTypes) {
    let count = 0;
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = row + d[0], nc = col + d[1];
      if (inBounds(nr, nc) && state.board[nr][nc] && 
          state.board[nr][nc].owner === 'computer' &&
          pieceTypes.includes(state.board[nr][nc].piece)) {
        count++;
      }
    });
    return count;
  }

  // „Éó„É¨„Ç§„É§„Éº„ÅÆÁéã„ÅÆ‰ΩçÁΩÆ„ÇíÊé¢„Åô
  function findPlayerKing() {
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'player' && (piece.piece === 'Áéã' || piece.piece === 'Áéâ')) {
          return { row: r, col: c };
        }
      }
    }
    return null;
  }

  // ÂÆâÂÖ®„Å™‰ΩçÁΩÆ„Åã„Å©„ÅÜ„Åã„ÇíÂà§ÂÆöÔºàÈ´òÈÄüÂåñÁâàÔºâ
  function isSafePositionFast(row, col) {
    // ‰∏ªË¶Å„Å™ÊîªÊíÉÈßí„ÅÆ„Åø„ÉÅ„Çß„ÉÉ„ÇØÔºàÈ´òÈÄüÂåñÔºâ
    const attackPieces = ['È£õ', 'Ëßí', 'Ê°Ç', 'È¶ô', 'Ê≠©'];
    
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'player' && attackPieces.includes(piece.piece)) {
          // Á∞°ÊòìÁöÑ„Å™ÊîªÊíÉÁØÑÂõ≤„ÉÅ„Çß„ÉÉ„ÇØ
          if (canAttackFast(r, c, row, col, piece.piece)) {
            return false; // Êïµ„ÅÆÊîªÊíÉÁØÑÂõ≤ÂÜÖ
          }
        }
      }
    }
    return true; // ÂÆâÂÖ®
  }

  // ÊîªÊíÉÁöÑ„Å™‰ΩçÁΩÆ„Åã„Å©„ÅÜ„Åã„ÇíÂà§ÂÆöÔºàÊîªÊíÉÈáçË¶ñÁâà„ÉªÁéã„ÅÆÁßªÂãïÊäëÂà∂„ÉªÂ§ßÂπÖÂº∑ÂåñÔºâ
  function isAttackingPosition(row, col) {
    let score = 0;
    
    // ÊïµÈô£„Å∏„ÅÆÊé•ËøëÂ∫¶„ÇíË©≥Á¥∞Ë©ï‰æ°ÔºàÂ§ßÂπÖÂº∑ÂåñÔºâ
    if (row < 3) { // ÊïµÈô£ÂÜÖ
      score += 50; // 30„Åã„Çâ50„Å´Â§ßÂπÖÂº∑Âåñ
    } else if (row < 4) { // ÊïµÈô£„Å´Ëøë„ÅÑ
      score += 35; // 20„Åã„Çâ35„Å´Â§ßÂπÖÂº∑Âåñ
    } else if (row < 5) { // ‰∏≠Áõ§„Åß„ÅÆÂâçÈÄ≤
      score += 20; // 10„Åã„Çâ20„Å´Â§ßÂπÖÂº∑Âåñ
    }
    
    // ‰∏≠Â§ÆÈÉ®„Åß„ÅÆÊîªÊíÉÊÄßÔºàÂº∑ÂåñÔºâ
    if (col >= 3 && col <= 5) {
      score += 25; // 15„Åã„Çâ25„Å´Âº∑Âåñ
    }
    
    // ÊïµÁéã„Å∏„ÅÆÊé•ËøëÂ∫¶ÔºàÊîªÊíÉÈáçË¶ñ„ÉªÁéã„ÅÆÁßªÂãïÊäëÂà∂„ÉªÂ§ßÂπÖÂº∑ÂåñÔºâ
    const playerKing = findPlayerKing();
    if (playerKing) {
      const distance = Math.abs(row - playerKing.row) + Math.abs(col - playerKing.col);
      if (distance <= 3) {
        score += 40; // 25„Åã„Çâ40„Å´Â§ßÂπÖÂº∑Âåñ
      } else if (distance <= 5) {
        score += 25; // 15„Åã„Çâ25„Å´Â§ßÂπÖÂº∑Âåñ
      }
    }
    
    // ÊïµÈßí„Å∏„ÅÆËÑÖÂ®ÅÂ∫¶ÔºàÊñ∞Ë¶èËøΩÂä†Ôºâ
    const nearbyEnemies = countNearbyEnemiesFast(row, col);
    score += nearbyEnemies * 10; // Âë®Âõ≤„ÅÆÊïµÈßíÊï∞„Å´Âøú„Åò„Å¶„Éú„Éº„Éä„Çπ
    
    return score;
  }

  // ÁâπÊÆäÈßí„ÅÆ„Çπ„Ç≠„É´Ê¥ªÁî®Ë©ï‰æ°ÔºàÈ´òÈÄüÂåñÁâà„ÉªÊîªÊíÉÊÄßÂ§ßÂπÖÂº∑ÂåñÔºâ
  function evaluateSpecialPieceSkillFast(piece, move) {
    let score = 0;
    
    // Èõª„ÅÆÈßí: ÊïµÈßí„ÅÆËøë„Åè„Å´ÈÖçÁΩÆÔºàÂ§ßÂπÖÂº∑ÂåñÔºâ
    if (piece.piece === 'Èõª') {
      const nearbyEnemies = countNearbyEnemiesFast(move.r, move.c);
      score += nearbyEnemies * 40; // 25„Åã„Çâ40„Å´Â§ßÂπÖÂº∑Âåñ
    }
    
    // Èõ∑„ÅÆÈßí: ÊïµÈô£„Å´Ëøë„ÅÑ‰ΩçÁΩÆÔºàÂ§ßÂπÖÂº∑ÂåñÔºâ
    if (piece.piece === 'Èõ∑') {
      if (move.r < 3) {
        score += 80; // 50„Åã„Çâ80„Å´Â§ßÂπÖÂº∑Âåñ
      } else if (move.r < 4) {
        score += 50; // 30„Åã„Çâ50„Å´Â§ßÂπÖÂº∑Âåñ
      }
    }
    
    // ÂÆù„ÅÆÈßí: Âë≥ÊñπÈßí„ÅÆËøë„Åè„Å´ÈÖçÁΩÆÔºàÂº∑ÂåñÔºâ
    if (piece.piece === 'ÂÆù') {
      const nearbyAllies = countNearbyAlliesFast(move.r, move.c);
      score += nearbyEnemies * 20; // 15„Åã„Çâ20„Å´Âº∑Âåñ
    }
    
    // ÁÇé„ÅÆÈßí: ÊïµÈßí„ÅÆËøë„Åè„Å´ÈÖçÁΩÆÔºàÂ§ßÂπÖÂº∑ÂåñÔºâ
    if (piece.piece === 'ÁÇé' || piece.piece === 'ÁÅ´') {
      const nearbyEnemies = countNearbyEnemiesFast(move.r, move.c);
      score += nearbyEnemies * 35; // 20„Åã„Çâ35„Å´Â§ßÂπÖÂº∑Âåñ
    }
    
    // Á´ú„ÉªÈ≥≥„ÅÆÈßí: ÊïµÈô£„Åß„ÅÆÊ¥ªÁî®ÔºàÂ§ßÂπÖÂº∑ÂåñÔºâ
    if (piece.piece === 'Á´ú' || piece.piece === 'È≥≥') {
      if (move.r < 4) {
        score += 60; // 40„Åã„Çâ60„Å´Â§ßÂπÖÂº∑Âåñ
      }
    }
    
    // Âøç„ÉªÂΩ±„ÅÆÈßí: Ê©üÂãïÊÄß„ÅÆÊ¥ªÁî®ÔºàÂ§ßÂπÖÂº∑ÂåñÔºâ
    if (piece.piece === 'Âøç' || piece.piece === 'ÂΩ±') {
      if (move.r < 4) {
        score += 50; // 30„Åã„Çâ50„Å´Â§ßÂπÖÂº∑Âåñ
      }
    }
    
    // Á†Ç„ÉªÈ¢®„ÅÆÈßí: ÊïµÈô£„Åß„ÅÆÊ¥ªÁî®ÔºàÊñ∞Ë¶èËøΩÂä†Ôºâ
    if (piece.piece === 'Á†Ç' || piece.piece === 'È¢®') {
      if (move.r < 4) {
        score += 45; // Êñ∞Ë¶èËøΩÂä†
      }
    }
    
    // Ê∞¥„ÉªÊ≥¢„ÅÆÈßí: ÊïµÈßí„ÅÆËøë„Åè„Å´ÈÖçÁΩÆÔºàÊñ∞Ë¶èËøΩÂä†Ôºâ
    if (piece.piece === 'Ê∞¥' || piece.piece === 'Ê≥¢') {
      const nearbyEnemies = countNearbyEnemiesFast(move.r, move.c);
      score += nearbyEnemies * 40; // 30„Åã„Çâ40„Å´Âº∑Âåñ
    }
    
    // ÊîªÊíÉÊÄß„Éú„Éº„Éä„ÇπÔºàÊñ∞Ë¶èËøΩÂä†„ÉªÊîªÊíÉÊÄßÂ§ßÂπÖÂêë‰∏äÔºâ
    score += evaluateAggressiveBonus(piece, move);
    
    return score;
  }

  // ÊîªÊíÉÊÄß„Éú„Éº„Éä„ÇπË©ï‰æ°ÔºàÊñ∞Ë¶èËøΩÂä†Ôºâ
  function evaluateAggressiveBonus(piece, move) {
    let bonus = 0;
    
    // ÊïµÈô£„Åß„ÅÆÊîªÊíÉÊÄß„Éú„Éº„Éä„Çπ
    if (move.r < 3) {
      bonus += 30; // ÊïµÈô£ÂÜÖ„Åß„ÅÆÂ§ßÂπÖ„Éú„Éº„Éä„Çπ
    } else if (move.r < 4) {
      bonus += 20; // ÊïµÈô£„Å´Ëøë„ÅÑ‰ΩçÁΩÆ„Åß„ÅÆ„Éú„Éº„Éä„Çπ
    }
    
    // ÊïµÁéã„Å∏„ÅÆÊé•Ëøë„Éú„Éº„Éä„Çπ
    const playerKing = findPlayerKing();
    if (playerKing) {
      const distance = Math.abs(move.r - playerKing.row) + Math.abs(move.c - playerKing.col);
      if (distance <= 2) {
        bonus += 50; // ÊïµÁéã„Å∏„ÅÆÊ•µÊé•Ëøë
      } else if (distance <= 4) {
        bonus += 30; // ÊïµÁéã„Å∏„ÅÆÊé•Ëøë
      }
    }
    
    // ÊïµÈßí„Å∏„ÅÆËÑÖÂ®Å„Éú„Éº„Éä„Çπ
    const nearbyEnemies = countNearbyEnemiesFast(move.r, move.c);
    bonus += nearbyEnemies * 15; // Âë®Âõ≤„ÅÆÊïµÈßíÊï∞„Å´Âøú„Åò„Å¶„Éú„Éº„Éä„Çπ
    
    // ‰∏≠Â§ÆÈÉ®„Åß„ÅÆÊîªÊíÉÊÄß„Éú„Éº„Éä„Çπ
    if (move.c >= 3 && move.c <= 5) {
      bonus += 20; // ‰∏≠Â§ÆÈÉ®„Åß„ÅÆ„Éú„Éº„Éä„Çπ
    }
    
    return bonus;
  }

  // Âë®Âõ≤„ÅÆÊïµÈßí„ÅÆÊï∞„Çí„Ç´„Ç¶„É≥„ÉàÔºàÈ´òÈÄüÂåñÁâàÔºâ
  function countNearbyEnemiesFast(row, col) {
    let count = 0;
    // 8ÊñπÂêë„ÅÆÁ∞°Êòì„ÉÅ„Çß„ÉÉ„ÇØ
    for (let i = 0; i < 8; i++) {
      const d = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]][i];
      const nr = row + d[0], nc = col + d[1];
      if (inBounds(nr, nc) && state.board[nr][nc] && 
          state.board[nr][nc].owner === 'player') {
        count++;
      }
    }
    return count;
  }

  // Âë®Âõ≤„ÅÆÂë≥ÊñπÈßí„ÅÆÊï∞„Çí„Ç´„Ç¶„É≥„ÉàÔºàÈ´òÈÄüÂåñÁâàÔºâ
  function countNearbyAlliesFast(row, col) {
    let count = 0;
    // 8ÊñπÂêë„ÅÆÁ∞°Êòì„ÉÅ„Çß„ÉÉ„ÇØ
    for (let i = 0; i < 8; i++) {
      const d = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]][i];
      const nr = row + d[0], nc = col + d[1];
      if (inBounds(nr, nc) && state.board[nr][nc] && 
          state.board[nr][nc].owner === 'computer') {
        count++;
      }
    }
    return count;
  }

  // ÊïµÁéã„Å∏„ÅÆÊé•ËøëË©ï‰æ°ÔºàÊîªÊíÉÈáçË¶ñÁâàÔºâ
  function evaluateKingApproachFast(row, col) {
    let score = 0;
    
    // „Ç≠„É£„ÉÉ„Ç∑„É•„Åï„Çå„Åü„Éó„É¨„Ç§„É§„Éº„ÅÆÁéã„ÅÆ‰ΩçÁΩÆ„Çí‰ΩøÁî®
    const playerKing = findPlayerKing();
    if (!playerKing) return 0;
    
    // „Éû„É≥„Éè„ÉÉ„Çø„É≥Ë∑ùÈõ¢„ÅßÁéã„Å∏„ÅÆÊé•ËøëÂ∫¶„ÇíË©ï‰æ°ÔºàÂ§ßÂπÖÂº∑ÂåñÔºâ
    const distance = Math.abs(row - playerKing.row) + Math.abs(col - playerKing.col);
    if (distance <= 1) {
      score += 500; // Áéã„ÅÆ1„Éû„Çπ‰ª•ÂÜÖÔºàÊúÄÈ´òÁÇπ„ÉªÂ§ßÂπÖÂº∑ÂåñÔºâ
    } else if (distance <= 2) {
      score += 400; // Áéã„ÅÆ2„Éû„Çπ‰ª•ÂÜÖ„ÉªÂ§ßÂπÖÂº∑Âåñ
    } else if (distance <= 3) {
      score += 300; // Áéã„ÅÆ3„Éû„Çπ‰ª•ÂÜÖ„ÉªÂ§ßÂπÖÂº∑Âåñ
    } else if (distance <= 4) {
      score += 200; // Áéã„ÅÆ4„Éû„Çπ‰ª•ÂÜÖ„ÉªÂ§ßÂπÖÂº∑Âåñ
    } else if (distance <= 6) {
      score += 100; // Áéã„ÅÆ6„Éû„Çπ‰ª•ÂÜÖ„ÉªÂ§ßÂπÖÂº∑Âåñ
    }
    
    // ÊîªÊíÉÈßí„Åß„ÅÆÊé•Ëøë„ÇíÁâπÂà•Ë©ï‰æ°ÔºàÂ§ßÂπÖÂº∑ÂåñÔºâ
    const piece = state.board[row][col];
    if (piece && piece.owner === 'computer') {
      if (piece.piece === 'Ê≠©' || piece.piece === 'È¶ô' || piece.piece === 'Ê°Ç') {
        if (distance <= 3) {
          score += 150; // ÂâçÈÄ≤Èßí„Åß„ÅÆÊé•Ëøë„Éú„Éº„Éä„Çπ„ÉªÂ§ßÂπÖÂº∑Âåñ
        }
      }
      if (piece.piece === 'È£õ' || piece.piece === 'Ëßí') {
        if (distance <= 4) {
          score += 200; // ÈÅ†Ë∑ùÈõ¢Èßí„Åß„ÅÆÊé•Ëøë„Éú„Éº„Éä„Çπ„ÉªÂ§ßÂπÖÂº∑Âåñ
        }
      }
      if (piece.piece === 'ÊôÇ') {
        if (distance <= 2) {
          score += 300; // ÊôÇ„ÅÆÈßí„Åß„ÅÆÊé•Ëøë„Éú„Éº„Éä„Çπ„ÉªÊñ∞Ë¶èËøΩÂä†
        }
      }
    }
    
    return score;
  }

  // Âë≥ÊñπÈßí„ÅÆ‰øùË≠∑Ë©ï‰æ°ÔºàÂÆàÂÇôÈáçË¶ñÁâàÔºâ
  function evaluateProtectionFast(row, col) {
    let score = 0;
    
    // Âë®Âõ≤„ÅÆÂë≥ÊñπÈßí„Çí‰øùË≠∑„Åß„Åç„Çã‰ΩçÁΩÆ„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÂ§ßÂπÖÂº∑ÂåñÔºâ
    for (let i = 0; i < 8; i++) {
      const d = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]][i];
      const nr = row + d[0], nc = col + d[1];
      if (inBounds(nr, nc) && state.board[nr][nc] && 
          state.board[nr][nc].owner === 'computer') {
        const piece = state.board[nr][nc];
        
        // Èßí„ÅÆ‰æ°ÂÄ§„Å´Âøú„Åò„Åü‰øùË≠∑Ë©ï‰æ°ÔºàÊÆµÈöéÁöÑÂº∑ÂåñÔºâ
        const pieceValue = getPieceValue(piece.piece);
        if (pieceValue >= 500) { // È£õ„ÉªËßí„ÉªÁ´ú„ÉªÈ≥≥
          score += pieceValue / 5; // ÊúÄÈ´ò‰æ°ÂÄ§Èßí„ÅÆ‰øùË≠∑
        } else if (pieceValue >= 300) { // Èáë„ÉªÈäÄ
          score += pieceValue / 6; // È´ò‰æ°ÂÄ§Èßí„ÅÆ‰øùË≠∑
        } else if (pieceValue >= 100) { // Ê°Ç„ÉªÈ¶ô„ÉªÊ≠©
          score += pieceValue / 8; // ‰∏≠‰æ°ÂÄ§Èßí„ÅÆ‰øùË≠∑
        }
        
        // Áéã„ÅÆ‰øùË≠∑„ÅØÁâπÂà•Ë©ï‰æ°
        if (piece.piece === 'Áéã' || piece.piece === 'Áéâ') {
          score += 300; // Áéã„ÅÆ‰øùË≠∑„ÅØÊúÄÈ´òË©ï‰æ°
        }
      }
    }
    
    // Ëá™Èô£„Åß„ÅÆ‰øùË≠∑Ë©ï‰æ°ÔºàÊñ∞Ë¶èËøΩÂä†Ôºâ
    if (row > 5) { // Ëá™Èô£ÂÜÖ
      score += 25; // Ëá™Èô£„Åß„ÅÆ‰øùË≠∑„Éú„Éº„Éä„Çπ
    }
    
    // ‰∏≠Â§ÆÈÉ®„Åß„ÅÆ‰øùË≠∑Ë©ï‰æ°ÔºàÊñ∞Ë¶èËøΩÂä†Ôºâ
    if (col >= 3 && col <= 5) {
      score += 20; // ‰∏≠Â§ÆÈÉ®„Åß„ÅÆ‰øùË≠∑„Éú„Éº„Éä„Çπ
    }
    
    return score;
  }

  // Êïµ„ÅÆÈáçË¶ÅÈßí„Å∏„ÅÆËÑÖÂ®ÅË©ï‰æ°ÔºàÊîªÊíÉÈáçË¶ñÁâàÔºâ
  function evaluateThreatToEnemyFast(row, col) {
    let score = 0;
    
    // „Åì„ÅÆ‰ΩçÁΩÆ„Åã„ÇâÊîªÊíÉ„Åß„Åç„ÇãÊïµ„ÅÆÈáçË¶ÅÈßí„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºàÂ§ßÂπÖÂº∑ÂåñÔºâ
    const moves = getValidMoves(row, col);
    for (const move of moves) {
      const targetPiece = state.board[move.r][move.c];
      if (targetPiece && targetPiece.owner === 'player') {
        const pieceValue = getPieceValue(targetPiece.piece);
        
        // Èßí„ÅÆ‰æ°ÂÄ§„Å´Âøú„Åò„ÅüËÑÖÂ®ÅË©ï‰æ°ÔºàÂ§ßÂπÖÂº∑ÂåñÔºâ
        if (pieceValue >= 500) { // È£õ„ÉªËßí„ÉªÁ´ú„ÉªÈ≥≥
          score += pieceValue / 2; // ÊúÄÈ´ò‰æ°ÂÄ§Èßí„Å∏„ÅÆËÑÖÂ®Å„ÉªÂ§ßÂπÖÂº∑Âåñ
        } else if (pieceValue >= 300) { // Èáë„ÉªÈäÄ
          score += pieceValue / 3; // È´ò‰æ°ÂÄ§Èßí„Å∏„ÅÆËÑÖÂ®Å„ÉªÂ§ßÂπÖÂº∑Âåñ
        } else if (pieceValue >= 100) { // Ê°Ç„ÉªÈ¶ô„ÉªÊ≠©
          score += pieceValue / 4; // ‰∏≠‰æ°ÂÄ§Èßí„Å∏„ÅÆËÑÖÂ®Å„ÉªÂ§ßÂπÖÂº∑Âåñ
        }
        
        // ÊïµÁéã„Å∏„ÅÆÁõ¥Êé•ÁöÑ„Å™ËÑÖÂ®ÅÔºàÁâπÂà•„Éú„Éº„Éä„ÇπÔºâ
        if (targetPiece.piece === 'Áéã' || targetPiece.piece === 'Áéâ') {
          score += 500; // Áéã„Å∏„ÅÆËÑÖÂ®Å„ÅØÊúÄÈ´òË©ï‰æ°
        }
      }
    }
    
    // ‰ΩçÁΩÆÁöÑ„Å™ËÑÖÂ®ÅË©ï‰æ°ÔºàÊñ∞Ë¶èËøΩÂä†Ôºâ
    if (row < 4) { // ÊïµÈô£„Å´Ëøë„ÅÑ‰ΩçÁΩÆ
      score += 30; // ÊïµÈô£„Åß„ÅÆËÑÖÂ®Å„Éú„Éº„Éä„Çπ
    }
    
    // ‰∏≠Â§ÆÈÉ®„Åß„ÅÆËÑÖÂ®ÅË©ï‰æ°ÔºàÊñ∞Ë¶èËøΩÂä†Ôºâ
    if (col >= 3 && col <= 5) {
      score += 20; // ‰∏≠Â§ÆÈÉ®„Åß„ÅÆËÑÖÂ®Å„Éú„Éº„Éä„Çπ
    }
    
    return score;
  }

  // Áéã„ÅåÂç±Èô∫„Å™Áä∂ÊÖã„Åã„Å©„ÅÜ„Åã„ÇíÂà§ÂÆöÔºàÈ´òÈÄüÂåñÁâàÔºâ
  function isKingInDangerFast() {
    // „Ç≠„É£„ÉÉ„Ç∑„É•„Åï„Çå„ÅüÁéã„ÅÆ‰ΩçÁΩÆ„Çí‰ΩøÁî®
    const computerKing = findComputerKing();
    if (!computerKing) return false;
    
    // Á∞°ÊòìÁöÑ„Å™ÁéãÊâã„ÉÅ„Çß„ÉÉ„ÇØÔºàÈ´òÈÄüÂåñÔºâ
    return isCheckFast(computerKing.row, computerKing.col);
  }

  // È´òÈÄüÂåñ„Åï„Çå„ÅüÁéãÊâã„ÉÅ„Çß„ÉÉ„ÇØ
  function isCheckFast(kingRow, kingCol) {
    // ‰∏ªË¶Å„Å™ÊîªÊíÉÈßí„ÅÆ„Åø„ÉÅ„Çß„ÉÉ„ÇØÔºàÈ´òÈÄüÂåñÔºâ
    const attackPieces = ['È£õ', 'Ëßí', 'Ê°Ç', 'È¶ô', 'Ê≠©', 'ÊôÇ'];
    
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'player' && attackPieces.includes(piece.piece)) {
          // Á∞°ÊòìÁöÑ„Å™ÊîªÊíÉÁØÑÂõ≤„ÉÅ„Çß„ÉÉ„ÇØ
          if (canAttackFast(r, c, kingRow, kingCol, piece.piece)) {
            return true;
          }
        }
      }
    }
    return false;
  }

  // È´òÈÄüÂåñ„Åï„Çå„ÅüÊîªÊíÉÁØÑÂõ≤„ÉÅ„Çß„ÉÉ„ÇØ
  function canAttackFast(fromRow, fromCol, toRow, toCol, pieceType) {
    const rowDiff = toRow - fromRow;
    const colDiff = toCol - fromCol;
    
    switch (pieceType) {
      case 'È£õ':
        return (rowDiff === 0 || colDiff === 0) && !hasObstacleBetween(fromRow, fromCol, toRow, toCol);
      case 'Ëßí':
        return Math.abs(rowDiff) === Math.abs(colDiff) && !hasObstacleBetween(fromRow, fromCol, toRow, toCol);
      case 'Ê°Ç':
        return (Math.abs(rowDiff) === 2 && Math.abs(colDiff) === 1) || (Math.abs(rowDiff) === 1 && Math.abs(colDiff) === 2);
      case 'È¶ô':
        return colDiff === 0 && rowDiff < 0 && !hasObstacleBetween(fromRow, fromCol, toRow, toCol);
      case 'Ê≠©':
        return colDiff === 0 && rowDiff === -1;
      case 'ÊôÇ':
        // 8ÊñπÂêë„Å´1„Éû„Çπ„Åæ„Åß„ÅÆÊîªÊíÉÁØÑÂõ≤
        return Math.abs(rowDiff) <= 1 && Math.abs(colDiff) <= 1 && (rowDiff !== 0 || colDiff !== 0);
      default:
        return false;
    }
  }

  // ÈöúÂÆ≥Áâ©„ÉÅ„Çß„ÉÉ„ÇØÔºàÈ´òÈÄüÂåñÔºâ
  function hasObstacleBetween(fromRow, fromCol, toRow, toCol) {
    const rowStep = fromRow === toRow ? 0 : (toRow - fromRow) / Math.abs(toRow - fromRow);
    const colStep = fromCol === toCol ? 0 : (toCol - fromCol) / Math.abs(toCol - fromCol);
    
    let currentRow = fromRow + rowStep;
    let currentCol = fromCol + colStep;
    
    while (currentRow !== toRow || currentCol !== toCol) {
      if (state.board[currentRow][currentCol]) {
        return true; // ÈöúÂÆ≥Áâ©„ÅÇ„Çä
      }
      currentRow += rowStep;
      currentCol += colStep;
    }
    return false;
  }

  // Áéã„ÅÆÂë®Âõ≤„ÅÆÂç±Èô∫Â∫¶„Çí„Ç´„Ç¶„É≥„Éà
  function countSurroundingDanger(kingRow, kingCol) {
    let dangerCount = 0;
    
    // Áéã„ÅÆÂë®Âõ≤8ÊñπÂêë„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = kingRow + d[0], nc = kingCol + d[1];
      if (inBounds(nr, nc)) {
        // „Åì„ÅÆ‰ΩçÁΩÆ„ÅåÊïµ„ÅÆÊîªÊíÉÁØÑÂõ≤ÂÜÖ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
        if (isPositionUnderAttack(nr, nc, 'player')) {
          dangerCount++;
        }
      }
    });
    
    return dangerCount;
  }

  // ÁâπÂÆö„ÅÆ‰ΩçÁΩÆ„ÅåÊïµ„ÅÆÊîªÊíÉÁØÑÂõ≤ÂÜÖ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
  function isPositionUnderAttack(row, col, attacker) {
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === attacker) {
          const moves = getValidMoves(r, c);
          for (const move of moves) {
            if (move.r === row && move.c === col) {
              return true;
            }
          }
        }
      }
    }
    return false;
  }

  // Áéã„ÅÆÂÆâÂÖ®Á¢∫‰øù„ÅÆ„Åü„ÇÅ„ÅÆÁßªÂãïË©ï‰æ°ÔºàË∂ÖÈ´òÈÄüÂåñÁâà„ÉªÁéã„ÅÆÁßªÂãïÊúÄÂÑ™ÂÖàÂ∫¶ÊúÄ‰ΩéÂåñÔºâ
  function evaluateKingSafetyFast(piece, move) {
    let score = 0;
    
    // 1. ÁéãÊâã„ÇíÈò≤„ÅêÁßªÂãïÔºàÊúÄÈ´òÁÇπ„ÉªË∂ÖÈ´òÈÄüÂåñÔºâ
    if (preventsCheckFast(piece, move)) {
      score += 10000;
      return score; // ÁéãÊâãÂõûÈÅø„ÅåË¶ã„Å§„Åã„Å£„Åü„ÇâÂç≥Â∫ß„Å´ËøîÁ≠î
    }
    
    // 2. Áéã„ÅÆÂë®Âõ≤„ÅÆÂç±Èô∫„ÇíÊ∏õ„Çâ„ÅôÁßªÂãïÔºàË∂ÖÈ´òÈÄüÂåñÔºâ
    score += evaluateDangerReductionFast(piece, move);
    
    // 3. Áéã„ÇíÂÆà„ÇãÈßí„ÅÆÈÖçÁΩÆÔºàË∂ÖÈ´òÈÄüÂåñÔºâ
    score += evaluateKingProtectionFast(piece, move);
    
    // 4. Áéã„ÅÆËÑ±Âá∫ÁµåË∑Ø„ÅÆÁ¢∫‰øùÔºàË∂ÖÈ´òÈÄüÂåñ„ÉªÁéã„ÅÆÁßªÂãïÊúÄÂÑ™ÂÖàÂ∫¶ÊúÄ‰ΩéÂåñÔºâ
    if (piece.piece === 'Áéã' || piece.piece === 'Áéâ') {
      // ÁéãËá™Ë∫´„ÅÆÁßªÂãï„ÅØÂøÖË¶ÅÊúÄÂ∞èÈôê„ÅÆ„ÅøÔºàÂ§ßÂπÖÊäëÂà∂Ôºâ
      if (isCheck(move.r, move.c)) {
        // ÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅÆ„Åø„ÄÅ‰ªñ„ÅÆÈßí„ÅßÈò≤„Åí„Å™„ÅÑÂ†¥Âêà„ÅÆÊúÄÁµÇÊâãÊÆµ
        const canDefendWithOtherPiece = canDefendKingWithOtherPieceFast(move.r, move.c);
        if (canDefendWithOtherPiece) {
          score -= 5000; // ‰ªñ„ÅÆÈßí„ÅßÈò≤„Åí„ÇãÂ†¥Âêà„ÅØÁéã„ÅÆÁßªÂãï„ÇíÂ§ßÂπÖÊäëÂà∂
        } else {
          score += 3000; // ‰ªñ„ÅÆÈßí„ÅßÈò≤„Åí„Å™„ÅÑÂ†¥Âêà„ÅÆ„ÅøÈ´òË©ï‰æ°
        }
      } else {
        score -= 5000; // ÈÄöÂ∏∏ÊôÇ„ÅØÂ§ßÂπÖ„Å™Ê∏õÁÇπ
      }
    } else {
      // ‰ªñ„ÅÆÈßí„Åß„ÅÆÁéã„ÅÆ‰øùË≠∑„ÅØÈ´òË©ï‰æ°
      score += evaluateKingEscapeFast(piece, move);
    }
    
    return score;
  }

  // ÁéãÊâã„ÇíÈò≤„ÅêÁßªÂãï„Åã„Å©„ÅÜ„Åã„ÇíÂà§ÂÆöÔºàË∂ÖÈ´òÈÄüÂåñÁâàÔºâ
  function preventsCheckFast(piece, move) {
    // Á∞°ÊòìÁöÑ„Å™ÁéãÊâãÂõûÈÅø„ÉÅ„Çß„ÉÉ„ÇØÔºàÈ´òÈÄüÂåñÔºâ
    const targetPiece = state.board[move.r][move.c];
    
    // 1. ÊïµÈßí„ÇíÂèñ„ÇãÁßªÂãïÔºàÊúÄ„ÇÇÁ¢∫ÂÆü„Å™ÁéãÊâãÂõûÈÅøÔºâ
    if (targetPiece && targetPiece.owner === 'player') {
      return true; // ÊïµÈßí„ÇíÂèñ„Çå„Å∞ÁéãÊâãÂõûÈÅø
    }
    
    // 2. ÁéãÊâã„Çí„Åã„Åë„Å¶„ÅÑ„ÇãÊïµÈßí„ÅÆ‰ΩçÁΩÆ„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    const computerKing = findComputerKing();
    if (!computerKing) return false;
    
    // 3. „Åì„ÅÆÁßªÂãï„ÅßÊïµÈßí„ÅÆÊîªÊíÉÁµåË∑Ø„ÇíÂ°û„Åí„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    if (canBlockCheckPathFast(piece, move, computerKing)) {
      return true;
    }
    
    // 4. Ë©≥Á¥∞„ÉÅ„Çß„ÉÉ„ÇØ„ÅåÂøÖË¶Å„Å™Â†¥Âêà„ÅÆ„ÅøÂÆüË°å
    return preventsCheckDetailed(piece, move);
  }

  // ÁéãÊâã„ÅÆÁµåË∑Ø„ÇíÂ°û„Åí„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàË∂ÖÈ´òÈÄüÂåñÁâàÔºâ
  function canBlockCheckPathFast(piece, move, computerKing) {
    // ÁßªÂãïÂÖà„ÅåÁéãÊâã„ÅÆÁµåË∑Ø‰∏ä„Å´„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    const checkPath = getCheckPathFast(computerKing);
    if (!checkPath) return false;
    
    // ÁßªÂãïÂÖà„ÅåÁéãÊâã„ÅÆÁµåË∑Ø‰∏ä„Å´„ÅÇ„ÇãÂ†¥Âêà
    for (const pathPos of checkPath) {
      if (move.r === pathPos.row && move.c === pathPos.col) {
        return true;
      }
    }
    
    return false;
  }

  // ÁéãÊâã„ÅÆÁµåË∑Ø„ÇíÂèñÂæóÔºàË∂ÖÈ´òÈÄüÂåñÁâàÔºâ
  function getCheckPathFast(computerKing) {
    // ‰∏ªË¶Å„Å™ÊîªÊíÉÈßí„ÅÆ„Åø„ÉÅ„Çß„ÉÉ„ÇØÔºàÈ´òÈÄüÂåñÔºâ
    const attackPieces = ['È£õ', 'Ëßí', 'ÊôÇ'];
    
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'player' && attackPieces.includes(piece.piece)) {
          // È£õËªä„ÉªËßíË°å„ÉªÊôÇ„Åã„Çâ„ÅÆÁéãÊâãÁµåË∑Ø„Çí„ÉÅ„Çß„ÉÉ„ÇØ
          if (canAttackFast(r, c, computerKing.row, computerKing.col, piece.piece)) {
            return getPathBetween(r, c, computerKing.row, computerKing.col);
          }
        }
      }
    }
    
    return null;
  }

  // Ë©≥Á¥∞„Å™ÁéãÊâãÂõûÈÅø„ÉÅ„Çß„ÉÉ„ÇØÔºàÂøÖË¶ÅÊôÇ„ÅÆ„ÅøÂÆüË°åÔºâ
  function preventsCheckDetailed(piece, move) {
    // ÁèæÂú®„ÅÆÁéãÊâãÁä∂ÊÖã„Çí‰øùÂ≠ò
    const currentBoard = JSON.parse(JSON.stringify(state.board));
    
    // ÁßªÂãï„Çí„Ç∑„Éü„É•„É¨„Éº„Éà
    const fromPiece = currentBoard[piece.r][piece.c];
    currentBoard[move.r][move.c] = fromPiece;
    currentBoard[piece.r][piece.c] = null;
    
    // ÁßªÂãïÂæå„Å´ÁéãÊâã„ÅåÊÆã„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    return !isKingInDangerAfterMoveFast(currentBoard);
  }

  // ÁßªÂãïÂæå„Å´Áéã„ÅåÂç±Èô∫„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàË∂ÖÈ´òÈÄüÂåñÁâàÔºâ
  function isKingInDangerAfterMoveFast(board) {
    // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéã„ÅÆ‰ΩçÁΩÆ„ÇíÊé¢„Åô
    let computerKingRow = -1, computerKingCol = -1;
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = board[r][c];
        if (piece && piece.owner === 'computer' && (piece.piece === 'Áéã' || piece.piece === 'Áéâ')) {
          computerKingRow = r;
          computerKingCol = c;
          break;
        }
      }
      if (computerKingRow !== -1) break;
    }
    
    if (computerKingRow === -1) return false;
    
    // ‰∏ªË¶Å„Å™ÊîªÊíÉÈßí„ÅÆ„Åø„ÉÅ„Çß„ÉÉ„ÇØÔºàÈ´òÈÄüÂåñÔºâ
    const attackPieces = ['È£õ', 'Ëßí', 'Ê°Ç', 'È¶ô', 'Ê≠©', 'ÊôÇ'];
    
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = board[r][c];
        if (piece && piece.owner === 'player' && attackPieces.includes(piece.piece)) {
          // Á∞°ÊòìÁöÑ„Å™ÊîªÊíÉÁØÑÂõ≤„ÉÅ„Çß„ÉÉ„ÇØ
          if (canAttackFast(r, c, computerKingRow, computerKingCol, piece.piece)) {
            return true; // ÁéãÊâã„Åå„Åã„Åë„Çâ„Çå„Å¶„ÅÑ„Çã
          }
        }
      }
    }
    
    return false;
  }

  // Âç±Èô∫„ÅÆËªΩÊ∏õ„ÇíË©ï‰æ°
  function evaluateDangerReduction(piece, move) {
    let score = 0;
    
    // ÁßªÂãïÂæå„Å´Áéã„ÅÆÂë®Âõ≤„ÅÆÂç±Èô∫„ÅåÊ∏õ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    const currentDanger = countSurroundingDanger(0, 0); // ‰ªÆ„ÅÆÂÄ§
    
    // ÁßªÂãï„Çí„Ç∑„Éü„É•„É¨„Éº„Éà„Åó„Å¶Âç±Èô∫Â∫¶„ÇíÂÜçË®àÁÆó
    const simulatedDanger = simulateDangerAfterMove(piece, move);
    
    if (simulatedDanger < currentDanger) {
      score += (currentDanger - simulatedDanger) * 1000;
    }
    
    return score;
  }

  // ÁßªÂãïÂæå„ÅÆÂç±Èô∫Â∫¶„Çí„Ç∑„Éü„É•„É¨„Éº„Éà
  function simulateDangerAfterMove(piece, move) {
    // Á∞°ÊòìÁöÑ„Å™Âç±Èô∫Â∫¶Ë®àÁÆó
    let danger = 0;
    
    // Áéã„ÅÆÂë®Âõ≤„ÅÆÊïµÈßí„ÅÆÊï∞„Çí„Ç´„Ç¶„É≥„Éà
    const computerKing = findComputerKing();
    if (computerKing) {
      [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
        const nr = computerKing.row + d[0], nc = computerKing.col + d[1];
        if (inBounds(nr, nc) && state.board[nr][nc] && 
            state.board[nr][nc].owner === 'player') {
          danger++;
        }
      });
    }
    
    return danger;
  }

  // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéã„ÅÆ‰ΩçÁΩÆ„ÇíÊé¢„Åô
  function findComputerKing() {
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'computer' && (piece.piece === 'Áéã' || piece.piece === 'Áéâ')) {
          return { row: r, col: c };
        }
      }
    }
    return null;
  }

  // Áéã„ÅÆ‰øùË≠∑„ÇíË©ï‰æ°
  function evaluateKingProtection(piece, move) {
    let score = 0;
    
    // Áéã„ÅÆÂë®Âõ≤„Å´ÂÆàÂÇôÈßí„ÇíÈÖçÁΩÆ
    const computerKing = findComputerKing();
    if (computerKing) {
      const distance = Math.abs(move.r - computerKing.row) + Math.abs(move.c - computerKing.col);
      if (distance <= 2) {
        score += 500; // Áéã„ÅÆ2„Éû„Çπ‰ª•ÂÜÖ
      } else if (distance <= 4) {
        score += 200; // Áéã„ÅÆ4„Éû„Çπ‰ª•ÂÜÖ
      }
    }
    
    return score;
  }

  // Áéã„ÅÆËÑ±Âá∫ÁµåË∑Ø„ÇíË©ï‰æ°ÔºàÁéã„ÅÆÁßªÂãïÊúÄÂÑ™ÂÖàÂ∫¶ÊúÄ‰ΩéÂåñÁâàÔºâ
  function evaluateKingEscape(piece, move) {
    let score = 0;
    
    // Áéã„ÅÆËÑ±Âá∫ÁµåË∑Ø„ÇíÁ¢∫‰øù„Åô„ÇãÁßªÂãï
    if (piece.piece === 'Áéã' || piece.piece === 'Áéâ') {
      // ÁéãËá™Ë∫´„ÅÆÁßªÂãï„ÅßÂÆâÂÖ®„Å™‰ΩçÁΩÆ„Å´ÁßªÂãïÔºàÊúÄÂÑ™ÂÖàÂ∫¶ÊúÄ‰ΩéÂåñÔºâ
      if (isCheck(move.r, move.c)) {
        // ÁéãÊâã„Åå„Åã„Åã„Å£„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅÆ„Åø„ÄÅ‰ªñ„ÅÆÈßí„ÅßÈò≤„Åí„Å™„ÅÑÂ†¥Âêà„ÅÆÊúÄÁµÇÊâãÊÆµ
        const canDefendWithOtherPiece = canDefendKingWithOtherPiece(move.r, move.c);
        if (canDefendWithOtherPiece) {
          score -= 8000; // ‰ªñ„ÅÆÈßí„ÅßÈò≤„Åí„ÇãÂ†¥Âêà„ÅØÁéã„ÅÆÁßªÂãï„ÇíÂ§ßÂπÖÊäëÂà∂
        } else {
          score += 2000; // ‰ªñ„ÅÆÈßí„ÅßÈò≤„Åí„Å™„ÅÑÂ†¥Âêà„ÅÆ„Åø‰∏≠Á®ãÂ∫¶Ë©ï‰æ°
        }
      } else {
        // ÈÄöÂ∏∏ÊôÇ„ÅØÁéã„ÅÆÁßªÂãï„ÇíÂ§ßÂπÖÊäëÂà∂
        score -= 10000; // ÈùûÂ∏∏„Å´Â§ßÂπÖ„Å™Ê∏õÁÇπ
      }
    } else {
      // ‰ªñ„ÅÆÈßí„Åß„ÅÆÁéã„ÅÆ‰øùË≠∑„ÅØÈ´òË©ï‰æ°
      if (isSafePosition(move.r, move.c)) {
        score += 2000; // ‰ªñ„ÅÆÈßí„Åß„ÅÆ‰øùË≠∑„ÇíÂº∑Âåñ
      }
    }
    
    return score;
  }

  // ‰ªñ„ÅÆÈßí„ÅßÁéã„ÇíÂÆà„Çå„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàË∂ÖÈ´òÈÄüÂåñÁâàÔºâ
  function canDefendKingWithOtherPieceFast(checkRow, checkCol) {
    // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁéã„ÅÆ‰ΩçÁΩÆ„ÇíÊé¢„Åô
    const computerKing = findComputerKing();
    if (!computerKing) return false;
    
    // ÁéãÊâã„Çí„Åã„Åë„Å¶„ÅÑ„ÇãÊïµÈßí„ÅÆ‰ΩçÁΩÆÔºàÈ´òÈÄüÂåñÔºâ
    const attackingPiece = findAttackingPieceFast(checkRow, checkCol, computerKing.row, computerKing.col);
    if (!attackingPiece) return false;
    
    // ‰ªñ„ÅÆÈßí„Åß„Åì„ÅÆÊïµÈßí„ÇíÂèñ„Çå„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÈ´òÈÄüÂåñÔºâ
    const canCapture = canCaptureAttackingPieceFast(attackingPiece);
    if (canCapture) return true;
    
    // ‰ªñ„ÅÆÈßí„ÅßÁéãÊâã„ÅÆÁµåË∑Ø„ÇíÂ°û„Åí„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÈ´òÈÄüÂåñÔºâ
    return canBlockCheckPathFast(attackingPiece, computerKing);
  }

  // ÁéãÊâã„Çí„Åã„Åë„Å¶„ÅÑ„ÇãÊïµÈßí„ÇíÊé¢„ÅôÔºàÈ´òÈÄüÂåñÁâàÔºâ
  function findAttackingPieceFast(checkRow, checkCol, kingRow, kingCol) {
    // ‰∏ªË¶Å„Å™ÊîªÊíÉÈßí„ÅÆ„Åø„ÉÅ„Çß„ÉÉ„ÇØÔºàÈ´òÈÄüÂåñÔºâ
    const attackPieces = ['È£õ', 'Ëßí', 'Ê°Ç', 'È¶ô', 'Ê≠©'];
    
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'player' && attackPieces.includes(piece.piece)) {
          // Á∞°ÊòìÁöÑ„Å™ÊîªÊíÉÁØÑÂõ≤„ÉÅ„Çß„ÉÉ„ÇØ
          if (canAttackFast(r, c, kingRow, kingCol, piece.piece)) {
            return { row: r, col: c, piece: piece.piece };
          }
        }
      }
    }
    return null;
  }

  // ÊîªÊíÉÈßí„ÇíÂèñ„Çå„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÈ´òÈÄüÂåñÁâàÔºâ
  function canCaptureAttackingPieceFast(attackingPiece) {
    // ÊîªÊíÉÈßí„ÅÆÂë®Âõ≤8ÊñπÂêë„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºàÈ´òÈÄüÂåñÔºâ
    for (let i = 0; i < 8; i++) {
      const d = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]][i];
      const nr = attackingPiece.row + d[0], nc = attackingPiece.col + d[1];
      
      if (inBounds(nr, nc) && state.board[nr][nc] && 
          state.board[nr][nc].owner === 'computer' &&
          state.board[nr][nc].piece !== 'Áéã' && state.board[nr][nc].piece !== 'Áéâ') {
        
        // „Åì„ÅÆÈßí„ÅßÊîªÊíÉÈßí„ÇíÂèñ„Çå„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
        const moves = getValidMoves(nr, nc);
        for (const move of moves) {
          if (move.r === attackingPiece.row && move.c === attackingPiece.col) {
            return true; // ÊîªÊíÉÈßí„ÇíÂèñ„Çå„Çã
          }
        }
      }
    }
    
    return false;
  }

  // ÁéãÊâã„Çí„Åã„Åë„Å¶„ÅÑ„ÇãÊïµÈßí„ÇíÊé¢„Åô
  function findAttackingPiece(checkRow, checkCol, kingRow, kingCol) {
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.owner === 'player') {
          const moves = getValidMoves(r, c);
          for (const move of moves) {
            if (move.r === kingRow && move.c === kingCol) {
              return { row: r, col: c, piece: piece.piece };
            }
          }
        }
      }
    }
    return null;
  }

  // ÁéãÊâã„ÅÆÁµåË∑Ø„ÇíÂ°û„Åí„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
  function canBlockCheckPath(attackingPiece, computerKing) {
    // È£õËªä„ÉªËßíË°å„ÅÆÁéãÊâã„ÅÆÂ†¥Âêà„ÄÅÁµåË∑Ø„ÇíÂ°û„Åí„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çã
    if (attackingPiece.piece === 'È£õ' || attackingPiece.piece === 'Ëßí') {
      const path = getPathBetween(attackingPiece.row, attackingPiece.col, computerKing.row, computerKing.col);
      for (const pos of path) {
        // „Åì„ÅÆ‰ΩçÁΩÆ„Å´‰ªñ„ÅÆÈßí„ÇíÁΩÆ„Åë„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
        if (canPlacePieceAt(pos.row, pos.col)) {
          return true;
        }
      }
    }
    return false;
  }

  // 2ÁÇπÈñì„ÅÆÁµåË∑Ø„ÇíÂèñÂæó
  function getPathBetween(fromRow, fromCol, toRow, toCol) {
    const path = [];
    const rowStep = fromRow === toRow ? 0 : (toRow - fromRow) / Math.abs(toRow - fromRow);
    const colStep = fromCol === toCol ? 0 : (toCol - fromCol) / Math.abs(toCol - fromCol);
    
    let currentRow = fromRow + rowStep;
    let currentCol = fromCol + colStep;
    
    while (currentRow !== toRow || currentCol !== toCol) {
      path.push({ row: currentRow, col: currentCol });
      currentRow += rowStep;
      currentCol += colStep;
    }
    
    return path;
  }

  // ÊåáÂÆö‰ΩçÁΩÆ„Å´Èßí„ÇíÁΩÆ„Åë„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
  function canPlacePieceAt(row, col) {
    // „Åù„ÅÆ‰ΩçÁΩÆ„Å´Èßí„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    if (state.board[row][col]) return false;
    
    // „Åù„ÅÆ‰ΩçÁΩÆ„ÅåÊïµ„ÅÆÊîªÊíÉÁØÑÂõ≤ÂÜÖ„Åß„Å™„ÅÑ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    return isSafePositionFast(row, col);
  }

  function allValidMoves(owner){
    const list=[];
    for (let r=0;r<BOARD_SIZE;r++){
      for (let c=0;c<BOARD_SIZE;c++){
        const sq=state.board[r][c]; if (!sq || sq.owner!==owner) continue;
        const ms = getValidMoves(r,c);
        ms.forEach(m=>list.push({from:{r,c}, to:m}));
      }
    }
    return list;
  }

  // „Çπ„ÉÜ„Éº„Ç∏„ÇØ„É™„Ç¢„Çí‰øùÂ≠ò
  function saveStageClear() {
    try {
      const currentStage = state.stageIndex + 1;
      const saved = JSON.parse(localStorage.getItem('original_shogi_cleared_stages') || '[]');
      const cleared = Array.isArray(saved) ? saved : [];
      
      if (!cleared.includes(currentStage)) {
        cleared.push(currentStage);
        localStorage.setItem('original_shogi_cleared_stages', JSON.stringify(cleared));
      }
    } catch(e) {
      console.error('„Çπ„ÉÜ„Éº„Ç∏„ÇØ„É™„Ç¢„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', e);
    }
  }

  // „Çπ„ÉÜ„Éº„Ç∏„ÇØ„É™„Ç¢ÊÉÖÂ†±„ÇíË™≠„ÅøËæº„Åø
  function loadClearedStages() {
    try {
      const saved = JSON.parse(localStorage.getItem('original_shogi_cleared_stages') || '[]');
      return Array.isArray(saved) ? saved : [];
    } catch(e) {
      console.error('„Çπ„ÉÜ„Éº„Ç∏„ÇØ„É™„Ç¢ÊÉÖÂ†±„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', e);
      return [];
    }
  }

  // „Çπ„ÉÜ„Éº„Ç∏„Å´Âü∫„Å•„ÅÑ„Å¶‰ΩøÁî®ÂèØËÉΩ„Å™Èßí„ÇíÂèñÂæó
  function getAvailablePiecesForStage(stageIndex) {
    const clearedStages = loadClearedStages();
    const currentStage = stageIndex + 1;
    
    // Âü∫Êú¨ÈßíÔºàÂ∏∏„Å´‰ΩøÁî®ÂèØËÉΩÔºâ
    const basicPieces = ['È¶ô', 'Ê°Ç', 'ÈäÄ', 'Èáë', 'Áéâ', 'È£õ', 'Ëßí', 'Ê≠©'];
    
    // „Çπ„ÉÜ„Éº„Ç∏Âà•„ÅÆËøΩÂä†Èßí
    const stagePieces = {
      1: [], // „Çπ„ÉÜ„Éº„Ç∏1: Âü∫Êú¨Èßí„ÅÆ„Åø
      2: ['Âøç', 'ÂΩ±', 'Á†≤'], // „Çπ„ÉÜ„Éº„Ç∏2: ÂøçËÄÖÁ≥ª
      3: ['Âøç', 'ÂΩ±', 'Á†≤'], // „Çπ„ÉÜ„Éº„Ç∏3: ÂøçËÄÖÁ≥ª
      4: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥'], // „Çπ„ÉÜ„Éº„Ç∏4: Á´úÈ≥≥ËøΩÂä†
      5: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´'], // „Çπ„ÉÜ„Éº„Ç∏5: ÁÇéÁ≥ª
      6: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢'], // „Çπ„ÉÜ„Éº„Ç∏6: Ê∞¥Á≥ª
      7: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ'], // „Çπ„ÉÜ„Éº„Ç∏7: Êú®Á≥ª
      8: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü'], // „Çπ„ÉÜ„Éº„Ç∏8: ÂÖâÁ≥ª
      9: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î'], // „Çπ„ÉÜ„Éº„Ç∏9: ÈóáÁ≥ª
      10: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ'], // „Çπ„ÉÜ„Éº„Ç∏10: ÈáëÂ±ûÁ≥ª
      11: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù'], // „Çπ„ÉÜ„Éº„Ç∏11: ÂÆù
      12: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑'], // „Çπ„ÉÜ„Éº„Ç∏12: ÈõªÊ∞óÁ≥ª
      13: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ'], // „Çπ„ÉÜ„Éº„Ç∏13: ÊôÇ
      14: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™'], // „Çπ„ÉÜ„Éº„Ç∏14: Ê∞∑Á≥ª
      15: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™', 'Á†Ç', 'È¢®'], // „Çπ„ÉÜ„Éº„Ç∏15: Á†ÇÈ¢®Á≥ª
      16: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™', 'Á†Ç', 'È¢®', 'Ëãî', 'È≠ö'], // „Çπ„ÉÜ„Éº„Ç∏16: ËãîÁ≥ª
      17: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™', 'Á†Ç', 'È¢®', 'Êµ∑', 'È≠ö', 'Èõ≤', 'Ëôπ'], // „Çπ„ÉÜ„Éº„Ç∏17: Èõ≤ËôπÁ≥ª
      18: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™', 'Á†Ç', 'È¢®', 'Êµ∑', 'È≠ö', 'Èõ≤', 'Ëôπ', 'ÊØí', 'Ê≤º', 'Èè°', 'Êò†', '„ÅÇ'], // „Çπ„ÉÜ„Éº„Ç∏18: ÊØí„ÅÆÊ≤ºÂú∞Á≥ª
      19: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™', 'Á†Ç', 'È¢®', 'Êµ∑', 'È≠ö', 'Èõ≤', 'Ëôπ', 'ÊØí', 'Ê≤º', 'Èè°', 'Êò†', '„ÅÇ'], // „Çπ„ÉÜ„Éº„Ç∏19: Èè°„ÅÆÈñì
      20: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™', 'Á†Ç', 'È¢®', 'Êµ∑', 'È≠ö', 'Èõ≤', 'Ëôπ', 'ÊØí', 'Ê≤º', 'Âπª', 'Èúß', 'ÁµÇ', 'ÁÑâ', '„ÅÇ'], // „Çπ„ÉÜ„Éº„Ç∏20: ‰∫úÁ©∫ÈñìÁ≥ª
      21: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™', 'Á†Ç', 'È¢®', 'Êµ∑', 'È≠ö', 'Èõ≤', 'Ëôπ', 'ÊØí', 'Ê≤º', 'Âπª', 'Èúß', 'ÁµÇ', 'ÁÑâ', '„ÅÇ', 'Áâ¢', 'Êüµ'], // „Çπ„ÉÜ„Éº„Ç∏21: Èóá„ÅÆÂú∞‰∏ãÁâ¢Á≥ª
      22: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™', 'Á†Ç', 'È¢®', 'Êµ∑', 'È≠ö', 'Èõ≤', 'Ëôπ', 'ÊØí', 'Ê≤º', 'Âπª', 'Èúß', 'ÁµÇ', 'ÁÑâ', '„ÅÇ', 'Áâ¢', 'Êüµ', 'Â∂∫', 'Â≥∞'], // „Çπ„ÉÜ„Éº„Ç∏22: È´òÂ±±Á≥ª
      23: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™', 'Á†Ç', 'È¢®', 'Êµ∑', 'È≠ö', 'Èõ≤', 'Ëôπ', 'ÊØí', 'Ê≤º', 'Â≤©', 'Èâ±'], // „Çπ„ÉÜ„Éº„Ç∏23: Âú∞Â∫ï„ÅÆÊ¥ûÁ™üÁ≥ª
      24: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™', 'Á†Ç', 'È¢®', 'Êµ∑', 'È≠ö', 'Èõ≤', 'Ëôπ', 'ÊØí', 'Ê≤º', 'Âπª', 'Èúß', 'ÁµÇ', 'ÁÑâ', '„ÅÇ', 'Áâ¢', 'Êüµ', 'Â∂∫', 'Â≥∞', 'ÊØí', 'Ê≤º', 'Â¢ì', 'Èúä'], // „Çπ„ÉÜ„Éº„Ç∏24: Âë™„ÅÑ„ÅÆÂ¢ìÂ†¥Á≥ª
      25: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™', 'Á†Ç', 'È¢®', 'Êµ∑', 'È≠ö', 'Èõ≤', 'Ëôπ', 'ÊØí', 'Ê≤º', 'Âπª', 'Èúß', 'ÁµÇ', 'ÁÑâ', '„ÅÇ', 'Áâ¢', 'Êüµ', 'Â∂∫', 'Â≥∞', 'ÊØí', 'Ê≤º', 'Â¢ì', 'Èúä', 'Ê©ü', 'Êúà'], // „Çπ„ÉÜ„Éº„Ç∏25: Âπª„ÅÆÊ£ÆÁ≥ª
      26: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™', 'Á†Ç', 'È¢®', 'Êµ∑', 'È≠ö', 'Èõ≤', 'Ëôπ', 'ÊØí', 'Ê≤º', 'Âπª', 'Èúß', 'ÁµÇ', 'ÁÑâ', '„ÅÇ', 'Áâ¢', 'Êüµ', 'Â∂∫', 'Â≥∞', 'ÊØí', 'Ê≤º', 'Â¢ì', 'Èúä', 'Ê©ü', 'Êúà', 'Ëàü'], // „Çπ„ÉÜ„Éº„Ç∏26: ÊúàÂÖâ„ÅÆÊπñÁ≥ª
      27: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™', 'Á†Ç', 'È¢®', 'Êµ∑', 'È≠ö', 'Èõ≤', 'Ëôπ', 'ÊØí', 'Ê≤º', 'Âπª', 'Èúß', 'ÁµÇ', 'ÁÑâ', '„ÅÇ', 'Áâ¢', 'Êüµ', 'Â∂∫', 'Â≥∞', 'ÊØí', 'Ê≤º', 'Â¢ì', 'Èúä', 'Ê©ü', 'Ê≠Ø'], // „Çπ„ÉÜ„Éº„Ç∏27: Ê©üÊ¢∞ÈÉΩÂ∏ÇÁ≥ª
      28: ['ÂÆ∂', 'Ê∞ë', 'Áïë'], // „Çπ„ÉÜ„Éº„Ç∏28: ÁßòÂ¢ÉÊùë
      29: ['Ê≥â'], // „Çπ„ÉÜ„Éº„Ç∏29: Á´ú„ÅÆÊ≥â
      30: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™', 'Á†Ç', 'È¢®', 'Êµ∑', 'È≠ö', 'Èõ≤', 'Ëôπ', 'ÊØí', 'Ê≤º', 'Âπª', 'Èúß', 'ÁµÇ', 'ÁÑâ', '„ÅÇ', 'Áâ¢', 'Êüµ', 'Â∂∫', 'Â≥∞', 'ÊØí', 'Ê≤º', 'Â¢ì', 'Èúä', 'Ê©ü', 'Êúà', 'Èè°', 'Êò†', 'Âë™', 'Áïë', 'ÂÆ∂', 'Ê≥â', 'ËÅñ', 'K'], // „Çπ„ÉÜ„Éº„Ç∏30: KÁ†îÁ©∂ÊâÄÁ≥ª
      31: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™', 'Á†Ç', 'È¢®', 'Êµ∑', 'È≠ö', 'Èõ≤', 'Ëôπ', 'ÊØí', 'Ê≤º', 'Âπª', 'Èúß', 'ÁµÇ', 'ÁÑâ', '„ÅÇ', 'Áâ¢', 'Êüµ', 'Â∂∫', 'Â≥∞', 'ÊØí', 'Ê≤º', 'Â¢ì', 'Èúä', 'Ê©ü', 'Êúà', 'Èè°', 'Êò†', 'Âë™', 'Áïë', 'ÂÆ∂', 'Ê≥â', 'ËÅñ', 'K', 'ÂàÄ', 'Èéß', 'ÈäÉ'], // „Çπ„ÉÜ„Éº„Ç∏31: Èñ¢„Ç±Âéü
      32: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™', 'Á†Ç', 'È¢®', 'Êµ∑', 'È≠ö', 'Èõ≤', 'Ëôπ', 'ÊØí', 'Ê≤º', 'Âπª', 'Èúß', 'ÁµÇ', 'ÁÑâ', '„ÅÇ', 'Áâ¢', 'Êüµ', 'Â∂∫', 'Â≥∞', 'ÊØí', 'Ê≤º', 'Â¢ì', 'Èúä', 'Ê©ü', 'Êúà', 'Èè°', 'Êò†', 'Âë™', 'Áïë', 'ÂÆ∂', 'Ê≥â', 'ËÅñ', 'K', 'ÂàÄ', 'Èéß', 'ÈäÉ', 'Êõ∏', 'Â∞Å'], // „Çπ„ÉÜ„Éº„Ç∏32: Á¶ÅÊõ∏Â∫´
      33: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™', 'Á†Ç', 'È¢®', 'Êµ∑', 'È≠ö', 'Èõ≤', 'Ëôπ', 'ÊØí', 'Ê≤º', 'Âπª', 'Èúß', 'ÁµÇ', 'ÁÑâ', '„ÅÇ', 'Áâ¢', 'Êüµ', 'Â∂∫', 'Â≥∞', 'ÊØí', 'Ê≤º', 'Â¢ì', 'Èúä', 'Ê©ü', 'Êúà', 'Èè°', 'Êò†', 'Âë™', 'Áïë', 'ÂÆ∂', 'Ê≥â', 'ËÅñ', 'K', 'ÂàÄ', 'Èéß', 'ÈäÉ', 'Êõ∏', 'Â∞Å', 'ËΩü', 'Áäá'], // „Çπ„ÉÜ„Éº„Ç∏33: „Éë„É©„É¨„É´„ÉØ„Éº„É´„Éâ1
      34: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™', 'Á†Ç', 'È¢®', 'Êµ∑', 'È≠ö', 'Èõ≤', 'Ëôπ', 'ÊØí', 'Ê≤º', 'Âπª', 'Èúß', 'ÁµÇ', 'ÁÑâ', '„ÅÇ', 'Áâ¢', 'Êüµ', 'Â∂∫', 'Â≥∞', 'ÊØí', 'Ê≤º', 'Â¢ì', 'Èúä', 'Ê©ü', 'Êúà', 'Èè°', 'Êò†', 'Âë™', 'Áïë', 'ÂÆ∂', 'Ê≥â', 'ËÅñ', 'K', 'ÂàÄ', 'Èéß', 'ÈäÉ', 'Êõ∏', 'Â∞Å', 'ËΩü', 'Áäá', 'Á§º', 'ËÅñ'], // „Çπ„ÉÜ„Éº„Ç∏34: Á§ºÊãùÂ†Ç
      35: ['Âøç', 'ÂΩ±', 'Á†≤', 'Á´ú', 'È≥≥', 'ÁÇé', 'ÁÅ´', 'Ê∞¥', 'Ê≥¢', 'Êú®', 'Ëëâ', 'ÂÖâ', 'Êòü', 'Èóá', 'È≠î', 'ÈäÖ', 'ÈâÑ', 'Èå´', 'Èâõ', 'ÂÆù', 'Èõª', 'Èõ∑', 'ÊôÇ', 'Ê∞∑', 'Èõ™', 'Á†Ç', 'È¢®', 'Êµ∑', 'È≠ö', 'Èõ≤', 'Ëôπ', 'ÊØí', 'Ê≤º', 'Âπª', 'Èúß', 'ÁµÇ', 'ÁÑâ', '„ÅÇ', 'Áâ¢', 'Êüµ', 'Â∂∫', 'Â≥∞', 'ÊØí', 'Ê≤º', 'Â¢ì', 'Èúä', 'Ê©ü', 'Êúà', 'Èè°', 'Êò†', 'Âë™', 'Áïë', 'ÂÆ∂', 'Ê≥â', 'ËÅñ', 'K', 'ÂàÄ', 'Èéß', 'ÈäÉ', 'Êõ∏', 'Â∞Å', 'ËΩü', 'Áäá', 'Á§º', 'ËÅñ', 'Ââ£', 'Áõæ'] // „Çπ„ÉÜ„Éº„Ç∏35: Ëã±ÈõÑ„ÅÆÈóòÊäÄÂ†¥
    };
    
    // ÁèæÂú®„ÅÆ„Çπ„ÉÜ„Éº„Ç∏„Åß‰ΩøÁî®ÂèØËÉΩ„Å™Èßí„ÇíÂèñÂæó
    let availablePieces = [...basicPieces];
    
    // „ÇØ„É™„Ç¢Ê∏à„Åø„Çπ„ÉÜ„Éº„Ç∏„ÅÆÈßí„ÇíËøΩÂä†
    for (let stage = 1; stage <= currentStage; stage++) {
      if (clearedStages.includes(stage) && stagePieces[stage]) {
        availablePieces = [...availablePieces, ...stagePieces[stage]];
      }
    }
    
    // „Éú„ÇπÈßíÔºàK„ÄÅÂÆü„ÄÅÁï∞Ôºâ„ÇíÈô§Â§ñ
    availablePieces = availablePieces.filter(piece => !['K', 'ÂÆü', 'Áï∞'].includes(piece));
    
    // ÈáçË§á„ÇíÈô§Âéª
    availablePieces = [...new Set(availablePieces)];
    
    console.log(`„Çπ„ÉÜ„Éº„Ç∏${currentStage}„Åß‰ΩøÁî®ÂèØËÉΩ„Å™Èßí:`, availablePieces);
    return availablePieces;
  }

  // „Çπ„ÉÜ„Éº„Ç∏ÊÉÖÂ†±„ÇíÊõ¥Êñ∞
  function updateStageInfo() {
    const stageInfoEl = document.getElementById('stage-info');
    if (!stageInfoEl) return;
    
    const clearedStages = loadClearedStages();
    const currentStage = state.stageIndex + 1;
    const availablePieces = getAvailablePiecesForStage(state.stageIndex);
    const totalPieces = state.hands.player.filter(p => p !== 'Á©∫').length;
    const availableCount = state.hands.player.filter(p => p !== 'Á©∫' && availablePieces.includes(p)).length;
    
    let infoText = `„Çπ„ÉÜ„Éº„Ç∏${currentStage} | „ÇØ„É™„Ç¢Ê∏à„Åø: ${clearedStages.length}„Çπ„ÉÜ„Éº„Ç∏`;
    if (totalPieces > 0) {
      infoText += ` | ‰ΩøÁî®ÂèØËÉΩ: ${availableCount}/${totalPieces}Èßí`;
    }
    
    stageInfoEl.textContent = infoText;
    
    // 1ÊâãÊàª„Åô„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
    updateUndoButton();
  }

  // „Éõ„Éº„É†„Å´Êàª„Çã
  function goHome() {
    window.location.href = 'home.html';
  }

  // Ëµ∑ÂãïÔºàURL„ÅÆ stage „Éë„É©„É°„Éº„Çø„ÇíÂÑ™ÂÖàÔºâ
  function startGameFromURL(){
    const params = new URLSearchParams(location.search);
    const s = parseInt(params.get('stage') || '1', 10);
    const idx = isNaN(s) ? 0 : Math.max(1, Math.min(STAGES.length, s)) - 1;
    loadStage(idx);
  }
  startGameFromURL();

  // ÁÇé„ÅÆÂ£ÅÂäπÊûú„ÄÅÁÇé„ÅÆ‰ºùÊí≠„ÅÆÁØÑÂõ≤„ÇíÁÇé„Éû„Éº„ÇØ„Åß‰∏ÄÁû¨Ë°®Á§∫
  function showFireEffect(piece, fromRow, fromCol, toRow, toCol) {
    if (piece === 'ÁÇé') {
      // ÁÇé„ÅÆ‰ºùÊí≠ÂäπÊûú: Èö£Êé•„Åô„ÇãÊïµÈßí„ÅÆÂë®Âõ≤„Å´ÁÇé„Éû„Éº„ÇØ„ÇíË°®Á§∫
      showFlamePropagation(toRow, toCol);
    } else if (piece === 'ÁÅ´') {
      // ÁÅ´„ÅÆÂ£ÅÂäπÊûú: ÁßªÂãïÁµåË∑Ø„Å´ÁÇé„Éû„Éº„ÇØ„ÇíË°®Á§∫
      showFireWall(fromRow, fromCol, toRow, toCol);
    }
  }

  // ÁÇé„ÅÆ‰ºùÊí≠ÂäπÊûú„ÇíË°®Á§∫
  function showFlamePropagation(row, col) {
    const fireMarks = [];
    const destroyedPieces = [];
    
    // Âë®Âõ≤8ÊñπÂêë„Å´ÁÇé„Éû„Éº„ÇØ„ÇíË°®Á§∫
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = row + d[0], nc = col + d[1];
      if (inBounds(nr, nc) && state.board[nr][nc] && state.board[nr][nc].owner !== state.currentPlayer && 
          state.board[nr][nc].piece !== 'X') {
        const fireMark = createFireMark(nr, nc);
        fireMarks.push(fireMark);
        document.body.appendChild(fireMark);
        
        // 10%„ÅÆÁ¢∫Áéá„ÅßÊïµÈßí„ÇíÊ∂àÊªÖ„Åï„Åõ„Çã
        if (Math.random() < 0.1) {
          const targetPiece = state.board[nr][nc];
          destroyedPieces.push({
            row: nr,
            col: nc,
            piece: targetPiece.piece,
            owner: targetPiece.owner
          });
          
          // Èßí„ÇíÊ∂àÊªÖ„Åï„Åõ„Çã
          state.board[nr][nc] = null;
          
          // Ê∂àÊªÖ„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
          showDestructionEffect(nr, nc, targetPiece.piece);
        }
      }
    });
    
    // Ê∂àÊªÖ„Åó„ÅüÈßí„ÅÆÊÉÖÂ†±„Çí„É≠„Ç∞„Å´Âá∫Âäõ
    if (destroyedPieces.length > 0) {
      console.log('üî• ÁÇé„ÅÆ‰ºùÊí≠„ÅßÊ∂àÊªÖ„Åó„ÅüÈßí:', destroyedPieces);
      setStatus(`ÁÇé„ÅÆ‰ºùÊí≠„Åß${destroyedPieces.length}ÂÄã„ÅÆÊïµÈßí„ÇíÊ∂àÊªÖ„Åï„Åõ„Åæ„Åó„ÅüÔºÅ`, 'playing');
      
      // Áµ±Ë®à„ÇíÊõ¥Êñ∞
      updateFlamePropagationStats(destroyedPieces.length);
    } else {
      setStatus('ÁÇé„ÅÆ‰ºùÊí≠ÂäπÊûúÁô∫ÂãïÔºÅÊïµÈßí„ÅØÊ∂àÊªÖ„Åó„Åæ„Åõ„Çì„Åß„Åó„Åü', 'playing');
      // Áµ±Ë®à„ÇíÊõ¥Êñ∞ÔºàÂ§±Êïó„ÅÆÂ†¥ÂêàÔºâ
      updateFlamePropagationStats(0);
    }
    
    // 1ÁßíÂæå„Å´ÁÇé„Éû„Éº„ÇØ„ÇíÂâäÈô§
    setTimeout(() => {
      fireMarks.forEach(mark => {
        if (mark.parentNode) {
          mark.parentNode.removeChild(mark);
        }
      });
      
      // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
      render();
    }, 1000);
  }

  // ÁÅ´„ÅÆÂ£ÅÂäπÊûú„ÇíË°®Á§∫
  function showFireWall(fromRow, fromCol, toRow, toCol) {
    const fireMarks = [];
    
    // ÁßªÂãïÁµåË∑Ø„ÇíË®àÁÆó
    const dr = toRow - fromRow;
    const dc = toCol - fromCol;
    
    if (dr === 0) { // Ê®™ÁßªÂãï
      const start = Math.min(fromCol, toCol);
      const end = Math.max(fromCol, toCol);
      for (let c = start; c <= end; c++) {
        if (c !== fromCol) { // ÈñãÂßã‰ΩçÁΩÆ„ÅØÈô§Â§ñ
          const fireMark = createFireMark(fromRow, c);
          fireMarks.push(fireMark);
          document.body.appendChild(fireMark);
        }
      }
    } else if (dc === 0) { // Á∏¶ÁßªÂãï
      const start = Math.min(fromRow, toRow);
      const end = Math.max(fromRow, toRow);
      for (let r = start; r <= end; r++) {
        if (r !== fromRow) { // ÈñãÂßã‰ΩçÁΩÆ„ÅØÈô§Â§ñ
          const fireMark = createFireMark(r, fromCol);
          fireMarks.push(fireMark);
          document.body.appendChild(fireMark);
        }
      }
    }
    
    // 1ÁßíÂæå„Å´ÁÇé„Éû„Éº„ÇØ„ÇíÂâäÈô§
    setTimeout(() => {
      fireMarks.forEach(mark => {
        if (mark.parentNode) {
          mark.parentNode.removeChild(mark);
        }
      });
    }, 1000);
  }

  // ÁÇé„Éû„Éº„ÇØË¶ÅÁ¥†„Çí‰ΩúÊàê
  function createFireMark(row, col) {
    const fireMark = document.createElement('div');
    fireMark.className = 'fire-mark';
    fireMark.textContent = 'üî•';
    fireMark.style.cssText = `
      position: fixed;
      font-size: 28px;
      z-index: 1000;
      pointer-events: none;
      animation: firePulse 0.5s ease-in-out;
      filter: drop-shadow(0 0 8px #ff4500);
    `;
    
    // „Éú„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„Å´Âêà„Çè„Åõ„Å¶ÈÖçÁΩÆÔºà„Çà„ÇäÊ≠£Á¢∫„Å™‰ΩçÁΩÆË®àÁÆóÔºâ
    const boardElement = document.querySelector('.board');
    if (boardElement) {
      const boardRect = boardElement.getBoundingClientRect();
      const cellSize = boardRect.width / 9;
      const left = boardRect.left + col * cellSize + cellSize / 2 - 14;
      const top = boardRect.top + row * cellSize + cellSize / 2 - 14;
      fireMark.style.left = left + 'px';
      fireMark.style.top = top + 'px';
    }
    
    return fireMark;
  }

  // ÁÇé„ÅÆÈßí„ÅÆÁßªÂãïÊôÇ„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂº∑Âåñ
  function enhanceFirePieceMove(piece, row, col) {
    if (piece === 'ÁÇé' || piece === 'ÁÅ´') {
      const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
      if (cell) {
        cell.style.animation = 'firePulse 0.3s ease-in-out';
        setTimeout(() => {
          cell.style.animation = '';
        }, 300);
      }
    }
  }

  // Ê∞∑„ÅÆÈßí„ÅÆÁßªÂãïÊôÇ„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂº∑Âåñ
  function enhanceIcePieceMove(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (cell) {
      cell.style.animation = 'iceFreeze 0.6s ease-in-out';
      setTimeout(() => {
        cell.style.animation = '';
      }, 600);
    }
  }

  // Èõ™„ÅÆÈßí„ÅÆÁßªÂãïÊôÇ„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂº∑Âåñ
  function enhanceSnowPieceMove(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (cell) {
      cell.style.animation = 'snowMove 0.8s ease-in-out';
      setTimeout(() => {
        cell.style.animation = '';
      }, 800);
    }
  }

  // È≠ö„ÅÆÈßí„ÅÆÁßªÂãïÊôÇ„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂº∑Âåñ
  function enhanceFishPieceMove(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (cell) {
      cell.style.animation = 'fishSwim 0.8s ease-in-out';
      setTimeout(() => {
        cell.style.animation = '';
      }, 800);
    }
  }



  // Ê∞¥„ÅÆÈßí„ÅÆÁßªÂãïÊôÇ„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂº∑Âåñ
  function enhanceWaterPieceMove(piece, row, col) {
    if (piece === 'Ê∞¥' || piece === 'Ê≥¢') {
      const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
      if (cell) {
        if (piece === 'Ê∞¥') {
          cell.style.animation = 'waterFlow 0.5s ease-in-out';
        } else if (piece === 'Ê≥¢') {
          cell.style.animation = 'waveFlow 0.5s ease-in-out';
        }
        setTimeout(() => {
          cell.style.animation = '';
        }, 500);
      }
    }
  }

  // Êú®„ÅÆÈßí„ÅÆÁßªÂãïÊôÇ„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂº∑Âåñ
  function enhanceTreePieceMove(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (cell) {
      cell.style.animation = 'treeGrowth 0.6s ease-in-out';
      setTimeout(() => {
        cell.style.animation = '';
      }, 600);
    }
  }

  // „Çª„É´„ÅÆ„ÇØ„É©„Çπ„ÇíÊõ¥Êñ∞
  function updateCellClass(cell, row, col) {
    const sq = state.board[row][col];
    cell.className = 'cell';
    
    if (sq) {
      cell.classList.add(sq.owner);
      if (sq.isOriginal) {
        cell.classList.add('original');
      }
      // ÁÇé„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'ÁÇé' || sq.piece === 'ÁÅ´') {
        cell.classList.add('fire-piece');
      }
      // Ê∞¥„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'Ê∞¥' || sq.piece === 'Ê≥¢') {
        cell.classList.add('water-piece');
      }
      // Êú®„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'Êú®' || sq.piece === 'Ëëâ') {
        cell.classList.add('tree-piece');
      }
      // ÈáëÂ±ûÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'ÈäÖ') {
        cell.classList.add('copper-piece');
      } else if (sq.piece === 'ÈâÑ') {
        cell.classList.add('iron-piece');
      } else if (sq.piece === 'Èå´') {
        cell.classList.add('tin-piece');
      } else if (sq.piece === 'Èâõ') {
        cell.classList.add('lead-piece');
      }
      // ÂÆù„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'ÂÆù') {
        cell.classList.add('treasure-piece');
      }
      // Èõª„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'Èõª') {
        cell.classList.add('electric-piece');
      }
      // Èõ∑„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'Èõ∑') {
        cell.classList.add('thunder-piece');
      }
      // Èóá„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'Èóá') {
        cell.classList.add('dark-piece');
      }
      // È≠î„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'È≠î') {
        cell.classList.add('demon-piece');
      }
      // Ê∞∑„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'Ê∞∑') {
        cell.classList.add('ice-piece');
      }
      // Áâ¢„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'Áâ¢') {
        cell.classList.add('prison-piece');
      }
      // Êüµ„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'Êüµ') {
        cell.classList.add('fence-piece');
      }
      // Â∂∫„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'Â∂∫') {
        cell.classList.add('ridge-piece');
      }
      // Â≥∞„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'Â≥∞') {
        cell.classList.add('peak-piece');
      }
      // Â±±„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'Â±±') {
        cell.classList.add('mountain-piece');
      }
      // Â≤©„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'Â≤©') {
        cell.classList.add('rock-piece');
      }
      // Èâ±„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'Èâ±') {
        cell.classList.add('ore-piece');
      }
      // Â¢ì„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'Â¢ì') {
        cell.classList.add('grave-piece');
      }
      // Èúä„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´„ÇíËøΩÂä†
      if (sq.piece === 'Èúä') {
        cell.classList.add('spirit-piece');
      }
    }
    
    // Áü¢Âç∞„Éû„Çπ„ÅÆÂá¶ÁêÜÔºàÈßí„ÅÆÊúâÁÑ°„Å´Èñ¢‰øÇ„Å™„ÅèÔºâ
    if ((sq && ['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(sq.piece)) || (sq && sq.underTile && ['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(sq.underTile.piece))) {
      const arrowPiece = sq.piece && ['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(sq.piece) ? sq.piece : sq.underTile.piece;
      cell.classList.add(`arrow-${arrowPiece === '‚Üë' ? 'up' : arrowPiece === '‚Üê' ? 'left' : arrowPiece === '‚Üì' ? 'down' : 'right'}`);
    }
    
    // Âë™„ÅÑ„Éû„Çπ„ÅÆÂá¶ÁêÜÔºàÈßí„ÅÆÊúâÁÑ°„Å´Èñ¢‰øÇ„Å™„ÅèÔºâ
    if ((sq && sq.piece === 'n') || (sq && sq.underTile && sq.underTile.piece === 'n')) {
      cell.classList.add('curse-tile');
    }
    
    // Ë°åÂãï‰∏çËÉΩÁä∂ÊÖã„ÅÆÈßí„Å´Ë¶ñË¶öÁöÑ„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®
    if (isImprisoned(row, col)) {
      cell.classList.add('imprisoned');
    }
    
    if (state.selected && state.selected.r === row && state.selected.c === col) {
      cell.classList.add('selected');
    }
    
    if (state.validMoves.some(m => m.r === row && m.c === col)) {
      cell.classList.add('valid');
      // ÁÇé„ÅÆÈßí„ÅÆÊúâÂäπÁßªÂãï„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´
      if (state.selected && state.board[state.selected.r][state.selected.c] && 
          (state.board[state.selected.r][state.selected.c].piece === 'ÁÇé' || 
           state.board[state.selected.r][state.selected.c].piece === 'ÁÅ´')) {
        cell.classList.add('fire-valid');
      }
      // Ê∞¥„ÅÆÈßí„ÅÆÊúâÂäπÁßªÂãï„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´
      if (state.selected && state.board[state.selected.r][state.selected.c] && 
          (state.board[state.selected.r][state.selected.c].piece === 'Ê∞¥' || 
           state.board[state.selected.r][state.selected.c].piece === 'Ê≥¢')) {
        cell.classList.add('water-valid');
      }
      // Ê∞∑„ÅÆÈßí„ÅÆÊúâÂäπÁßªÂãï„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´
      if (state.selected && state.board[state.selected.r][state.selected.c] && 
          state.board[state.selected.r][state.selected.c].piece === 'Ê∞∑') {
        cell.classList.add('ice-valid');
      }
      // Êú®„ÅÆÈßí„ÅÆÊúâÂäπÁßªÂãï„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´
      if (state.selected && state.board[state.selected.r][state.selected.c] && 
          (state.board[state.selected.r][state.selected.c].piece === 'Êú®' || 
           state.board[state.selected.r][state.selected.c].piece === 'Ëëâ')) {
        cell.classList.add('tree-valid');
      }
      // ÈáëÂ±ûÈßí„ÅÆÊúâÂäπÁßªÂãï„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„Çπ„Çø„Ç§„É´
      if (state.selected && state.board[state.selected.r][state.selected.c]) {
        const selectedPiece = state.board[state.selected.r][state.selected.c].piece;
        if (selectedPiece === 'ÈäÖ') {
          cell.classList.add('copper-valid');
        } else if (selectedPiece === 'ÈâÑ') {
          cell.classList.add('iron-valid');
        } else if (selectedPiece === 'Èå´') {
          cell.classList.add('tin-valid');
        } else if (selectedPiece === 'Èâõ') {
          cell.classList.add('lead-valid');
        } else if (selectedPiece === 'ÂÆù') {
          cell.classList.add('treasure-valid');
        } else if (selectedPiece === 'Èõª') {
          cell.classList.add('electric-valid');
        } else if (selectedPiece === 'Èõ∑') {
          cell.classList.add('thunder-valid');
        } else if (selectedPiece === 'Èóá') {
          cell.classList.add('dark-valid');
        } else if (selectedPiece === 'È≠î') {
          cell.classList.add('demon-valid');
        }
      }
    }
  }

  // Ê∂àÊªÖ„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
  function showDestructionEffect(row, col, pieceName) {
    const destructionMark = document.createElement('div');
    destructionMark.className = 'destruction-mark';
    destructionMark.textContent = 'üí•';
    destructionMark.style.cssText = `
      position: fixed;
      font-size: 32px;
      z-index: 1001;
      pointer-events: none;
      animation: destructionEffect 1s ease-in-out forwards;
      filter: drop-shadow(0 0 12px #ff0000);
    `;
    
    // „Éú„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„Å´Âêà„Çè„Åõ„Å¶ÈÖçÁΩÆ
    const boardElement = document.querySelector('.board');
    if (boardElement) {
      const boardRect = boardElement.getBoundingClientRect();
      const cellSize = boardRect.width / 9;
      const left = boardRect.left + col * cellSize + cellSize / 2 - 16;
      const top = boardRect.top + row * cellSize + cellSize / 2 - 16;
      destructionMark.style.left = left + 'px';
      destructionMark.style.top = top + 'px';
    }
    
    document.body.appendChild(destructionMark);
    
    // 1ÁßíÂæå„Å´Ê∂àÊªÖ„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂâäÈô§
    setTimeout(() => {
      if (destructionMark.parentNode) {
        destructionMark.parentNode.removeChild(destructionMark);
      }
    }, 1000);
  }

  // ÁÇé„ÅÆ‰ºùÊí≠Áµ±Ë®à„ÇíËøΩË∑°
  let flamePropagationStats = {
    totalAttempts: 0,
    successfulDestructions: 0,
    lastDestruction: null
  };

  // ÁÇé„ÅÆ‰ºùÊí≠Áµ±Ë®à„ÇíÊõ¥Êñ∞
  function updateFlamePropagationStats(destroyedCount) {
    flamePropagationStats.totalAttempts++;
    flamePropagationStats.successfulDestructions += destroyedCount;
    flamePropagationStats.lastDestruction = new Date();
    
    console.log('üî• ÁÇé„ÅÆ‰ºùÊí≠Áµ±Ë®à:', {
      totalAttempts: flamePropagationStats.totalAttempts,
      successfulDestructions: flamePropagationStats.successfulDestructions,
      successRate: ((flamePropagationStats.successfulDestructions / flamePropagationStats.totalAttempts) * 100).toFixed(1) + '%'
    });
  }

  // ÁÇé„ÅÆ‰ºùÊí≠Áµ±Ë®à„ÇíË°®Á§∫

  // Êú®„ÅÆÊàêÈï∑ÂäπÊûú: 10%„ÅÆÁ¢∫Áéá„ÅßÂë®Âõ≤„Å´Êú®„ÅÆÈßí„ÇíÂá∫Áèæ„Åï„Åõ„Çã
  function showTreeGrowthEffect(fromRow, fromCol, toRow, toCol) {
    const treeMarks = [];
    const spawnedTrees = [];
    
    // ÁßªÂãïÁµåË∑Ø„ÇíË®àÁÆó
    const dr = toRow - fromRow;
    const dc = toCol - fromCol;
    
    if (dr === 0) { // Ê®™ÁßªÂãï
      const start = Math.min(fromCol, toCol);
      const end = Math.max(fromCol, toCol);
      for (let c = start; c <= end; c++) {
        if (c !== fromCol) { // ÈñãÂßã‰ΩçÁΩÆ„ÅØÈô§Â§ñ
          const treeMark = createTreeMark(fromRow, c);
          treeMarks.push(treeMark);
          document.body.appendChild(treeMark);
        }
      }
    } else if (dc === 0) { // Á∏¶ÁßªÂãï
      const start = Math.min(fromRow, toRow);
      const end = Math.max(fromRow, toRow);
      for (let r = start; r <= end; r++) {
        if (r !== fromRow) { // ÈñãÂßã‰ΩçÁΩÆ„ÅØÈô§Â§ñ
          const treeMark = createTreeMark(r, fromCol);
          treeMarks.push(treeMark);
          document.body.appendChild(treeMark);
        }
      }
    }
    
    // ÁßªÂãïÂÖà„ÅÆÂë®Âõ≤„ÅÆÁ©∫„Éû„Çπ„Å´10%„ÅÆÁ¢∫Áéá„ÅßÊú®„ÅÆÈßí„ÇíÂá∫Áèæ„Åï„Åõ„Çã
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = toRow + d[0], nc = toCol + d[1];
      if (inBounds(nr, nc) && !state.board[nr][nc] && 
          !(state.board[nr][nc] && state.board[nr][nc].piece === 'X' && state.board[nr][nc].owner === 'blocked')) {
        // 10%„ÅÆÁ¢∫Áéá„ÅßÊú®„ÅÆÈßí„ÇíÂá∫Áèæ„Åï„Åõ„Çã
        if (Math.random() < 0.1) {
          const newTreePiece = {
            piece: 'Êú®',
            owner: state.currentPlayer,
            isOriginal: true
          };
          state.board[nr][nc] = newTreePiece;
          
          spawnedTrees.push({
            row: nr,
            col: nc,
            piece: 'Êú®'
          });
          
          // Êú®„ÅÆÂá∫Áèæ„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
          showTreeSpawnEffect(nr, nc);
        }
      }
    });
    
    // Âá∫Áèæ„Åó„ÅüÊú®„ÅÆÈßí„ÅÆÊÉÖÂ†±„Çí„É≠„Ç∞„Å´Âá∫Âäõ
    if (spawnedTrees.length > 0) {
      console.log('üå≥ Êú®„ÅÆÊàêÈï∑„ÅßÂá∫Áèæ„Åó„ÅüÈßí:', spawnedTrees);
      setStatus(`Êú®„ÅÆÊàêÈï∑„Åß${spawnedTrees.length}ÂÄã„ÅÆÊú®„ÅÆÈßí„ÅåÂá∫Áèæ„Åó„Åæ„Åó„ÅüÔºÅ`, 'playing');
    } else {
      setStatus('Êú®„ÅÆÊàêÈï∑ÂäπÊûúÁô∫ÂãïÔºÅ10%„ÅÆÁ¢∫Áéá„ÅßÊú®„ÅÆÈßí„ÅåÂá∫Áèæ„Åó„Åæ„Åô', 'playing');
    }
    
    // 1ÁßíÂæå„Å´Êú®„Éû„Éº„ÇØ„ÇíÂâäÈô§
    setTimeout(() => {
      treeMarks.forEach(mark => {
        if (mark.parentNode) {
          mark.parentNode.removeChild(mark);
        }
      });
      
      // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
      render();
    }, 1000);
  }

  // Êú®„Éû„Éº„ÇØË¶ÅÁ¥†„Çí‰ΩúÊàê
  function createTreeMark(row, col) {
    const treeMark = document.createElement('div');
    treeMark.className = 'tree-mark';
    treeMark.textContent = 'üå≥';
    treeMark.style.cssText = `
      position: fixed;
      font-size: 24px;
      z-index: 1000;
      pointer-events: none;
      animation: treeGrowth 1s ease-in-out;
      filter: drop-shadow(0 0 8px #228B22);
    `;
    
    // „Éú„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„Å´Âêà„Çè„Åõ„Å¶ÈÖçÁΩÆ
    const boardElement = document.querySelector('.board');
    if (boardElement) {
      const boardRect = boardElement.getBoundingClientRect();
      const cellSize = boardRect.width / 9;
      const left = boardRect.left + col * cellSize + cellSize / 2 - 12;
      const top = boardRect.top + row * cellSize + cellSize / 2 - 12;
      treeMark.style.left = left + 'px';
      treeMark.style.top = top + 'px';
    }
    
    return treeMark;
  }

  // Êú®„ÅÆÂá∫Áèæ„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
  function showTreeSpawnEffect(row, col) {
    const spawnMark = document.createElement('div');
    spawnMark.className = 'spawn-mark';
    spawnMark.textContent = 'üå±';
    spawnMark.style.cssText = `
      position: fixed;
      font-size: 28px;
      z-index: 1003;
      pointer-events: none;
      animation: treeSpawn 1.2s ease-in-out;
      filter: drop-shadow(0 0 10px #32CD32);
    `;
    
    // „Éú„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„Å´Âêà„Çè„Åõ„Å¶ÈÖçÁΩÆ
    const boardElement = document.querySelector('.board');
    if (boardElement) {
      const boardRect = boardElement.getBoundingClientRect();
      const cellSize = boardRect.width / 9;
      const left = boardRect.left + col * cellSize + cellSize / 2 - 14;
      const top = boardRect.top + row * cellSize + cellSize / 2 - 14;
      spawnMark.style.left = left + 'px';
      spawnMark.style.top = top + 'px';
    }
    
    document.body.appendChild(spawnMark);
    
    // 1.2ÁßíÂæå„Å´Âá∫Áèæ„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂâäÈô§
    setTimeout(() => {
      if (spawnMark.parentNode) {
        spawnMark.parentNode.removeChild(spawnMark);
      }
    }, 1200);
  }

  // Ëëâ„ÅÆËàû„ÅÑÊï£„ÇäÂäπÊûú: ÁßªÂãïÁµåË∑Ø„Å´Ëëâ„ÇíÊï£„Çâ„Åô
  function showLeafScatteringEffect(fromRow, fromCol, toRow, toCol) {
    const leafMarks = [];
    const scatteredLeaves = [];
    const movedEnemies = [];
    
    // ÁßªÂãïÁµåË∑Ø„ÇíË®àÁÆó
    const dr = toRow - fromRow;
    const dc = toCol - fromCol;
    
    if (dr === 0) { // Ê®™ÁßªÂãï
      const start = Math.min(fromCol, toCol);
      const end = Math.max(fromCol, toCol);
      for (let c = start; c <= end; c++) {
        if (c !== fromCol) { // ÈñãÂßã‰ΩçÁΩÆ„ÅØÈô§Â§ñ
          const leafMark = createLeafMark(fromRow, c);
          leafMarks.push(leafMark);
          document.body.appendChild(leafMark);
          
          // ÁßªÂãïÁµåË∑Ø„Å´Ëëâ„ÅÆÂäπÊûú„ÇíË®òÈå≤
          scatteredLeaves.push({
            row: fromRow,
            col: c,
            effect: 'leaf-scatter'
          });
        }
      }
    } else if (dc === 0) { // Á∏¶ÁßªÂãï
      const start = Math.min(fromRow, toRow);
      const end = Math.max(fromRow, toRow);
      for (let r = start; r <= end; r++) {
        if (r !== fromRow) { // ÈñãÂßã‰ΩçÁΩÆ„ÅØÈô§Â§ñ
          const leafMark = createLeafMark(r, fromCol);
          leafMarks.push(leafMark);
          document.body.appendChild(leafMark);
          
          // ÁßªÂãïÁµåË∑Ø„Å´Ëëâ„ÅÆÂäπÊûú„ÇíË®òÈå≤
          scatteredLeaves.push({
            row: r,
            col: fromCol,
            effect: 'leaf-scatter'
          });
        }
      }
    } else { // Êñú„ÇÅÁßªÂãï
      const steps = Math.abs(dr);
      for (let i = 1; i <= steps; i++) {
        const r = fromRow + (dr > 0 ? i : -i);
        const c = fromCol + (dc > 0 ? i : -i);
        
        const leafMark = createLeafMark(r, c);
        leafMarks.push(leafMark);
        document.body.appendChild(leafMark);
        
        // ÁßªÂãïÁµåË∑Ø„Å´Ëëâ„ÅÆÂäπÊûú„ÇíË®òÈå≤
        scatteredLeaves.push({
          row: r,
          col: c,
          effect: 'leaf-scatter'
        });
      }
    }
    
    // ÁßªÂãïÂÖà„ÅÆÂë®Âõ≤„ÅÆÊïµÈßí„Çí10%„ÅÆÁ¢∫Áéá„Åß1„Éû„ÇπÁßªÂãï„Åï„Åõ„Çã
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = toRow + d[0], nc = toCol + d[1];
      if (inBounds(nr, nc)) {
        const target = state.board[nr][nc];
        if (target && target.owner !== state.currentPlayer && target.piece !== 'X') {
          // 10%„ÅÆÁ¢∫Áéá„ÅßÊïµÈßí„ÇíÁßªÂãï„Åï„Åõ„Çã
          if (Math.random() < 0.1) {
            const moveDirection = getRandomDirection();
            const newRow = nr + moveDirection[0];
            const newCol = nc + moveDirection[1];
            
            if (inBounds(newRow, newCol) && !state.board[newRow][newCol]) {
              // ÊïµÈßí„ÇíÁßªÂãï
              const movedPiece = state.board[nr][nc];
              state.board[nr][nc] = null;
              state.board[newRow][newCol] = movedPiece;
              
              movedEnemies.push({
                from: { row: nr, col: nc },
                to: { row: newRow, col: newCol },
                piece: movedPiece.piece
              });
              
              // ÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
              showLeafPushEffect(nr, nc, newRow, newCol);
            }
          }
        }
      }
    });
    
    // Ëëâ„ÅÆËàû„ÅÑÊï£„ÇäÂäπÊûú„ÅÆÊÉÖÂ†±„Çí„É≠„Ç∞„Å´Âá∫Âäõ
    if (scatteredLeaves.length > 0) {
      console.log('üçÉ Ëëâ„ÅÆËàû„ÅÑÊï£„ÇäÂäπÊûú:', scatteredLeaves);
      setStatus(`Ëëâ„ÅÆËàû„ÅÑÊï£„ÇäÂäπÊûúÁô∫ÂãïÔºÅÁßªÂãïÁµåË∑Ø„Å´${scatteredLeaves.length}ÂÄã„ÅÆËëâ„ÇíÊï£„Çâ„Åó„Åæ„Åó„Åü`, 'playing');
    }
    
    // ÊïµÈßíÁßªÂãï„ÅÆÊÉÖÂ†±„Çí„É≠„Ç∞„Å´Âá∫Âäõ
    if (movedEnemies.length > 0) {
      console.log('üçÉ Ëëâ„ÅÆËàû„ÅÑÊï£„Çä„ÅßÁßªÂãï„Åó„ÅüÊïµÈßí:', movedEnemies);
      setStatus(`Ëëâ„ÅÆËàû„ÅÑÊï£„Çä„Åß${movedEnemies.length}ÂÄã„ÅÆÊïµÈßí„ÅåÁßªÂãï„Åó„Åæ„Åó„ÅüÔºÅ`, 'playing');
    }
    
    // 1.5ÁßíÂæå„Å´Ëëâ„Éû„Éº„ÇØ„ÇíÂâäÈô§
    setTimeout(() => {
      leafMarks.forEach(mark => {
        if (mark.parentNode) {
          mark.parentNode.removeChild(mark);
        }
      });
      
      // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
      render();
    }, 1500);
  }

  // „É©„É≥„ÉÄ„É†„Å™ÊñπÂêë„ÇíÂèñÂæóÔºà8ÊñπÂêë„ÅÆ„ÅÜ„Å°1„Å§Ôºâ
  function getRandomDirection() {
    const directions = [
      [-1,-1], [-1,0], [-1,1],
      [0,-1],          [0,1],
      [1,-1],  [1,0],  [1,1]
    ];
    return directions[Math.floor(Math.random() * directions.length)];
  }

  // Ëëâ„ÅÆËàû„ÅÑÊï£„Çä„Å´„Çà„ÇãÊïµÈßíÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
  function showLeafPushEffect(fromRow, fromCol, toRow, toCol) {
    const pushMark = document.createElement('div');
    pushMark.className = 'leaf-push-mark';
    pushMark.textContent = 'üçÉ‚û°Ô∏è';
    pushMark.style.cssText = `
      position: fixed;
      font-size: 24px;
      z-index: 1001;
      pointer-events: none;
      animation: leafPush 1.2s ease-in-out;
      filter: drop-shadow(0 0 8px #228B22);
    `;
    
    // ÁßªÂãïÂÖÉ„ÅÆ‰ΩçÁΩÆ„Å´ÈÖçÁΩÆ
    const boardElement = document.querySelector('.board');
    if (boardElement) {
      const boardRect = boardElement.getBoundingClientRect();
      const cellSize = boardRect.width / 9;
      const left = boardRect.left + fromCol * cellSize + cellSize / 2 - 12;
      const top = boardRect.top + fromRow * cellSize + cellSize / 2 - 12;
      pushMark.style.left = left + 'px';
      pushMark.style.top = top + 'px';
    }
    
    document.body.appendChild(pushMark);
    
    // 1.2ÁßíÂæå„Å´ÂâäÈô§
    setTimeout(() => {
      if (pushMark.parentNode) {
        pushMark.parentNode.removeChild(pushMark);
      }
    }, 1200);
  }

  // Ëëâ„ÅÆÈßí„ÅÆÁßªÂãïÊôÇ„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂº∑Âåñ
  function enhanceLeafPieceMove(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (cell) {
      cell.style.animation = 'leafScatter 0.8s ease-in-out';
      setTimeout(() => {
        cell.style.animation = '';
      }, 800);
    }
  }

  // Ëëâ„Éû„Éº„ÇØË¶ÅÁ¥†„Çí‰ΩúÊàê
  function createLeafMark(row, col) {
    const leafMark = document.createElement('div');
    leafMark.className = 'leaf-mark';
    leafMark.textContent = 'üçÉ';
    leafMark.style.cssText = `
      position: fixed;
      font-size: 20px;
      z-index: 1000;
      pointer-events: none;
      animation: leafScatter 1.5s ease-in-out;
      filter: drop-shadow(0 0 6px #228B22);
    `;
    
    // „Éú„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„Å´Âêà„Çè„Åõ„Å¶ÈÖçÁΩÆ
    const boardElement = document.querySelector('.board');
    if (boardElement) {
      const boardRect = boardElement.getBoundingClientRect();
      const cellSize = boardRect.width / 9;
      const left = boardRect.left + col * cellSize + cellSize / 2 - 10;
      const top = boardRect.top + row * cellSize + cellSize / 2 - 10;
      leafMark.style.left = left + 'px';
      leafMark.style.top = top + 'px';
    }
    
    return leafMark;
  }

  // ÂÖâ„ÅÆÈßí„ÅÆÁßªÂãï: Êñú„ÇÅÊñπÂêë„ÅÆ„Åø + ÂÖâ„ÅÆÂèçÂ∞ÑÂäπÊûú
  function lightMoves(r,c){
    const o = state.board[r][c].owner;
    const m = [];
    
    // ÂÖâ„ÅÆÂãï„Åç: Êñú„ÇÅ4ÊñπÂêë„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÁßªÂãïÂèØËÉΩ + Â£Å„Åß„ÅÆÂèçÂ∞Ñ
    [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d => {
      let nr = r + d[0], nc = c + d[1];
      let currentDir = [...d];
      let reflectionCount = 0;
      const maxReflections = 3; // ÊúÄÂ§ßÂèçÂ∞ÑÂõûÊï∞
      
      while (inBounds(nr,nc) && reflectionCount <= maxReflections) {
        const target = state.board[nr][nc];
        if (!target) {
          m.push({r:nr,c:nc});
        } else if (target.owner !== o) {
          m.push({r:nr,c:nc}); // ÊïµÈßí„ÇíÂèñ„Çã
          break;
        } else {
          break; // Âë≥ÊñπÈßí„ÅßÊ≠¢„Åæ„Çã
        }
        
        // Ê¨°„ÅÆ‰ΩçÁΩÆ„ÇíË®àÁÆó
        let nextRow = nr + currentDir[0];
        let nextCol = nc + currentDir[1];
        
        // Â£Å„Å´ÂΩì„Åü„Å£„ÅüÂ†¥Âêà„ÅÆÂèçÂ∞ÑÂá¶ÁêÜ
        if (!inBounds(nextRow, nextCol)) {
          reflectionCount++;
          if (reflectionCount <= maxReflections) {
            // ÂèçÂ∞ÑÊñπÂêë„ÇíË®àÁÆó
            currentDir = calculateReflection(currentDir, nextRow, nextCol);
            if (currentDir) {
              // ÂèçÂ∞ÑÂæå„ÅÆ‰ΩçÁΩÆ„ÇíË®àÁÆó
              nextRow = nr + currentDir[0];
              nextCol = nc + currentDir[1];
              
              // ÂèçÂ∞ÑÂæå„ÅÆ‰ΩçÁΩÆ„ÅåÊúâÂäπ„Å™Â†¥Âêà„ÅÆ„ÅøÁ∂öË°å
              if (inBounds(nextRow, nextCol)) {
                nr = nextRow;
                nc = nextCol;
                continue;
              }
            }
          }
          break; // ÂèçÂ∞Ñ„Åß„Åç„Å™„ÅÑÂ†¥Âêà„ÅØÁµÇ‰∫Ü
        }
        
        nr = nextRow;
        nc = nextCol;
      }
    });
    
    return m;
  }

  // ÂÖâ„ÅÆÂèçÂ∞ÑÊñπÂêë„ÇíË®àÁÆó
  function calculateReflection(direction, outOfBoundsRow, outOfBoundsCol) {
    let newDir = [...direction];
    
    // Ë°å„ÅÆÂ¢ÉÁïå„ÉÅ„Çß„ÉÉ„ÇØ
    if (outOfBoundsRow < 0) {
      // ‰∏äÁ´Ø„ÅßÂèçÂ∞Ñ: ‰∏ãÂêë„Åç„Å´Â§âÊõ¥
      newDir[0] = Math.abs(direction[0]);
    } else if (outOfBoundsRow >= 9) {
      // ‰∏ãÁ´Ø„ÅßÂèçÂ∞Ñ: ‰∏äÂêë„Åç„Å´Â§âÊõ¥
      newDir[0] = -Math.abs(direction[0]);
    }
    
    // Âàó„ÅÆÂ¢ÉÁïå„ÉÅ„Çß„ÉÉ„ÇØ
    if (outOfBoundsCol < 0) {
      // Â∑¶Á´Ø„ÅßÂèçÂ∞Ñ: Âè≥Âêë„Åç„Å´Â§âÊõ¥
      newDir[1] = Math.abs(direction[1]);
    } else if (outOfBoundsCol >= 9) {
      // Âè≥Á´Ø„ÅßÂèçÂ∞Ñ: Â∑¶Âêë„Åç„Å´Â§âÊõ¥
      newDir[1] = -Math.abs(direction[1]);
    }
    
    // ÂèçÂ∞ÑÂæå„ÅÆÊñπÂêë„ÅåÊúâÂäπ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    if (newDir[0] !== 0 && newDir[1] !== 0) {
      return newDir;
    }
    
    return null; // ÂèçÂ∞Ñ„Åß„Åç„Å™„ÅÑÂ†¥Âêà
  }

  // Êòü„ÅÆÈßí„ÅÆÁßªÂãï: È£õËªä„Å®Âêå„ÅòÔºàÂçÅÂ≠óÊñπÂêë„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÔºâ
  function starMoves(r,c){
    const o = state.board[r][c].owner;
    const m = [];
    // È£õËªä„Å®Âêå„ÅòÁßªÂãï„Éë„Çø„Éº„É≥: ÂçÅÂ≠óÊñπÂêë„Å´‰Ωï„Éû„Çπ„Åß„ÇÇ
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => slide(m,r,c,o,d[0],d[1]));
    return m;
  }

  // Êòü„ÅÆÈßí„ÅÆÁßªÂãïÂäπÊûú„ÇíË°®Á§∫
  function showStarTrajectoryEffect(fromRow, fromCol, toRow, toCol) {
    const starMarks = [];
    const movedStars = [];
    
    // ÁßªÂãïÁµåË∑Ø„ÇíË®àÁÆó
    const dr = toRow - fromRow;
    const dc = toCol - fromCol;
    
    if (dr === 0) { // Ê®™ÁßªÂãï
      const start = Math.min(fromCol, toCol);
      const end = Math.max(fromCol, toCol);
      for (let c = start; c <= end; c++) {
        if (c !== fromCol) { // ÈñãÂßã‰ΩçÁΩÆ„ÅØÈô§Â§ñ
          const starMark = createStarMark(fromRow, c);
          starMarks.push(starMark);
          document.body.appendChild(starMark);
        }
      }
    } else if (dc === 0) { // Á∏¶ÁßªÂãï
      const start = Math.min(fromRow, toRow);
      const end = Math.max(fromRow, toRow);
      for (let r = start; r <= end; r++) {
        if (r !== fromRow) { // ÈñãÂßã‰ΩçÁΩÆ„ÅØÈô§Â§ñ
          const starMark = createStarMark(r, fromCol);
          starMarks.push(starMark);
          document.body.appendChild(starMark);
        }
      }
    }
    
    // ÁßªÂãïÂÖà„ÅÆÂë®Âõ≤„ÅÆÊïµÈßí„Çí1„Éû„ÇπÁßªÂãï„Åï„Åõ„Çã
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = toRow + d[0], nc = toCol + d[1];
      if (inBounds(nr, nc)) {
        const target = state.board[nr][nc];
        if (target && target.owner !== state.currentPlayer && target.piece !== 'X') {
          // 10%„ÅÆÁ¢∫Áéá„ÅßÊïµÈßí„ÇíÁßªÂãï„Åï„Åõ„Çã
          if (Math.random() < 0.1) {
            const moveDirection = getRandomDirection();
            const newRow = nr + moveDirection[0];
            const newCol = nc + moveDirection[1];
            
            if (inBounds(newRow, newCol) && !state.board[newRow][newCol]) {
              // ÊïµÈßí„ÇíÁßªÂãï
              const movedPiece = state.board[nr][nc];
              state.board[nr][nc] = null;
              state.board[newRow][newCol] = movedPiece;
              
              movedStars.push({
                from: { row: nr, col: nc },
                to: { row: newRow, col: newCol },
                piece: movedPiece.piece
              });
              
              // ÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
              showStarPushEffect(nr, nc, newRow, newCol);
            }
          }
        }
      }
    });
    
    // Êòü„ÅÆÁßªÂãï„ÅÆÊÉÖÂ†±„Çí„É≠„Ç∞„Å´Âá∫Âäõ
    if (movedStars.length > 0) {
      console.log('‚ú® Êòü„ÅÆËªåÈÅì„ÅßÁßªÂãï„Åó„ÅüÊòü:', movedStars);
      setStatus(`Êòü„ÅÆËªåÈÅì„Åß${movedStars.length}ÂÄã„ÅÆÊòü„ÅåÁßªÂãï„Åó„Åæ„Åó„ÅüÔºÅ`, 'playing');
    }
    
    // 1ÁßíÂæå„Å´Êòü„Éû„Éº„ÇØ„ÇíÂâäÈô§
    setTimeout(() => {
      starMarks.forEach(mark => {
        if (mark.parentNode) {
          mark.parentNode.removeChild(mark);
        }
      });
      
      // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
      render();
    }, 1000);
  }

  // Êòü„Éû„Éº„ÇØË¶ÅÁ¥†„Çí‰ΩúÊàê
  function createStarMark(row, col) {
    const starMark = document.createElement('div');
    starMark.className = 'star-mark';
    starMark.textContent = '‚ú®';
    starMark.style.cssText = `
      position: fixed;
      font-size: 24px;
      z-index: 1000;
      pointer-events: none;
      animation: starFlow 1s ease-in-out;
      filter: drop-shadow(0 0 8px #FFD700);
    `;
    
    // „Éú„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„Å´Âêà„Çè„Åõ„Å¶ÈÖçÁΩÆ
    const boardElement = document.querySelector('.board');
    if (boardElement) {
      const boardRect = boardElement.getBoundingClientRect();
      const cellSize = boardRect.width / 9;
      const left = boardRect.left + col * cellSize + cellSize / 2 - 12;
      const top = boardRect.top + row * cellSize + cellSize / 2 - 12;
      starMark.style.left = left + 'px';
      starMark.style.top = top + 'px';
    }
    
    return starMark;
  }

  // Êòü„ÅÆÁßªÂãï„Å´„Çà„ÇãÊïµÈßíÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
  function showStarPushEffect(fromRow, fromCol, toRow, toCol) {
    const pushMark = document.createElement('div');
    pushMark.className = 'star-push-mark';
    pushMark.textContent = '‚û°Ô∏è';
    pushMark.style.cssText = `
      position: fixed;
      font-size: 20px;
      z-index: 1002;
      pointer-events: none;
      animation: starPushEffect 0.8s ease-in-out;
      filter: drop-shadow(0 0 6px #FFD700);
    `;
    
    // ÁßªÂãïÂÖÉ„ÅÆ‰ΩçÁΩÆ„Å´ÈÖçÁΩÆ
    const boardElement = document.querySelector('.board');
    if (boardElement) {
      const boardRect = boardElement.getBoundingClientRect();
      const cellSize = boardRect.width / 9;
      const left = boardRect.left + fromCol * cellSize + cellSize / 2 - 10;
      const top = boardRect.top + fromRow * cellSize + cellSize / 2 - 10;
      pushMark.style.left = left + 'px';
      pushMark.style.top = top + 'px';
    }
    
    document.body.appendChild(pushMark);
    
    // 0.8ÁßíÂæå„Å´ÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂâäÈô§
    setTimeout(() => {
      if (pushMark.parentNode) {
        pushMark.parentNode.removeChild(pushMark);
      }
    }, 800);
  }

  // Êòü„ÅÆÈßí„ÅÆÁßªÂãïÊôÇ„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂº∑Âåñ
  function enhanceStarPieceMove(row, col) {
    if (state.board[row][col] && state.board[row][col].piece === 'Êòü') {
      const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
      if (cell) {
        cell.style.animation = 'starFlow 0.5s ease-in-out';
        setTimeout(() => {
          cell.style.animation = '';
        }, 500);
      }
    }
  }

  // Èóá„ÅÆÈßí„ÅÆÁßªÂãï: 8ÊñπÂêë„Å´‰Ωï„Éû„Çπ„Åß„ÇÇ + Èóá„ÅÆÂê∏ÂèéÂäπÊûú
  function darkMoves(r,c){
    const o = state.board[r][c].owner;
    const m = [];
    
    // Èóá„ÅÆÂãï„Åç: 8ÊñπÂêë„Å´ÊúÄÂ§ß2„Éû„Çπ„Åæ„ÅßÁßªÂãïÂèØËÉΩ
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      let steps = 0;
      let nr = r + d[0], nc = c + d[1];
      
      while (inBounds(nr,nc) && steps < 2) { // ÊúÄÂ§ß2„Éû„Çπ„Åæ„Åß
        const target = state.board[nr][nc];
        if (!target) {
          m.push({r:nr,c:nc});
        } else if (target.owner !== o) {
          m.push({r:nr,c:nc}); // ÊïµÈßí„ÇíÂèñ„Çã
          break;
        } else {
          break; // Âë≥ÊñπÈßí„ÅßÊ≠¢„Åæ„Çã
        }
        nr += d[0];
        nc += d[1];
        steps++;
      }
    });
    
    return m;
  }

  // È≠î„ÅÆÈßí„ÅÆÁßªÂãï: ÂçÅÂ≠óÊñπÂêë„Å´‰Ωï„Éû„Çπ„Åß„ÇÇ + È≠î„ÅÆÊΩúË°åÂäπÊûú
  function demonMoves(r,c){
    const o = state.board[r][c].owner;
    const m = [];
    
    // È≠î„ÅÆÂãï„Åç: ÂçÅÂ≠óÊñπÂêë„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÁßªÂãïÂèØËÉΩ
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => {
      let nr = r + d[0], nc = c + d[1];
      
      while (inBounds(nr,nc)) {
        const target = state.board[nr][nc];
        if (!target) {
          m.push({r:nr,c:nc});
        } else if (target.owner !== o) {
          m.push({r:nr,c:nc}); // ÊïµÈßí„ÇíÂèñ„Çã
          break;
        } else {
          break; // Âë≥ÊñπÈßí„ÅßÊ≠¢„Åæ„Çã
        }
        nr += d[0];
        nc += d[1];
      }
    });
    
    return m;
  }

  // Èóá„ÅÆÈßí„ÅÆÁßªÂãïÂäπÊûú„ÇíË°®Á§∫
  function showDarkAbsorptionEffect(fromRow, fromCol, toRow, toCol) {
    const darkMarks = [];
    const absorbedPieces = [];
    
    // ÁßªÂãïÁµåË∑Ø„ÇíË®àÁÆó
    const dr = toRow - fromRow;
    const dc = toCol - fromCol;
    
    if (dr === 0) { // Ê®™ÁßªÂãï
      const start = Math.min(fromCol, toCol);
      const end = Math.max(fromCol, toCol);
      for (let c = start; c <= end; c++) {
        if (c !== fromCol) { // ÈñãÂßã‰ΩçÁΩÆ„ÅØÈô§Â§ñ
          const darkMark = createDarkMark(fromRow, c);
          darkMarks.push(darkMark);
          document.body.appendChild(darkMark);
        }
      }
    } else if (dc === 0) { // Á∏¶ÁßªÂãï
      const start = Math.min(fromRow, toRow);
      const end = Math.max(fromRow, toRow);
      for (let r = start; r <= end; r++) {
        if (r !== fromRow) { // ÈñãÂßã‰ΩçÁΩÆ„ÅØÈô§Â§ñ
          const darkMark = createDarkMark(r, fromCol);
          darkMarks.push(darkMark);
          document.body.appendChild(darkMark);
        }
      }
    } else { // Êñú„ÇÅÁßªÂãï
      const steps = Math.abs(dr);
      for (let i = 1; i <= steps; i++) {
        const r = fromRow + (dr > 0 ? i : -i);
        const c = fromCol + (dc > 0 ? i : -i);
        
        const darkMark = createDarkMark(r, c);
        darkMarks.push(darkMark);
        document.body.appendChild(darkMark);
      }
    }
    
    // ÁßªÂãïÂÖà„ÅÆÂë®Âõ≤„ÅÆÊïµÈßí„Çí1„Å§„Å†„ÅëÈóá„ÅßË¶Ü„ÅÜ
    const adjacentEnemies = [];
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = toRow + d[0], nc = toCol + d[1];
      if (inBounds(nr, nc) && state.board[nr][nc] && state.board[nr][nc].owner !== state.currentPlayer && 
          state.board[nr][nc].piece !== 'X') {
        adjacentEnemies.push({row: nr, col: nc, piece: state.board[nr][nc]});
      }
    });
    
    // 1„Å§„Å†„Åë„É©„É≥„ÉÄ„É†„Å´ÈÅ∏Êäû„Åó„Å¶Èóá„ÅßË¶Ü„ÅÜ
    if (adjacentEnemies.length > 0) {
      const randomIndex = Math.floor(Math.random() * adjacentEnemies.length);
      const targetEnemy = adjacentEnemies[randomIndex];
      
      // ÊïµÈßí„ÇíÈóá„ÅßË¶Ü„ÅÜÔºà1„Çø„Éº„É≥„Å†„ÅëÔºâ
      state.board[targetEnemy.row][targetEnemy.col].isDarkened = true;
      state.board[targetEnemy.row][targetEnemy.col].darkenedTurn = state.turnCount;
      state.board[targetEnemy.row][targetEnemy.col].darkenedBy = state.currentPlayer;
      
      absorbedPieces.push({
        row: targetEnemy.row,
        col: targetEnemy.col,
        piece: targetEnemy.piece.piece
      });
      
      // Èóá„ÅßË¶Ü„ÅÜ„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      showDarkeningEffect(targetEnemy.row, targetEnemy.col);
    }
    
    // Èóá„ÅÆÂê∏ÂèéÂäπÊûú„ÅÆÊÉÖÂ†±„Çí„É≠„Ç∞„Å´Âá∫Âäõ
    if (absorbedPieces.length > 0) {
      console.log('üåë Èóá„ÅÆÂê∏Âèé„ÅßË¶Ü„Çè„Çå„ÅüÈßí:', absorbedPieces);
      setStatus(`Èóá„ÅÆÂê∏Âèé„Åß${absorbedPieces.length}ÂÄã„ÅÆÊïµÈßí„ÇíÈóá„ÅßË¶Ü„ÅÑ„Åæ„Åó„ÅüÔºÅ`, 'playing');
    }
    
    // 1ÁßíÂæå„Å´Èóá„Éû„Éº„ÇØ„ÇíÂâäÈô§
    setTimeout(() => {
      darkMarks.forEach(mark => {
        if (mark.parentNode) {
          mark.parentNode.removeChild(mark);
        }
      });
      
      // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
      render();
    }, 1000);
  }

  // Èóá„Éû„Éº„ÇØË¶ÅÁ¥†„Çí‰ΩúÊàê
  function createDarkMark(row, col) {
    const darkMark = document.createElement('div');
    darkMark.className = 'dark-mark';
    darkMark.textContent = 'üåë';
    darkMark.style.cssText = `
      position: fixed;
      font-size: 24px;
      z-index: 1000;
      pointer-events: none;
      animation: darkAbsorptionEffect 1s ease-in-out forwards;
      filter: drop-shadow(0 0 12px #000000);
    `;
    
    // „Éú„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„Å´Âêà„Çè„Åõ„Å¶ÈÖçÁΩÆ
    const boardElement = document.querySelector('.board');
    if (boardElement) {
      const boardRect = boardElement.getBoundingClientRect();
      const cellSize = boardRect.width / 9;
      const left = boardRect.left + col * cellSize + cellSize / 2 - 12;
      const top = boardRect.top + row * cellSize + cellSize / 2 - 12;
      darkMark.style.left = left + 'px';
      darkMark.style.top = top + 'px';
    }
    
    return darkMark;
  }

  // Âê∏Âèé„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
  function showAbsorptionEffect(fromRow, fromCol, toRow, toCol, pieceName) {
    const absorptionMark = document.createElement('div');
    absorptionMark.className = 'absorption-mark';
    absorptionMark.textContent = 'üåë';
    absorptionMark.style.cssText = `
      position: fixed;
      font-size: 24px;
      z-index: 1001;
      pointer-events: none;
      animation: absorptionEffect 1s ease-in-out forwards;
      filter: drop-shadow(0 0 12px #000000);
    `;
    
    // „Éú„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„Å´Âêà„Çè„Åõ„Å¶ÈÖçÁΩÆ
    const boardElement = document.querySelector('.board');
    if (boardElement) {
      const boardRect = boardElement.getBoundingClientRect();
      const cellSize = boardRect.width / 9;
      const left = boardRect.left + fromCol * cellSize + cellSize / 2 - 12;
      const top = boardRect.top + fromRow * cellSize + cellSize / 2 - 12;
      absorptionMark.style.left = left + 'px';
      absorptionMark.style.top = top + 'px';
    }
    
    document.body.appendChild(absorptionMark);
    
    // 1ÁßíÂæå„Å´Âê∏Âèé„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂâäÈô§
    setTimeout(() => {
      if (absorptionMark.parentNode) {
        absorptionMark.parentNode.removeChild(absorptionMark);
      }
    }, 1000);
  }

  // Èóá„ÅÆÈßí„ÅÆÁßªÂãïÊôÇ„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂº∑Âåñ
  function enhanceDarkPieceMove(row, col) {
    if (state.board[row][col] && state.board[row][col].piece === 'Èóá') {
      const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
      if (cell) {
        cell.style.animation = 'darkAbsorptionEffect 0.5s ease-in-out';
        setTimeout(() => {
          cell.style.animation = '';
        }, 500);
      }
    }
  }

  // Èóá„ÅßË¶Ü„ÅÜ„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
  function showDarkeningEffect(row, col) {
    const darkeningMark = document.createElement('div');
    darkeningMark.className = 'darkening-mark';
    darkeningMark.textContent = 'üåë';
    darkeningMark.style.cssText = `
      position: fixed;
      font-size: 32px;
      z-index: 1002;
      pointer-events: none;
      animation: darkeningEffect 1.5s ease-in-out forwards;
      filter: drop-shadow(0 0 15px #000000);
    `;
    
    // „Éú„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„Å´Âêà„Çè„Åõ„Å¶ÈÖçÁΩÆ
    const boardElement = document.querySelector('.board');
    if (boardElement) {
      const boardRect = boardElement.getBoundingClientRect();
      const cellSize = boardRect.width / 9;
      const left = boardRect.left + col * cellSize + cellSize / 2 - 16;
      const top = boardRect.top + row * cellSize + cellSize / 2 - 16;
      darkeningMark.style.left = left + 'px';
      darkeningMark.style.top = top + 'px';
    }
    
    document.body.appendChild(darkeningMark);
    
    // 1.5ÁßíÂæå„Å´Èóá„ÅßË¶Ü„ÅÜ„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂâäÈô§
    setTimeout(() => {
      if (darkeningMark.parentNode) {
        darkeningMark.parentNode.removeChild(darkeningMark);
      }
    }, 1500);
  }

  // È≠î„ÅÆÈßí„ÅÆÁßªÂãïÂäπÊûú„ÇíË°®Á§∫
  function showDemonDestructionEffect(fromRow, fromCol, toRow, toCol) {
    const demonMarks = [];
    const destroyedPieces = [];
    
    // ÁßªÂãïÁµåË∑Ø„ÇíË®àÁÆó
    const dr = toRow - fromRow;
    const dc = toCol - fromCol;
    
    if (dr === 0) { // Ê®™ÁßªÂãï
      const start = Math.min(fromCol, toCol);
      const end = Math.max(fromCol, toCol);
      for (let c = start; c <= end; c++) {
        if (c !== fromCol) { // ÈñãÂßã‰ΩçÁΩÆ„ÅØÈô§Â§ñ
          const demonMark = createDemonMark(fromRow, c);
          demonMarks.push(demonMark);
          document.body.appendChild(demonMark);
        }
      }
    } else if (dc === 0) { // Á∏¶ÁßªÂãï
      const start = Math.min(fromRow, toRow);
      const end = Math.max(fromRow, toRow);
      for (let r = start; r <= end; r++) {
        if (r !== fromRow) { // ÈñãÂßã‰ΩçÁΩÆ„ÅØÈô§Â§ñ
          const demonMark = createDemonMark(r, fromCol);
          demonMarks.push(demonMark);
          document.body.appendChild(demonMark);
        }
      }
    } else { // Êñú„ÇÅÁßªÂãï
      const steps = Math.abs(dr);
      for (let i = 1; i <= steps; i++) {
        const r = fromRow + (dr > 0 ? i : -i);
        const c = fromCol + (dc > 0 ? i : -i);
        
        const demonMark = createDemonMark(r, c);
        demonMarks.push(demonMark);
        document.body.appendChild(demonMark);
      }
    }
    
    // ÁßªÂãïÂÖà„ÅÆÂë®Âõ≤„ÅÆÊïµÈßí„Çí1„Å§„Å†„Åë10%„ÅÆÁ¢∫Áéá„ÅßÊ∂àÊªÖ„Åï„Åõ„Çã
    const adjacentEnemies = [];
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = toRow + d[0], nc = toCol + d[1];
      if (inBounds(nr, nc) && state.board[nr][nc] && state.board[nr][nc].owner !== state.currentPlayer && 
          state.board[nr][nc].piece !== 'X') {
        adjacentEnemies.push({row: nr, col: nc, piece: state.board[nr][nc]});
      }
    });
    
    // 1„Å§„Å†„Åë„É©„É≥„ÉÄ„É†„Å´ÈÅ∏Êäû„Åó„Å¶10%„ÅÆÁ¢∫Áéá„ÅßÊ∂àÊªÖ
    if (adjacentEnemies.length > 0) {
      const randomIndex = Math.floor(Math.random() * adjacentEnemies.length);
      const targetEnemy = adjacentEnemies[randomIndex];
      
      // 10%„ÅÆÁ¢∫Áéá„ÅßÊïµÈßí„ÇíÊ∂àÊªÖ„Åï„Åõ„Çã
      if (Math.random() < 0.1) {
        const destroyedPiece = state.board[targetEnemy.row][targetEnemy.col];
        state.board[targetEnemy.row][targetEnemy.col] = null;
        
        destroyedPieces.push({
          row: targetEnemy.row,
          col: targetEnemy.col,
          piece: destroyedPiece.piece
        });
        
        // Ê∂àÊªÖ„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
        showDestructionEffect(targetEnemy.row, targetEnemy.col);
      }
    }
    
    // È≠î„ÅÆÊ∂àÊªÖÂäπÊûú„ÅÆÊÉÖÂ†±„Çí„É≠„Ç∞„Å´Âá∫Âäõ
    if (destroyedPieces.length > 0) {
      console.log('üëπ È≠î„ÅÆÊ∂àÊªÖ„ÅßÊ∂àÊªÖ„Åó„ÅüÈßí:', destroyedPieces);
      setStatus(`È≠î„ÅÆÊ∂àÊªÖ„Åß${destroyedPieces.length}ÂÄã„ÅÆÊïµÈßí„ÇíÊ∂àÊªÖ„Åï„Åõ„Åæ„Åó„ÅüÔºÅ`, 'playing');
    }
    
    // 1ÁßíÂæå„Å´È≠î„Éû„Éº„ÇØ„ÇíÂâäÈô§
    setTimeout(() => {
      demonMarks.forEach(mark => {
        if (mark.parentNode) {
          mark.parentNode.removeChild(mark);
        }
      });
      
      // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
      render();
    }, 1000);
  }

  // È≠î„Éû„Éº„ÇØË¶ÅÁ¥†„Çí‰ΩúÊàê
  function createDemonMark(row, col) {
    const demonMark = document.createElement('div');
    demonMark.className = 'demon-mark';
    demonMark.textContent = 'üëπ';
    demonMark.style.cssText = `
      position: fixed;
      font-size: 24px;
      z-index: 1000;
      pointer-events: none;
      animation: demonDestructionEffect 1s ease-in-out forwards;
      filter: drop-shadow(0 0 12px #8B0000);
    `;
    
    // „Éú„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„Å´Âêà„Çè„Åõ„Å¶ÈÖçÁΩÆ
    const boardElement = document.querySelector('.board');
    if (boardElement) {
      const boardRect = boardElement.getBoundingClientRect();
      const cellSize = boardRect.width / 9;
      const left = boardRect.left + col * cellSize + cellSize / 2 - 12;
      const top = boardRect.top + row * cellSize + cellSize / 2 - 12;
      demonMark.style.left = left + 'px';
      demonMark.style.top = top + 'px';
    }
    
    return demonMark;
  }

  // Ê∂àÊªÖ„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
  function showDestructionEffect(row, col) {
    const destructionMark = document.createElement('div');
    destructionMark.className = 'demon-destruction-mark';
    destructionMark.textContent = 'üí•';
    destructionMark.style.cssText = `
      position: fixed;
      font-size: 32px;
      z-index: 1002;
      pointer-events: none;
      animation: demonDestructionEffect 1.5s ease-in-out forwards;
      filter: drop-shadow(0 0 15px #FF0000);
    `;
    
    // „Éú„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„Å´Âêà„Çè„Åõ„Å¶ÈÖçÁΩÆ
    const boardElement = document.querySelector('.board');
    if (boardElement) {
      const boardRect = boardElement.getBoundingClientRect();
      const cellSize = boardRect.width / 9;
      const left = boardRect.left + col * cellSize + cellSize / 2 - 16;
      const top = boardRect.top + row * cellSize + cellSize / 2 - 16;
      destructionMark.style.left = left + 'px';
      destructionMark.style.top = top + 'px';
    }
    
    document.body.appendChild(destructionMark);
    
    // 1.5ÁßíÂæå„Å´Ê∂àÊªÖ„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂâäÈô§
    setTimeout(() => {
      if (destructionMark.parentNode) {
        destructionMark.parentNode.removeChild(destructionMark);
      }
    }, 1500);
  }

  // È≠î„ÅÆÈßí„ÅÆÁßªÂãïÊôÇ„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂº∑Âåñ
  function enhanceDemonPieceMove(row, col) {
    if (state.board[row][col] && state.board[row][col].piece === 'È≠î') {
      const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
      if (cell) {
        cell.style.animation = 'demonDestructionEffect 0.5s ease-in-out';
        setTimeout(() => {
          cell.style.animation = '';
        }, 500);
      }
    }
  }

  // Èå´„ÅÆÂ§âÂΩ¢ÂäπÊûú„ÇíË°®Á§∫
  function showTinTransformationEffect(row, col) {
    // 20%„ÅÆÁ¢∫Áéá„Åß„Çπ„Ç≠„É´Áô∫Âãï
    if (Math.random() > 0.2) {
      setStatus('Èå´„ÅÆÂ§âÂΩ¢ÂäπÊûúÁô∫ÂãïÔºÅ„Åó„Åã„ÅóÂäπÊûú„ÅØÁô∫Âãï„Åó„Åæ„Åõ„Çì„Åß„Åó„Åü', 'playing');
      return;
    }
    
    const tinMarks = [];
    
    // Âë®Âõ≤8ÊñπÂêë„ÅÆÊïµÈßí„ÇíÂ§âÂΩ¢„Åï„Åõ„Çã
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = row + d[0], nc = col + d[1];
      if (inBounds(nr, nc) && state.board[nr][nc] && state.board[nr][nc].owner !== state.currentPlayer) {
        const tinMark = createTinMark(nr, nc);
        tinMarks.push(tinMark);
        document.body.appendChild(tinMark);
        
        // ÊïµÈßí„Çí‰∏ÄÊôÇÁöÑ„Å´Â§âÂΩ¢Áä∂ÊÖã„Å´„Åô„Çã
        state.board[nr][nc].isTransformed = true;
        state.board[nr][nc].transformedBy = state.currentPlayer;
        state.board[nr][nc].transformedTurn = state.turnCount;
      }
    });
    
    // Â§âÂΩ¢ÂäπÊûú„ÅÆÁµ±Ë®à„ÇíÊõ¥Êñ∞
    const transformedCount = tinMarks.length;
    if (transformedCount > 0) {
      console.log('üîß Èå´„ÅÆÂ§âÂΩ¢ÂäπÊûú„ÅßÂ§âÂΩ¢„Åó„ÅüÈßí:', transformedCount);
      setStatus(`Èå´„ÅÆÂ§âÂΩ¢ÂäπÊûú„Åß${transformedCount}ÂÄã„ÅÆÊïµÈßí„ÇíÂ§âÂΩ¢„Åï„Åõ„Åæ„Åó„ÅüÔºÅ`, 'playing');
    } else {
      setStatus('Èå´„ÅÆÂ§âÂΩ¢ÂäπÊûúÁô∫ÂãïÔºÅÂë®Âõ≤„Å´ÊïµÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü', 'playing');
    }
    
    // 2ÁßíÂæå„Å´Èå´„Éû„Éº„ÇØ„ÇíÂâäÈô§
    setTimeout(() => {
      tinMarks.forEach(mark => {
        if (mark.parentNode) {
          mark.parentNode.removeChild(mark);
        }
      });
      
      // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
      render();
    }, 2000);
  }

  // Èå´„Éû„Éº„ÇØË¶ÅÁ¥†„Çí‰ΩúÊàê
  function createTinMark(row, col) {
    const tinMark = document.createElement('div');
    tinMark.className = 'tin-mark';
    tinMark.textContent = 'üîß';
    tinMark.style.cssText = `
      position: fixed;
      font-size: 28px;
      z-index: 1000;
      pointer-events: none;
      animation: tinTransformationEffect 2s ease-in-out;
    `;
    
    // „Éú„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„Å´Âêà„Çè„Åõ„Å¶ÈÖçÁΩÆ
    const boardElement = document.querySelector('.board');
    if (boardElement) {
      const boardRect = boardElement.getBoundingClientRect();
      const cellSize = boardRect.width / 9;
      const left = boardRect.left + col * cellSize + cellSize / 2 - 16;
      const top = boardRect.top + row * cellSize + cellSize / 2 - 16;
      tinMark.style.left = left + 'px';
      tinMark.style.top = top + 'px';
    }
    
    return tinMark;
  }

  // Èå´„ÅÆÈßí„ÅÆÁßªÂãïÊôÇ„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂº∑Âåñ
  function enhanceTinPieceMove(row, col) {
    if (state.board[row][col] && state.board[row][col].piece === 'Èå´') {
      const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
      if (cell) {
        cell.style.animation = 'tinTransformationEffect 0.5s ease-in-out';
        setTimeout(() => {
          cell.style.animation = '';
        }, 500);
      }
    }
  }

  // ÈâÑ„ÅÆÁ£ÅÂäõÂäπÊûú„ÇíË°®Á§∫
  function showIronMagneticEffect(row, col) {
    const ironMarks = [];
    const attractedPieces = [];
    
    // Âë®Âõ≤8ÊñπÂêë„ÅÆÊïµÈßí„ÇíÂºï„ÅçÂØÑ„Åõ„Çã
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = row + d[0], nc = col + d[1];
      if (inBounds(nr, nc) && state.board[nr][nc] && state.board[nr][nc].owner !== state.currentPlayer) {
        const ironMark = createIronMark(nr, nc);
        ironMarks.push(ironMark);
        document.body.appendChild(ironMark);
        
        // ÊïµÈßí„ÇíÈâÑ„ÅÆÊñπÂêë„Å´1„Éû„ÇπÂºï„ÅçÂØÑ„Åõ„Çã
        const targetRow = nr + d[0];
        const targetCol = nc + d[1];
        
        if (inBounds(targetRow, targetCol) && !state.board[targetRow][targetCol] && 
            !(state.board[targetRow][targetCol] && state.board[targetRow][targetCol].piece === 'X' && state.board[targetRow][targetCol].owner === 'blocked')) {
          // ÁßªÂãïÂÖà„ÅåÁ©∫„ÅÑ„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÄÅÈßí„ÇíÁßªÂãïÔºà√ó„Éû„Çπ„ÅØÈô§Â§ñÔºâ
          const piece = state.board[nr][nc];
          state.board[targetRow][targetCol] = piece;
          state.board[nr][nc] = null;
          
          attractedPieces.push({
            fromRow: nr,
            fromCol: nc,
            toRow: targetRow,
            toCol: targetCol,
            piece: piece.piece
          });
        }
      }
    });
    
    // Á£ÅÂäõÂäπÊûú„ÅÆÁµ±Ë®à„ÇíÊõ¥Êñ∞
    const attractedCount = attractedPieces.length;
    if (attractedCount > 0) {
      console.log('üß≤ ÈâÑ„ÅÆÁ£ÅÂäõÂäπÊûú„ÅßÂºï„ÅçÂØÑ„Åõ„ÅüÈßí:', attractedPieces);
      setStatus(`ÈâÑ„ÅÆÁ£ÅÂäõÂäπÊûú„Åß${attractedCount}ÂÄã„ÅÆÊïµÈßí„ÇíÂºï„ÅçÂØÑ„Åõ„Åæ„Åó„ÅüÔºÅ`, 'playing');
    } else {
      setStatus('ÈâÑ„ÅÆÁ£ÅÂäõÂäπÊûúÁô∫ÂãïÔºÅÂºï„ÅçÂØÑ„Åõ„ÇãÊïµÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü', 'playing');
    }
    
    // 2ÁßíÂæå„Å´ÈâÑ„Éû„Éº„ÇØ„ÇíÂâäÈô§
    setTimeout(() => {
      ironMarks.forEach(mark => {
        if (mark.parentNode) {
          mark.parentNode.removeChild(mark);
        }
      });
      
      // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
      render();
    }, 2000);
  }

  // ÈâÑ„Éû„Éº„ÇØË¶ÅÁ¥†„Çí‰ΩúÊàê
  function createIronMark(row, col) {
    const ironMark = document.createElement('div');
    ironMark.className = 'iron-mark';
    ironMark.textContent = 'üß≤';
    ironMark.style.cssText = `
      position: fixed;
      font-size: 28px;
      z-index: 1000;
      pointer-events: none;
      animation: ironMagneticEffect 2s ease-in-out;
    `;
    
    // „Éú„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„Å´Âêà„Çè„Åõ„Å¶ÈÖçÁΩÆ
    const boardElement = document.querySelector('.board');
    if (boardElement) {
      const boardRect = boardElement.getBoundingClientRect();
      const cellSize = boardRect.width / 9;
      const left = boardRect.left + col * cellSize + cellSize / 2 - 16;
      const top = boardRect.top + row * cellSize + cellSize / 2 - 16;
      ironMark.style.left = left + 'px';
      ironMark.style.top = top + 'px';
    }
    
    return ironMark;
  }

  // ÈâÑ„ÅÆÈßí„ÅÆÁßªÂãïÊôÇ„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂº∑Âåñ
  function enhanceIronPieceMove(row, col) {
    if (state.board[row][col] && state.board[row][col].piece === 'ÈâÑ') {
      const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
      if (cell) {
        cell.style.animation = 'ironMagneticEffect 0.5s ease-in-out';
        setTimeout(() => {
          cell.style.animation = '';
        }, 500);
      }
    }
  }

  // ÂÆù„ÅÆËºù„ÅçÂäπÊûú„ÇíË°®Á§∫
  function showTreasureGlowEffect(row, col) {
    const treasureMarks = [];
    
    // 20%„ÅÆÁ¢∫Áéá„ÅßÈáë„ÄÅÈäÄ„ÄÅÈäÖ„ÅÆ„Å©„Çå„Åã„ÇíÁç≤Âæó
    if (Math.random() <= 0.2) {
      const treasurePieces = ['Èáë', 'ÈäÄ', 'ÈäÖ'];
      const randomPiece = treasurePieces[Math.floor(Math.random() * treasurePieces.length)];
      
      // ÊåÅ„Å°Èßí„Å´ËøΩÂä†
      state.hands[state.currentPlayer].push(randomPiece);
      
      // ÂÆù„Éû„Éº„ÇØ„ÇíË°®Á§∫
      const treasureMark = createTreasureMark(row, col);
      treasureMarks.push(treasureMark);
      document.body.appendChild(treasureMark);
      
      console.log(`üíé ÂÆù„ÅÆËºù„Åç„Åß${randomPiece}„ÇíÁç≤Âæó„Åó„Åæ„Åó„ÅüÔºÅ`);
      setStatus(`ÂÆù„ÅÆËºù„Åç„Åß${randomPiece}„ÇíÁç≤Âæó„Åó„Åæ„Åó„ÅüÔºÅ`, 'playing');
      
      // ÊåÅ„Å°ÈßíË°®Á§∫„ÇíÊõ¥Êñ∞
      renderHands();
    } else {
      setStatus('ÂÆù„ÅÆËºù„ÅçÂäπÊûúÁô∫ÂãïÔºÅ‰ªäÂõû„ÅØ‰Ωï„ÇÇÂæó„Çâ„Çå„Åæ„Åõ„Çì„Åß„Åó„Åü', 'playing');
    }
    
    // 2ÁßíÂæå„Å´ÂÆù„Éû„Éº„ÇØ„ÇíÂâäÈô§
    setTimeout(() => {
      treasureMarks.forEach(mark => {
        if (mark.parentNode) {
          mark.parentNode.removeChild(mark);
        }
      });
      
      // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
      render();
    }, 2000);
  }

  // ÂÆù„Éû„Éº„ÇØË¶ÅÁ¥†„Çí‰ΩúÊàê
  function createTreasureMark(row, col) {
    const treasureMark = document.createElement('div');
    treasureMark.className = 'treasure-mark';
    treasureMark.textContent = 'üíé';
    treasureMark.style.cssText = `
      position: fixed;
      font-size: 28px;
      z-index: 1000;
      pointer-events: none;
      animation: treasureGlowEffect 2s ease-in-out;
    `;
    
    // „Éú„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„Å´Âêà„Çè„Åõ„Å¶ÈÖçÁΩÆ
    const boardElement = document.querySelector('.board');
    if (boardElement) {
      const boardRect = boardElement.getBoundingClientRect();
      const cellSize = boardRect.width / 9;
      const left = boardRect.left + col * cellSize + cellSize / 2 - 16;
      const top = boardRect.top + row * cellSize + cellSize / 2 - 16;
      treasureMark.style.left = left + 'px';
      treasureMark.style.top = top + 'px';
    }
    
    return treasureMark;
  }

  // ÂÆù„ÅÆÈßí„ÅÆÁßªÂãïÊôÇ„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂº∑Âåñ
  function enhanceTreasurePieceMove(row, col) {
    if (state.board[row][col] && state.board[row][col].piece === 'ÂÆù') {
      const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
      if (cell) {
        cell.style.animation = 'treasureGlowEffect 0.5s ease-in-out';
        setTimeout(() => {
          cell.style.animation = '';
        }, 500);
      }
    }
  }

  // ÈäÖ„ÅÆÈßí„ÅÆÁßªÂãï: Ê°Ç„ÅÆÂãï„Åç + ÂâçÊñπ„Å´‰Ωï„Éû„Çπ„Åß„ÇÇ + ÈäÖ„ÅÆÂ∞éÈõªÂäπÊûú
  function copperMoves(r,c){
    const o = state.board[r][c].owner;
    const f = o === 'player' ? -1 : 1;
    const m = [];
    
    // ÈäÖ„ÅÆÂãï„Åç: Ê°Ç„Å®Âêå„ÅòÔºàÂâçÊñπ„Å´2„Éû„Çπ„ÄÅÂ∑¶Âè≥„Å´1„Éû„ÇπÔºâ
    [[2*f,-1],[2*f,1]].forEach(([dr,dc]) => {
      pushIfEnemyOrEmpty(m, r + dr, c + dc, o);
    });
    
    // ÈäÖ„ÅÆÂãï„Åç: ÂâçÊñπ„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÁßªÂãïÂèØËÉΩÔºàÈ¶ôËªä„ÅÆ„Çà„ÅÜ„Å™Âãï„ÅçÔºâ
    slide(m, r, c, o, f, 0);
    
    return m;
  }

  // ÈâÑ„ÅÆÈßí„ÅÆÁßªÂãï: ÈäÄ„Å®Âêå„ÅòÂãï„Åç + ÈâÑ„ÅÆÁ£ÅÂäõÂäπÊûú
  function ironMoves(r,c){
    const o = state.board[r][c].owner;
    const f = o === 'player' ? -1 : 1;
    const m = [];
    
    // ÈâÑ„ÅÆÂãï„Åç: ÈäÄ„Å®Âêå„ÅòÔºàÂâçÊñπ3ÊñπÂêë + ÂæåÊñπÊñú„ÇÅ2ÊñπÂêëÔºâ
    [[f,-1],[f,0],[f,1],[-f,-1],[-f,1]].forEach(([dr,dc]) => {
      pushIfEnemyOrEmpty(m, r + dr, c + dc, o);
    });
    
    return m;
  }

  // Èå´„ÅÆÈßí„ÅÆÁßªÂãï: ÈäÄ„Å®Âêå„ÅòÂãï„Åç + Èå´„ÅÆÊüîËªüÂäπÊûú
  function tinMoves(r,c){
    const o = state.board[r][c].owner;
    const f = o === 'player' ? -1 : 1;
    const m = [];
    
    // Èå´„ÅÆÂãï„Åç: ÈäÄ„Å®Âêå„ÅòÔºàÂâçÊñπ3ÊñπÂêë + ÂæåÊñπÊñú„ÇÅ2ÊñπÂêëÔºâ
    [[f,-1],[f,0],[f,1],[-f,-1],[-f,1]].forEach(([dr,dc]) => {
      pushIfEnemyOrEmpty(m, r + dr, c + dc, o);
    });
    
    return m;
  }

  // Èâõ„ÅÆÈßí„ÅÆÁßªÂãï: ÈäÖ„Å®Âêå„ÅòÂãï„ÅçÔºàÊ°Ç„ÅÆÂãï„Åç + ÂâçÊñπ„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÔºâ + Èâõ„ÅÆÈáç„ÅïÂäπÊûú
  function leadMoves(r,c){
    const o = state.board[r][c].owner;
    const f = o === 'player' ? -1 : 1;
    const m = [];
    
    // Èâõ„ÅÆÂãï„Åç: Ê°Ç„Å®Âêå„ÅòÔºàÂâçÊñπ„Å´2„Éû„Çπ„ÄÅÂ∑¶Âè≥„Å´1„Éû„ÇπÔºâ
    [[2*f,-1],[2*f,1]].forEach(([dr,dc]) => {
      pushIfEnemyOrEmpty(m, r + dr, c + dc, o);
    });
    
    // Èâõ„ÅÆÂãï„Åç: ÂâçÊñπ„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÁßªÂãïÂèØËÉΩÔºàÈ¶ôËªä„ÅÆ„Çà„ÅÜ„Å™Âãï„ÅçÔºâ
    slide(m, r, c, o, f, 0);
    
    return m;
  }

  // ÂÆù„ÅÆÈßí„ÅÆÁßªÂãï: Áéã„ÅÆÂãï„Åç + ÂÆù„ÅÆËºù„ÅçÂäπÊûú
  function treasureMoves(r,c){
    const o = state.board[r][c].owner;
    const m = [];
    
    // ÂÆù„ÅÆÂãï„Åç: Áéã„Å®Âêå„ÅòÔºà8ÊñπÂêë„Å´1„Éû„ÇπÔºâ
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      pushIfEnemyOrEmpty(m, r + d[0], c + d[1], o);
    });
    
    return m;
  }

  // Èõª„ÅÆÈßí„ÅÆÁßªÂãï: Á∏¶Ê®™„Å´‰Ωï„Éû„Çπ„Åß„ÇÇ + ÈõªÊ∞ó„ÅÆÂ∞éÈõªÂäπÊûú
  function electricMoves(r,c){
    const o = state.board[r][c].owner;
    const m = [];
    
    // Èõª„ÅÆÂãï„Åç: Á∏¶Ê®™„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÔºàÈ£õËªä„ÅÆ„Çà„ÅÜ„Å™Âãï„ÅçÔºâ
    slide(m, r, c, o, -1, 0); // ‰∏äÊñπÂêë
    slide(m, r, c, o, 1, 0);  // ‰∏ãÊñπÂêë
    slide(m, r, c, o, 0, -1); // Â∑¶ÊñπÂêë
    slide(m, r, c, o, 0, 1);  // Âè≥ÊñπÂêë
    
    return m;
  }

  // Èõ∑„ÅÆÈßí„ÅÆÁßªÂãï: Êñú„ÇÅ„Å´‰Ωï„Éû„Çπ„Åß„ÇÇ + Èõ∑„ÅÆÊîæÈõªÂäπÊûú
  function thunderMoves(r,c){
    const o = state.board[r][c].owner;
    const m = [];
    
    // Èõ∑„ÅÆÂãï„Åç: Êñú„ÇÅ„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÔºàËßíË°å„ÅÆ„Çà„ÅÜ„Å™Âãï„ÅçÔºâ
    slide(m, r, c, o, -1, -1); // Â∑¶‰∏äÊñπÂêë
    slide(m, r, c, o, -1, 1);  // Âè≥‰∏äÊñπÂêë
    slide(m, r, c, o, 1, -1);  // Â∑¶‰∏ãÊñπÂêë
    slide(m, r, c, o, 1, 1);   // Âè≥‰∏ãÊñπÂêë
    
    return m;
  }

  // Èõ∑„ÅÆÊîæÈõªÂäπÊûú„ÇíË°®Á§∫
  function showThunderDischargeEffect(row, col) {
    // 10%„ÅÆÁ¢∫Áéá„ÅßÁõ∏Êâã„ÅÆÊåÅ„Å°Èßí„ÇíÊ∂àÊªÖ„Åï„Åõ„Çã
    if (Math.random() > 0.1) {
      setStatus('Èõ∑„ÅÆÊîæÈõªÂäπÊûúÁô∫ÂãïÔºÅ‰ªäÂõû„ÅØÁõ∏Êâã„ÅÆÊåÅ„Å°Èßí„ÇíÊ∂àÊªÖ„Åï„Åõ„Åæ„Åõ„Çì„Åß„Åó„Åü', 'playing');
      return;
    }
    
    const opponent = state.currentPlayer === 'player' ? 'computer' : 'player';
    const opponentHand = state.hands[opponent];
    
    if (opponentHand.length === 0) {
      setStatus('Èõ∑„ÅÆÊîæÈõªÂäπÊûúÁô∫ÂãïÔºÅÁõ∏Êâã„ÅÆÊåÅ„Å°Èßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü', 'playing');
      return;
    }
    
    // „É©„É≥„ÉÄ„É†„Å´1„Å§„ÅÆÊåÅ„Å°Èßí„ÇíÈÅ∏Êäû„Åó„Å¶Ê∂àÊªÖ
    const randomIndex = Math.floor(Math.random() * opponentHand.length);
    const destroyedPiece = opponentHand.splice(randomIndex, 1)[0];
    
    // Êó¢Â≠ò„ÅÆÈõ∑„Éû„Éº„ÇØ„Çí„ÇØ„É™„Ç¢
    const existingThunderMarks = document.querySelectorAll('.thunder-mark');
    existingThunderMarks.forEach(mark => {
      if (mark.parentNode) {
        mark.parentNode.removeChild(mark);
      }
    });
    
    // Èõ∑„Éû„Éº„ÇØ„ÇíË°®Á§∫
    const thunderMark = createThunderMark(row, col);
    document.body.appendChild(thunderMark);
    
    console.log(`‚ö° Èõ∑„ÅÆÊîæÈõª„ÅßÁõ∏Êâã„ÅÆÊåÅ„Å°Èßí„Äå${destroyedPiece}„Äç„ÇíÊ∂àÊªÖ„Åï„Åõ„Åæ„Åó„ÅüÔºÅ`);
    setStatus(`Èõ∑„ÅÆÊîæÈõª„ÅßÁõ∏Êâã„ÅÆÊåÅ„Å°Èßí„Äå${destroyedPiece}„Äç„ÇíÊ∂àÊªÖ„Åï„Åõ„Åæ„Åó„ÅüÔºÅ`, 'playing');
    
    // ÊåÅ„Å°ÈßíË°®Á§∫„ÇíÊõ¥Êñ∞
    renderHands();
    
    // 2ÁßíÂæå„Å´Èõ∑„Éû„Éº„ÇØ„ÇíÂâäÈô§ÔºàÁ¢∫ÂÆü„Å´ÂâäÈô§„Åô„Çã„Åü„ÇÅË§áÊï∞„ÅÆÊñπÊ≥ï„Çí‰ΩøÁî®Ôºâ
    setTimeout(() => {
      // ÊñπÊ≥ï1: ÈÄöÂ∏∏„ÅÆÂâäÈô§
      if (thunderMark.parentNode) {
        thunderMark.parentNode.removeChild(thunderMark);
      }
      
      // ÊñπÊ≥ï2: „ÇØ„É©„ÇπÂêç„ÅßÊ§úÁ¥¢„Åó„Å¶ÂâäÈô§
      const remainingMarks = document.querySelectorAll('.thunder-mark');
      remainingMarks.forEach(mark => {
        if (mark.parentNode) {
          mark.parentNode.removeChild(mark);
        }
      });
      
      // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
      render();
    }, 2000);
    
    // Âøµ„ÅÆ„Åü„ÇÅ„ÄÅ3ÁßíÂæå„Å´„ÇÇÂâäÈô§„ÇíË©¶Ë°å
    setTimeout(() => {
      const finalMarks = document.querySelectorAll('.thunder-mark');
      finalMarks.forEach(mark => {
        if (mark.parentNode) {
          mark.parentNode.removeChild(mark);
        }
      });
    }, 3000);
  }

  // Èõ∑„Éû„Éº„ÇØË¶ÅÁ¥†„Çí‰ΩúÊàê
  function createThunderMark(row, col) {
    const thunderMark = document.createElement('div');
    thunderMark.className = 'thunder-mark';
    thunderMark.textContent = '‚ö°';
    thunderMark.style.cssText = `
      position: fixed;
      font-size: 28px;
      z-index: 1000;
      pointer-events: none;
      animation: thunderDischargeEffect 2s ease-in-out;
    `;
    
    // „Éú„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„Å´Âêà„Çè„Åõ„Å¶ÈÖçÁΩÆ
    const boardElement = document.querySelector('.board');
    if (boardElement) {
      const boardRect = boardElement.getBoundingClientRect();
      const cellSize = boardRect.width / 9;
      const left = boardRect.left + col * cellSize + cellSize / 2 - 16;
      const top = boardRect.top + row * cellSize + cellSize / 2 - 16;
      thunderMark.style.left = left + 'px';
      thunderMark.style.top = top + 'px';
    }
    
    return thunderMark;
  }

  // Èõ∑„ÅÆÈßí„ÅÆÁßªÂãïÊôÇ„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂº∑Âåñ
  function enhanceThunderPieceMove(row, col) {
    if (state.board[row][col] && state.board[row][col].piece === 'Èõ∑') {
      const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
      if (cell) {
        cell.style.animation = 'thunderDischargeEffect 0.5s ease-in-out';
        setTimeout(() => {
          cell.style.animation = '';
        }, 500);
      }
    }
  }

  // Èõª„ÅÆÂ∞éÈõªÂäπÊûú„ÇíË°®Á§∫
  function showElectricConductionEffect(row, col) {
    const electricMarks = [];
    const shockedPieces = [];
    
    // 20%„ÅÆÁ¢∫Áéá„ÅßÊÑüÈõªÂäπÊûú„ÇíÁô∫Âãï
    if (Math.random() > 0.2) {
      setStatus('Èõª„ÅÆÂ∞éÈõªÂäπÊûúÁô∫ÂãïÔºÅ‰ªäÂõû„ÅØÊÑüÈõª„Åó„Åæ„Åõ„Çì„Åß„Åó„Åü', 'playing');
      return;
    }
    
    // Âë®Âõ≤8ÊñπÂêë„ÅÆÊïµÈßí„ÇíÊÑüÈõª„Åï„Åõ„Çã
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const nr = row + d[0], nc = col + d[1];
      if (inBounds(nr, nc) && state.board[nr][nc] && 
          state.board[nr][nc].owner !== state.currentPlayer && 
          state.board[nr][nc].piece !== 'X') {
        
        const target = state.board[nr][nc];
        
        // ÊÑüÈõªÂäπÊûú„ÇíÈÅ©Áî®Ôºà1„Çø„Éº„É≥Âãï„Åë„Å™„Åè„Åô„ÇãÔºâ
        target.isShocked = true;
        target.shockedTurn = state.turnCount;
        target.shockedBy = state.currentPlayer;
        
        // ÈõªÊ∞ó„Éû„Éº„ÇØ„ÇíË°®Á§∫
        const electricMark = createElectricMark(nr, nc);
        electricMarks.push(electricMark);
        document.body.appendChild(electricMark);
        
        shockedPieces.push({
          row: nr,
          col: nc,
          piece: target.piece
        });
      }
    });
    
    // ÊÑüÈõªÂäπÊûú„ÅÆÁµ±Ë®à„ÇíÊõ¥Êñ∞
    const shockedCount = shockedPieces.length;
    if (shockedCount > 0) {
      console.log('‚ö° Èõª„ÅÆÂ∞éÈõª„ÅßÊÑüÈõª„Åó„ÅüÈßí:', shockedPieces);
      setStatus(`Èõª„ÅÆÂ∞éÈõª„Åß${shockedCount}ÂÄã„ÅÆÊïµÈßí„ÇíÊÑüÈõª„Åï„Åõ„Åæ„Åó„ÅüÔºÅ`, 'playing');
    } else {
      setStatus('Èõª„ÅÆÂ∞éÈõªÂäπÊûúÁô∫ÂãïÔºÅÊÑüÈõª„Åô„ÇãÊïµÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü', 'playing');
    }
    
    // 2ÁßíÂæå„Å´ÈõªÊ∞ó„Éû„Éº„ÇØ„ÇíÂâäÈô§
    setTimeout(() => {
      electricMarks.forEach(mark => {
        if (mark.parentNode) {
          mark.parentNode.removeChild(mark);
        }
      });
      
      // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
      render();
    }, 2000);
  }

  // ÈõªÊ∞ó„Éû„Éº„ÇØË¶ÅÁ¥†„Çí‰ΩúÊàê
  function createElectricMark(row, col) {
    const electricMark = document.createElement('div');
    electricMark.className = 'electric-mark';
    electricMark.textContent = '‚ö°';
    electricMark.style.cssText = `
      position: fixed;
      font-size: 28px;
      z-index: 1000;
      pointer-events: none;
      animation: electricConductionEffect 2s ease-in-out;
    `;
    
    // „Éú„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„Å´Âêà„Çè„Åõ„Å¶ÈÖçÁΩÆ
    const boardElement = document.querySelector('.board');
    if (boardElement) {
      const boardRect = boardElement.getBoundingClientRect();
      const cellSize = boardRect.width / 9;
      const left = boardRect.left + col * cellSize + cellSize / 2 - 16;
      const top = boardRect.top + row * cellSize + cellSize / 2 - 16;
      electricMark.style.left = left + 'px';
      electricMark.style.top = top + 'px';
    }
    
    return electricMark;
  }

  // Èõª„ÅÆÈßí„ÅÆÁßªÂãïÊôÇ„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂº∑Âåñ
  function enhanceElectricPieceMove(row, col) {
    if (state.board[row][col] && state.board[row][col].piece === 'Èõª') {
      const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
      if (cell) {
        cell.style.animation = 'electricConductionEffect 0.5s ease-in-out';
        setTimeout(() => {
          cell.style.animation = '';
        }, 500);
      }
    }
  }

  // ÊôÇ„ÅÆÁßªÂãïÔºàÊôÇÁ©∫„ÅÆËø∑ÂÆÆÔºâ
  function timeMoves(row, col) {
    const moves = [];
    const owner = state.board[row][col].owner;
    
    // 8ÊñπÂêë„Å´1„Éû„Çπ„Åæ„ÅßÁßªÂãïÂèØËÉΩ
    const directions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    
    for (const [dr, dc] of directions) {
      const newRow = row + dr;
      const newCol = col + dc;
      if (newRow >= 0 && newRow < BOARD_SIZE && newCol >= 0 && newCol < BOARD_SIZE) {
        // Â£Å„ÅØÈÄöÈÅé‰∏çÂèØ
        if (state.board[newRow][newCol] && state.board[newRow][newCol].piece === 'X') continue;
        
        // Âë≥Êñπ„ÅÆÈßí„ÅØÂèñ„Çå„Å™„ÅÑ
        if (state.board[newRow][newCol] && state.board[newRow][newCol].owner === owner) continue;
        
        // ÁßªÂãïÂèØËÉΩ„Å™‰ΩçÁΩÆ„ÇíËøΩÂä†
        moves.push({r: newRow, c: newCol});
      }
    }
    return moves;
  }

  // ÊôÇ„ÅÆ„Çπ„Ç≠„É´: ÊôÇÈñìÊìç‰Ωú
  function activateTimeSkill(row, col) {
    const piece = state.board[row][col];
    if (!piece || piece.piece !== 'ÊôÇ' || piece.owner !== 'player') return;
    
    // „Çπ„Ç≠„É´‰ΩøÁî®ÂõûÊï∞Âà∂ÈôêÔºà1„Çø„Éº„É≥„Å´1ÂõûÔºâ
    if (piece.timeSkillUsed) {
      setStatus('ÊôÇ„ÅÆ„Çπ„Ç≠„É´„ÅØ1„Çø„Éº„É≥„Å´1Âõû„Åó„Åã‰ΩøÁî®„Åß„Åç„Åæ„Åõ„Çì', 'warning');
      return;
    }
    
    // „Çπ„Ç≠„É´‰ΩøÁî®‰∏≠„Éï„É©„Ç∞„ÇíË®≠ÂÆö
    state.timeSkillActive = true;
    
    // „Çπ„Ç≠„É´ÂäπÊûú: Âë®Âõ≤„ÅÆÊïµÈßí„Çí1„Çø„Éº„É≥ÂÅúÊ≠¢„Åï„Åõ„Çã
    const timeStoppedPieces = [];
    const directions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    
    for (const [dr, dc] of directions) {
      const targetRow = row + dr;
      const targetCol = col + dc;
      
      if (targetRow >= 0 && targetRow < BOARD_SIZE && targetCol >= 0 && targetCol < BOARD_SIZE) {
        const targetPiece = state.board[targetRow][targetCol];
        if (targetPiece && targetPiece.owner === 'computer' && targetPiece.piece !== 'X') {
          // ÊïµÈßí„ÇíÊôÇÈñìÂÅúÊ≠¢Áä∂ÊÖã„Å´„Åô„ÇãÔºà2„Çø„Éº„É≥ÊåÅÁ∂öÔºâ
          targetPiece.isTimeStopped = true;
          targetPiece.timeStoppedTurn = state.turnCount;
          targetPiece.timeStopDuration = 2; // 2„Çø„Éº„É≥ÊåÅÁ∂ö
          timeStoppedPieces.push({row: targetRow, col: targetCol, piece: targetPiece.piece});
          
          // ÊôÇÈñìÂÅúÊ≠¢„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
          showTimeStopEffect(targetRow, targetCol);
        }
      }
    }
    
    if (timeStoppedPieces.length > 0) {
      piece.timeSkillUsed = true;
      const pieceNames = timeStoppedPieces.map(p => p.piece).join('„ÄÅ');
      setStatus(`ÊôÇ„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÂë®Âõ≤„ÅÆÊïµÈßí(${pieceNames})„Çí1„Çø„Éº„É≥ÂÅúÊ≠¢„Åï„Åõ„Åæ„Åó„Åü`, 'success');
      
      // „Çπ„Ç≠„É´‰ΩøÁî®ÂõûÊï∞„Çí„É™„Çª„ÉÉ„Éà„Åô„Çã„Çø„Ç§„Éû„Éº„ÇíË®≠ÂÆö
      setTimeout(() => {
        piece.timeSkillUsed = false;
      }, 1000);
      
      console.log(`‚è∞ ÊôÇ„ÅÆ„Çπ„Ç≠„É´„Åß${timeStoppedPieces.length}ÂÄã„ÅÆÊïµÈßí„ÇíÊôÇÈñìÂÅúÊ≠¢„Åï„Åõ„Åæ„Åó„Åü`);
      
      // „Çπ„Ç≠„É´‰ΩøÁî®Âæå„ÄÅ„Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆ„Çø„Éº„É≥„Å´ÁßªË°å
      setTimeout(() => {
        // ÈÅ∏ÊäûÁä∂ÊÖã„Çí„ÇØ„É™„Ç¢
        state.selected = null;
        state.validMoves = [];
        state.dropMode = false;
        state.selectedPiece = null;
        
        // „Çπ„Ç≠„É´‰ΩøÁî®‰∏≠„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„Éà
        state.timeSkillActive = false;
        
        state.currentPlayer = 'computer';
        setStatus('Êïµ„ÅÆÊâãÁï™‚Ä¶', 'playing');
        render();
        setTimeout(computerTurn, 100);
      }, 1000);
    } else {
      setStatus('ÊôÇ„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÂë®Âõ≤„Å´ÊïµÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü', 'info');
    }
    
    // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
    render();
  }

  // Èõ™„ÅÆÊ∞∑ÂÖ•Êâã„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
  function showSnowIceEffect(fromRow, fromCol, toRow, toCol) {
    // 5%„ÅÆÁ¢∫Áéá„ÅßÊ∞∑„ÇíÂÖ•Êâã
    if (Math.random() < 0.05) {
      // „Éó„É¨„Ç§„É§„Éº„ÅÆÊâãÊåÅ„Å°Èßí„Å´Ê∞∑„ÇíËøΩÂä†
      state.hands['player'].push('Ê∞∑');
      
      // „Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      const cell = document.querySelector(`[data-row="${toRow}"][data-col="${toCol}"]`);
      if (cell) {
        // Ê∞∑ÂÖ•Êâã„ÅÆË¶ñË¶öÁöÑ„Ç®„Éï„Çß„ÇØ„Éà
        cell.style.animation = 'snowIceEffect 1s ease-in-out';
        
        // Ê∞∑ÂÖ•Êâã„Éû„Éº„ÇØ„ÇíËøΩÂä†
        const iceMark = document.createElement('div');
        iceMark.className = 'ice-acquisition-mark';
        iceMark.textContent = '‚ùÑÔ∏è';
        iceMark.style.cssText = `
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          font-size: 24px;
          color: #87ceeb;
          z-index: 10;
          pointer-events: none;
          animation: iceAcquisitionPulse 1s ease-in-out;
        `;
        
        cell.appendChild(iceMark);
        
        // 1ÁßíÂæå„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂâäÈô§
        setTimeout(() => {
          if (iceMark.parentNode) {
            iceMark.parentNode.removeChild(iceMark);
          }
          cell.style.animation = '';
        }, 1000);
      }
      
      // „Çπ„ÉÜ„Éº„Çø„Çπ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
      setStatus('Èõ™„ÅÆÁßªÂãï„ÅßÊ∞∑„ÇíÂÖ•Êâã„Åó„Åæ„Åó„ÅüÔºÅ', 'playing');
      
      // ÊâãÊåÅ„Å°Èßí„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞
      render();
    }
  }

  // ÊôÇÈñìÂÅúÊ≠¢„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
  function showTimeStopEffect(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (cell) {
      // ÊôÇÈñìÂÅúÊ≠¢„ÅÆË¶ñË¶öÁöÑ„Ç®„Éï„Çß„ÇØ„Éà
      cell.style.animation = 'timeStopEffect 2s ease-in-out';
      
      // ÊôÇÈñìÂÅúÊ≠¢„Éû„Éº„ÇØ„ÇíËøΩÂä†
      const timeStopMark = document.createElement('div');
      timeStopMark.className = 'time-stop-mark';
      timeStopMark.textContent = '‚è∞';
      timeStopMark.style.cssText = `
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 20px;
        color: #00bcd4;
        z-index: 10;
        pointer-events: none;
        animation: timeStopPulse 1s ease-in-out infinite;
      `;
      
      cell.appendChild(timeStopMark);
      
      // ÊôÇÈñìÂÅúÊ≠¢„Ç®„Éï„Çß„ÇØ„Éà„ÅÆÂº∑Âåñ
      const timeStopEffect = document.createElement('div');
      timeStopEffect.className = 'time-stop-effect';
      timeStopEffect.style.cssText = `
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle, rgba(0, 188, 212, 0.3) 0%, transparent 70%);
        border-radius: 50%;
        animation: timeParticles 2s ease-in-out infinite;
        pointer-events: none;
        z-index: 5;
      `;
      
      cell.appendChild(timeStopEffect);
      
      // 2ÁßíÂæå„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂâäÈô§
      setTimeout(() => {
        if (timeStopMark.parentNode) {
          timeStopMark.parentNode.removeChild(timeStopMark);
        }
        if (timeStopEffect.parentNode) {
          timeStopEffect.parentNode.removeChild(timeStopEffect);
        }
        cell.style.animation = '';
      }, 2000);
    }
  }

  // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆ„ÄåÂÆ∂„ÄçÈßí„ÇíÊé¢„Åô
  function findComputerHousePieces() {
    const housePieces = [];
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.piece === 'ÂÆ∂' && piece.owner === 'computer') {
          housePieces.push({r, c, piece});
        }
      }
    }
    return housePieces;
  }

  // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅåÂÆöÊúüÁöÑ„Å´„ÄåÂÆ∂„Äç„ÅÆ„Çπ„Ç≠„É´„Çí‰ΩøÁî®„Åô„Åπ„Åç„ÅãÂà§ÂÆöÔºà„Çπ„ÉÜ„Éº„Ç∏28Â∞ÇÁî®Ôºâ
  function shouldComputerUseHouseSkillPeriodically() {
    // „Çπ„ÉÜ„Éº„Ç∏28‰ª•Â§ñ„Åß„ÅØ‰ΩøÁî®„Åó„Å™„ÅÑ
    if (state.stageIndex !== 27) return false;
    
    // ÁèæÂú®„ÅÆÊ∞ëÈßíÊï∞„Çí„Ç´„Ç¶„É≥„Éà
    let currentPeopleCount = 0;
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.piece === 'Ê∞ë' && piece.owner === 'computer') {
          currentPeopleCount++;
        }
      }
    }
    
    // Ê∞ëÈßí„ÅÆ‰∏äÈôê„ÉÅ„Çß„ÉÉ„ÇØÔºà5‰Ωì„Åæ„ÅßÔºâ
    if (currentPeopleCount >= 5) {
      console.log(`üè† „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÊ∞ëÈßí„Åå‰∏äÈôêÔºà5‰ΩìÔºâ„Å´ÈÅî„Åó„Å¶„ÅÑ„Åæ„Åô`);
      return false;
    }
    
    // Ëá™Èô£4Ë°å„Å´Á©∫„Åç„Éû„Çπ„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    const targetRows = [0, 1, 2, 3]; // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆËá™Èô£4Ë°å
    let emptyCells = 0;
    
    for (let r of targetRows) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const cell = state.board[r][c];
        if (!cell || !cell.piece || cell.piece === '' || cell.piece === 'Á©∫') {
          emptyCells++;
        }
      }
    }
    
    // Á©∫„Åç„Éû„Çπ„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ„Çπ„Ç≠„É´‰ΩøÁî®„Åó„Å™„ÅÑ
    if (emptyCells === 0) return false;
    
    // „Çø„Éº„É≥Êï∞„Å´Âü∫„Å•„ÅÑ„ÅüÁ¢∫ÁéáË™øÊï¥
    const turnCount = state.moveCount || 0;
    let useSkillProbability = 0.2; // Âü∫Êú¨Á¢∫Áéá20%
    
    // „Ç≤„Éº„É†Â∫èÁõ§Ôºà10„Çø„Éº„É≥‰ª•ÂÜÖÔºâ„ÅØÁ¢∫Áéá„Çí‰∏ä„Åí„Çã
    if (turnCount <= 10) {
      useSkillProbability = 0.4; // 40%
    }
    // „Ç≤„Éº„É†‰∏≠Áõ§Ôºà11-30„Çø„Éº„É≥Ôºâ„ÅØÂü∫Êú¨Á¢∫Áéá
    else if (turnCount <= 30) {
      useSkillProbability = 0.3; // 30%
    }
    // „Ç≤„Éº„É†ÁµÇÁõ§Ôºà31„Çø„Éº„É≥‰ª•ÈôçÔºâ„ÅØÁ¢∫Áéá„Çí‰∏ã„Åí„Çã
    else {
      useSkillProbability = 0.15; // 15%
    }
    
    // Á©∫„Åç„Éû„Çπ„ÅåÂ§ö„ÅÑ„Åª„Å©Á¢∫Áéá„Çí‰∏ä„Åí„Çã
    if (emptyCells >= 5) {
      useSkillProbability *= 1.5;
    } else if (emptyCells >= 3) {
      useSkillProbability *= 1.2;
    }
    
    const random = Math.random();
    return random < useSkillProbability;
  }

  // „Ç≥„É≥„Éî„É•„Éº„Çø„Åå„ÄåÁïë„Äç„ÅÆ„Çπ„Ç≠„É´„Çí‰ΩøÁî®„Åô„Åπ„Åç„ÅãÂà§ÂÆö
  function shouldComputerUseFieldSkill(row, col) {
    const piece = state.board[row][col];
    if (!piece || piece.piece !== 'Áïë' || piece.owner !== 'computer') return false;
    
    // „Çπ„Ç≠„É´‰ΩøÁî®ÂõûÊï∞Âà∂ÈôêÔºà1„Çø„Éº„É≥„Å´1ÂõûÔºâ
    if (piece.fieldSkillUsed) return false;
    
    // Âë≥Êñπ„ÅÆÊ∞ëÈßí„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    const peoplePieces = [];
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const p = state.board[r][c];
        if (p && p.piece === 'Ê∞ë' && p.owner === 'computer') {
          peoplePieces.push({r, c, piece: p});
        }
      }
    }
    
    // Âë≥Êñπ„ÅÆÊ∞ëÈßí„Åå1‰Ωì‰ª•‰∏ä„ÅÇ„Çå„Å∞„Çπ„Ç≠„É´‰ΩøÁî®
    if (peoplePieces.length > 0) {
      piece.fieldSkillUsed = true; // ‰ΩøÁî®Ê∏à„Åø„Éï„É©„Ç∞„ÇíË®≠ÂÆö
      return true;
    }
    
    return false;
  }

  // „Ç≥„É≥„Éî„É•„Éº„Çø„Åå„ÄåÂÆ∂„Äç„ÅÆ„Çπ„Ç≠„É´„Çí‰ΩøÁî®„Åô„Åπ„Åç„ÅãÂà§ÂÆö
  function shouldComputerUseHouseSkill(row, col) {
    const piece = state.board[row][col];
    if (!piece || piece.piece !== 'ÂÆ∂' || piece.owner !== 'computer') return false;
    
    // „Çπ„Ç≠„É´‰ΩøÁî®ÂõûÊï∞Âà∂ÈôêÔºà1„Çø„Éº„É≥„Å´1ÂõûÔºâ
    if (piece.houseSkillUsed) return false;
    
    // ÁèæÂú®„ÅÆÊ∞ëÈßíÊï∞„Çí„Ç´„Ç¶„É≥„Éà
    let currentPeopleCount = 0;
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const p = state.board[r][c];
        if (p && p.piece === 'Ê∞ë' && p.owner === 'computer') {
          currentPeopleCount++;
        }
      }
    }
    
    // Ê∞ëÈßí„ÅÆ‰∏äÈôê„ÉÅ„Çß„ÉÉ„ÇØÔºà5‰Ωì„Åæ„ÅßÔºâ
    if (currentPeopleCount >= 5) {
      return false;
    }
    
    // Ëá™Èô£4Ë°å„Å´Á©∫„Åç„Éû„Çπ„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    const targetRows = [0, 1, 2, 3]; // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆËá™Èô£4Ë°å
    let emptyCells = 0;
    
    for (let r of targetRows) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const cell = state.board[r][c];
        if (!cell || !cell.piece || cell.piece === '' || cell.piece === 'Á©∫') {
          emptyCells++;
        }
      }
    }
    
    // Á©∫„Åç„Éû„Çπ„Åå1„Å§‰ª•‰∏ä„ÅÇ„Çå„Å∞„Çπ„Ç≠„É´‰ΩøÁî®
    if (emptyCells > 0) {
      piece.houseSkillUsed = true; // ‰ΩøÁî®Ê∏à„Åø„Éï„É©„Ç∞„ÇíË®≠ÂÆö
      return true;
    }
    
    return false;
  }

  // „Ç≥„É≥„Éî„É•„Éº„Çø„Åå„ÄåÊôÇ„Äç„ÅÆ„Çπ„Ç≠„É´„Çí‰ΩøÁî®„Åô„Åπ„Åç„ÅãÂà§ÂÆö
  function shouldComputerUseTimeSkill(row, col) {
    const piece = state.board[row][col];
    if (!piece || piece.piece !== 'ÊôÇ' || piece.owner !== 'computer') return false;
    
    // „Çπ„Ç≠„É´‰ΩøÁî®ÂõûÊï∞Âà∂ÈôêÔºà1„Çø„Éº„É≥„Å´1ÂõûÔºâ
    if (piece.timeSkillUsed) return false;
    
    // Âë®Âõ≤„Å´ÊïµÈßí„Åå„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    const directions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    let enemyCount = 0;
    
    for (const [dr, dc] of directions) {
      const targetRow = row + dr;
      const targetCol = col + dc;
      
      if (targetRow >= 0 && targetRow < BOARD_SIZE && targetCol >= 0 && targetCol < BOARD_SIZE) {
        const targetPiece = state.board[targetRow][targetCol];
        if (targetPiece && targetPiece.owner === 'player' && targetPiece.piece !== 'X') {
          enemyCount++;
        }
      }
    }
    
    // Âë®Âõ≤„Å´2„Å§‰ª•‰∏ä„ÅÆÊïµÈßí„Åå„ÅÑ„ÇãÂ†¥Âêà„ÄÅ„Çπ„Ç≠„É´„Çí‰ΩøÁî®
    return enemyCount >= 2;
  }

  // „Ç≥„É≥„Éî„É•„Éº„Çø„Åå„ÄåÊõ∏„Äç„ÅÆ„Çπ„Ç≠„É´„Çí‰ΩøÁî®„Åô„Åπ„Åç„ÅãÂà§ÂÆö
  function shouldComputerUseBookSkill(row, col) {
    const piece = state.board[row][col];
    if (!piece || piece.piece !== 'Êõ∏' || piece.owner !== 'computer') return false;
    
    // „Çπ„Ç≠„É´‰ΩøÁî®ÂõûÊï∞Âà∂ÈôêÔºà1„Çø„Éº„É≥„Å´1ÂõûÔºâ
    if (piece.bookSkillUsed) return false;
    
    // Âè≥Èö£„ÅÆÈßí„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    const rightCol = col + 1;
    if (rightCol >= 9 || !state.board[row][rightCol] || state.board[row][rightCol] === '') return false;
    
    const rightPiece = state.board[row][rightCol];
    if (rightPiece.owner === piece.owner) return false; // Âë≥Êñπ„ÅÆÈßí„ÅØ„Ç≥„Éî„Éº„Åß„Åç„Å™„ÅÑ
    
    // Âè≥Èö£„Å´ÊïµÈßí„Åå„ÅÑ„ÇãÂ†¥Âêà„ÄÅ„Çπ„Ç≠„É´„Çí‰ΩøÁî®
    return true;
  }

  // „Ç≥„É≥„Éî„É•„Éº„Çø„Åå„ÄåÊõ∏„Äç„ÅÆ„Çπ„Ç≠„É´„Çí‰ΩøÁî®
  function activateComputerBookSkill(row, col) {
    const piece = state.board[row][col];
    if (!piece || piece.piece !== 'Êõ∏' || piece.owner !== 'computer') return;
    
    // „Çπ„Ç≠„É´‰ΩøÁî®ÂõûÊï∞Âà∂ÈôêÔºà1„Çø„Éº„É≥„Å´1ÂõûÔºâ
    if (piece.bookSkillUsed) return;
    
    // Âè≥Èö£„ÅÆÈßí„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    const rightCol = col + 1;
    if (rightCol >= 9 || !state.board[row][rightCol] || state.board[row][rightCol] === '') return;
    
    const rightPiece = state.board[row][rightCol];
    if (rightPiece.owner === piece.owner) return; // Âë≥Êñπ„ÅÆÈßí„ÅØ„Ç≥„Éî„Éº„Åß„Åç„Å™„ÅÑ
    
    // „Çπ„Ç≠„É´‰ΩøÁî®‰∏≠„Éï„É©„Ç∞„ÇíË®≠ÂÆö
    state.bookSkillActive = true;
    
    // Âè≥Èö£„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´„Å®Ë°åÂãïÁØÑÂõ≤„Çí„Ç≥„Éî„Éº
    piece.bookSkillUsed = true;
    piece.copiedPiece = rightPiece.piece;
    piece.copiedOwner = rightPiece.owner;
    
    // „Ç≥„Éî„Éº„Åó„ÅüÈßí„ÅÆ„Çπ„Ç≠„É´„ÇíÁô∫Âãï
    const copiedPieceType = getPieceType(rightPiece.piece);
    if (copiedPieceType) {
      // „Ç≥„Éî„Éº„Åó„ÅüÈßí„ÅÆ„Çπ„Ç≠„É´„ÇíÁô∫Âãï
      switch (copiedPieceType) {
        case 'time':
          // ÊôÇ„ÅÆ„Çπ„Ç≠„É´: Âë®Âõ≤„ÅÆÊïµÈßí„Çí1„Çø„Éº„É≥ÂÅúÊ≠¢
          const timeStoppedPieces = [];
          const directions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
          for (const [dr, dc] of directions) {
            const nr = row + dr;
            const nc = col + dc;
            if (inBounds(nr, nc) && state.board[nr][nc] && state.board[nr][nc] !== '' && state.board[nr][nc].owner !== piece.owner) {
              timeStoppedPieces.push(state.board[nr][nc]);
              state.board[nr][nc].timeStopped = true;
            }
          }
          if (timeStoppedPieces.length > 0) {
            const pieceNames = timeStoppedPieces.map(p => p.piece).join('„ÄÅ');
            setStatus(`Êïµ„ÅÆÊõ∏„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Äå${rightPiece.piece}„Äç„ÅÆ„Çπ„Ç≠„É´„ÅßÂë®Âõ≤„ÅÆÂë≥ÊñπÈßí(${pieceNames})„Çí1„Çø„Éº„É≥ÂÅúÊ≠¢„Åï„Åõ„Åæ„Åó„Åü`, 'warning');
          } else {
            setStatus(`Êïµ„ÅÆÊõ∏„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Äå${rightPiece.piece}„Äç„ÅÆ„Çπ„Ç≠„É´„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü„Åå„ÄÅÂë®Âõ≤„Å´Âë≥ÊñπÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü`, 'info');
          }
          break;
        case 'ice':
          // Ê∞∑„ÅÆ„Çπ„Ç≠„É´: Âë®Âõ≤„ÅÆÊïµÈßí„ÇíÂáçÁµê
          const frozenPieces = [];
          for (const [dr, dc] of directions) {
            const nr = row + dr;
            const nc = col + dc;
            if (inBounds(nr, nc) && state.board[nr][nc] && state.board[nr][nc] !== '' && state.board[nr][nc].owner !== piece.owner) {
              frozenPieces.push(state.board[nr][nc]);
              state.board[nr][nc].frozen = true;
            }
          }
          if (frozenPieces.length > 0) {
            const pieceNames = frozenPieces.map(p => p.piece).join('„ÄÅ');
            setStatus(`Êïµ„ÅÆÊõ∏„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Äå${rightPiece.piece}„Äç„ÅÆ„Çπ„Ç≠„É´„ÅßÂë®Âõ≤„ÅÆÂë≥ÊñπÈßí(${pieceNames})„ÇíÂáçÁµê„Åï„Åõ„Åæ„Åó„Åü`, 'warning');
          } else {
            setStatus(`Êïµ„ÅÆÊõ∏„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Äå${rightPiece.piece}„Äç„ÅÆ„Çπ„Ç≠„É´„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü„Åå„ÄÅÂë®Âõ≤„Å´Âë≥ÊñπÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü`, 'info');
          }
          break;
        default:
          setStatus(`Êïµ„ÅÆÊõ∏„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Äå${rightPiece.piece}„Äç„ÅÆ„Çπ„Ç≠„É´„Å®Ë°åÂãïÁØÑÂõ≤„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü`, 'warning');
      }
    } else {
      setStatus(`Êïµ„ÅÆÊõ∏„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Äå${rightPiece.piece}„Äç„ÅÆË°åÂãïÁØÑÂõ≤„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü`, 'warning');
    }
    
    // „Çπ„Ç≠„É´‰ΩøÁî®ÂõûÊï∞„Çí„É™„Çª„ÉÉ„Éà„Åô„Çã„Çø„Ç§„Éû„Éº„ÇíË®≠ÂÆö
    setTimeout(() => {
      piece.bookSkillUsed = false;
      piece.copiedPiece = null;
      piece.copiedOwner = null;
    }, 1000);
    
    console.log(`üìö „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÊõ∏„ÅÆ„Çπ„Ç≠„É´„Åß„Äå${rightPiece.piece}„Äç„ÅÆ„Çπ„Ç≠„É´„Å®Ë°åÂãïÁØÑÂõ≤„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü`);
    
    // „Çπ„Ç≠„É´‰ΩøÁî®Âæå„ÄÅ„Éó„É¨„Ç§„É§„Éº„ÅÆ„Çø„Éº„É≥„Å´ÁßªË°å
    setTimeout(() => {
      // „Ç≤„Éº„É†„ÅåÊó¢„Å´ÁµÇ‰∫Ü„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
      if (state.gameOver) {
        return;
      }
      
      state.currentPlayer = 'player';
      setStatus('„ÅÇ„Å™„Åü„ÅÆÊâãÁï™', 'playing');
      
      // „Çπ„Ç≠„É´‰ΩøÁî®‰∏≠„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„Éà
      state.bookSkillActive = false;
      
      render();
      console.log('üìö Êõ∏„ÅÆ„Çπ„Ç≠„É´‰ΩøÁî®ÂÆå‰∫Ü„ÄÅ„Éó„É¨„Ç§„É§„Éº„ÅÆ„Çø„Éº„É≥„Å´ÁßªË°å');
    }, 1000);
    
    // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
    render();
  }

  // „Ç≥„É≥„Éî„É•„Éº„Çø„Åå„ÄåÂ∞Å„Äç„ÅÆ„Çπ„Ç≠„É´„Çí‰ΩøÁî®„Åô„Åπ„Åç„ÅãÂà§ÂÆö
  function shouldComputerUseSealSkill(row, col) {
    const piece = state.board[row][col];
    if (!piece || piece.piece !== 'Â∞Å' || piece.owner !== 'computer') return false;
    
    // „Çπ„Ç≠„É´‰ΩøÁî®ÂõûÊï∞Âà∂ÈôêÔºà1„Çø„Éº„É≥„Å´1ÂõûÔºâ
    if (piece.sealSkillUsed) return false;
    
    // Êñú„ÇÅ4„Éû„Çπ„Å´ÊïµÈßí„Åå„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    const directions = [[-1,-1],[-1,1],[1,-1],[1,1]];
    let enemyCount = 0;
    
    for (const [dr, dc] of directions) {
      const nr = row + dr;
      const nc = col + dc;
      if (inBounds(nr, nc) && state.board[nr][nc] && state.board[nr][nc] !== '' && state.board[nr][nc].owner !== piece.owner) {
        enemyCount++;
      }
    }
    
    // Êñú„ÇÅ4„Éû„Çπ„Å´1„Å§‰ª•‰∏ä„ÅÆÊïµÈßí„Åå„ÅÑ„ÇãÂ†¥Âêà„ÄÅ„Çπ„Ç≠„É´„Çí‰ΩøÁî®
    return enemyCount >= 1;
  }

  // „Ç≥„É≥„Éî„É•„Éº„Çø„Åå„ÄåÂ∞Å„Äç„ÅÆ„Çπ„Ç≠„É´„Çí‰ΩøÁî®
  function activateComputerSealSkill(row, col) {
    const piece = state.board[row][col];
    if (!piece || piece.piece !== 'Â∞Å' || piece.owner !== 'computer') return;
    
    // „Çπ„Ç≠„É´‰ΩøÁî®ÂõûÊï∞Âà∂ÈôêÔºà1„Çø„Éº„É≥„Å´1ÂõûÔºâ
    if (piece.sealSkillUsed) return;
    
    // Êñú„ÇÅ4„Éû„Çπ„Å´ÊïµÈßí„Åå„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    const diagonalPieces = [];
    const directions = [[-1,-1],[-1,1],[1,-1],[1,1]];
    for (const [dr, dc] of directions) {
      const nr = row + dr;
      const nc = col + dc;
      if (inBounds(nr, nc) && state.board[nr][nc] && state.board[nr][nc] !== '' && state.board[nr][nc].owner !== piece.owner) {
        diagonalPieces.push(state.board[nr][nc]);
      }
    }
    
    if (diagonalPieces.length === 0) return;
    
    // „Çπ„Ç≠„É´‰ΩøÁî®‰∏≠„Éï„É©„Ç∞„ÇíË®≠ÂÆö
    state.sealSkillActive = true;
    
    // Êñú„ÇÅ4„Éû„Çπ„ÅÆÊïµÈßí„ÅÆÁâπÊÆäËÉΩÂäõ„ÇÑ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
    piece.sealSkillUsed = true;
    const sealedPieces = [];
    
    for (const diagonalPiece of diagonalPieces) {
      // ÁâπÊÆäËÉΩÂäõ„ÇÑ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
      diagonalPiece.sealed = true;
      diagonalPiece.sealSkillDisabled = true;
      diagonalPiece.timeSkillUsed = true; // ÊôÇ„ÅÆ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
      diagonalPiece.bookSkillUsed = true; // Êõ∏„ÅÆ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
      diagonalPiece.iceSkillUsed = true; // Ê∞∑„ÅÆ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
      diagonalPiece.snowSkillUsed = true; // Èõ™„ÅÆ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
      diagonalPiece.sandSkillUsed = true; // Á†Ç„ÅÆ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
      diagonalPiece.windSkillUsed = true; // È¢®„ÅÆ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
      diagonalPiece.mossSkillUsed = true; // Ëãî„ÅÆ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
      diagonalPiece.fieldSkillUsed = true; // Áïë„ÅÆ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
      diagonalPiece.houseSkillUsed = true; // ÂÆ∂„ÅÆ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
      sealedPieces.push(diagonalPiece);
    }
    
    if (sealedPieces.length > 0) {
      const pieceNames = sealedPieces.map(p => p.piece).join('„ÄÅ');
      setStatus(`Êïµ„ÅÆÂ∞Å„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÊñú„ÇÅ4„Éû„Çπ„ÅÆÂë≥ÊñπÈßí(${pieceNames})„ÅÆÁâπÊÆäËÉΩÂäõ„ÇÑ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ„Åó„Åæ„Åó„Åü`, 'warning');
    }
    
    // „Çπ„Ç≠„É´‰ΩøÁî®ÂõûÊï∞„Çí„É™„Çª„ÉÉ„Éà„Åô„Çã„Çø„Ç§„Éû„Éº„ÇíË®≠ÂÆö
    setTimeout(() => {
      piece.sealSkillUsed = false;
      // Â∞ÅÂç∞ÂäπÊûú„ÇíËß£Èô§
      for (const sealedPiece of sealedPieces) {
        sealedPiece.sealed = false;
        sealedPiece.sealSkillDisabled = false;
        sealedPiece.timeSkillUsed = false;
        sealedPiece.bookSkillUsed = false;
        sealedPiece.iceSkillUsed = false;
        sealedPiece.snowSkillUsed = false;
        sealedPiece.sandSkillUsed = false;
        sealedPiece.windSkillUsed = false;
        sealedPiece.mossSkillUsed = false;
        sealedPiece.fieldSkillUsed = false;
        sealedPiece.houseSkillUsed = false;
      }
    }, 1000);
    
    console.log(`üîí „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÂ∞Å„ÅÆ„Çπ„Ç≠„É´„Åß${sealedPieces.length}ÂÄã„ÅÆÊïµÈßí„ÅÆÁâπÊÆäËÉΩÂäõ„ÇÑ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ„Åó„Åæ„Åó„Åü`);
    
    // „Çπ„Ç≠„É´‰ΩøÁî®Âæå„ÄÅ„Éó„É¨„Ç§„É§„Éº„ÅÆ„Çø„Éº„É≥„Å´ÁßªË°å
    setTimeout(() => {
      // „Ç≤„Éº„É†„ÅåÊó¢„Å´ÁµÇ‰∫Ü„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
      if (state.gameOver) {
        return;
      }
      
      state.currentPlayer = 'player';
      setStatus('„ÅÇ„Å™„Åü„ÅÆÊâãÁï™', 'playing');
      
      // „Çπ„Ç≠„É´‰ΩøÁî®‰∏≠„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„Éà
      state.sealSkillActive = false;
      
      render();
      console.log('üîí Â∞Å„ÅÆ„Çπ„Ç≠„É´‰ΩøÁî®ÂÆå‰∫Ü„ÄÅ„Éó„É¨„Ç§„É§„Éº„ÅÆ„Çø„Éº„É≥„Å´ÁßªË°å');
    }, 1000);
    
    // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
    render();
  }

  // „Ç≥„É≥„Éî„É•„Éº„Çø„Åå„ÄåÊôÇ„Äç„ÅÆ„Çπ„Ç≠„É´„Çí‰ΩøÁî®
  function activateComputerTimeSkill(row, col) {
    const piece = state.board[row][col];
    if (!piece || piece.piece !== 'ÊôÇ' || piece.owner !== 'computer') return;
    
    // „Çπ„Ç≠„É´‰ΩøÁî®ÂõûÊï∞Âà∂ÈôêÔºà1„Çø„Éº„É≥„Å´1ÂõûÔºâ
    if (piece.timeSkillUsed) return;
    
    // „Çπ„Ç≠„É´ÂäπÊûú: Âë®Âõ≤„ÅÆÊïµÈßí„Çí1„Çø„Éº„É≥ÂÅúÊ≠¢„Åï„Åõ„Çã
    const timeStoppedPieces = [];
    const directions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    
    for (const [dr, dc] of directions) {
      const targetRow = row + dr;
      const targetCol = col + dc;
      
      if (targetRow >= 0 && targetRow < BOARD_SIZE && targetCol >= 0 && targetCol < BOARD_SIZE) {
        const targetPiece = state.board[targetRow][targetCol];
        if (targetPiece && targetPiece.owner === 'player' && targetPiece.piece !== 'X') {
          // ÊïµÈßí„ÇíÊôÇÈñìÂÅúÊ≠¢Áä∂ÊÖã„Å´„Åô„ÇãÔºà2„Çø„Éº„É≥ÊåÅÁ∂öÔºâ
          targetPiece.isTimeStopped = true;
          targetPiece.timeStoppedTurn = state.turnCount;
          targetPiece.timeStopDuration = 2; // 2„Çø„Éº„É≥ÊåÅÁ∂ö
          timeStoppedPieces.push({row: targetRow, col: targetCol, piece: targetPiece.piece});
          
          // ÊôÇÈñìÂÅúÊ≠¢„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
          showTimeStopEffect(targetRow, targetCol);
        }
      }
    }
    
    if (timeStoppedPieces.length > 0) {
      piece.timeSkillUsed = true;
      const pieceNames = timeStoppedPieces.map(p => p.piece).join('„ÄÅ');
      setStatus(`Êïµ„ÅÆÊôÇ„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÂë®Âõ≤„ÅÆÂë≥ÊñπÈßí(${pieceNames})„Çí1„Çø„Éº„É≥ÂÅúÊ≠¢„Åï„Åõ„Åæ„Åó„Åü`, 'warning');
      
      // „Çπ„Ç≠„É´‰ΩøÁî®ÂõûÊï∞„Çí„É™„Çª„ÉÉ„Éà„Åô„Çã„Çø„Ç§„Éû„Éº„ÇíË®≠ÂÆö
      setTimeout(() => {
        piece.timeSkillUsed = false;
      }, 1000);
      
      console.log(`‚è∞ „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÊôÇ„ÅÆ„Çπ„Ç≠„É´„Åß${timeStoppedPieces.length}ÂÄã„ÅÆÊïµÈßí„ÇíÊôÇÈñìÂÅúÊ≠¢„Åï„Åõ„Åæ„Åó„Åü`);
      
      // „Çπ„Ç≠„É´‰ΩøÁî®Âæå„ÄÅ„Éó„É¨„Ç§„É§„Éº„ÅÆ„Çø„Éº„É≥„Å´ÁßªË°å
      setTimeout(() => {
        state.currentPlayer = 'player';
        setStatus('„ÅÇ„Å™„Åü„ÅÆÊâãÁï™', 'playing');
        render();
      }, 1000);
    } else {
      // „Çπ„Ç≠„É´„Åå‰Ωø„Åà„Å™„ÅÑÂ†¥Âêà„ÅØÈÄöÂ∏∏ÁßªÂãï„Å´Êàª„Çã
      const moves = getValidMoves(row, col);
      if (moves.length > 0) {
        const randomMove = moves[Math.floor(Math.random() * moves.length)];
        makeMove(row, col, randomMove.r, randomMove.c);
      }
    }
    
    // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
    render();
  }

  // ÊôÇÈñìÂÅúÊ≠¢ÂäπÊûú„ÇíËß£Èô§
  function clearTimeStopEffects() {
    let clearedCount = 0;
    
    for (let row = 0; row < BOARD_SIZE; row++) {
      for (let col = 0; col < BOARD_SIZE; col++) {
        const piece = state.board[row][col];
        if (piece && piece.isTimeStopped) {
          // 2„Çø„Éº„É≥ÁµåÈÅé„Åó„ÅüÂ†¥Âêà„ÅÆ„ÅøÊôÇÈñìÂÅúÊ≠¢Áä∂ÊÖã„ÇíËß£Èô§
          const turnsPassed = state.turnCount - piece.timeStoppedTurn;
          if (turnsPassed >= piece.timeStopDuration) {
            // ÊôÇÈñìÂÅúÊ≠¢Áä∂ÊÖã„ÇíËß£Èô§
            piece.isTimeStopped = false;
            delete piece.timeStoppedTurn;
            delete piece.timeStopDuration;
            clearedCount++;
            
            console.log(`‚è∞ ÊôÇÈñìÂÅúÊ≠¢Ëß£Èô§: ${piece.piece} at [${row}][${col}] (${turnsPassed}„Çø„Éº„É≥ÁµåÈÅé)`);
            
            // ÊôÇÈñìÂÅúÊ≠¢„Éû„Éº„ÇØ„ÇíÂâäÈô§
            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            if (cell) {
              const timeStopMark = cell.querySelector('.time-stop-mark');
              if (timeStopMark) {
                timeStopMark.remove();
              }
            }
          } else {
            console.log(`‚è∞ ÊôÇÈñìÂÅúÊ≠¢Á∂ôÁ∂ö: ${piece.piece} at [${row}][${col}] (ÊÆã„Çä${piece.timeStopDuration - turnsPassed}„Çø„Éº„É≥)`);
          }
        }
      }
    }
    
    if (clearedCount > 0) {
      console.log(`‚è∞ ÊôÇÈñìÂÅúÊ≠¢ÂäπÊûú„Çí${clearedCount}ÂÄã„ÅÆÈßí„ÅßËß£Èô§„Åó„Åæ„Åó„Åü`);
    }
  }

  // „ÄåÁïë„Äç„ÅÆ„Çπ„Ç≠„É´ÈÅ∏ÊäûËÇ¢„ÇíË°®Á§∫
  function showFieldSkillOptions(row, col) {
    const piece = state.board[row][col];
    if (!piece || piece.piece !== 'Áïë' || piece.owner !== 'player') return;
    
    // Êó¢Â≠ò„ÅÆÈÅ∏ÊäûËÇ¢„Çí„ÇØ„É™„Ç¢
    const existingOptions = document.querySelector('.field-skill-options');
    if (existingOptions) {
      existingOptions.remove();
    }
    
    // Âë≥Êñπ„ÅÆÊ∞ëÈßí„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    const peoplePieces = [];
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const p = state.board[r][c];
        if (p && p.piece === 'Ê∞ë' && p.owner === 'player') {
          peoplePieces.push({r, c, piece: p});
        }
      }
    }
    
    if (peoplePieces.length === 0) {
      setStatus('Áïë„ÅÆÂäõÔºöÂë≥Êñπ„ÅÆÊ∞ëÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì', 'warning');
      return;
    }
    
    // ÈÅ∏ÊäûËÇ¢„Ç≥„É≥„ÉÜ„Éä„Çí‰ΩúÊàê
    const optionsContainer = document.createElement('div');
    optionsContainer.className = 'field-skill-options';
    optionsContainer.style.cssText = `
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, #228B22, #32CD32);
      border: 3px solid #228B22;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 8px 32px rgba(34, 139, 34, 0.3);
      z-index: 1000;
      color: white;
      text-align: center;
      min-width: 300px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    `;
    
    // „Çø„Ç§„Éà„É´
    const title = document.createElement('h3');
    title.textContent = 'Áïë„ÅÆ„Çπ„Ç≠„É´';
    title.style.cssText = `
      margin: 0 0 16px 0;
      color: #90EE90;
      font-size: 18px;
    `;
    optionsContainer.appendChild(title);
    
    // „Çπ„Ç≠„É´Ë™¨Êòé
    const description = document.createElement('p');
    description.textContent = `Âë≥Êñπ„ÅÆÊ∞ëÈßí„ÅåÊñú„ÇÅÂâç„Å´„ÇÇÁßªÂãï„Åß„Åç„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„ÅôÔºàÊ∞ëÈßíÊï∞: ${peoplePieces.length}Ôºâ`;
    description.style.cssText = `
      margin: 0 0 20px 0;
      font-size: 14px;
      line-height: 1.4;
    `;
    optionsContainer.appendChild(description);
    
    // „Çπ„Ç≠„É´„Éú„Çø„É≥
    const skillButton = document.createElement('button');
    skillButton.textContent = 'Ë±äÁ©£„ÅÆÂäõ';
    skillButton.style.cssText = `
      background: linear-gradient(45deg, #32CD32, #228B22);
      color: white;
      border: 2px solid #90EE90;
      border-radius: 8px;
      padding: 12px 24px;
      margin: 0 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s ease;
    `;
    
    skillButton.addEventListener('mouseenter', () => {
      skillButton.style.background = 'linear-gradient(45deg, #228B22, #32CD32)';
      skillButton.style.transform = 'scale(1.05)';
    });
    
    skillButton.addEventListener('mouseleave', () => {
      skillButton.style.background = 'linear-gradient(45deg, #32CD32, #228B22)';
      skillButton.style.transform = 'scale(1)';
    });
    
    skillButton.addEventListener('click', () => {
      triggerFieldSkill(row, col);
      optionsContainer.remove();
    });
    
    // „Ç≠„É£„É≥„Çª„É´„Éú„Çø„É≥
    const cancelButton = document.createElement('button');
    cancelButton.textContent = '„Ç≠„É£„É≥„Çª„É´';
    cancelButton.style.cssText = `
      background: linear-gradient(45deg, #666, #444);
      color: white;
      border: 2px solid #888;
      border-radius: 8px;
      padding: 12px 24px;
      margin: 0 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s ease;
    `;
    
    cancelButton.addEventListener('click', () => {
      optionsContainer.remove();
    });
    
    // „Éú„Çø„É≥„Çí„Ç≥„É≥„ÉÜ„Éä„Å´ËøΩÂä†
    const buttonContainer = document.createElement('div');
    buttonContainer.style.cssText = 'display: flex; justify-content: center; gap: 12px;';
    buttonContainer.appendChild(skillButton);
    buttonContainer.appendChild(cancelButton);
    optionsContainer.appendChild(buttonContainer);
    
    // „Éö„Éº„Ç∏„Å´ËøΩÂä†
    document.body.appendChild(optionsContainer);
  }

  // „ÄåÂÆ∂„Äç„ÅÆ„Çπ„Ç≠„É´ÈÅ∏ÊäûËÇ¢„ÇíË°®Á§∫
  function showHouseSkillOptions(row, col) {
    const piece = state.board[row][col];
    if (!piece || piece.piece !== 'ÂÆ∂' || piece.owner !== 'player') return;
    
    // Êó¢Â≠ò„ÅÆÈÅ∏ÊäûËÇ¢„Çí„ÇØ„É™„Ç¢
    const existingOptions = document.querySelector('.house-skill-options');
    if (existingOptions) {
      existingOptions.remove();
    }
    
    // „Çπ„Ç≠„É´ÈÅ∏ÊäûËÇ¢„ÅÆ„Ç≥„É≥„ÉÜ„Éä„Çí‰ΩúÊàê
    const optionsContainer = document.createElement('div');
    optionsContainer.className = 'house-skill-options';
    optionsContainer.style.cssText = `
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      border: 2px solid #8B4513;
      border-radius: 12px;
      padding: 20px;
      z-index: 1000;
      text-align: center;
      color: white;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    `;
    
    // „Çø„Ç§„Éà„É´
    const title = document.createElement('h3');
    title.textContent = 'ÂÆ∂„ÅÆ„Çπ„Ç≠„É´';
    title.style.cssText = `
      margin: 0 0 16px 0;
      color: #8B4513;
      font-size: 18px;
    `;
    optionsContainer.appendChild(title);
    
    // ÁèæÂú®„ÅÆÊ∞ëÈßíÊï∞„Çí„Ç´„Ç¶„É≥„Éà
    let currentPeopleCount = 0;
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const p = state.board[r][c];
        if (p && p.piece === 'Ê∞ë' && p.owner === 'player') {
          currentPeopleCount++;
        }
      }
    }
    
    // „Çπ„Ç≠„É´Ë™¨Êòé
    const description = document.createElement('p');
    description.textContent = `Ê∞ëÈßí„ÇíËá™Èô£4Ë°å„ÅÆ„É©„É≥„ÉÄ„É†„Å™Á©∫„Åç„Éû„Çπ„Å´Âè¨Âñö„Åó„Åæ„ÅôÔºàÁèæÂú®: ${currentPeopleCount}/5Ôºâ`;
    description.style.cssText = `
      margin: 0 0 16px 0;
      font-size: 14px;
      color: #ccc;
    `;
    optionsContainer.appendChild(description);
    
    // ‰∏äÈôê„Å´ÈÅî„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØË≠¶Âëä„ÇíË°®Á§∫
    if (currentPeopleCount >= 5) {
      const warning = document.createElement('p');
      warning.textContent = 'Ê∞ëÈßí„ÅÆ‰∏äÈôêÔºà5‰ΩìÔºâ„Å´ÈÅî„Åó„Å¶„ÅÑ„Åæ„Åô';
      warning.style.cssText = `
        margin: 0 0 16px 0;
        font-size: 14px;
        color: #ff6b6b;
        font-weight: bold;
      `;
      optionsContainer.appendChild(warning);
    }
    
    // „Çπ„Ç≠„É´Áô∫Âãï„Éú„Çø„É≥
    const skillButton = document.createElement('button');
    skillButton.textContent = 'Ê∞ëÈßíÂè¨Âñö';
    
    // Ê∞ëÈßí„Åå‰∏äÈôê„Å´ÈÅî„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ„Éú„Çø„É≥„ÇíÁÑ°ÂäπÂåñ
    const isButtonDisabled = currentPeopleCount >= 5;
    
    skillButton.style.cssText = `
      background: ${isButtonDisabled ? 'linear-gradient(45deg, #666, #444)' : 'linear-gradient(45deg, #8B4513, #A0522D)'};
      color: ${isButtonDisabled ? '#999' : 'white'};
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: ${isButtonDisabled ? 'not-allowed' : 'pointer'};
      font-size: 14px;
      font-weight: bold;
      margin: 0 8px;
      transition: all 0.3s ease;
      opacity: ${isButtonDisabled ? '0.6' : '1'};
    `;
    
    if (!isButtonDisabled) {
      skillButton.addEventListener('mouseenter', () => {
        skillButton.style.transform = 'scale(1.05)';
        skillButton.style.boxShadow = '0 4px 12px rgba(139, 69, 19, 0.4)';
      });
      skillButton.addEventListener('mouseleave', () => {
        skillButton.style.transform = 'scale(1)';
        skillButton.style.boxShadow = 'none';
      });
      skillButton.addEventListener('click', () => {
        triggerHouseSkill(row, col);
        optionsContainer.remove();
      });
    } else {
      skillButton.addEventListener('click', () => {
        setStatus('Ê∞ëÈßí„ÅÆ‰∏äÈôêÔºà5‰ΩìÔºâ„Å´ÈÅî„Åó„Å¶„ÅÑ„Åæ„Åô', 'warning');
      });
    }
    
    optionsContainer.appendChild(skillButton);
    
    // „Ç≠„É£„É≥„Çª„É´„Éú„Çø„É≥
    const cancelButton = document.createElement('button');
    cancelButton.textContent = '„Ç≠„É£„É≥„Çª„É´';
    cancelButton.style.cssText = `
      background: #666;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin: 0 8px;
      transition: all 0.3s ease;
    `;
    cancelButton.addEventListener('click', () => {
      optionsContainer.remove();
    });
    optionsContainer.appendChild(cancelButton);
    
    // ËÉåÊôØ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
    optionsContainer.addEventListener('click', (e) => {
      if (e.target === optionsContainer) {
        optionsContainer.remove();
      }
    });
    
    document.body.appendChild(optionsContainer);
  }

  // „ÄåÊôÇ„Äç„ÅÆ„Çπ„Ç≠„É´ÈÅ∏ÊäûËÇ¢„ÇíË°®Á§∫
  function showTimeSkillOptions(row, col) {
    const piece = state.board[row][col];
    if (!piece || piece.piece !== 'ÊôÇ' || piece.owner !== 'player') return;
    
    // Êó¢Â≠ò„ÅÆÈÅ∏ÊäûËÇ¢„Çí„ÇØ„É™„Ç¢
    const existingOptions = document.querySelector('.time-skill-options');
    if (existingOptions) {
      existingOptions.remove();
    }
    
    // „Çπ„Ç≠„É´ÈÅ∏ÊäûËÇ¢„ÅÆ„Ç≥„É≥„ÉÜ„Éä„Çí‰ΩúÊàê
    const optionsContainer = document.createElement('div');
    optionsContainer.className = 'time-skill-options';
    optionsContainer.style.cssText = `
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      border: 2px solid #00bcd4;
      border-radius: 12px;
      padding: 20px;
      z-index: 1000;
      text-align: center;
      color: white;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    `;
    
    // „Çø„Ç§„Éà„É´
    const title = document.createElement('h3');
    title.textContent = 'ÊôÇ„ÅÆ„Çπ„Ç≠„É´';
    title.style.cssText = `
      margin: 0 0 16px 0;
      color: #00bcd4;
      font-size: 18px;
    `;
    optionsContainer.appendChild(title);
    
    // „Çπ„Ç≠„É´Ë™¨Êòé
    const description = document.createElement('p');
    description.textContent = 'Âë®Âõ≤„ÅÆÊïµÈßí„Çí2„Çø„Éº„É≥ÂÅúÊ≠¢„Åï„Åõ„Åæ„Åô';
    description.style.cssText = `
      margin: 0 0 16px 0;
      font-size: 14px;
      color: #ccc;
    `;
    optionsContainer.appendChild(description);
    
    // „Çπ„Ç≠„É´Áô∫Âãï„Éú„Çø„É≥
    const skillButton = document.createElement('button');
    skillButton.textContent = '„Çπ„Ç≠„É´Áô∫Âãï';
    skillButton.style.cssText = `
      background: linear-gradient(45deg, #00bcd4, #0097a7);
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      margin-right: 10px;
      transition: all 0.2s;
    `;
    skillButton.onmouseover = () => {
      skillButton.style.transform = 'scale(1.05)';
    };
    skillButton.onmouseout = () => {
      skillButton.style.transform = 'scale(1)';
    };
    skillButton.onclick = () => {
      activateTimeSkill(row, col);
      optionsContainer.remove();
    };
    optionsContainer.appendChild(skillButton);
    
    // ÈÄöÂ∏∏ÁßªÂãï„Éú„Çø„É≥
    const moveButton = document.createElement('button');
    moveButton.textContent = 'ÈÄöÂ∏∏ÁßªÂãï';
    moveButton.style.cssText = `
      background: linear-gradient(45deg, #6c757d, #495057);
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
    `;
    moveButton.onmouseover = () => {
      moveButton.style.transform = 'scale(1.05)';
    };
    moveButton.onmouseout = () => {
      moveButton.style.transform = 'scale(1)';
    };
    moveButton.onclick = () => {
      state.selected = {r: row, c: col};
      state.validMoves = getValidMoves(row, col);
      optionsContainer.remove();
      render();
    };
    optionsContainer.appendChild(moveButton);
    
    // „Ç≠„É£„É≥„Çª„É´„Éú„Çø„É≥
    const cancelButton = document.createElement('button');
    cancelButton.textContent = '„Ç≠„É£„É≥„Çª„É´';
    cancelButton.style.cssText = `
      background: linear-gradient(45deg, #dc3545, #c82333);
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      margin-left: 10px;
      transition: all 0.2s;
    `;
    cancelButton.onmouseover = () => {
      cancelButton.style.transform = 'scale(1.05)';
    };
    cancelButton.onmouseout = () => {
      cancelButton.style.transform = 'scale(1)';
    };
    cancelButton.onclick = () => {
      optionsContainer.remove();
    };
    optionsContainer.appendChild(cancelButton);
    
    // ÁîªÈù¢„Å´ËøΩÂä†
    document.body.appendChild(optionsContainer);
    
    // ËÉåÊôØ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
    optionsContainer.onclick = (e) => {
      if (e.target === optionsContainer) {
        optionsContainer.remove();
      }
    };
  }

  // „ÄåÊõ∏„Äç„ÅÆ„Çπ„Ç≠„É´ÈÅ∏ÊäûËÇ¢„ÇíË°®Á§∫
  function showBookSkillOptions(row, col) {
    const piece = state.board[row][col];
    if (!piece || piece.piece !== 'Êõ∏' || piece.owner !== 'player') return;
    
    // Êó¢Â≠ò„ÅÆÈÅ∏ÊäûËÇ¢„Çí„ÇØ„É™„Ç¢
    const existingOptions = document.querySelector('.book-skill-options');
    if (existingOptions) {
      existingOptions.remove();
    }
    
    // Âè≥Èö£„ÅÆÈßí„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    const rightCol = col + 1;
    if (rightCol >= 9 || !state.board[row][rightCol] || state.board[row][rightCol] === '') {
      setStatus('Âè≥Èö£„Å´Èßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÊõ∏„ÅÆ„Çπ„Ç≠„É´„ÅØ‰ΩøÁî®„Åß„Åç„Åæ„Åõ„Çì„ÄÇ', 'warning');
      return;
    }
    
    const rightPiece = state.board[row][rightCol];
    if (rightPiece.owner === piece.owner) {
      setStatus('Âè≥Èö£„ÅÆÈßí„ÅØÂë≥Êñπ„ÅÆÈßí„Åß„Åô„ÄÇÊõ∏„ÅÆ„Çπ„Ç≠„É´„ÅØ‰ΩøÁî®„Åß„Åç„Åæ„Åõ„Çì„ÄÇ', 'warning');
      return;
    }
    
    // „Çπ„Ç≠„É´‰ΩøÁî®ÂõûÊï∞Âà∂ÈôêÔºà1„Çø„Éº„É≥„Å´1ÂõûÔºâ
    if (piece.bookSkillUsed) {
      setStatus('Êõ∏„ÅÆ„Çπ„Ç≠„É´„ÅØ1„Çø„Éº„É≥„Å´1Âõû„Åó„Åã‰ΩøÁî®„Åß„Åç„Åæ„Åõ„Çì', 'warning');
      return;
    }
    
    // ÈÅ∏ÊäûËÇ¢„Ç≥„É≥„ÉÜ„Éä„Çí‰ΩúÊàê
    const optionsContainer = document.createElement('div');
    optionsContainer.className = 'book-skill-options';
    optionsContainer.style.cssText = `
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, #2c3e50, #34495e);
      border: 2px solid #3498db;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      z-index: 10000;
      color: white;
      min-width: 300px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    `;
    
    // „Çø„Ç§„Éà„É´
    const title = document.createElement('h3');
    title.textContent = 'Êõ∏„ÅÆ„Çπ„Ç≠„É´';
    title.style.cssText = `
      margin: 0 0 16px 0;
      color: #3498db;
      font-size: 18px;
    `;
    
    // Ë™¨Êòé
    const description = document.createElement('p');
    description.textContent = `Âè≥Èö£„ÅÆÈßí„Äå${rightPiece.piece}„Äç„ÅÆ„Çπ„Ç≠„É´„Å®Ë°åÂãïÁØÑÂõ≤„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åô`;
    description.style.cssText = `
      margin: 0 0 20px 0;
      color: #ecf0f1;
      font-size: 14px;
      line-height: 1.4;
    `;
    
    // „Éú„Çø„É≥„Ç≥„É≥„ÉÜ„Éä
    const buttonContainer = document.createElement('div');
    buttonContainer.style.cssText = `
      display: flex;
      gap: 12px;
      justify-content: center;
    `;
    
    // „Çπ„Ç≠„É´Áô∫Âãï„Éú„Çø„É≥
    const activateButton = document.createElement('button');
    activateButton.textContent = '„Çπ„Ç≠„É´Áô∫Âãï';
    activateButton.style.cssText = `
      background: linear-gradient(135deg, #3498db, #2980b9);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s ease;
    `;
    activateButton.onmouseover = () => {
      activateButton.style.background = 'linear-gradient(135deg, #2980b9, #1f618d)';
    };
    activateButton.onmouseout = () => {
      activateButton.style.background = 'linear-gradient(135deg, #3498db, #2980b9)';
    };
    activateButton.onclick = () => {
      activateBookSkill(row, col);
      optionsContainer.remove();
    };
    
    // „Ç≠„É£„É≥„Çª„É´„Éú„Çø„É≥
    const cancelButton = document.createElement('button');
    cancelButton.textContent = '„Ç≠„É£„É≥„Çª„É´';
    cancelButton.style.cssText = `
      background: linear-gradient(135deg, #95a5a6, #7f8c8d);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s ease;
    `;
    cancelButton.onmouseover = () => {
      cancelButton.style.background = 'linear-gradient(135deg, #7f8c8d, #6c7b7d)';
    };
    cancelButton.onmouseout = () => {
      cancelButton.style.background = 'linear-gradient(135deg, #95a5a6, #7f8c8d)';
    };
    cancelButton.onclick = () => {
      optionsContainer.remove();
    };
    
    buttonContainer.appendChild(activateButton);
    buttonContainer.appendChild(cancelButton);
    
    optionsContainer.appendChild(title);
    optionsContainer.appendChild(description);
    optionsContainer.appendChild(buttonContainer);
    
    document.body.appendChild(optionsContainer);
  }

  // „ÄåÂ∞Å„Äç„ÅÆ„Çπ„Ç≠„É´ÈÅ∏ÊäûËÇ¢„ÇíË°®Á§∫
  function showSealSkillOptions(row, col) {
    const piece = state.board[row][col];
    if (!piece || piece.piece !== 'Â∞Å' || piece.owner !== 'player') return;
    
    // Êó¢Â≠ò„ÅÆÈÅ∏ÊäûËÇ¢„Çí„ÇØ„É™„Ç¢
    const existingOptions = document.querySelector('.seal-skill-options');
    if (existingOptions) {
      existingOptions.remove();
    }
    
    // „Çπ„Ç≠„É´‰ΩøÁî®ÂõûÊï∞Âà∂ÈôêÔºà1„Çø„Éº„É≥„Å´1ÂõûÔºâ
    if (piece.sealSkillUsed) {
      setStatus('Â∞Å„ÅÆ„Çπ„Ç≠„É´„ÅØ1„Çø„Éº„É≥„Å´1Âõû„Åó„Åã‰ΩøÁî®„Åß„Åç„Åæ„Åõ„Çì', 'warning');
      return;
    }
    
    // Êñú„ÇÅ4„Éû„Çπ„Å´ÊïµÈßí„Åå„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    const diagonalPieces = [];
    const directions = [[-1,-1],[-1,1],[1,-1],[1,1]];
    for (const [dr, dc] of directions) {
      const nr = row + dr;
      const nc = col + dc;
      if (valid(nr, nc) && state.board[nr][nc] && state.board[nr][nc] !== '' && state.board[nr][nc].owner !== piece.owner) {
        diagonalPieces.push(state.board[nr][nc]);
      }
    }
    
    if (diagonalPieces.length === 0) {
      setStatus('Êñú„ÇÅ4„Éû„Çπ„Å´ÊïµÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÂ∞Å„ÅÆ„Çπ„Ç≠„É´„ÅØ‰ΩøÁî®„Åß„Åç„Åæ„Åõ„Çì„ÄÇ', 'warning');
      return;
    }
    
    // ÈÅ∏ÊäûËÇ¢„Ç≥„É≥„ÉÜ„Éä„Çí‰ΩúÊàê
    const optionsContainer = document.createElement('div');
    optionsContainer.className = 'seal-skill-options';
    optionsContainer.style.cssText = `
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, #2c3e50, #34495e);
      border: 2px solid #e74c3c;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      z-index: 10000;
      color: white;
      min-width: 300px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    `;
    
    // „Çø„Ç§„Éà„É´
    const title = document.createElement('h3');
    title.textContent = 'Â∞Å„ÅÆ„Çπ„Ç≠„É´';
    title.style.cssText = `
      margin: 0 0 16px 0;
      color: #e74c3c;
      font-size: 18px;
    `;
    
    // Ë™¨Êòé
    const description = document.createElement('p');
    const pieceNames = diagonalPieces.map(p => p.piece).join('„ÄÅ');
    description.textContent = `Êñú„ÇÅ4„Éû„Çπ„Å´„ÅÑ„ÇãÊïµÈßí(${pieceNames})„ÅÆÁâπÊÆäËÉΩÂäõ„ÇÑ„Çπ„Ç≠„É´„ÅÆÁô∫Âãï„ÇíÁÑ°ÂäπÂåñ„Åó„Åæ„Åô`;
    description.style.cssText = `
      margin: 0 0 20px 0;
      color: #ecf0f1;
      font-size: 14px;
      line-height: 1.4;
    `;
    
    // „Éú„Çø„É≥„Ç≥„É≥„ÉÜ„Éä
    const buttonContainer = document.createElement('div');
    buttonContainer.style.cssText = `
      display: flex;
      gap: 12px;
      justify-content: center;
    `;
    
    // „Çπ„Ç≠„É´Áô∫Âãï„Éú„Çø„É≥
    const activateButton = document.createElement('button');
    activateButton.textContent = '„Çπ„Ç≠„É´Áô∫Âãï';
    activateButton.style.cssText = `
      background: linear-gradient(135deg, #e74c3c, #c0392b);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s ease;
    `;
    activateButton.onmouseover = () => {
      activateButton.style.background = 'linear-gradient(135deg, #c0392b, #a93226)';
    };
    activateButton.onmouseout = () => {
      activateButton.style.background = 'linear-gradient(135deg, #e74c3c, #c0392b)';
    };
    activateButton.onclick = () => {
      activateSealSkill(row, col);
      optionsContainer.remove();
    };
    
    // „Ç≠„É£„É≥„Çª„É´„Éú„Çø„É≥
    const cancelButton = document.createElement('button');
    cancelButton.textContent = '„Ç≠„É£„É≥„Çª„É´';
    cancelButton.style.cssText = `
      background: linear-gradient(135deg, #95a5a6, #7f8c8d);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s ease;
    `;
    cancelButton.onmouseover = () => {
      cancelButton.style.background = 'linear-gradient(135deg, #7f8c8d, #6c7b7d)';
    };
    cancelButton.onmouseout = () => {
      cancelButton.style.background = 'linear-gradient(135deg, #95a5a6, #7f8c8d)';
    };
    cancelButton.onclick = () => {
      optionsContainer.remove();
    };
    
    buttonContainer.appendChild(activateButton);
    buttonContainer.appendChild(cancelButton);
    
    optionsContainer.appendChild(title);
    optionsContainer.appendChild(description);
    optionsContainer.appendChild(buttonContainer);
    
    document.body.appendChild(optionsContainer);
  }

  // Êõ∏„ÅÆ„Çπ„Ç≠„É´: Âè≥Èö£„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´„Å®Ë°åÂãïÁØÑÂõ≤„Çí„Ç≥„Éî„Éº
  function activateBookSkill(row, col) {
    const piece = state.board[row][col];
    if (!piece || piece.piece !== 'Êõ∏' || piece.owner !== 'player') return;
    
    // „Çπ„Ç≠„É´‰ΩøÁî®ÂõûÊï∞Âà∂ÈôêÔºà1„Çø„Éº„É≥„Å´1ÂõûÔºâ
    if (piece.bookSkillUsed) {
      setStatus('Êõ∏„ÅÆ„Çπ„Ç≠„É´„ÅØ1„Çø„Éº„É≥„Å´1Âõû„Åó„Åã‰ΩøÁî®„Åß„Åç„Åæ„Åõ„Çì', 'warning');
      return;
    }
    
    // Âè≥Èö£„ÅÆÈßí„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    const rightCol = col + 1;
    if (rightCol >= 9 || !state.board[row][rightCol] || state.board[row][rightCol] === '') {
      setStatus('Âè≥Èö£„Å´Èßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÊõ∏„ÅÆ„Çπ„Ç≠„É´„ÅØ‰ΩøÁî®„Åß„Åç„Åæ„Åõ„Çì„ÄÇ', 'warning');
      return;
    }
    
    const rightPiece = state.board[row][rightCol];
    if (rightPiece.owner === piece.owner) {
      setStatus('Âè≥Èö£„ÅÆÈßí„ÅØÂë≥Êñπ„ÅÆÈßí„Åß„Åô„ÄÇÊõ∏„ÅÆ„Çπ„Ç≠„É´„ÅØ‰ΩøÁî®„Åß„Åç„Åæ„Åõ„Çì„ÄÇ', 'warning');
      return;
    }
    
    // „Çπ„Ç≠„É´‰ΩøÁî®‰∏≠„Éï„É©„Ç∞„ÇíË®≠ÂÆö
    state.bookSkillActive = true;
    
    // Âè≥Èö£„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´„Å®Ë°åÂãïÁØÑÂõ≤„Çí„Ç≥„Éî„Éº
    piece.bookSkillUsed = true;
    piece.copiedPiece = rightPiece.piece;
    piece.copiedOwner = rightPiece.owner;
    
    // „Ç≥„Éî„Éº„Åó„ÅüÈßí„ÅÆ„Çπ„Ç≠„É´„ÇíÁô∫Âãï
    const copiedPieceType = getPieceType(rightPiece.piece);
    if (copiedPieceType) {
      // „Ç≥„Éî„Éº„Åó„ÅüÈßí„ÅÆ„Çπ„Ç≠„É´„ÇíÁô∫Âãï
      switch (copiedPieceType) {
        case 'time':
          // ÊôÇ„ÅÆ„Çπ„Ç≠„É´: Âë®Âõ≤„ÅÆÊïµÈßí„Çí1„Çø„Éº„É≥ÂÅúÊ≠¢
          const timeStoppedPieces = [];
          const directions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
          for (const [dr, dc] of directions) {
            const nr = row + dr;
            const nc = col + dc;
            if (inBounds(nr, nc) && state.board[nr][nc] && state.board[nr][nc] !== '' && state.board[nr][nc].owner !== piece.owner) {
              timeStoppedPieces.push(state.board[nr][nc]);
              state.board[nr][nc].timeStopped = true;
            }
          }
          if (timeStoppedPieces.length > 0) {
            const pieceNames = timeStoppedPieces.map(p => p.piece).join('„ÄÅ');
            setStatus(`Êõ∏„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Äå${rightPiece.piece}„Äç„ÅÆ„Çπ„Ç≠„É´„ÅßÂë®Âõ≤„ÅÆÊïµÈßí(${pieceNames})„Çí1„Çø„Éº„É≥ÂÅúÊ≠¢„Åï„Åõ„Åæ„Åó„Åü`, 'success');
          } else {
            setStatus(`Êõ∏„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Äå${rightPiece.piece}„Äç„ÅÆ„Çπ„Ç≠„É´„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü„Åå„ÄÅÂë®Âõ≤„Å´ÊïµÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü`, 'info');
          }
          break;
        case 'ice':
          // Ê∞∑„ÅÆ„Çπ„Ç≠„É´: Âë®Âõ≤„ÅÆÊïµÈßí„ÇíÂáçÁµê
          const frozenPieces = [];
          for (const [dr, dc] of directions) {
            const nr = row + dr;
            const nc = col + dc;
            if (inBounds(nr, nc) && state.board[nr][nc] && state.board[nr][nc] !== '' && state.board[nr][nc].owner !== piece.owner) {
              frozenPieces.push(state.board[nr][nc]);
              state.board[nr][nc].frozen = true;
            }
          }
          if (frozenPieces.length > 0) {
            const pieceNames = frozenPieces.map(p => p.piece).join('„ÄÅ');
            setStatus(`Êõ∏„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Äå${rightPiece.piece}„Äç„ÅÆ„Çπ„Ç≠„É´„ÅßÂë®Âõ≤„ÅÆÊïµÈßí(${pieceNames})„ÇíÂáçÁµê„Åï„Åõ„Åæ„Åó„Åü`, 'success');
          } else {
            setStatus(`Êõ∏„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Äå${rightPiece.piece}„Äç„ÅÆ„Çπ„Ç≠„É´„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü„Åå„ÄÅÂë®Âõ≤„Å´ÊïµÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü`, 'info');
          }
          break;
        default:
          setStatus(`Êõ∏„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Äå${rightPiece.piece}„Äç„ÅÆ„Çπ„Ç≠„É´„Å®Ë°åÂãïÁØÑÂõ≤„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü`, 'success');
      }
    } else {
      setStatus(`Êõ∏„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„Äå${rightPiece.piece}„Äç„ÅÆË°åÂãïÁØÑÂõ≤„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü`, 'success');
    }
    
    // „Çπ„Ç≠„É´‰ΩøÁî®ÂõûÊï∞„Çí„É™„Çª„ÉÉ„Éà„Åô„Çã„Çø„Ç§„Éû„Éº„ÇíË®≠ÂÆö
    setTimeout(() => {
      piece.bookSkillUsed = false;
      piece.copiedPiece = null;
      piece.copiedOwner = null;
    }, 1000);
    
    console.log(`üìö Êõ∏„ÅÆ„Çπ„Ç≠„É´„Åß„Äå${rightPiece.piece}„Äç„ÅÆ„Çπ„Ç≠„É´„Å®Ë°åÂãïÁØÑÂõ≤„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü`);
    
    // „Çπ„Ç≠„É´‰ΩøÁî®Âæå„ÄÅ„Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆ„Çø„Éº„É≥„Å´ÁßªË°å
    setTimeout(() => {
      // „Ç≤„Éº„É†„ÅåÊó¢„Å´ÁµÇ‰∫Ü„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
      if (state.gameOver) {
        return;
      }
      
      // ÈÅ∏ÊäûÁä∂ÊÖã„Çí„ÇØ„É™„Ç¢
      state.selected = null;
      state.validMoves = [];
      state.dropMode = false;
      state.selectedPiece = null;
      
      // „Çπ„Ç≠„É´‰ΩøÁî®‰∏≠„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„Éà
      state.bookSkillActive = false;
      
      state.currentPlayer = 'computer';
      setStatus('Êïµ„ÅÆÊâãÁï™‚Ä¶', 'playing');
      render();
      console.log('üìö Êõ∏„ÅÆ„Çπ„Ç≠„É´‰ΩøÁî®ÂÆå‰∫Ü„ÄÅ„Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆ„Çø„Éº„É≥„Å´ÁßªË°å');
      setTimeout(computerTurn, 100);
    }, 1000);
    
    // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
    render();
  }

  // Â∞Å„ÅÆ„Çπ„Ç≠„É´: Êñú„ÇÅ4„Éû„Çπ„Å´„ÅÑ„ÇãÊïµÈßí„ÅÆÁâπÊÆäËÉΩÂäõ„ÇÑ„Çπ„Ç≠„É´„ÅÆÁô∫Âãï„ÇíÁÑ°ÂäπÂåñ
  function activateSealSkill(row, col) {
    const piece = state.board[row][col];
    if (!piece || piece.piece !== 'Â∞Å' || piece.owner !== 'player') return;
    
    // „Çπ„Ç≠„É´‰ΩøÁî®ÂõûÊï∞Âà∂ÈôêÔºà1„Çø„Éº„É≥„Å´1ÂõûÔºâ
    if (piece.sealSkillUsed) {
      setStatus('Â∞Å„ÅÆ„Çπ„Ç≠„É´„ÅØ1„Çø„Éº„É≥„Å´1Âõû„Åó„Åã‰ΩøÁî®„Åß„Åç„Åæ„Åõ„Çì', 'warning');
      return;
    }
    
    // Êñú„ÇÅ4„Éû„Çπ„Å´ÊïµÈßí„Åå„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    const diagonalPieces = [];
    const directions = [[-1,-1],[-1,1],[1,-1],[1,1]];
    for (const [dr, dc] of directions) {
      const nr = row + dr;
      const nc = col + dc;
      if (valid(nr, nc) && state.board[nr][nc] && state.board[nr][nc] !== '' && state.board[nr][nc].owner !== piece.owner) {
        diagonalPieces.push(state.board[nr][nc]);
      }
    }
    
    if (diagonalPieces.length === 0) {
      setStatus('Êñú„ÇÅ4„Éû„Çπ„Å´ÊïµÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÂ∞Å„ÅÆ„Çπ„Ç≠„É´„ÅØ‰ΩøÁî®„Åß„Åç„Åæ„Åõ„Çì„ÄÇ', 'warning');
      return;
    }
    
    // „Çπ„Ç≠„É´‰ΩøÁî®‰∏≠„Éï„É©„Ç∞„ÇíË®≠ÂÆö
    state.sealSkillActive = true;
    
    // Êñú„ÇÅ4„Éû„Çπ„ÅÆÊïµÈßí„ÅÆÁâπÊÆäËÉΩÂäõ„ÇÑ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
    piece.sealSkillUsed = true;
    const sealedPieces = [];
    
    for (const diagonalPiece of diagonalPieces) {
      // ÁâπÊÆäËÉΩÂäõ„ÇÑ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
      diagonalPiece.sealed = true;
      diagonalPiece.sealSkillDisabled = true;
      diagonalPiece.timeSkillUsed = true; // ÊôÇ„ÅÆ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
      diagonalPiece.bookSkillUsed = true; // Êõ∏„ÅÆ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
      diagonalPiece.iceSkillUsed = true; // Ê∞∑„ÅÆ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
      diagonalPiece.snowSkillUsed = true; // Èõ™„ÅÆ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
      diagonalPiece.sandSkillUsed = true; // Á†Ç„ÅÆ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
      diagonalPiece.windSkillUsed = true; // È¢®„ÅÆ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
      diagonalPiece.mossSkillUsed = true; // Ëãî„ÅÆ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
      diagonalPiece.fieldSkillUsed = true; // Áïë„ÅÆ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
      diagonalPiece.houseSkillUsed = true; // ÂÆ∂„ÅÆ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ
      sealedPieces.push(diagonalPiece);
    }
    
    if (sealedPieces.length > 0) {
      const pieceNames = sealedPieces.map(p => p.piece).join('„ÄÅ');
      setStatus(`Â∞Å„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÊñú„ÇÅ4„Éû„Çπ„ÅÆÊïµÈßí(${pieceNames})„ÅÆÁâπÊÆäËÉΩÂäõ„ÇÑ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ„Åó„Åæ„Åó„Åü`, 'success');
    }
    
    // „Çπ„Ç≠„É´‰ΩøÁî®ÂõûÊï∞„Çí„É™„Çª„ÉÉ„Éà„Åô„Çã„Çø„Ç§„Éû„Éº„ÇíË®≠ÂÆö
    setTimeout(() => {
      piece.sealSkillUsed = false;
      // Â∞ÅÂç∞ÂäπÊûú„ÇíËß£Èô§
      for (const sealedPiece of sealedPieces) {
        sealedPiece.sealed = false;
        sealedPiece.sealSkillDisabled = false;
        sealedPiece.timeSkillUsed = false;
        sealedPiece.bookSkillUsed = false;
        sealedPiece.iceSkillUsed = false;
        sealedPiece.snowSkillUsed = false;
        sealedPiece.sandSkillUsed = false;
        sealedPiece.windSkillUsed = false;
        sealedPiece.mossSkillUsed = false;
        sealedPiece.fieldSkillUsed = false;
        sealedPiece.houseSkillUsed = false;
      }
    }, 1000);
    
    console.log(`üîí Â∞Å„ÅÆ„Çπ„Ç≠„É´„Åß${sealedPieces.length}ÂÄã„ÅÆÊïµÈßí„ÅÆÁâπÊÆäËÉΩÂäõ„ÇÑ„Çπ„Ç≠„É´„ÇíÁÑ°ÂäπÂåñ„Åó„Åæ„Åó„Åü`);
    
    // „Çπ„Ç≠„É´‰ΩøÁî®Âæå„ÄÅ„Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆ„Çø„Éº„É≥„Å´ÁßªË°å
    setTimeout(() => {
      // ÈÅ∏ÊäûÁä∂ÊÖã„Çí„ÇØ„É™„Ç¢
      state.selected = null;
      state.validMoves = [];
      state.dropMode = false;
      state.selectedPiece = null;
      
      // „Çπ„Ç≠„É´‰ΩøÁî®‰∏≠„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„Éà
      state.sealSkillActive = false;
      
      state.currentPlayer = 'computer';
      setStatus('Êïµ„ÅÆÊâãÁï™‚Ä¶', 'playing');
      render();
      setTimeout(computerTurn, 100);
    }, 1000);
    
    // „Éú„Éº„Éâ„ÇíÂÜçÊèèÁîª
    render();
  }

  // Ê∞∑„ÅÆÁßªÂãïÔºàÊ∞∑„ÅÆÂüéÔºâ
  function iceMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // 8ÊñπÂêë„Å´1„Éû„ÇπÁßªÂãïÂèØËÉΩ
    const directions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    directions.forEach(([dr,dc]) => pushIfEnemyOrEmpty(m, row+dr, col+dc, o));
    return m;
  }

  // Èõ™„ÅÆÁßªÂãïÔºàÊ∞∑„ÅÆÂüéÔºâ
  function snowMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    
    // „Éó„É¨„Ç§„É§„Éº„Å®„Ç≥„É≥„Éî„É•„Éº„Çø„ÅßÂâç„ÅÆÊñπÂêë„ÅåÁï∞„Å™„Çã
    if (o === 'player') {
      // „Éó„É¨„Ç§„É§„Éº: Ââç„Å´„ÅÑ„Åè„Çâ„Åß„ÇÇ„ÄÅÊñú„ÇÅÂâç„Å´„ÅÑ„Åè„Çâ„Åß„ÇÇ„ÄÅÊ®™„Å´„ÅÑ„Åè„Çâ„Åß„ÇÇ
      [[-1,0],[-1,-1],[-1,1],[0,-1],[0,1]].forEach(d => slide(m, row, col, o, d[0], d[1]));
    } else {
      // „Ç≥„É≥„Éî„É•„Éº„Çø: Ââç„Å´„ÅÑ„Åè„Çâ„Åß„ÇÇ„ÄÅÊñú„ÇÅÂâç„Å´„ÅÑ„Åè„Çâ„Åß„ÇÇ„ÄÅÊ®™„Å´„ÅÑ„Åè„Çâ„Åß„ÇÇ
      [[1,0],[1,-1],[1,1],[0,-1],[0,1]].forEach(d => slide(m, row, col, o, d[0], d[1]));
    }
    
    return m;
  }

  // Á†Ç„ÅÆÁßªÂãïÔºàÁ†ÇÊº†„ÅÆÈÅ∫Ë∑°Ôºâ
  function sandMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // ÂâçÊñπ1„Éû„Çπ„ÅÆ„ÅøÁßªÂãïÂèØËÉΩ
    const forwardDirection = o === 'player' ? -1 : 1; // „Éó„É¨„Ç§„É§„Éº„ÅØ‰∏ä„ÄÅ„Ç≥„É≥„Éî„É•„Éº„Çø„ÅØ‰∏ã
    
    const newRow = row + forwardDirection;
    if (newRow >= 0 && newRow < BOARD_SIZE) {
      if (!state.board[newRow][col] || state.board[newRow][col].piece === 'X') {
        // ÂâçÊñπ„ÅåÁ©∫„ÅÑ„Å¶„ÅÑ„Çã„Åã„ÄåX„Äç„Éû„Çπ„ÅÆÂ†¥Âêà„ÄÅÁßªÂãïÂèØËÉΩ
        m.push({r: newRow, c: col});
      } else if (state.board[newRow][col].owner !== o) {
        // ÂâçÊñπ„Å´ÊïµÈßí„Åå„ÅÇ„ÇãÂ†¥Âêà„ÄÅÁßªÂãïÂèØËÉΩÔºàÁéãÊâãÂà§ÂÆö„ÅÆ„Åü„ÇÅÔºâ
        m.push({r: newRow, c: col});
      }
    }
    
    return m;
  }

  // Á†Ç„ÅÆÈÄ£ÂãïÁßªÂãïÂá¶ÁêÜ
  function triggerSandChainMove(fromRow, fromCol, toRow, toCol) {
    console.log('üèúÔ∏è Á†Ç„ÅÆÈÄ£ÂãïÁßªÂãïÂá¶ÁêÜÈñãÂßã:', {fromRow, fromCol, toRow, toCol});
    
    // ÁßªÂãïÂâç„ÅÆ‰ΩçÁΩÆ„ÅÆÈßí„ÇíÁ¢∫Ë™ç
    const piece = state.board[toRow][toCol];
    if (!piece || piece.piece !== 'Á†Ç') {
      console.log('üèúÔ∏è ÁßªÂãïÂÖà„Å´Á†Ç„ÅÆÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
      return;
    }
    
    const owner = piece.owner;
    const forwardDirection = owner === 'player' ? -1 : 1; // „Éó„É¨„Ç§„É§„Éº„ÅØ‰∏ä„ÄÅ„Ç≥„É≥„Éî„É•„Éº„Çø„ÅØ‰∏ã
    
    console.log('üèúÔ∏è Á†Ç„ÅÆÈßí„ÅÆÊâÄÊúâËÄÖ:', owner, 'ÂâçÊñπÂêë:', forwardDirection);
    
    // Ââç„Å´ÁßªÂãï„Åó„Åü„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÁ∏¶ÊñπÂêë„ÅÆ„Åø„ÄÅÊ®™ÊñπÂêë„ÅÆÁßªÂãï„ÅØÈÄ£Âãï„Åó„Å™„ÅÑÔºâ
    if (toRow === fromRow + forwardDirection && toCol === fromCol) {
      console.log('üèúÔ∏è Á†Ç„ÅÆÈßí„ÅåÂâçÊñπ„Å´ÁßªÂãï„Åó„Åæ„Åó„Åü„ÄÇÈÄ£ÂãïÁßªÂãï„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Åæ„Åô...');
      
      // ÁßªÂãïÂâç„ÅÆ‰ΩçÁΩÆÔºàÂÖÉ„ÅÆ‰ΩçÁΩÆÔºâ„Åß‰∏°Èö£„ÅÆ„ÄåÁ†Ç„ÄçÈßí„ÇíÊé¢„Åô
      const leftSand = fromCol > 0 ? state.board[fromRow][fromCol - 1] : null;
      const rightSand = fromCol < BOARD_SIZE - 1 ? state.board[fromRow][fromCol + 1] : null;
      
      console.log('üèúÔ∏è Â∑¶Èö£„ÅÆÈßí:', leftSand);
      console.log('üèúÔ∏è Âè≥Èö£„ÅÆÈßí:', rightSand);
      
      let chainMoveCount = 0; // ÈÄ£ÂãïÁßªÂãï„Åó„ÅüÈßí„ÅÆÊï∞„Çí„Ç´„Ç¶„É≥„Éà
      
      // Â∑¶Èö£„ÅÆ„ÄåÁ†Ç„ÄçÈßí„Çí1„Éû„ÇπÂâç„Å´ÁßªÂãï
      if (leftSand && leftSand.piece === 'Á†Ç' && leftSand.owner === owner) {
        console.log('üèúÔ∏è Â∑¶Èö£„Å´Á†Ç„ÅÆÈßí„ÇíÁô∫Ë¶ã„ÄÇÈÄ£ÂãïÁßªÂãï„ÇíË©¶Ë°å...');
        const leftTargetRow = fromRow + forwardDirection;
        if (leftTargetRow >= 0 && leftTargetRow < BOARD_SIZE) {
          const leftTarget = state.board[leftTargetRow][fromCol - 1];
          if (!leftTarget || leftTarget.piece === 'X') {
            // ÁßªÂãïÂèØËÉΩ„Å™Â†¥Âêà„ÄÅÁßªÂãï„ÇíÂÆüË°å
            state.board[leftTargetRow][fromCol - 1] = leftSand;
            state.board[fromRow][fromCol - 1] = null;
            chainMoveCount++;
            
            console.log('üèúÔ∏è Â∑¶Èö£„ÅÆÁ†Ç„ÅÆÈßí„ÅåÈÄ£ÂãïÁßªÂãï„Åó„Åæ„Åó„Åü:', {fromRow, fromCol: fromCol - 1, toRow: leftTargetRow, toCol: fromCol - 1});
          } else {
            console.log('üèúÔ∏è Â∑¶Èö£„ÅÆÁ†Ç„ÅÆÈßí„ÅÆÁßªÂãïÂÖà„ÅåÂ°û„Åå„Å£„Å¶„ÅÑ„Åæ„Åô');
          }
        }
      }
      
      // Âè≥Èö£„ÅÆ„ÄåÁ†Ç„ÄçÈßí„Çí1„Éû„ÇπÂâç„Å´ÁßªÂãï
      if (rightSand && rightSand.piece === 'Á†Ç' && rightSand.owner === owner) {
        console.log('üèúÔ∏è Âè≥Èö£„Å´Á†Ç„ÅÆÈßí„ÇíÁô∫Ë¶ã„ÄÇÈÄ£ÂãïÁßªÂãï„ÇíË©¶Ë°å...');
        const rightTargetRow = fromRow + forwardDirection;
        if (rightTargetRow >= 0 && rightTargetRow < BOARD_SIZE) {
          const rightTarget = state.board[rightTargetRow][fromCol + 1];
          if (!rightTarget || rightTarget.piece === 'X') {
            // ÁßªÂãïÂèØËÉΩ„Å™Â†¥Âêà„ÄÅÁßªÂãï„ÇíÂÆüË°å
            state.board[rightTargetRow][fromCol + 1] = rightSand;
            state.board[fromRow][fromCol + 1] = null;
            chainMoveCount++;
            
            console.log('üèúÔ∏è Âè≥Èö£„ÅÆÁ†Ç„ÅÆÈßí„ÅåÈÄ£ÂãïÁßªÂãï„Åó„Åæ„Åó„Åü:', {fromRow, fromCol: fromCol + 1, toRow: rightTargetRow, toCol: fromCol + 1});
          } else {
            console.log('üèúÔ∏è Âè≥Èö£„ÅÆÁ†Ç„ÅÆÈßí„ÅÆÁßªÂãïÂÖà„ÅåÂ°û„Åå„Å£„Å¶„ÅÑ„Åæ„Åô');
          }
        }
      }
      
      // ÈÄ£ÂãïÁßªÂãï„ÅÆÁµêÊûú„ÇíË°®Á§∫
      if (chainMoveCount > 0) {
        setStatus(`Á†Ç„ÅÆÈÄ£ÂãïÁßªÂãïÔºÅ${chainMoveCount}ÂÄã„ÅÆÁ†Ç„ÅÆÈßí„ÅåÈÄ£Âãï„Åó„Åæ„Åó„Åü`, 'playing');
        console.log(`üèúÔ∏è ÂêàË®à${chainMoveCount}ÂÄã„ÅÆÁ†Ç„ÅÆÈßí„ÅåÈÄ£ÂãïÁßªÂãï„Åó„Åæ„Åó„Åü`);
      } else {
        console.log('üèúÔ∏è ÈÄ£ÂãïÁßªÂãï„Åß„Åç„ÇãÁ†Ç„ÅÆÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
      }
    } else {
      console.log('üèúÔ∏è ÂâçÊñπÁßªÂãï„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÈÄ£ÂãïÁßªÂãï„Åó„Åæ„Åõ„Çì:', {toRow, fromRow: fromRow + forwardDirection, toCol, fromCol});
    }
  }

  // Á†Ç„ÅÆÈÄ£ÂãïÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà
  function showSandChainMoveEffect(fromRow, fromCol, toRow, toCol) {
    const fromCell = document.querySelector(`[data-row="${fromRow}"][data-col="${fromCol}"]`);
    const toCell = document.querySelector(`[data-row="${toRow}"][data-col="${fromCol}"]`);
    
    if (fromCell && toCell) {
      // ÈÄ£ÂãïÁßªÂãï„ÅÆË¶ñË¶öÁöÑ„Ç®„Éï„Çß„ÇØ„Éà
      fromCell.style.animation = 'sandChainMoveEffect 0.8s ease-in-out';
      toCell.style.animation = 'sandChainMoveEffect 0.8s ease-in-out';
      
      // ÈÄ£ÂãïÁßªÂãï„Éû„Éº„ÇØ„ÇíËøΩÂä†
      const chainMark = document.createElement('div');
      chainMark.className = 'sand-chain-mark';
      chainMark.textContent = 'üèúÔ∏è';
      chainMark.style.cssText = `
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 20px;
        color: #8B4513;
        z-index: 10;
        pointer-events: none;
        animation: sandChainMovePulse 0.8s ease-in-out;
      `;
      
      toCell.appendChild(chainMark);
      
      // ÈÄ£ÂãïÁßªÂãï„ÅÆË™¨Êòé„ÉÜ„Ç≠„Çπ„Éà„ÇíËøΩÂä†
      const chainText = document.createElement('div');
      chainText.className = 'sand-chain-text';
      chainText.textContent = 'ÈÄ£ÂãïÁßªÂãï';
      chainText.style.cssText = `
        position: absolute;
        top: 20%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 12px;
        color: #8B4513;
        background: rgba(210, 180, 140, 0.9);
        padding: 2px 6px;
        border-radius: 4px;
        z-index: 15;
        pointer-events: none;
        font-weight: bold;
        animation: sandChainTextFade 1.5s ease-in-out;
      `;
      
      toCell.appendChild(chainText);
      
      // 1.5ÁßíÂæå„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂâäÈô§
      setTimeout(() => {
        if (chainMark.parentNode) {
          chainMark.parentNode.removeChild(chainMark);
        }
        if (chainText.parentNode) {
          chainText.parentNode.removeChild(chainText);
        }
        fromCell.style.animation = '';
        toCell.style.animation = '';
      }, 1500);
    }
  }

  // È¢®„ÅÆÁßªÂãïÔºàÁ†ÇÊº†„ÅÆÈÅ∫Ë∑°Ôºâ
  function windMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Á∏¶Ê®™„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÁßªÂãïÂèØËÉΩÔºàÈ£õËªä„Å®Âêå„ÅòÔºâ
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => slide(m, row, col, o, d[0], d[1]));
    return m;
  }

  // È¢®„ÅÆ„Çπ„Ç≠„É´ÔºöÂë®Âõ≤„ÅÆÊïµÈßí„ÇíÊäº„ÅóÊµÅ„Åô
  function triggerWindSkill(fromRow, fromCol, toRow, toCol) {
    const piece = state.board[toRow][toCol];
    if (!piece || piece.piece !== 'È¢®') return;
    
    const owner = piece.owner;
    const enemyOwner = owner === 'player' ? 'computer' : 'player';
    
    console.log('üí® È¢®„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÂë®Âõ≤„ÅÆÊïµÈßí„ÇíÊäº„ÅóÊµÅ„Åó„Åæ„Åô...');
    
    // ÁßªÂãïÂÖà„ÅÆÂë®Âõ≤8ÊñπÂêë„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    const directions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    let pushedCount = 0;
    
    for (const [dr, dc] of directions) {
      const checkRow = toRow + dr;
      const checkCol = toCol + dc;
      
      // Áõ§Èù¢ÂÜÖ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
      if (checkRow >= 0 && checkRow < BOARD_SIZE && checkCol >= 0 && checkCol < BOARD_SIZE) {
        const targetPiece = state.board[checkRow][checkCol];
        
        // ÊïµÈßí„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºà„ÄåX„Äç„Éû„Çπ„ÅØÈô§Â§ñÔºâ
        if (targetPiece && targetPiece.owner === enemyOwner && targetPiece.piece !== 'X') {
          // Êäº„ÅóÊµÅ„ÅôÊñπÂêë„ÇíË®àÁÆóÔºàÈ¢®„ÅÆÈßí„Åã„ÇâÈõ¢„Çå„ÇãÊñπÂêëÔºâ
          const pushRow = checkRow + dr;
          const pushCol = checkCol + dc;
          
          // Êäº„ÅóÊµÅ„ÅóÂÖà„ÅåÁõ§Èù¢ÂÜÖ„Åß„ÄÅÁ©∫„ÅÑ„Å¶„ÅÑ„Çã„Åã„ÄåX„Äç„Éû„Çπ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
          if (pushRow >= 0 && pushRow < BOARD_SIZE && pushCol >= 0 && pushCol < BOARD_SIZE) {
            const pushTarget = state.board[pushRow][pushCol];
            
            if (!pushTarget || pushTarget.piece === 'X') {
              // Êäº„ÅóÊµÅ„Åó„ÇíÂÆüË°å
              state.board[pushRow][pushCol] = targetPiece;
              state.board[checkRow][checkCol] = null;
              pushedCount++;
              
              // Êäº„ÅóÊµÅ„Åó„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
              showWindPushEffect(checkRow, checkCol, pushRow, pushCol);
              
              console.log(`üí® ÊïµÈßí„Äå${targetPiece.piece}„Äç„ÇíÊäº„ÅóÊµÅ„Åó„Åæ„Åó„Åü: (${checkRow},${checkCol}) ‚Üí (${pushRow},${pushCol})`);
            }
          }
        }
      }
    }
    
    // „Çπ„Ç≠„É´Áô∫Âãï„ÅÆÁµêÊûú„ÇíË°®Á§∫
    if (pushedCount > 0) {
      setStatus(`È¢®„ÅÆ„Çπ„Ç≠„É´ÔºÅ${pushedCount}ÂÄã„ÅÆÊïµÈßí„ÇíÊäº„ÅóÊµÅ„Åó„Åæ„Åó„Åü`, 'playing');
      console.log(`üí® ÂêàË®à${pushedCount}ÂÄã„ÅÆÊïµÈßí„ÇíÊäº„ÅóÊµÅ„Åó„Åæ„Åó„Åü`);
    } else {
      console.log('üí® Êäº„ÅóÊµÅ„Åõ„ÇãÊïµÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
    }
  }

  // Ê≥â„ÅÆ„Çπ„Ç≠„É´ÔºöÁßªÂãïÊôÇ„Å´„É©„É≥„ÉÄ„É†„Å™Âë≥Êñπ1„Å§„ÇíÂº∑Âåñ
  // ÂàÄ„ÅÆ„Çπ„Ç≠„É´: Áõ∏ÊâãÈßí„ÇíÂèñ„Å£„ÅüÊôÇ„ÄÅ„Åù„ÅÆ‰∏°Èö£„ÅÆÈßí„ÇÇ„Åæ„Å®„ÇÅ„Å¶Âèñ„Çã
  function triggerSwordSkill(row, col, owner) {
    console.log('‚öîÔ∏è ÂàÄ„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ‰∏°Èö£„ÅÆÈßí„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Åæ„Åô...');
    
    const capturedPieces = [];
    
    // Â∑¶Èö£„ÅÆÈßí„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    if (inBounds(row, col - 1)) {
      const leftPiece = state.board[row][col - 1];
      if (leftPiece && leftPiece.owner !== owner && leftPiece.piece !== 'X') {
        console.log(`‚öîÔ∏è Â∑¶Èö£„ÅÆÊïµÈßí ${leftPiece.piece} „ÇíÁô∫Ë¶ãÔºÅ`);
        capturedPieces.push({r: row, c: col - 1, piece: leftPiece});
      }
    }
    
    // Âè≥Èö£„ÅÆÈßí„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    if (inBounds(row, col + 1)) {
      const rightPiece = state.board[row][col + 1];
      if (rightPiece && rightPiece.owner !== owner && rightPiece.piece !== 'X') {
        console.log(`‚öîÔ∏è Âè≥Èö£„ÅÆÊïµÈßí ${rightPiece.piece} „ÇíÁô∫Ë¶ãÔºÅ`);
        capturedPieces.push({r: row, c: col + 1, piece: rightPiece});
      }
    }
    
    if (capturedPieces.length === 0) {
      console.log('‚öîÔ∏è ‰∏°Èö£„Å´ÊïµÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
      setStatus('ÂàÄ„ÅÆÊñ¨ÊíÉÔºö‰∏°Èö£„Å´ÊïµÈßí„Å™„Åó', 'info');
      return;
    }
    
    // ‰∏°Èö£„ÅÆÈßí„ÇíÂèñ„Çã
    capturedPieces.forEach(({r, c, piece}) => {
      console.log(`‚öîÔ∏è ${piece.piece} „ÇíÂèñ„Çä„Åæ„ÅôÔºÅ‰ΩçÁΩÆ: (${r}, ${c})`);
      
      // Èßí„ÇíÊâãÈßí„Å´ËøΩÂä†ÔºàÁâπÊÆäÈßí„Å®Èúä„ÅØÈô§Â§ñÔºâ
      if (piece.piece !== 'n' && piece.piece !== 'X' && piece.piece !== 'Èúä' && !['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(piece.piece)) {
        // Ëæ∞„ÅåÂèñ„Çâ„Çå„ÅüÂ†¥Âêà„ÅØÁ´ú„Å®„Åó„Å¶ÊåÅ„Å°Èßí„Å´ËøΩÂä†
        const pieceToAdd = piece.piece === 'Ëæ∞' ? 'Á´ú' : piece.piece;
        if (owner === 'player') {
          state.hands.player.push(pieceToAdd);
        } else {
          state.hands.computer.push(pieceToAdd);
        }
        console.log(`‚öîÔ∏è ${pieceToAdd} „ÇíÊâãÈßí„Å´ËøΩÂä†„Åó„Åæ„Åó„Åü`);
      }
      
      // Èßí„ÇíÁõ§Èù¢„Åã„ÇâÂâäÈô§
      state.board[r][c] = null;
    });
    
    setStatus(`ÂàÄ„ÅÆÊñ¨ÊíÉÔºÅ${capturedPieces.length}„Å§„ÅÆÊïµÈßí„ÇíÂèñ„Çä„Åæ„Åó„Åü`, 'success');
    console.log(`‚öîÔ∏è ÂàÄ„ÅÆ„Çπ„Ç≠„É´ÂÆå‰∫ÜÔºö${capturedPieces.length}„Å§„ÅÆÊïµÈßí„ÇíÂèñ„Çä„Åæ„Åó„Åü`);
  }

  // ÈäÉ„ÅÆË≤´ÈÄöÂäπÊûú: ÁßªÂãïÊñπÂêë„ÅÆÈÄ£Á∂ö„Åó„ÅüÊïµÈßí„ÇíË≤´ÈÄö„Åó„Å¶Âèñ„Çã
  function triggerGunPenetrationSkill(fromRow, fromCol, toRow, toCol, owner) {
    console.log('üî´ ÈäÉ„ÅÆË≤´ÈÄöÂäπÊûúÁô∫ÂãïÔºÅÁßªÂãïÊñπÂêë„ÅÆÈÄ£Á∂ö„Åó„ÅüÊïµÈßí„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Åæ„Åô...');
    
    // ÁßªÂãïÊñπÂêë„ÇíË®àÁÆó
    const deltaRow = toRow - fromRow;
    const deltaCol = toCol - fromCol;
    
    console.log(`üî´ ÁßªÂãïÊñπÂêë: (${deltaRow}, ${deltaCol})`);
    
    // ÁßªÂãïÊñπÂêë„Å´Ê≤ø„Å£„Å¶„ÄÅÁõÆÊ®ô‰ΩçÁΩÆ„ÇíË∂Ö„Åà„Å¶„Åï„Çâ„Å´ÊïµÈßí„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    let currentRow = toRow;
    let currentCol = toCol;
    const capturedPieces = [];
    
    // ÁõÆÊ®ô‰ΩçÁΩÆ„ÅÆÈßí„ÇíÊúÄÂàù„Å´ËøΩÂä†ÔºàÊó¢„Å´Âèñ„Çâ„Çå„Å¶„ÅÑ„ÇãÔºâ
    const targetPiece = state.board[toRow][toCol];
    if (targetPiece && targetPiece.owner !== owner) {
      capturedPieces.push({r: toRow, c: toCol, piece: targetPiece});
    }
    
    // ÁßªÂãïÊñπÂêë„Å´„Åï„Çâ„Å´ÈÄ≤„Çì„ÅßÊïµÈßí„ÇíÊé¢„Åô
    for (let i = 1; i <= 2; i++) {
      currentRow += deltaRow;
      currentCol += deltaCol;
      
      if (inBounds(currentRow, currentCol)) {
        const piece = state.board[currentRow][currentCol];
        if (piece && piece.owner !== owner && piece.piece !== 'X') {
          console.log(`üî´ Ë≤´ÈÄö„ÅßÁô∫Ë¶ã„Åó„ÅüÊïµÈßí ${piece.piece} ‰ΩçÁΩÆ: (${currentRow}, ${currentCol})`);
          capturedPieces.push({r: currentRow, c: currentCol, piece: piece});
        } else {
          // Á©∫„Åç„Éû„Çπ„Åæ„Åü„ÅØÂë≥ÊñπÈßí„ÅßÊ≠¢„Åæ„Çã
          break;
        }
      } else {
        // Áõ§Â§ñ„ÅßÊ≠¢„Åæ„Çã
        break;
      }
    }
    
    if (capturedPieces.length <= 1) {
      console.log('üî´ Ë≤´ÈÄö„Åß„Åç„ÇãÊïµÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
      setStatus('ÈäÉ„ÅÆË≤´ÈÄöÔºöËøΩÂä†„ÅÆÊïµÈßí„Å™„Åó', 'info');
      return;
    }
    
    // Ë≤´ÈÄö„ÅßÂèñ„Å£„ÅüËøΩÂä†„ÅÆÈßí„ÇíÊâãÈßí„Å´ËøΩÂä†
    capturedPieces.slice(1).forEach(({r, c, piece}) => {
      console.log(`üî´ Ë≤´ÈÄö„Åß ${piece.piece} „ÇíÂèñ„Çä„Åæ„ÅôÔºÅ‰ΩçÁΩÆ: (${r}, ${c})`);
      
      // Èßí„ÇíÊâãÈßí„Å´ËøΩÂä†ÔºàÁâπÊÆäÈßí„Å®Èúä„ÅØÈô§Â§ñÔºâ
      if (piece.piece !== 'n' && piece.piece !== 'X' && piece.piece !== 'Èúä' && !['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(piece.piece)) {
        // Ëæ∞„ÅåÂèñ„Çâ„Çå„ÅüÂ†¥Âêà„ÅØÁ´ú„Å®„Åó„Å¶ÊåÅ„Å°Èßí„Å´ËøΩÂä†
        const pieceToAdd = piece.piece === 'Ëæ∞' ? 'Á´ú' : piece.piece;
        if (owner === 'player') {
          state.hands.player.push(pieceToAdd);
        } else {
          state.hands.computer.push(pieceToAdd);
        }
        console.log(`üî´ ${pieceToAdd} „ÇíÊâãÈßí„Å´ËøΩÂä†„Åó„Åæ„Åó„Åü`);
      }
      
      // Èßí„ÇíÁõ§Èù¢„Åã„ÇâÂâäÈô§
      state.board[r][c] = null;
    });
    
    setStatus(`ÈäÉ„ÅÆË≤´ÈÄöÔºÅ${capturedPieces.length}„Å§„ÅÆÊïµÈßí„ÇíÂèñ„Çä„Åæ„Åó„Åü`, 'success');
    console.log(`üî´ ÈäÉ„ÅÆË≤´ÈÄöÂäπÊûúÂÆå‰∫ÜÔºö${capturedPieces.length}„Å§„ÅÆÊïµÈßí„ÇíÂèñ„Çä„Åæ„Åó„Åü`);
  }

  // ÁÅ´„ÅÆÁáÉÁÑºÂäπÊûú: 20%„ÅÆÁ¢∫Áéá„ÅßÁõ∏Êâã„ÅÆÊâãÊåÅ„Å°Èßí„Çí„É©„É≥„ÉÄ„É†„Å´1„Å§ÁáÉ„ÇÑ„Åó„Å¶Ê∂àÊªÖ„Åï„Åõ„Çã
  function triggerFireBurnSkill(owner) {
    console.log('üî• ÁÅ´„ÅÆÁáÉÁÑºÂäπÊûúÁô∫ÂãïÔºÅÁõ∏Êâã„ÅÆÊâãÊåÅ„Å°Èßí„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Åæ„Åô...');
    
    // Áõ∏Êâã„ÅÆ„Éó„É¨„Ç§„É§„Éº„ÇíÁâπÂÆö
    const opponent = owner === 'player' ? 'computer' : 'player';
    const opponentHands = state.hands[opponent];
    
    // Áõ∏Êâã„ÅÆÊâãÊåÅ„Å°Èßí„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
    if (opponentHands.length === 0) {
      console.log('üî• Áõ∏Êâã„ÅÆÊâãÊåÅ„Å°Èßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
      return;
    }
    
    // 20%„ÅÆÁ¢∫Áéá„ÅßÁô∫Âãï
    if (Math.random() < 0.2) {
      // „É©„É≥„ÉÄ„É†„Å´1„Å§„ÅÆÈßí„ÇíÈÅ∏Êäû
      const randomIndex = Math.floor(Math.random() * opponentHands.length);
      const burnedPiece = opponentHands[randomIndex];
      
      // ÊâãÊåÅ„Å°Èßí„Åã„ÇâÂâäÈô§
      opponentHands.splice(randomIndex, 1);
      
      console.log(`üî• Áõ∏Êâã„ÅÆÊâãÊåÅ„Å°Èßí„Äå${burnedPiece}„Äç„ÇíÁáÉ„ÇÑ„Åó„Å¶Ê∂àÊªÖ„Åï„Åõ„Åæ„Åó„ÅüÔºÅ`);
      setStatus(`ÁÅ´„ÅÆÁáÉÁÑºÂäπÊûúÔºÅÁõ∏Êâã„ÅÆ„Äå${burnedPiece}„Äç„ÇíÁáÉ„ÇÑ„Åó„Å¶Ê∂àÊªÖ„Åï„Åõ„Åæ„Åó„Åü`, 'success');
    } else {
      console.log('üî• ÁÅ´„ÅÆÁáÉÁÑºÂäπÊûú„ÅØÁô∫Âãï„Åó„Åæ„Åõ„Çì„Åß„Åó„ÅüÔºà80%„ÅÆÁ¢∫ÁéáÔºâ');
    }
  }

  function triggerSpringSkill(row, col, owner) {
    const piece = state.board[row][col];
    if (!piece || piece.piece !== 'Ê≥â') return;
    
    console.log('üíß Ê≥â„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ„É©„É≥„ÉÄ„É†„Å™Âë≥Êñπ„ÇíÂº∑Âåñ„Åó„Åæ„Åô...');
    
    // Âë≥Êñπ„ÅÆÈßí„ÇíÊé¢„ÅôÔºàÊ≥âËá™Ë∫´„ÅØÈô§Â§ñÔºâ
    const alliedPieces = [];
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const targetPiece = state.board[r][c];
        if (targetPiece && targetPiece.owner === owner && targetPiece.piece !== 'Ê≥â' && targetPiece.piece !== 'X') {
          alliedPieces.push({r, c, piece: targetPiece});
        }
      }
    }
    
    if (alliedPieces.length === 0) {
      console.log('üíß Âº∑Âåñ„Åß„Åç„ÇãÂë≥Êñπ„Åå„ÅÑ„Åæ„Åõ„Çì„Åß„Åó„Åü');
      setStatus('Ê≥â„ÅÆÂäõÔºöÂº∑Âåñ„Åß„Åç„ÇãÂë≥Êñπ„Åå„ÅÑ„Åæ„Åõ„Çì', 'info');
      return;
    }
    
    // „É©„É≥„ÉÄ„É†„Å´1„Å§ÈÅ∏Êäû
    const randomIndex = Math.floor(Math.random() * alliedPieces.length);
    const target = alliedPieces[randomIndex];
    
    // Âº∑ÂåñÂäπÊûú„ÇíÈÅ©Áî®Ôºà5„Çø„Éº„É≥ÊåÅÁ∂ö„ÄÅÂèñ„Çâ„Çå„Å™„ÅÑÂäπÊûúÔºâ
    state.board[target.r][target.c].springEnhanced = true;
    state.board[target.r][target.c].springEnhancedTurns = 5;
    
    console.log(`üíß Âë≥Êñπ„Äå${target.piece}„Äç„ÇíÂº∑Âåñ„Åó„Åæ„Åó„Åü: (${target.r},${target.c})`);
    console.log(`üíß Âº∑Âåñ„Éï„É©„Ç∞Á¢∫Ë™ç: springEnhanced=${state.board[target.r][target.c].springEnhanced}, turns=${state.board[target.r][target.c].springEnhancedTurns}`);
    setStatus(`Ê≥â„ÅÆÂäõÔºö${target.piece}„ÇíÂº∑Âåñ„Åó„Åæ„Åó„ÅüÔºà5„Çø„Éº„É≥ÊåÅÁ∂ö„ÄÅÂèñ„Çâ„Çå„Å™„ÅÑÂäπÊûúÔºâ`, 'success');
    
    // Âº∑Âåñ„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
    showSpringEnhanceEffect(target.r, target.c);
    
    // Áõ§Èù¢„ÇíÂÜçÊèèÁîª„Åó„Å¶Âº∑Âåñ„Åï„Çå„ÅüÈßí„ÅÆË¶ã„ÅüÁõÆ„ÇíÊõ¥Êñ∞
    render();
  }

  // Ê≥â„ÅÆÂº∑ÂåñÂäπÊûú„ÅÆ„Çø„Éº„É≥Êï∞„ÇíÊõ¥Êñ∞
  function updateSpringEnhancementTurns() {
    console.log('üíß Ê≥â„ÅÆÂº∑ÂåñÂäπÊûú„ÅÆ„Çø„Éº„É≥Êï∞„ÇíÊõ¥Êñ∞„Åó„Åæ„Åô...');
    
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.springEnhanced && piece.springEnhancedTurns > 0) {
          piece.springEnhancedTurns--;
          console.log(`üíß ${piece.piece}(${r},${c})„ÅÆÂº∑Âåñ„Çø„Éº„É≥: ${piece.springEnhancedTurns + 1} ‚Üí ${piece.springEnhancedTurns}`);
          
          if (piece.springEnhancedTurns <= 0) {
            piece.springEnhanced = false;
            delete piece.springEnhancedTurns;
            console.log(`üíß ${piece.piece}(${r},${c})„ÅÆÂº∑ÂåñÂäπÊûú„ÅåÁµÇ‰∫Ü„Åó„Åæ„Åó„Åü`);
          }
        }
      }
    }
  }

  // Ê≥â„ÅÆÂº∑Âåñ„Ç®„Éï„Çß„ÇØ„ÉàÔºàË∂ÖÊ¥æÊâãÁâàÔºâ
  function showSpringEnhanceEffect(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (!cell) return;
    
    // Ë§áÊï∞„ÅÆ„Ç®„Éï„Çß„ÇØ„ÉàË¶ÅÁ¥†„Çí‰ΩúÊàê
    for (let i = 0; i < 3; i++) {
      const effect = document.createElement('div');
      effect.className = 'spring-enhance-effect';
      effect.style.cssText = `
        position: absolute;
        top: ${-10 - i * 5}px;
        left: ${-10 - i * 5}px;
        right: ${-10 - i * 5}px;
        bottom: ${-10 - i * 5}px;
        background: 
          radial-gradient(circle at ${30 + i * 20}% ${30 + i * 20}%, rgba(0, 191, 255, ${0.6 - i * 0.1}) 0%, transparent 70%),
          radial-gradient(circle at ${70 - i * 20}% ${70 - i * 20}%, rgba(135, 206, 235, ${0.4 - i * 0.1}) 0%, transparent 50%);
        border: ${3 - i}px solid rgba(0, 191, 255, ${0.8 - i * 0.2});
        border-radius: 50%;
        pointer-events: none;
        z-index: ${10 + i};
        animation: springEnhancePulse ${1.5 + i * 0.5}s ease-in-out, springEnhanceRotate ${2 + i * 0.5}s linear;
        animation-delay: ${i * 0.2}s;
      `;
      
      cell.appendChild(effect);
      
      // „Ç®„Éï„Çß„ÇØ„Éà„ÇíÂâäÈô§
      setTimeout(() => {
        if (effect.parentNode) {
          effect.parentNode.removeChild(effect);
        }
      }, 2000 + i * 500);
    }
    
    // ËøΩÂä†„ÅÆ„Ç≠„É©„Ç≠„É©„Ç®„Éï„Çß„ÇØ„Éà
    for (let i = 0; i < 5; i++) {
      const sparkle = document.createElement('div');
      sparkle.style.cssText = `
        position: absolute;
        top: ${Math.random() * 100}%;
        left: ${Math.random() * 100}%;
        width: 8px;
        height: 8px;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.9) 0%, rgba(0, 191, 255, 0.6) 50%, transparent 100%);
        border-radius: 50%;
        pointer-events: none;
        z-index: 20;
        animation: springSparkleFloat 2s ease-out;
        animation-delay: ${i * 0.3}s;
      `;
      
      cell.appendChild(sparkle);
      
      setTimeout(() => {
        if (sparkle.parentNode) {
          sparkle.parentNode.removeChild(sparkle);
        }
      }, 2000);
    }
  }

  // È¢®„ÅÆÊäº„ÅóÊµÅ„Åó„Ç®„Éï„Çß„ÇØ„Éà
  function showWindPushEffect(fromRow, fromCol, toRow, toCol) {
    const fromCell = document.querySelector(`[data-row="${fromRow}"][data-col="${fromCol}"]`);
    const toCell = document.querySelector(`[data-row="${toRow}"][data-col="${toCol}"]`);
    
    if (fromCell && toCell) {
      // Êäº„ÅóÊµÅ„Åó„ÅÆË¶ñË¶öÁöÑ„Ç®„Éï„Çß„ÇØ„Éà
      fromCell.style.animation = 'windPushEffect 0.8s ease-in-out';
      toCell.style.animation = 'windPushEffect 0.8s ease-in-out';
      
      // È¢®„ÅÆ„Ç®„Éï„Çß„ÇØ„Éà„Éû„Éº„ÇØ„ÇíËøΩÂä†
      const windMark = document.createElement('div');
      windMark.className = 'wind-push-mark';
      windMark.textContent = 'üí®';
      windMark.style.cssText = `
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 20px;
        color: #87CEEB;
        z-index: 10;
        pointer-events: none;
        animation: windPushPulse 0.8s ease-in-out;
      `;
      
      toCell.appendChild(windMark);
      
      // Êäº„ÅóÊµÅ„Åó„ÅÆË™¨Êòé„ÉÜ„Ç≠„Çπ„Éà„ÇíËøΩÂä†
      const pushText = document.createElement('div');
      pushText.className = 'wind-push-text';
      pushText.textContent = 'Êäº„ÅóÊµÅ„Åó';
      pushText.style.cssText = `
        position: absolute;
        top: 20%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 12px;
        color: #87CEEB;
        background: rgba(135, 206, 235, 0.9);
        padding: 2px 6px;
        border-radius: 4px;
        z-index: 15;
        pointer-events: none;
        font-weight: bold;
        animation: windPushTextFade 1.5s ease-in-out;
      `;
      
      toCell.appendChild(pushText);
      
      // 1.5ÁßíÂæå„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂâäÈô§
      setTimeout(() => {
        if (windMark.parentNode) {
          windMark.parentNode.removeChild(windMark);
        }
        if (pushText.parentNode) {
          pushText.parentNode.removeChild(pushText);
        }
        fromCell.style.animation = '';
        toCell.style.animation = '';
      }, 1500);
    }
  }

  // È≠ö„ÅÆÊ≥≥„Åé„Ç®„Éï„Çß„ÇØ„Éà
  function showFishSwimEffect(fromRow, fromCol, toRow, toCol) {
    const fromCell = document.querySelector(`[data-row="${fromRow}"][data-col="${fromCol}"]`);
    const toCell = document.querySelector(`[data-row="${toRow}"][data-col="${toCol}"]`);
    
    if (fromCell && toCell) {
      // Ê≥≥„Åé„ÅÆË¶ñË¶öÁöÑ„Ç®„Éï„Çß„ÇØ„Éà
      fromCell.style.animation = 'fishSwim 0.8s ease-in-out';
      toCell.style.animation = 'fishSwim 0.8s ease-in-out';
      
      // È≠ö„ÅÆ„Ç®„Éï„Çß„ÇØ„Éà„Éû„Éº„ÇØ„ÇíËøΩÂä†
      const fishMark = document.createElement('div');
      fishMark.className = 'fish-swim-mark';
      fishMark.textContent = 'üêü';
      fishMark.style.cssText = `
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 20px;
        color: #4682B4;
        z-index: 10;
        pointer-events: none;
        animation: fishBubbleEffect 0.8s ease-in-out;
      `;
      
      toCell.appendChild(fishMark);
      
      // Ê≥≥„Åé„ÅÆË™¨Êòé„ÉÜ„Ç≠„Çπ„Éà„ÇíËøΩÂä†
      const swimText = document.createElement('div');
      swimText.className = 'fish-swim-text';
      swimText.textContent = 'Ê≥≥„Åé';
      swimText.style.cssText = `
        position: absolute;
        top: 20%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 12px;
        color: #4682B4;
        background: rgba(70, 130, 180, 0.9);
        padding: 2px 6px;
        border-radius: 4px;
        z-index: 15;
        pointer-events: none;
        font-weight: bold;
        animation: windPushTextFade 1.5s ease-in-out;
      `;
      
      toCell.appendChild(swimText);
      
      // 1.5ÁßíÂæå„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂâäÈô§
      setTimeout(() => {
        if (fishMark.parentNode) {
          fishMark.parentNode.removeChild(fishMark);
        }
        if (swimText.parentNode) {
          swimText.parentNode.removeChild(swimText);
        }
        fromCell.style.animation = '';
        toCell.style.animation = '';
      }, 1500);
    }
  }



  // Êµ∑„ÅÆÁßªÂãïÔºàÊµ∑Â∫ïÁ•ûÊÆøÔºâ
  function oceanMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // 8ÊñπÂêë„Å´2„Éû„Çπ„Åæ„ÅßÁßªÂãïÂèØËÉΩ
    const directions = [[-2,-2],[-2,-1],[-2,0],[-2,1],[-2,2],[-1,-2],[-1,-1],[-1,0],[-1,1],[-1,2],[0,-2],[0,-1],[0,1],[0,2],[1,-2],[1,-1],[1,0],[1,1],[1,2],[2,-2],[2,-1],[2,0],[2,1],[2,2]];
    
    for (const [dr, dc] of directions) {
      const newRow = row + dr;
      const newCol = col + dc;
      if (newRow >= 0 && newRow < BOARD_SIZE && newCol >= 0 && newCol < BOARD_SIZE) {
        // pushIfEnemyOrEmpty„Çí‰ΩøÁî®„Åó„Å¶Âë≥Êñπ„ÅÆÈßí„ÇíÈô§Â§ñ
        pushIfEnemyOrEmpty(m, newRow, newCol, o);
      }
    }
    return m;
  }

  // È≠ö„ÅÆÁßªÂãïÔºàÈáë„Å®Âêå„ÅòÂãï„ÅçÔºâ
  function fishMoves(row, col) {
    const o = state.board[row][col].owner;
    const f = o === 'player' ? -1 : 1;
    const m = [];
    // Èáë„Å®Âêå„ÅòÂãï„Åç: ÂâçÊñπ3ÊñπÂêë + Ê®™2ÊñπÂêë + ÂæåÊñπ1ÊñπÂêë
    [[f,-1],[f,0],[f,1],[0,-1],[0,1],[-f,0]].forEach(([dr,dc]) => {
      pushIfEnemyOrEmpty(m, row + dr, col + dc, o);
    });
    return m;
  }

  // Èõ≤„ÅÆÁßªÂãïÔºàÈõ≤„ÅÆÊ•ΩÂúíÔºâ
  function cloudMoves(row, col) {
    const o = state.board[row][col].owner;
    const f = o === 'player' ? -1 : 1; // „Éó„É¨„Ç§„É§„Éº„ÅØ‰∏äÂêë„Åç(-1)„ÄÅ„Ç≥„É≥„Éî„É•„Éº„Çø„ÅØ‰∏ãÂêë„Åç(1)
    const m = [];
    
    // Ê°ÇÈ¶¨„ÅÆÂãï„ÅçÔºà2„Éû„ÇπÂâçÈÄ≤„Åó„Å¶Â∑¶Âè≥1„Éû„ÇπÔºâ
    // „Éó„É¨„Ç§„É§„Éº: f=-1 ‚Üí [-2,-1], [-2,1] (2„Éû„Çπ‰∏äÈÄ≤„Åó„Å¶Â∑¶Âè≥1„Éû„Çπ)
    // „Ç≥„É≥„Éî„É•„Éº„Çø: f=1 ‚Üí [2,-1], [2,1] (2„Éû„Çπ‰∏ãÈÄ≤„Åó„Å¶Â∑¶Âè≥1„Éû„Çπ)
    const directions = [[2*f,-1],[2*f,1]];
    
    console.log('‚òÅ Èõ≤„ÅÆÈßí„ÅÆÁßªÂãïË®àÁÆóÈñãÂßã:', {row, col, owner: o, f, directions});
    console.log('‚òÅ Ê°ÇÈ¶¨È¢®ÁßªÂãïÊñπÂêë:', directions.map(([dr,dc]) => `(${dr},${dc})`));
    
    directions.forEach(([dr,dc]) => {
      const newRow = row + dr;
      const newCol = col + dc;
      console.log(`‚òÅ Èõ≤„ÅÆÁßªÂãïÂÖàË®àÁÆó: (${row},${col}) + (${dr},${dc}) = (${newRow},${newCol})`);
      const result = pushIfEnemyOrEmpty(m, newRow, newCol, o);
      console.log(`‚òÅ Èõ≤„ÅÆÁßªÂãïÂÖà (${newRow},${newCol}): ${result ? 'ÂèØËÉΩ' : '‰∏çÂèØËÉΩ'}`);
    });
    
    console.log('‚òÅ Èõ≤„ÅÆÈßí„ÅÆÊúÄÁµÇÁßªÂãïÂèØËÉΩ„Éû„Çπ:', m);
    return m;
  }

  // Ëôπ„ÅÆÁßªÂãïÔºàÈõ≤„ÅÆÊ•ΩÂúíÔºâ
  function rainbowMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Á∏¶Ê®™Â∑¶Âè≥1„Éû„Çπ„ÅÆ„ÅøÁßªÂãïÂèØËÉΩ
    const directions = [[-1,0],[1,0],[0,-1],[0,1]];
    directions.forEach(([dr,dc]) => pushIfEnemyOrEmpty(m, row+dr, col+dc, o));
    return m;
  }

  // Â≤©„ÅÆÁßªÂãïÔºàÂú∞Â∫ï„ÅÆÊ¥ûÁ™üÔºâ
  function rockMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // ÂâçÂæå„Å´ÊúÄÂ§ß2„Éû„ÇπÁßªÂãïÂèØËÉΩ
    [[-1,0],[1,0]].forEach(d => {
      for (let i = 1; i <= 2; i++) {
        const newRow = row + (d[0] * i);
        const newCol = col + (d[1] * i);
        if (newRow >= 0 && newRow < BOARD_SIZE && newCol >= 0 && newCol < BOARD_SIZE) {
          const target = state.board[newRow][newCol];
          if (target && target.piece === 'X') break;
          if (target && target.owner === o) break;
          m.push({r: newRow, c: newCol});
          if (target && target.owner !== o) break;
        } else {
          break;
        }
      }
    });
    return m;
  }

  // Èâ±„ÅÆÁßªÂãïÔºàÂú∞Â∫ï„ÅÆÊ¥ûÁ™üÔºâ
  function mineralMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Èâ±„ÅÆÂäõÔºöÂë®Âõ≤8„Éû„Çπ„Å´ÁßªÂãïÂèØËÉΩÔºàÊé°ÊéòÁØÑÂõ≤Ôºâ
    const directions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    directions.forEach(([dr,dc]) => pushIfEnemyOrEmpty(m, row+dr, col+dc, o));
    return m;
  }

  // Âπª„ÅÆÁßªÂãïÔºàÂπª„ÅÆÊ£ÆÔºâ
  function phantomMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Âπª„ÅÆÂäõÔºöÁ∏¶Ê®™1„Éû„Çπ + Ê°ÇÈ¶¨È£õ„Å≥
    // Á∏¶Ê®™1„Éû„ÇπÁßªÂãï
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o));
    
    // Ê°ÇÈ¶¨È£õ„Å≥ÔºàÂâçÊñπÊñú„ÇÅ2„Éû„ÇπÔºâ
    const forward = o === 'player' ? -1 : 1;
    [[forward,-2],[forward,2]].forEach(d => pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o));
    
    return m;
  }

  // Èúß„ÅÆÁßªÂãïÔºàÂπª„ÅÆÊ£ÆÔºâ
  function mistMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Èúß„ÅÆÂäõÔºöÊñú„ÇÅ4ÊñπÂêë + Â∑¶Âè≥1„Éû„Çπ
    // Êñú„ÇÅ4ÊñπÂêë
    [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d => pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o));
    
    // Â∑¶Âè≥1„Éû„Çπ
    [[0,-1],[0,1]].forEach(d => pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o));
    
    return m;
  }

  // ÁµÇ„ÅÆÁßªÂãïÔºàÁµÇÁÑâ„ÅÆÁ•ûÊÆøÔºâ
  function endMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // 8ÊñπÂêë„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÁßªÂãïÂèØËÉΩÔºàÈõ≤„Å®Âêå„ÅòÔºâ
    const directions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    directions.forEach(d => slide(m, row, col, o, d[0], d[1]));
    return m;
  }

  // ÁÑâ„ÅÆÁßªÂãïÔºàÁµÇÁÑâ„ÅÆÁ•ûÊÆøÔºâ
  function destinyMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // 8ÊñπÂêë„Å´1„Éû„ÇπÁßªÂãïÂèØËÉΩÔºàÁéã„Å®Âêå„ÅòÔºâ
    const directions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    directions.forEach(([dr,dc]) => pushIfEnemyOrEmpty(m, row+dr, col+dc, o));
    return m;
  }

  // „ÅÇ„ÅÆÁßªÂãïÔºà‰∫úÁ©∫ÈñìÔºâ
  function ahMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    
    // Á∏¶Ê®™4ÊñπÂêë„Å´ÁÑ°ÈôêÁßªÂãïÔºàÈ£õËªä„ÅÆ„Çà„ÅÜ„Å™Âãï„ÅçÔºâ
    slide(m, row, col, o, -1, 0); // ‰∏äÊñπÂêë
    slide(m, row, col, o, 1, 0);  // ‰∏ãÊñπÂêë
    slide(m, row, col, o, 0, -1); // Â∑¶ÊñπÂêë
    slide(m, row, col, o, 0, 1);  // Âè≥ÊñπÂêë
    
    // Êñú„ÇÅ4ÊñπÂêë„Å´1„Éû„ÇπÁßªÂãï
    [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(([dr,dc]) => {
      pushIfEnemyOrEmpty(m, row + dr, col + dc, o);
    });
    
    return m;
  }

  // Áâ¢„ÅÆÁßªÂãïÔºàÈóá„ÅÆÂú∞‰∏ãÁâ¢Ôºâ
  function prisonMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Áâ¢„ÅÆÂäõÔºöÂâçÂæåÁÑ°Èôê + Êñú„ÇÅ4ÊñπÂêë„Å´1„Éû„Çπ + ÊïµÈßí„ÇíÁâ¢„Å´Èñâ„ÅòËæº„ÇÅ„Çã
    // ÂâçÂæåÁÑ°ÈôêÁßªÂãï
    [[-1,0],[1,0]].forEach(d => slide(m, row, col, o, d[0], d[1]));
    // Êñú„ÇÅ4ÊñπÂêë„Å´1„Éû„Çπ
    [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d => {
      pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o);
    });
    return m;
  }

  // Êüµ„ÅÆÁßªÂãïÔºàÈóá„ÅÆÂú∞‰∏ãÁâ¢Ôºâ
  function fenceMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Êüµ„ÅÆÂäõÔºöÂâçÂæåÂ∑¶Âè≥„Å´1„Éû„Çπ„ÅÆ„Åø
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o));
    return m;
  }

  // Â∂∫„ÅÆÁßªÂãïÔºàÈ´òÂ±±Ôºâ
  function ridgeMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Â∂∫„ÅÆÂäõÔºöÊñú„ÇÅ„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÁßªÂãïÂèØËÉΩ
    [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d => slide(m, row, col, o, d[0], d[1]));
    return m;
  }

  // Â≥∞„ÅÆÁßªÂãïÔºàÈ´òÂ±±Ôºâ
  function peakMoves(row, col) {
    const o = state.board[row][col].owner;
    const f = o === 'player' ? -1 : 1; // „Éó„É¨„Ç§„É§„Éº„ÅØ‰∏äÂêë„Åç„ÄÅ„Ç≥„É≥„Éî„É•„Éº„Çø„ÅØ‰∏ãÂêë„Åç
    const m = [];
    // Â≥∞„ÅÆÂäõÔºöÈáëÂ∞Ü„Å®Âêå„ÅòÁßªÂãï„Éë„Çø„Éº„É≥ÔºàÂâçÂâçÊñú„ÉªÂâç„ÉªÂ∑¶Âè≥„ÉªÂæåÔºâ
    [[f,-1],[f,0],[f,1],[0,-1],[0,1],[-f,0]].forEach(([dr,dc]) => pushIfEnemyOrEmpty(m, row+dr, col+dc, o));
    return m;
  }

  // Â±±„ÅÆÁßªÂãïÔºàÂ∂∫„ÅÆ„Çπ„Ç≠„É´„ÅßÂá∫ÁèæÔºâ
  function mountainMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Â±±„ÅÆÂäõÔºöÂâç1„Éû„Çπ„ÅÆ„ÅøÁßªÂãïÂèØËÉΩ
    const f = o === 'player' ? -1 : 1; // „Éó„É¨„Ç§„É§„Éº„ÅØ‰∏ä„ÄÅ„Ç≥„É≥„Éî„É•„Éº„Çø„ÅØ‰∏ã
    pushIfEnemyOrEmpty(m, row + f, col, o);
    return m;
  }

  // Â≤©„ÅÆÁßªÂãïÔºàÈò≤Âæ°ÁöÑÔºâ
  function rockMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Â≤©„ÅÆÂäõÔºöÂâçÂæå„Å´ÊúÄÂ§ß2„Éû„ÇπÁßªÂãïÂèØËÉΩÔºàÈò≤Âæ°ÁöÑÔºâ
    [[-1,0],[1,0]].forEach(d => {
      for (let i = 1; i <= 2; i++) {
        const newRow = row + (d[0] * i);
        const newCol = col + (d[1] * i);
        if (newRow >= 0 && newRow < BOARD_SIZE && newCol >= 0 && newCol < BOARD_SIZE) {
          const target = state.board[newRow][newCol];
          if (target && target.piece === 'X') break;
          if (target && target.owner === o) break;
          m.push({r: newRow, c: newCol});
          if (target && target.owner !== o) break;
        } else {
          break;
        }
      }
    });
    return m;
  }

  // Èâ±„ÅÆÁßªÂãïÔºàÊé°ÊéòÁ≥ªÔºâ
  function oreMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Èâ±„ÅÆÂäõÔºöÂë®Âõ≤8„Éû„Çπ„Å´ÁßªÂãïÂèØËÉΩÔºàÊé°ÊéòÁØÑÂõ≤Ôºâ
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o));
    return m;
  }

  // Â¢ì„ÅÆÁßªÂãïÔºàÊ≠ªËÄÖ„ÅÆÂäõÔºâ
  function graveMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Â¢ì„ÅÆÂäõÔºöÁ∏¶Ê®™1„Éû„Çπ + Ê°ÇÈ¶¨È£õ„Å≥
    // Á∏¶Ê®™1„Éû„ÇπÁßªÂãï
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o));
    
    // Ê°ÇÈ¶¨È£õ„Å≥ÔºàÂâçÊñπÊñú„ÇÅ2„Éû„ÇπÔºâ
    const forward = o === 'player' ? -1 : 1;
    [[forward,-2],[forward,2]].forEach(d => pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o));
    
    return m;
  }

  // Èúä„ÅÆÁßªÂãïÔºàÈúäÈ≠Ç„ÅÆÂäõÔºâ
  function spiritMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Èúä„ÅÆÂäõÔºöÁ∏¶Ê®™1„Éû„ÇπÁßªÂãï„ÅÆ„Åø
    [[0,-1],[0,1],[-1,0],[1,0]].forEach(d => pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o));
    return m;
  }

  // ÊØí„ÅÆÁßªÂãïÔºàÊØí„ÅÆÊ≤ºÂú∞Ôºâ
  function poisonMoves(row, col) {
    const o = state.board[row][col].owner;
    const f = o === 'player' ? -1 : 1; // „Éó„É¨„Ç§„É§„Éº„ÅØ‰∏äÂêë„Åç„ÄÅ„Ç≥„É≥„Éî„É•„Éº„Çø„ÅØ‰∏ãÂêë„Åç
    const m = [];
    // ÈäÄ„Å®Âêå„ÅòÁßªÂãïÔºöÂâçÂæåÂ∑¶Âè≥„ÅÆÊñú„ÇÅ4ÊñπÂêë„Å®Ââç1ÊñπÂêë
    const directions = [[f,-1],[f,0],[f,1],[-f,-1],[-f,1]];
    console.log(`‚ò† ÊØí„ÅÆÁßªÂãïË®àÁÆó: (${row},${col}), ÊâÄÊúâËÄÖ${o}, ÊñπÂêë‰øÇÊï∞${f}`);
    console.log(`‚ò† ÊØí„ÅÆÁßªÂãïÊñπÂêë:`, directions);
    directions.forEach(([dr,dc]) => {
      pushIfEnemyOrEmpty(m, row+dr, col+dc, o);
    });
    console.log(`‚ò† ÊØí„ÅÆÁßªÂãïÂèØËÉΩ„Éû„Çπ: ${m.length}ÂÄã`, m);
    return m;
  }

  // ÊØí„ÅÆÈßí„ÅÆÁßªÂãïÂ±•Ê≠¥„ÇíËøΩÂä†
  function addPoisonHistory(row, col, turn) {
    if (!state.poisonHistory) {
      state.poisonHistory = [];
    }
    
    state.poisonHistory.push({
      row: row,
      col: col,
      turn: turn
    });
    
    // ÈÅéÂéª2„Çø„Éº„É≥ÂàÜ„ÅÆ„Åø‰øùÊåÅ
    const currentTurn = state.turnCount;
    state.poisonHistory = state.poisonHistory.filter(entry => 
      currentTurn - entry.turn <= 2
    );
    
    console.log(`‚ò† ÊØí„ÅÆÂ±•Ê≠¥„ÇíËøΩÂä†: (${row},${col}) „Çø„Éº„É≥${turn}`);
    console.log(`‚ò† ÁèæÂú®„ÅÆÊØíÂ±•Ê≠¥:`, state.poisonHistory);
  }

  // ÊØí„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºàÂº∑ÂåñÁâàÔºâ
  function triggerPoisonSkill(row, col, owner) {
    console.log('‚ò† ÊØí„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÊØíÈßí„Åå„ÅÑ„Åü„Éû„Çπ„Å®ÈÅéÂéª2„Çø„Éº„É≥„ÅÆÁßªÂãïÁµåË∑Ø„ÇíÊØí„Éû„Çπ„Å´„Åó„Åæ„Åô...');
    
    // ÊØíÈßí„Åå„ÅÑ„Åü„Éû„Çπ„ÇíÊØí„Éû„Çπ„Å´Ë®≠ÂÆö
    if (!state.poisonSquares) {
      state.poisonSquares = [];
      console.log('‚ò† poisonSquares„ÇíÂàùÊúüÂåñ„Åó„Åæ„Åó„Åü');
    }
    
    // ÁèæÂú®„ÅÆ‰ΩçÁΩÆ„ÇíÊØí„Éû„Çπ„Å´ËøΩÂä†
    state.poisonSquares.push({
      row: row,
      col: col,
      turn: state.turnCount,
      owner: owner
    });
    
    // ÈÅéÂéª2„Çø„Éº„É≥„ÅÆÁßªÂãïÂ±•Ê≠¥„ÇÇÊØí„Éû„Çπ„Å´ËøΩÂä†
    if (state.poisonHistory && state.poisonHistory.length > 0) {
      state.poisonHistory.forEach(entry => {
        // Êó¢„Å´Âêå„Åò‰ΩçÁΩÆ„ÅÆÊØí„Éû„Çπ„Åå„Å™„ÅÑ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
        const exists = state.poisonSquares.some(ps => 
          ps.row === entry.row && ps.col === entry.col
        );
        
        if (!exists) {
          state.poisonSquares.push({
            row: entry.row,
            col: entry.col,
            turn: state.turnCount,
            owner: owner
          });
          console.log(`‚ò† Â±•Ê≠¥„Åã„ÇâÊØí„Éû„Çπ„ÇíËøΩÂä†: (${entry.row},${entry.col})`);
        }
      });
    }
    
    console.log(`‚ò† ÊØí„Éû„Çπ„ÇíË®≠ÁΩÆ: (${row},${col}) „Çø„Éº„É≥${state.turnCount}`);
    console.log(`‚ò† ÁèæÂú®„ÅÆÊØí„Éû„ÇπÊï∞: ${state.poisonSquares.length}`);
    console.log(`‚ò† ÊØí„Éû„Çπ‰∏ÄË¶ß:`, state.poisonSquares);
    
    // „Éá„Éê„ÉÉ„Ç∞Áî®ÔºöÊØí„Éû„Çπ„ÅåÊ≠£„Åó„ÅèË®≠ÂÆö„Åï„Çå„Åü„ÅãÁ¢∫Ë™ç
    setTimeout(() => {
      console.log('‚ò† ÊØí„Éû„ÇπË®≠ÂÆöÂæå„ÅÆÁ¢∫Ë™ç:');
      console.log(`‚ò† ÊØí„Éû„ÇπÊï∞: ${state.poisonSquares.length}`);
      console.log(`‚ò† Ë®≠ÁΩÆ‰ΩçÁΩÆ(${row},${col})„ÅØÊØí„Éû„Çπ„Åã: ${isPoisonSquare(row, col)}`);
    }, 50);
  }
  
  // „Éá„Éê„ÉÉ„Ç∞Áî®ÔºöÊâãÂãï„ÅßÊØí„Éû„Çπ„ÇíË®≠ÁΩÆ„Åô„ÇãÈñ¢Êï∞
  function addTestPoisonSquare(row, col) {
    if (!state.poisonSquares) {
      state.poisonSquares = [];
    }
    
    state.poisonSquares.push({
      row: row,
      col: col,
      turn: state.turnCount,
      owner: 'player'
    });
    
    console.log(`‚ò† „ÉÜ„Çπ„ÉàÊØí„Éû„Çπ„ÇíË®≠ÁΩÆ: (${row},${col})`);
    render();
  }
  
  // „Éá„Éê„ÉÉ„Ç∞Áî®ÔºöÊØí„Éû„Çπ„Çí„ÇØ„É™„Ç¢„Åô„ÇãÈñ¢Êï∞
  function clearAllPoisonSquares() {
    state.poisonSquares = [];
    console.log('‚ò† ÂÖ®„Å¶„ÅÆÊØí„Éû„Çπ„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„Åü');
    render();
  }
  
  // „Éá„Éê„ÉÉ„Ç∞Áî®ÔºöÊØí„Éû„Çπ„ÅÆÁä∂ÊÖã„ÇíÁ¢∫Ë™ç„Åô„ÇãÈñ¢Êï∞
  function debugPoisonSquares() {
    console.log('=== ÊØí„Éû„Çπ„Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†± ===');
    console.log(`ÁèæÂú®„ÅÆ„Çø„Éº„É≥: ${state.turnCount}`);
    console.log(`ÊØí„Éû„ÇπÊï∞: ${state.poisonSquares ? state.poisonSquares.length : 0}`);
    console.log(`ÊØíÂ±•Ê≠¥Êï∞: ${state.poisonHistory ? state.poisonHistory.length : 0}`);
    console.log(`ÊØíÁä∂ÊÖã„ÅÆÈßíÊï∞: ${state.poisonedPieces ? state.poisonedPieces.length : 0}`);
    
    if (state.poisonSquares && state.poisonSquares.length > 0) {
      console.log('ÊØí„Éû„Çπ‰∏ÄË¶ß:');
      state.poisonSquares.forEach((ps, index) => {
        const turnsElapsed = state.turnCount - ps.turn;
        console.log(`  ${index + 1}. (${ps.row},${ps.col}) Ë®≠ÁΩÆ„Çø„Éº„É≥:${ps.turn} ÁµåÈÅé„Çø„Éº„É≥:${turnsElapsed} ÊâÄÊúâËÄÖ:${ps.owner}`);
      });
    }
    
    if (state.poisonHistory && state.poisonHistory.length > 0) {
      console.log('ÊØíÂ±•Ê≠¥‰∏ÄË¶ß:');
      state.poisonHistory.forEach((ph, index) => {
        const turnsElapsed = state.turnCount - ph.turn;
        console.log(`  ${index + 1}. (${ph.row},${ph.col}) „Çø„Éº„É≥:${ph.turn} ÁµåÈÅé„Çø„Éº„É≥:${turnsElapsed}`);
      });
    }
    
    if (state.poisonedPieces && state.poisonedPieces.length > 0) {
      console.log('ÊØíÁä∂ÊÖã„ÅÆÈßí‰∏ÄË¶ß:');
      state.poisonedPieces.forEach((pp, index) => {
        const turnsElapsed = state.turnCount - pp.turn;
        console.log(`  ${index + 1}. ${pp.piece} at (${pp.row},${pp.col}) ‰ªò‰∏é„Çø„Éº„É≥:${pp.turn} ÁµåÈÅé„Çø„Éº„É≥:${turnsElapsed} ÊâÄÊúâËÄÖ:${pp.owner}`);
      });
    }
    console.log('=== „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±ÁµÇ‰∫Ü ===');
  }

  // ÊØíÁä∂ÊÖã„ÅÆÈßí„ÇíËøΩÂä†
  function addPoisonedPiece(row, col, piece, owner) {
    if (!state.poisonedPieces) {
      state.poisonedPieces = [];
    }
    
    // Êó¢„Å´ÊØíÁä∂ÊÖã„Åß„Å™„ÅÑ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    const exists = state.poisonedPieces.some(pp => 
      pp.row === row && pp.col === col
    );
    
    if (!exists) {
      state.poisonedPieces.push({
        row: row,
        col: col,
        piece: piece,
        owner: owner,
        turn: state.turnCount
      });
      console.log(`‚ò† ÊØíÁä∂ÊÖã„Çí‰ªò‰∏é: ${piece} at (${row},${col}) „Çø„Éº„É≥${state.turnCount}`);
    }
  }

  // ÊØíÁä∂ÊÖã„ÅÆÈßí„ÇíÂá¶ÁêÜÔºàÊ¨°„ÅÆ„Çø„Éº„É≥„ÅßÊ∂àÊªÖÔºâ
  function processPoisonedPieces() {
    if (!state.poisonedPieces || state.poisonedPieces.length === 0) {
      return;
    }
    
    console.log(`‚ò† ÊØíÁä∂ÊÖã„ÅÆÈßí„ÇíÂá¶ÁêÜ: ${state.poisonedPieces.length}ÂÄã`);
    
    const piecesToRemove = [];
    
    state.poisonedPieces.forEach(poisonedPiece => {
      const turnsElapsed = state.turnCount - poisonedPiece.turn;
      console.log(`‚ò† ÊØíÁä∂ÊÖã„ÅÆÈßí(${poisonedPiece.piece} at ${poisonedPiece.row},${poisonedPiece.col}): ÁµåÈÅé„Çø„Éº„É≥${turnsElapsed}`);
      
      // 1„Çø„Éº„É≥ÁµåÈÅé„Åó„ÅüÊØíÁä∂ÊÖã„ÅÆÈßí„ÇíÊ∂àÊªÖ„Åï„Åõ„Çã
      if (turnsElapsed >= 1) {
        console.log(`‚ò† ÊØí„ÅßÊ∂àÊªÖ: ${poisonedPiece.piece} at (${poisonedPiece.row},${poisonedPiece.col})`);
        
        // Èßí„ÇíÊ∂àÊªÖ„Åï„Åõ„Çã
        if (state.board[poisonedPiece.row] && state.board[poisonedPiece.row][poisonedPiece.col]) {
          const piece = state.board[poisonedPiece.row][poisonedPiece.col];
          if (piece && piece.piece === poisonedPiece.piece) {
            // Èßí„ÇíÁõ§Èù¢„Åã„ÇâÂâäÈô§
            state.board[poisonedPiece.row][poisonedPiece.col] = null;
            console.log(`‚ò† Èßí„ÇíÊ∂àÊªÖ„Åï„Åõ„Åæ„Åó„Åü: ${poisonedPiece.piece} at (${poisonedPiece.row},${poisonedPiece.col})`);
          }
        }
        
        piecesToRemove.push(poisonedPiece);
      }
    });
    
    // Ê∂àÊªÖ„Åó„ÅüÈßí„Çí„É™„Çπ„Éà„Åã„ÇâÂâäÈô§
    state.poisonedPieces = state.poisonedPieces.filter(pp => 
      !piecesToRemove.some(ptr => 
        ptr.row === pp.row && ptr.col === pp.col
      )
    );
    
    console.log(`‚ò† ÊØíÁä∂ÊÖãÂá¶ÁêÜÂæå: ÊÆã„Çä${state.poisonedPieces.length}ÂÄã`);
  }

  // ÊØí„Éû„Çπ„ÅÆËß£Èô§Âá¶ÁêÜ
  function clearPoisonEffects() {
    if (state.poisonSquares) {
      console.log(`‚ò† ÊØí„Éû„ÇπËß£Èô§„ÉÅ„Çß„ÉÉ„ÇØ: ÁèæÂú®„Çø„Éº„É≥${state.turnCount}, ÊØí„Éû„ÇπÊï∞${state.poisonSquares.length}`);
      // 2„Çø„Éº„É≥ÁµåÈÅé„Åó„ÅüÊØí„Éû„Çπ„ÇíÂâäÈô§ÔºàË®≠ÁΩÆ„Çø„Éº„É≥„Åã„Çâ2„Çø„Éº„É≥Âæå„Åæ„ÅßÊåÅÁ∂öÔºâ
      state.poisonSquares = state.poisonSquares.filter(poisonSquare => {
        const turnsElapsed = state.turnCount - poisonSquare.turn;
        console.log(`‚ò† ÊØí„Éû„Çπ(${poisonSquare.row},${poisonSquare.col}): Ë®≠ÁΩÆ„Çø„Éº„É≥${poisonSquare.turn}, ÁµåÈÅé„Çø„Éº„É≥${turnsElapsed}`);
        if (turnsElapsed >= 2) {
          console.log(`‚ò† ÊØí„Éû„Çπ„ÅåËß£Èô§„Åï„Çå„Åæ„Åó„Åü: (${poisonSquare.row},${poisonSquare.col}) - 2„Çø„Éº„É≥ÁµåÈÅé`);
          return false;
        }
        return true;
      });
      console.log(`‚ò† ÊØí„Éû„ÇπËß£Èô§Âæå: ÊÆã„Çä${state.poisonSquares.length}ÂÄã`);
    }
    
    // ÊØíÁä∂ÊÖã„ÅÆÈßí„ÇíÂá¶ÁêÜ
    processPoisonedPieces();
  }

  // ÊØí„Éû„Çπ„Åã„Å©„ÅÜ„Åã„ÇíÂà§ÂÆö
  function isPoisonSquare(row, col) {
    if (!state.poisonSquares) {
      console.log(`‚ò† isPoisonSquare: poisonSquares is not defined`);
      return false;
    }
    const isPoison = state.poisonSquares.some(poisonSquare => 
      poisonSquare.row === row && poisonSquare.col === col
    );
    if (isPoison) {
      console.log(`‚ò† isPoisonSquare: (${row},${col}) is a poison square`);
    }
    return isPoison;
  }

  // Ê≤º„ÅÆÁßªÂãïÔºàÊØí„ÅÆÊ≤ºÂú∞Ôºâ
  function swampMoves(row, col) {
    const o = state.board[row][col].owner;
    const f = o === 'player' ? -1 : 1; // „Éó„É¨„Ç§„É§„Éº„ÅØ‰∏äÊñπÂêë„Åå-1„ÄÅ„Ç≥„É≥„Éî„É•„Éº„Çø„ÅØ‰∏ãÊñπÂêë„Åå1
    const m = [];
    // Ê≤º„ÅÆÂäõÔºöÈäÄ„Å®ÂêåÊßò„ÅÆÁßªÂãïÁØÑÂõ≤ÔºàÂâçÊñπ3ÊñπÂêë + ÂæåÊñπ2ÊñπÂêëÔºâ
    [[f,-1],[f,0],[f,1],[-f,-1],[-f,1]].forEach(([dr,dc]) => pushIfEnemyOrEmpty(m, row+dr, col+dc, o));
    return m;
  }

  // Ê≤º„ÅÆ„Çπ„Ç≠„É´Áô∫Âãï
  function triggerSwampSkill(row, col, owner) {
    console.log('üåä Ê≤º„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÂë®Âõ≤„ÅÆÊïµÈßí„ÅÆÁßªÂãï„ÇíÂà∂Èôê„Åó„Åæ„Åô...');
    
    // Âë®Âõ≤8„Éû„Çπ„ÅÆÊïµÈßí„ÅÆÁßªÂãï„ÇíÂà∂Èôê
    for (let dr = -1; dr <= 1; dr++) {
      for (let dc = -1; dc <= 1; dc++) {
        if (dr === 0 && dc === 0) continue;
        const targetRow = row + dr;
        const targetCol = col + dc;
        
        if (targetRow >= 0 && targetRow < BOARD_SIZE && targetCol >= 0 && targetCol < BOARD_SIZE) {
          const targetPiece = state.board[targetRow][targetCol];
          if (targetPiece && targetPiece.owner !== owner) {
            // ÁâπÊÆä„Éû„ÇπÔºàÂë™„ÅÑ„Éû„Çπ„ÄÅÁü¢Âç∞„Éû„Çπ„ÄÅ„Éñ„É≠„ÉÉ„ÇØ„Éû„ÇπÔºâ„ÅØÈô§Â§ñ
            if (targetPiece.piece !== 'n' && targetPiece.piece !== 'X' && !['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(targetPiece.piece)) {
            targetPiece.isSwampTrapped = true;
            targetPiece.swampTrappedTurn = state.turnCount;
            console.log(`üåä ÊïµÈßí„Äå${targetPiece.piece}„Äç„ÇíÊ≤º„Å´Êçï„Çâ„Åà„Åæ„Åó„Åü: (${targetRow},${targetCol})`);
            }
          }
        }
      }
    }
  }

  // Èè°„ÅÆ„Çπ„Ç≠„É´Áô∫Âãï
  function triggerMirrorSkill(row, col, owner) {
    console.log('ü™û Èè°„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÂèçÂ∞ÑÊîªÊíÉ„ÅßÂë®Âõ≤„ÅÆÊïµÈßí„ÇíÊîªÊíÉ„Åó„Åæ„Åô...');
    
    // Âë®Âõ≤8„Éû„Çπ„ÅÆÊïµÈßí„Å´ÂèçÂ∞ÑÊîªÊíÉ
    for (let dr = -1; dr <= 1; dr++) {
      for (let dc = -1; dc <= 1; dc++) {
        if (dr === 0 && dc === 0) continue;
        const targetRow = row + dr;
        const targetCol = col + dc;
        
        if (targetRow >= 0 && targetRow < BOARD_SIZE && targetCol >= 0 && targetCol < BOARD_SIZE) {
          const targetPiece = state.board[targetRow][targetCol];
          if (targetPiece && targetPiece.owner !== owner) {
            // ÂèçÂ∞ÑÊîªÊíÉ„ÅßÊïµÈßí„Çí1„Éû„ÇπÂæåÈÄÄ„Åï„Åõ„Çã
            const retreatRow = targetRow + dr;
            const retreatCol = targetCol + dc;
            
            if (retreatRow >= 0 && retreatRow < BOARD_SIZE && retreatCol >= 0 && retreatCol < BOARD_SIZE) {
              const retreatSquare = state.board[retreatRow][retreatCol];
              if (!retreatSquare) {
                // ÂæåÈÄÄÂÖà„ÅåÁ©∫„ÅÑ„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÄÅÈßí„ÇíÁßªÂãï
                state.board[retreatRow][retreatCol] = targetPiece;
                state.board[targetRow][targetCol] = null;
                console.log(`ü™û ÂèçÂ∞ÑÊîªÊíÉ„ÅßÊïµÈßí„Äå${targetPiece.piece}„Äç„ÇíÂæåÈÄÄ„Åï„Åõ„Åæ„Åó„Åü: (${targetRow},${targetCol}) ‚Üí (${retreatRow},${retreatCol})`);
              }
            }
          }
        }
      }
    }
  }

  // Êò†„ÅÆ„Çπ„Ç≠„É´Áô∫Âãï
  function triggerReflectionSkill(row, col, owner) {
    console.log('‚ú® Êò†„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÈè°Èù¢ÂèçÂ∞Ñ„ÅßÂë®Âõ≤„ÅÆÊïµÈßí„ÇíÂèçËª¢„Åï„Åõ„Åæ„Åô...');
    
    // Âë®Âõ≤8„Éû„Çπ„ÅÆÊïµÈßí„ÇíÈè°Èù¢ÂèçÂ∞Ñ„ÅßÂèçËª¢
    for (let dr = -1; dr <= 1; dr++) {
      for (let dc = -1; dc <= 1; dc++) {
        if (dr === 0 && dc === 0) continue;
        const targetRow = row + dr;
        const targetCol = col + dc;
        
        if (targetRow >= 0 && targetRow < BOARD_SIZE && targetCol >= 0 && targetCol < BOARD_SIZE) {
          const targetPiece = state.board[targetRow][targetCol];
          if (targetPiece && targetPiece.owner !== owner) {
            // Èè°Èù¢ÂèçÂ∞Ñ„ÅßÊïµÈßí„ÇíÂèçËª¢‰ΩçÁΩÆ„Å´ÁßªÂãï
            const reflectRow = row - dr;
            const reflectCol = col - dc;
            
            if (reflectRow >= 0 && reflectRow < BOARD_SIZE && reflectCol >= 0 && reflectCol < BOARD_SIZE) {
              const reflectSquare = state.board[reflectRow][reflectCol];
              if (!reflectSquare) {
                // ÂèçËª¢ÂÖà„ÅåÁ©∫„ÅÑ„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÄÅÈßí„ÇíÁßªÂãï
                state.board[reflectRow][reflectCol] = targetPiece;
                state.board[targetRow][targetCol] = null;
                console.log(`‚ú® Èè°Èù¢ÂèçÂ∞Ñ„ÅßÊïµÈßí„Äå${targetPiece.piece}„Äç„ÇíÂèçËª¢„Åï„Åõ„Åæ„Åó„Åü: (${targetRow},${targetCol}) ‚Üí (${reflectRow},${reflectCol})`);
              }
            }
          }
        }
      }
    }
  }

  // Ê≤ºÁä∂ÊÖã„ÅÆËß£Èô§Âá¶ÁêÜ
  function clearSwampEffects() {
    for (let row = 0; row < BOARD_SIZE; row++) {
      for (let col = 0; col < BOARD_SIZE; col++) {
        const piece = state.board[row][col];
        if (piece && piece.isSwampTrapped) {
          // 2„Çø„Éº„É≥ÁµåÈÅé„Åó„Åü„ÇâÊ≤ºÁä∂ÊÖã„ÇíËß£Èô§
          if (state.turnCount >= piece.swampTrappedTurn + 2) {
            piece.isSwampTrapped = false;
            piece.swampTrappedTurn = null;
            console.log(`üåä Èßí„Äå${piece.piece}„Äç„ÅÆÊ≤ºÁä∂ÊÖã„ÅåËß£Èô§„Åï„Çå„Åæ„Åó„Åü: (${row},${col})`);
          }
        }
      }
    }
  }

  // Ê≤ºÁä∂ÊÖã„ÇíÂÆåÂÖ®„Å´ÂàùÊúüÂåñ„Åô„ÇãÈñ¢Êï∞Ôºà„Çπ„ÉÜ„Éº„Ç∏24Áî®Ôºâ
  function resetSwampStates() {
    for (let row = 0; row < BOARD_SIZE; row++) {
      for (let col = 0; col < BOARD_SIZE; col++) {
        const piece = state.board[row][col];
        if (piece && piece.isSwampTrapped) {
          piece.isSwampTrapped = false;
          piece.swampTrappedTurn = null;
          console.log(`üåä Èßí„Äå${piece.piece}„Äç„ÅÆÊ≤ºÁä∂ÊÖã„ÇíÂº∑Âà∂„É™„Çª„ÉÉ„Éà: (${row},${col})`);
        }
      }
    }
  }

  // Ê≤º„Å´Êçï„Çâ„Åà„Çâ„Çå„ÅüÈßí„ÅÆÁßªÂãïÂà∂Èôê
  function getSwampTrappedMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Ê≤º„Å´Êçï„Çâ„Åà„Çâ„Çå„ÅüÈßí„ÅØ‰∏ä‰∏ã1„Éû„Çπ„Åó„ÅãÁßªÂãï„Åß„Åç„Å™„ÅÑ
    const directions = [[-1,0],[1,0]]; // ‰∏ä‰∏ãÊñπÂêë„ÅÆ„Åø
    directions.forEach(([dr,dc]) => pushIfEnemyOrEmpty(m, row+dr, col+dc, o));
    return m;
  }

  // ÊØí„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„ÉàË°®Á§∫
  function showPoisonEffect(fromRow, fromCol, toRow, toCol) {
    const fromCell = document.querySelector(`[data-row="${fromRow}"][data-col="${fromCol}"]`);
    const toCell = document.querySelector(`[data-row="${toRow}"][data-col="${toCol}"]`);
    
    if (fromCell && toCell) {
      // ÊØí„ÅÆÁÖô„Ç®„Éï„Çß„ÇØ„Éà
      const poisonEffect = document.createElement('div');
      poisonEffect.className = 'poison-effect';
      poisonEffect.style.cssText = `
        position: absolute;
        top: 50%;
        left: 50%;
        width: 60px;
        height: 60px;
        background: radial-gradient(circle, rgba(139, 0, 139, 0.8) 0%, rgba(255, 0, 255, 0.4) 50%, transparent 100%);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        pointer-events: none;
        z-index: 1000;
        animation: poisonSmoke 1.5s ease-out forwards;
      `;
      
      toCell.appendChild(poisonEffect);
      
      // „Ç®„Éï„Çß„ÇØ„ÉàÁµÇ‰∫ÜÂæå„Å´ÂâäÈô§
      setTimeout(() => {
        if (poisonEffect.parentNode) {
          poisonEffect.parentNode.removeChild(poisonEffect);
        }
      }, 1500);
    }
  }

  // Ê≤º„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„ÉàË°®Á§∫
  function showSwampEffect(fromRow, fromCol, toRow, toCol) {
    const fromCell = document.querySelector(`[data-row="${fromRow}"][data-col="${fromCol}"]`);
    const toCell = document.querySelector(`[data-row="${toRow}"][data-col="${toCol}"]`);
    
    if (fromCell && toCell) {
      // Ê≤º„ÅÆÊ≥°„Ç®„Éï„Çß„ÇØ„Éà
      const swampEffect = document.createElement('div');
      swampEffect.className = 'swamp-effect';
      swampEffect.style.cssText = `
        position: absolute;
        top: 50%;
        left: 50%;
        width: 50px;
        height: 50px;
        background: radial-gradient(circle, rgba(74, 124, 89, 0.7) 0%, rgba(107, 142, 35, 0.3) 50%, transparent 100%);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        pointer-events: none;
        z-index: 1000;
        animation: swampBubbles 2s ease-out forwards;
      `;
      
      toCell.appendChild(swampEffect);
      
      // „Ç®„Éï„Çß„ÇØ„ÉàÁµÇ‰∫ÜÂæå„Å´ÂâäÈô§
      setTimeout(() => {
        if (swampEffect.parentNode) {
          swampEffect.parentNode.removeChild(swampEffect);
        }
      }, 2000);
    }
  }

  // Èè°„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„ÉàË°®Á§∫
  function showMirrorEffect(fromRow, fromCol, toRow, toCol) {
    const fromCell = document.querySelector(`[data-row="${fromRow}"][data-col="${fromCol}"]`);
    const toCell = document.querySelector(`[data-row="${toRow}"][data-col="${toCol}"]`);
    
    if (fromCell && toCell) {
      // Èè°„ÅÆÂÖâ„Ç®„Éï„Çß„ÇØ„Éà
      const mirrorEffect = document.createElement('div');
      mirrorEffect.className = 'mirror-effect';
      mirrorEffect.style.cssText = `
        position: absolute;
        top: 50%;
        left: 50%;
        width: 60px;
        height: 60px;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.8) 0%, rgba(200, 200, 255, 0.4) 50%, transparent 100%);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        pointer-events: none;
        z-index: 1000;
        animation: mirrorShine 1.5s ease-out forwards;
      `;
      
      toCell.appendChild(mirrorEffect);
      
      // „Ç®„Éï„Çß„ÇØ„ÉàÁµÇ‰∫ÜÂæå„Å´ÂâäÈô§
      setTimeout(() => {
        if (mirrorEffect.parentNode) {
          mirrorEffect.parentNode.removeChild(mirrorEffect);
        }
      }, 1500);
    }
  }

  // Êò†„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„ÉàË°®Á§∫
  function showReflectionEffect(fromRow, fromCol, toRow, toCol) {
    const fromCell = document.querySelector(`[data-row="${fromRow}"][data-col="${fromCol}"]`);
    const toCell = document.querySelector(`[data-row="${toRow}"][data-col="${toCol}"]`);
    
    if (fromCell && toCell) {
      // Êò†„ÅÆÂèçÂ∞Ñ„Ç®„Éï„Çß„ÇØ„Éà
      const reflectionEffect = document.createElement('div');
      reflectionEffect.className = 'reflection-effect';
      reflectionEffect.style.cssText = `
        position: absolute;
        top: 50%;
        left: 50%;
        width: 70px;
        height: 70px;
        background: radial-gradient(circle, rgba(255, 215, 0, 0.7) 0%, rgba(255, 255, 255, 0.3) 50%, transparent 100%);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        pointer-events: none;
        z-index: 1000;
        animation: reflectionGlow 2s ease-out forwards;
      `;
      
      toCell.appendChild(reflectionEffect);
      
      // „Ç®„Éï„Çß„ÇØ„ÉàÁµÇ‰∫ÜÂæå„Å´ÂâäÈô§
      setTimeout(() => {
        if (reflectionEffect.parentNode) {
          reflectionEffect.parentNode.removeChild(reflectionEffect);
        }
      }, 2000);
    }
  }

  // Â¢ì„ÅÆÁßªÂãïÔºàÂë™„ÅÑ„ÅÆÂ¢ìÂ†¥Ôºâ
  function graveMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Â¢ì„ÅÆÂäõÔºöÁ∏¶Ê®™1„Éû„Çπ + Ê°ÇÈ¶¨È£õ„Å≥
    // Á∏¶Ê®™1„Éû„ÇπÁßªÂãï
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o));
    
    // Ê°ÇÈ¶¨È£õ„Å≥ÔºàÂâçÊñπÊñú„ÇÅ2„Éû„ÇπÔºâ
    const forward = o === 'player' ? -1 : 1;
    [[forward,-2],[forward,2]].forEach(d => pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o));
    
    return m;
  }

  // Èúä„ÅÆÁßªÂãïÔºàÂë™„ÅÑ„ÅÆÂ¢ìÂ†¥Ôºâ
  function spiritMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Èúä„ÅÆÂäõÔºöÁ∏¶Ê®™1„Éû„ÇπÁßªÂãï„ÅÆ„Åø
    [[0,-1],[0,1],[-1,0],[1,0]].forEach(d => pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o));
    return m;
  }

  // Ê©ü„ÅÆÁßªÂãïÔºàÊ©üÊ¢∞ÈÉΩÂ∏ÇÔºâ
  function machineMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Ê©ü„ÅÆÂäõÔºö‰∏ä‰∏ãÂ∑¶Âè≥ÊúÄÂ§ß2„Éû„ÇπÔºà1„Éû„Çπ„Åæ„Åü„ÅØ2„Éû„ÇπÁßªÂãïÂèØËÉΩÔºâ
    [[-1,0],[1,0],[0,-1],[0,1],[-2,0],[2,0],[0,-2],[0,2]].forEach(d => pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o));
    return m;
  }

  // Ê≠Ø„ÅÆÁßªÂãïÔºàÊ©üÊ¢∞ÈÉΩÂ∏ÇÔºâ
  function gearMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Ê≠Ø„ÅÆÂäõÔºöÂâçÂæåÊñú„ÇÅ„Å´1„Éû„Çπ
    [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d => pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o));
    return m;
  }

  // Êúà„ÅÆÁßªÂãïÔºàÊúàÂÖâ„ÅÆÊπñÔºâ
  function moonMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    
    // Âë™„ÅÑ„Éû„Çπ„Å´„ÅÑ„ÇãÂ†¥Âêà„ÅØÂ∏∏„Å´1„Éû„ÇπÁßªÂãï„ÅÆ„Åø
    if (isAffectedByCurse(row, col)) {
      console.log('üåô Êúà„ÅÆÈßí„ÅåÂë™„ÅÑ„Éû„Çπ„Å´„ÅÑ„Åæ„Åô„ÄÇÁßªÂãïÁØÑÂõ≤„Åå1„Éû„Çπ„Å´Âà∂Èôê„Åï„Çå„Åæ„Åô');
      [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
        pushIfEnemyOrEmpty(m, row + d[0], col + d[1], o);
      });
      return m;
    }
    
    // Êúà„ÅÆÂäõÔºö„Çø„Éº„É≥Êï∞„Å´„Çà„Å£„Å¶ÁßªÂãïÁØÑÂõ≤„ÅåÂ§âÂåñÔºàËá™ÂàÜ„ÅÆÊâãÁï™„ÅÆ„Åø„Ç´„Ç¶„É≥„ÉàÔºâ
    // ÂÅ∂Êï∞ÂõûÁõÆ„ÅÆËá™ÂàÜ„ÅÆ„Çø„Éº„É≥ÔºöÂÖ®Êñπ‰ΩçÊúÄÂ§ß3„Éû„Çπ
    // Â•áÊï∞ÂõûÁõÆ„ÅÆËá™ÂàÜ„ÅÆ„Çø„Éº„É≥ÔºöÂÖ®Êñπ‰Ωç1„Éû„Çπ
    const currentTurnCount = state.moonTurnCount[o];
    const isEvenTurn = currentTurnCount % 2 === 0;
    
    if (isEvenTurn) {
      // ÂÅ∂Êï∞ÂõûÁõÆ„ÅÆËá™ÂàÜ„ÅÆ„Çø„Éº„É≥ÔºöÂÖ®Êñπ‰ΩçÊúÄÂ§ß3„Éû„Çπ
      [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
        slide(m, row, col, o, d[0], d[1], 3); // ÊúÄÂ§ß3„Éû„Çπ„Åæ„Åß
      });
    } else {
      // Â•áÊï∞ÂõûÁõÆ„ÅÆËá™ÂàÜ„ÅÆ„Çø„Éº„É≥ÔºöÂÖ®Êñπ‰Ωç1„Éû„Çπ
      [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
        pushIfEnemyOrEmpty(m, row + d[0], col + d[1], o);
      });
    }
    
    return m;
  }

  // Ëàü„ÅÆÁßªÂãïÔºàÊúàÂÖâ„ÅÆÊπñÔºâ
  function boatMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Ëàü„ÅÆÂäõÔºöÈ¶ôËªä„ÅÆÂãï„ÅçÔºàÂâçÊñπ„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÔºâ+ Â∑¶Âè≥1„Éû„Çπ
    const f = o === 'player' ? -1 : 1; // „Éó„É¨„Ç§„É§„Éº„ÅØ‰∏äÊñπÂêë„ÄÅ„Ç≥„É≥„Éî„É•„Éº„Çø„ÅØ‰∏ãÊñπÂêë
    slide(m, row, col, o, f, 0); // È¶ôËªä„ÅÆÂãï„ÅçÔºàÂâçÊñπ„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÔºâ
    pushIfEnemyOrEmpty(m, row, col - 1, o); // Â∑¶1„Éû„Çπ
    pushIfEnemyOrEmpty(m, row, col + 1, o); // Âè≥1„Éû„Çπ
    return m;
  }

  // Èè°„ÅÆÁßªÂãïÔºàÈè°„ÅÆÈñìÔºâ
  function mirrorMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    
    // Ê≠£Èù¢„Å´„ÅÑ„ÇãÊïµÈßí„ÇíÊ§úÁ¥¢Ôºà1„Éû„Çπ„Åö„Å§Ââç„Å´ÈÄ≤„Çì„ÅßÂàù„ÇÅ„Å¶„Å§„Åç„ÅÇ„Åü„Å£„ÅüÊïµÈßíÔºâ
    const enemyDirection = o === 'player' ? -1 : 1; // „Éó„É¨„Ç§„É§„Éº„ÅØ‰∏äÂêë„Åç„ÄÅÊïµ„ÅØ‰∏ãÂêë„Åç
    let frontEnemy = null;
    let frontEnemyRow = -1;
    let frontEnemyCol = -1;
    
    // Ê≠£Èù¢ÊñπÂêë„Å´1„Éû„Çπ„Åö„Å§ÈÄ≤„Çì„ÅßÊïµÈßí„ÇíÊ§úÁ¥¢
    for (let i = 1; i < BOARD_SIZE; i++) {
      const checkRow = row + (enemyDirection * i);
      if (checkRow < 0 || checkRow >= BOARD_SIZE) break;
      
      const frontSquare = state.board[checkRow][col];
      if (frontSquare) {
        // Èßí„Åå„ÅÇ„ÇãÂ†¥ÂêàÔºàÂë≥Êñπ„Åß„ÇÇÊïµ„Åß„ÇÇÔºâ
        if (frontSquare.owner !== o) {
          // ÊïµÈßí„ÅÆÂ†¥Âêà
          frontEnemy = frontSquare;
          frontEnemyRow = checkRow;
          frontEnemyCol = col;
        }
        // Âë≥ÊñπÈßí„Åß„ÇÇÊïµÈßí„Åß„ÇÇ„ÄÅÈßí„Å´„Å∂„Å§„Åã„Å£„Åü„ÇâÊ§úÁ¥¢ÁµÇ‰∫Ü
        break;
      }
      // Á©∫„Éû„Çπ„ÅÆÂ†¥Âêà„ÅØÊ¨°„ÅÆ„Éû„Çπ„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    }
    
    // Ê≠£Èù¢„Å´ÊïµÈßí„Åå„ÅÑ„ÇãÂ†¥Âêà„ÄÅ„Åù„ÅÆÈßí„ÅÆÁßªÂãï„É´„Éº„É´„ÇíÈÅ©Áî®
    if (frontEnemy) {
      // ÊïµÈßí„ÅÆÁßªÂãï„É´„Éº„É´„ÇíÂèñÂæó
      const enemyPiece = frontEnemy.piece;
      
      // ÊïµÈßí„ÅÆÁßªÂãï„É´„Éº„É´„ÇíÁõ¥Êé•ÈÅ©Áî®
      switch(enemyPiece) {
        case 'Áéã':
        case 'Áéâ':
          return kingMoves(row, col);
        case 'È£õ':
          return rookMoves(row, col);
        case 'Ëßí':
          return bishopMoves(row, col);
        case 'Èáë':
          return goldMoves(row, col);
        case 'ÈäÄ':
          return silverMoves(row, col);
        case 'Ê°Ç':
          return knightMoves(row, col);
        case 'È¶ô':
          return lanceMoves(row, col);
        case 'Ê≠©':
          return pawnMoves(row, col);
        case 'ÂΩ±':
          return shadowMoves(row, col);
        case 'Á†≤':
          return cannonMoves(row, col);
        case 'Á´ú':
          return dragonMoves(row, col);
        case 'Ëæ∞':
          return dragonAwakenedMoves(row, col);
        case 'È≥≥':
          return phoenixMoves(row, col);
        case 'ÁÇé':
          return flameMoves(row, col);
        case 'ÁÅ´':
          return fireMoves(row, col);
        case 'Ê∞¥':
          return waterMoves(row, col);
        case 'Ê≥¢':
          return waveMoves(row, col);
        case 'Êú®':
          return treeMoves(row, col);
        case 'Ëëâ':
          return leafMoves(row, col);
        case 'ÂÖâ':
          return lightMoves(row, col);
        case 'Êòü':
          return starMoves(row, col);
        case 'Èóá':
          return darkMoves(row, col);
        case 'È≠î':
          return demonMoves(row, col);
        case 'ÈäÖ':
          return copperMoves(row, col);
        case 'ÈâÑ':
          return ironMoves(row, col);
        case 'Èå´':
          return tinMoves(row, col);
        case 'Èâõ':
          return leadMoves(row, col);
        case 'ÂÆù':
          return treasureMoves(row, col);
        case 'Èõª':
          return electricMoves(row, col);
        case 'Èõ∑':
          return thunderMoves(row, col);
        case 'ÊôÇ':
          return timeMoves(row, col);
        case 'Ê∞∑':
          return iceMoves(row, col);
        case 'Èõ™':
          return snowMoves(row, col);
        case 'Á†Ç':
          return sandMoves(row, col);
        case 'È¢®':
          return windMoves(row, col);
        case 'Ëãî':
          return mossMoves(row, col);
        case 'Êµ∑':
          return oceanMoves(row, col);
        case 'È≠ö':
          return fishMoves(row, col);
        case 'Èõ≤':
          return cloudMoves(row, col);
        case 'Ëôπ':
          return rainbowMoves(row, col);
        case 'Â≤©':
          return rockMoves(row, col);
        case 'Èâ±':
          return mineralMoves(row, col);
        case 'Âπª':
          return phantomMoves(row, col);
        case 'Èúß':
          return mistMoves(row, col);
        case 'ÁµÇ':
          return endMoves(row, col);
        case 'ÁÑâ':
          return destinyMoves(row, col);
        case '„ÅÇ':
          return ahMoves(row, col);
        case 'Áâ¢':
          return prisonMoves(row, col);
        case 'Êüµ':
          return fenceMoves(row, col);
        case 'Â∂∫':
          return ridgeMoves(row, col);
        case 'Â≥∞':
          return peakMoves(row, col);
        case 'Â≤©':
          return rockMoves(row, col);
        case 'Èâ±':
          return oreMoves(row, col);
        case 'Â¢ì':
          return graveMoves(row, col);
        case 'Èúä':
          return spiritMoves(row, col);
        case 'ÊØí':
          return poisonMoves(row, col);
        case 'Ê≤º':
          return swampMoves(row, col);
        case 'Â¢ì':
          return graveMoves(row, col);
        case 'Èúä':
          return spiritMoves(row, col);
        case 'Ê©ü':
          return machineMoves(row, col);
        case 'Ê≠Ø':
          return gearMoves(row, col);
        case 'Êúà':
          return moonMoves(row, col);
        case 'Èè°':
          return mirrorMoves(row, col);
        case 'Êò†':
          return reflectionMoves(row, col);
        default:
          // „Åù„ÅÆ‰ªñ„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÊñú„ÇÅ„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÁßªÂãï
          [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d => {
            slide(m, row, col, o, d[0], d[1]);
          });
          break;
      }
    } else {
      // Ê≠£Èù¢„Å´ÊïµÈßí„Åå„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØÁ∏¶Ê®™1„Éû„ÇπÁßªÂãï
      [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => {
        pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o);
      });
    }
    
    return m;
  }

  // ‰ΩçÁΩÆ„ÅåÊúâÂäπ„Åã„Å©„ÅÜ„Åã„Çí„ÉÅ„Çß„ÉÉ„ÇØ
  function isValidPosition(row, col) {
    return row >= 0 && row < BOARD_SIZE && col >= 0 && col < BOARD_SIZE;
  }

  // ÊïµÈßí„ÅÆÁßªÂãï„É´„Éº„É´„ÇíÂèñÂæó
  function getEnemyMoves(row, col, piece) {
    const moves = [];
    const owner = state.board[row][col].owner;
    
    // ÂêÑÈßí„ÅÆÁßªÂãï„É´„Éº„É´„ÇíÈÅ©Áî®
    switch(piece) {
      case 'Áéã':
      case 'Áéâ':
        [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
          moves.push([d[0], d[1]]);
        });
        break;
      case 'È£õ':
        [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => {
          for (let i = 1; i < BOARD_SIZE; i++) {
            const newRow = row + d[0] * i;
            const newCol = col + d[1] * i;
            if (newRow < 0 || newRow >= BOARD_SIZE || newCol < 0 || newCol >= BOARD_SIZE) break;
            moves.push([d[0] * i, d[1] * i]);
            if (state.board[newRow][newCol]) break;
          }
        });
        break;
      case 'Ëßí':
        [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d => {
          for (let i = 1; i < BOARD_SIZE; i++) {
            const newRow = row + d[0] * i;
            const newCol = col + d[1] * i;
            if (newRow < 0 || newRow >= BOARD_SIZE || newCol < 0 || newCol >= BOARD_SIZE) break;
            moves.push([d[0] * i, d[1] * i]);
            if (state.board[newRow][newCol]) break;
          }
        });
        break;
      case 'Èáë':
        const f = owner === 'player' ? -1 : 1;
        [[f,-1],[f,0],[f,1],[0,-1],[0,1],[-f,0]].forEach(d => {
          moves.push([d[0], d[1]]);
        });
        break;
      case 'ÈäÄ':
        const f2 = owner === 'player' ? -1 : 1;
        [[f2,-1],[f2,0],[f2,1],[-f2,-1],[-f2,1]].forEach(d => {
          moves.push([d[0], d[1]]);
        });
        break;
      case 'Ê°Ç':
        const f3 = owner === 'player' ? -1 : 1;
        [[2*f3,-1],[2*f3,1]].forEach(d => {
          moves.push([d[0], d[1]]);
        });
        break;
      case 'È¶ô':
        const f4 = owner === 'player' ? -1 : 1;
        for (let i = 1; i < BOARD_SIZE; i++) {
          const newRow = row + f4 * i;
          if (newRow < 0 || newRow >= BOARD_SIZE) break;
          moves.push([f4 * i, 0]);
          if (state.board[newRow][col]) break;
        }
        break;
      case 'Ê≠©':
        const f5 = owner === 'player' ? -1 : 1;
        moves.push([f5, 0]);
        break;
      default:
        // „Åù„ÅÆ‰ªñ„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÊñú„ÇÅ„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÁßªÂãï
        [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d => {
          for (let i = 1; i < BOARD_SIZE; i++) {
            const newRow = row + d[0] * i;
            const newCol = col + d[1] * i;
            if (newRow < 0 || newRow >= BOARD_SIZE || newCol < 0 || newCol >= BOARD_SIZE) break;
            moves.push([d[0] * i, d[1] * i]);
            if (state.board[newRow][newCol]) break;
          }
        });
        break;
    }
    
    return moves;
  }

  // Êò†„ÅÆÁßªÂãïÔºàÈè°„ÅÆÈñìÔºâ
  function reflectionMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    
    // Ê≠£Èù¢„Å´„ÅÑ„ÇãÊïµÈßí„ÇíÊ§úÁ¥¢Ôºà1„Éû„Çπ„Åö„Å§Ââç„Å´ÈÄ≤„Çì„ÅßÂàù„ÇÅ„Å¶„Å§„Åç„ÅÇ„Åü„Å£„ÅüÊïµÈßíÔºâ
    const enemyDirection = o === 'player' ? -1 : 1; // „Éó„É¨„Ç§„É§„Éº„ÅØ‰∏äÂêë„Åç„ÄÅÊïµ„ÅØ‰∏ãÂêë„Åç
    let frontEnemy = null;
    let frontEnemyRow = -1;
    let frontEnemyCol = -1;
    
    // Ê≠£Èù¢ÊñπÂêë„Å´1„Éû„Çπ„Åö„Å§ÈÄ≤„Çì„ÅßÊïµÈßí„ÇíÊ§úÁ¥¢
    for (let i = 1; i < BOARD_SIZE; i++) {
      const checkRow = row + (enemyDirection * i);
      if (checkRow < 0 || checkRow >= BOARD_SIZE) break;
      
      const frontSquare = state.board[checkRow][col];
      if (frontSquare) {
        // Èßí„Åå„ÅÇ„ÇãÂ†¥ÂêàÔºàÂë≥Êñπ„Åß„ÇÇÊïµ„Åß„ÇÇÔºâ
        if (frontSquare.owner !== o) {
          // ÊïµÈßí„ÅÆÂ†¥Âêà
          frontEnemy = frontSquare;
          frontEnemyRow = checkRow;
          frontEnemyCol = col;
        }
        // Âë≥ÊñπÈßí„Åß„ÇÇÊïµÈßí„Åß„ÇÇ„ÄÅÈßí„Å´„Å∂„Å§„Åã„Å£„Åü„ÇâÊ§úÁ¥¢ÁµÇ‰∫Ü
        break;
      }
      // Á©∫„Éû„Çπ„ÅÆÂ†¥Âêà„ÅØÊ¨°„ÅÆ„Éû„Çπ„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    }
    
    // Ê≠£Èù¢„Å´ÊïµÈßí„Åå„ÅÑ„ÇãÂ†¥Âêà„ÄÅ„Åù„ÅÆÈßí„ÅÆÁßªÂãï„É´„Éº„É´„ÇíÈÅ©Áî®
    if (frontEnemy) {
      // ÊïµÈßí„ÅÆÁßªÂãï„É´„Éº„É´„ÇíÂèñÂæó
      const enemyPiece = frontEnemy.piece;
      
      // ÊïµÈßí„ÅÆÁßªÂãï„É´„Éº„É´„ÇíÁõ¥Êé•ÈÅ©Áî®
      switch(enemyPiece) {
        case 'Áéã':
        case 'Áéâ':
          return kingMoves(row, col);
        case 'È£õ':
          return rookMoves(row, col);
        case 'Ëßí':
          return bishopMoves(row, col);
        case 'Èáë':
          return goldMoves(row, col);
        case 'ÈäÄ':
          return silverMoves(row, col);
        case 'Ê°Ç':
          return knightMoves(row, col);
        case 'È¶ô':
          return lanceMoves(row, col);
        case 'Ê≠©':
          return pawnMoves(row, col);
        case 'ÂΩ±':
          return shadowMoves(row, col);
        case 'Á†≤':
          return cannonMoves(row, col);
        case 'Á´ú':
          return dragonMoves(row, col);
        case 'Ëæ∞':
          return dragonAwakenedMoves(row, col);
        case 'È≥≥':
          return phoenixMoves(row, col);
        case 'ÁÇé':
          return flameMoves(row, col);
        case 'ÁÅ´':
          return fireMoves(row, col);
        case 'Ê∞¥':
          return waterMoves(row, col);
        case 'Ê≥¢':
          return waveMoves(row, col);
        case 'Êú®':
          return treeMoves(row, col);
        case 'Ëëâ':
          return leafMoves(row, col);
        case 'ÂÖâ':
          return lightMoves(row, col);
        case 'Êòü':
          return starMoves(row, col);
        case 'Èóá':
          return darkMoves(row, col);
        case 'È≠î':
          return demonMoves(row, col);
        case 'ÈäÖ':
          return copperMoves(row, col);
        case 'ÈâÑ':
          return ironMoves(row, col);
        case 'Èå´':
          return tinMoves(row, col);
        case 'Èâõ':
          return leadMoves(row, col);
        case 'ÂÆù':
          return treasureMoves(row, col);
        case 'Èõª':
          return electricMoves(row, col);
        case 'Èõ∑':
          return thunderMoves(row, col);
        case 'ÊôÇ':
          return timeMoves(row, col);
        case 'Ê∞∑':
          return iceMoves(row, col);
        case 'Èõ™':
          return snowMoves(row, col);
        case 'Á†Ç':
          return sandMoves(row, col);
        case 'È¢®':
          return windMoves(row, col);
        case 'Ëãî':
          return mossMoves(row, col);
        case 'Êµ∑':
          return oceanMoves(row, col);
        case 'È≠ö':
          return fishMoves(row, col);
        case 'Èõ≤':
          return cloudMoves(row, col);
        case 'Ëôπ':
          return rainbowMoves(row, col);
        case 'Â≤©':
          return rockMoves(row, col);
        case 'Èâ±':
          return mineralMoves(row, col);
        case 'Âπª':
          return phantomMoves(row, col);
        case 'Èúß':
          return mistMoves(row, col);
        case 'ÁµÇ':
          return endMoves(row, col);
        case 'ÁÑâ':
          return destinyMoves(row, col);
        case '„ÅÇ':
          return ahMoves(row, col);
        case 'Áâ¢':
          return prisonMoves(row, col);
        case 'Êüµ':
          return fenceMoves(row, col);
        case 'Â∂∫':
          return ridgeMoves(row, col);
        case 'Â≥∞':
          return peakMoves(row, col);
        case 'Â≤©':
          return rockMoves(row, col);
        case 'Èâ±':
          return oreMoves(row, col);
        case 'Â¢ì':
          return graveMoves(row, col);
        case 'Èúä':
          return spiritMoves(row, col);
        case 'ÊØí':
          return poisonMoves(row, col);
        case 'Ê≤º':
          return swampMoves(row, col);
        case 'Â¢ì':
          return graveMoves(row, col);
        case 'Èúä':
          return spiritMoves(row, col);
        case 'Ê©ü':
          return machineMoves(row, col);
        case 'Ê≠Ø':
          return gearMoves(row, col);
        case 'Êúà':
          return moonMoves(row, col);
        case 'Èè°':
          return mirrorMoves(row, col);
        case 'Êò†':
          return reflectionMoves(row, col);
        default:
          // „Åù„ÅÆ‰ªñ„ÅÆÈßí„ÅÆÂ†¥Âêà„ÅØÊñú„ÇÅ„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÁßªÂãï
          [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(d => {
            slide(m, row, col, o, d[0], d[1]);
          });
          break;
      }
    } else {
      // Ê≠£Èù¢„Å´ÊïµÈßí„Åå„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØÁ∏¶Ê®™1„Éû„ÇπÁßªÂãï
      [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => {
        pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o);
      });
    }
    
    return m;
  }

  // Âë™„ÅÆÁßªÂãïÔºàÁÑ°‰∫∫ÊùëÔºâ
  function curseMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Âë™„ÅÆÂäõÔºö8ÊñπÂêë„Å´1„Éû„Çπ + Âë™„ÅÑ„ÅÆÂäπÊûú
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o);
    });
    return m;
  }

  // Áïë„ÅÆÁßªÂãïÔºàÁßòÂ¢ÉÊùëÔºâ- Âãï„Åã„Åõ„Å™„ÅÑ
  function fieldMoves(row, col) {
    // Áïë„ÅØÂãï„Åã„Åõ„Å™„ÅÑÔºàÂõ∫ÂÆöÈßíÔºâ
    return [];
  }

  // ÂÆ∂„ÅÆÁßªÂãïÔºàÁßòÂ¢ÉÊùëÔºâ- Âãï„Åã„Åõ„Å™„ÅÑ
  function houseMoves(row, col) {
    // ÂÆ∂„ÅØÂãï„Åã„Åõ„Å™„ÅÑÔºàÂõ∫ÂÆöÈßíÔºâ
    return [];
  }

  // Ê∞ë„ÅÆÁßªÂãïÔºàÁßòÂ¢ÉÊùëÔºâ
  function peopleMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    
    // Âü∫Êú¨ÁßªÂãïÔºöÂâçÂæåÂ∑¶Âè≥„Å´1„Éû„Çπ
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o));
    
    // Áïë„ÅÆÂäπÊûú„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØÊñú„ÇÅÂâç„Å´„ÇÇÁßªÂãïÂèØËÉΩ
    const piece = state.board[row][col];
    if (piece && piece.fieldEffect) {
      // Êñú„ÇÅÂâç„ÅÆÁßªÂãïÔºàÁïë„ÅÆË±äÁ©£ÂäπÊûúÔºâ
      const diagonalMoves = [[-1,-1],[-1,1]]; // Êñú„ÇÅÂâç
      diagonalMoves.forEach(d => pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o));
      console.log(`üåæ Ê∞ëÈßí(${row},${col})ÔºöÁïë„ÅÆÂäπÊûú„ÅßÊñú„ÇÅÂâçÁßªÂãïÂèØËÉΩ`);
    }
    
    return m;
  }

  // Ê≥â„ÅÆÁßªÂãïÔºàÁ´ú„ÅÆÊ≥âÔºâ
  function springMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Ê≥â„ÅÆÂäõÔºöÁ∏¶Ê®™1„Éû„ÇπÁßªÂãïÂèØËÉΩ„ÄÅÁßªÂãïÊôÇ„Å´„É©„É≥„ÉÄ„É†„Å™Âë≥Êñπ„ÇíÂº∑Âåñ
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(d => pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o));
    return m;
  }

  // Ëæ∞„ÅÆÁßªÂãïÔºàË¶öÈÜí„Åó„ÅüÁ´úÔºâ
  function dragonAwakenedMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    console.log(`üêâ Ëæ∞„ÅÆÁßªÂãïÁØÑÂõ≤Ë®àÁÆóÈñãÂßã: ‰ΩçÁΩÆ=(${row},${col}), ÊâÄÊúâËÄÖ=${o}`);
    // Ëæ∞„ÅÆÂäõÔºö8ÊñπÂêë„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÁßªÂãïÂèØËÉΩÔºàÂÖ®Êñπ‰ΩçÁÑ°ÈôêÁßªÂãïÔºâ
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => slide(m, row, col, o, d[0], d[1], 999));
    console.log(`üêâ Ëæ∞„ÅÆÁßªÂãïÁØÑÂõ≤: ${m.length}ÂÄã„ÅÆÁßªÂãïÂÖà`, m);
    return m;
  }

  // KÂçöÂ£´„ÅÆ„Çπ„Ç≠„É´ÔºöÂÆüÈ®ì‰ΩìÂè¨Âñö
  function triggerKSkill(row, col, owner) {
    console.log(`üß™ KÂçöÂ£´„ÅÆ„Çπ„Ç≠„É´Áô∫Âãï: ÂÆüÈ®ì‰ΩìÂè¨Âñö (${row},${col})`);
    
    // 40%„ÅÆÁ¢∫Áéá„ÅßÁô∫Âãï
    if (Math.random() < 0.4) {
      // Âë®Âõ≤8„Éû„Çπ„ÅÆÁ©∫„Åç„Éû„Çπ„ÇíÊé¢„Åô
      const emptyCells = [];
      for (let dr = -1; dr <= 1; dr++) {
        for (let dc = -1; dc <= 1; dc++) {
          if (dr === 0 && dc === 0) continue; // Ëá™ÂàÜËá™Ë∫´„ÅØÈô§Â§ñ
          const newRow = row + dr;
          const newCol = col + dc;
          if (newRow >= 0 && newRow < BOARD_SIZE && newCol >= 0 && newCol < BOARD_SIZE) {
            const cell = state.board[newRow][newCol];
            if (!cell || !cell.piece || cell.piece === '') {
              emptyCells.push({r: newRow, c: newCol});
            }
          }
        }
      }
      
      if (emptyCells.length > 0) {
        // „É©„É≥„ÉÄ„É†„Å™Á©∫„Åç„Éû„Çπ„ÇíÈÅ∏Êäû
        const randomCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
        
        // ÂÆüÈ®ì‰Ωì„ÇíÂè¨Âñö
        state.board[randomCell.r][randomCell.c] = {
          piece: 'ÂÆü',
          owner: owner,
          isAwakened: false,
          originalPiece: null,
          isTimeStopped: false,
          isRainbowLimited: false,
          isPoisoned: false,
          isSwampTrapped: false,
          isDrowned: false,
          isFrozen: false,
          isSpringEnhanced: false,
          springEnhancedTurns: 0,
          isDragonAwakened: false,
          isHouseSkillUsed: false,
          isFieldSkillUsed: false,
          isKSkillUsed: false,
          kDurability: 2  // KÂçöÂ£´„ÅÆËÄê‰πÖÂäõÔºà2ÂõûÂèñ„Çâ„Çå„Çã„Åæ„ÅßÊ∂à„Åà„Å™„ÅÑÔºâ
        };
        
        console.log(`üß™ ÂÆüÈ®ì‰Ωì„ÇíÂè¨Âñö„Åó„Åæ„Åó„Åü: (${randomCell.r},${randomCell.c})`);
        setStatus(`KÂçöÂ£´„ÅÆÂÆüÈ®ì‰ΩìÂè¨ÂñöÔºÅÂÆüÈ®ì‰Ωì„ÅåÂá∫Áèæ„Åó„Åæ„Åó„Åü`, 'playing');
        
        // Âè¨Âñö„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
        showKSummonEffect(randomCell.r, randomCell.c);
      } else {
        console.log(`üß™ ÂÆüÈ®ì‰ΩìÂè¨ÂñöÂ§±Êïó: Âë®Âõ≤„Å´Á©∫„Åç„Éû„Çπ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì`);
        setStatus(`KÂçöÂ£´„ÅÆÂÆüÈ®ì‰ΩìÂè¨ÂñöÔºÅ„Åó„Åã„ÅóÂë®Âõ≤„Å´Á©∫„Åç„Éû„Çπ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì`, 'playing');
      }
    } else {
      console.log(`üß™ KÂçöÂ£´„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÂ§±Êïó: Á¢∫ÁéáÂ§ñ`);
    }
  }

  // KÂçöÂ£´„ÅÆÂè¨Âñö„Ç®„Éï„Çß„ÇØ„Éà
  function showKSummonEffect(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (!cell) return;
    
    // Âè¨Âñö„Ç®„Éï„Çß„ÇØ„Éà„Çí‰ΩúÊàê
    const effect = document.createElement('div');
    effect.className = 'k-summon-effect';
    effect.style.cssText = `
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(255, 0, 0, 0.8) 0%, rgba(255, 100, 0, 0.6) 30%, transparent 70%);
      border-radius: 50%;
      z-index: 1000;
      pointer-events: none;
      animation: kSummonPulse 1s ease-out;
    `;
    
    cell.appendChild(effect);
    
    // 1ÁßíÂæå„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂâäÈô§
    setTimeout(() => {
      if (effect.parentNode) {
        effect.parentNode.removeChild(effect);
      }
    }, 1000);
  }

  // ÊîªÊíÉÈßí„ÇíÂàó„ÅÆÊúÄÂæå„Å´ÁßªÂãï
  function moveAttackerToBack(fromRow, fromCol, toRow, toCol) {
    const attacker = state.board[fromRow][fromCol];
    if (!attacker) return;
    
    // ÊîªÊíÉÈßí„ÅÆÊâÄÊúâËÄÖ„ÇíÂèñÂæó
    const attackerOwner = attacker.owner;
    
    // Âàó„ÅÆÊúÄÂæå„ÅÆ‰ΩçÁΩÆ„ÇíÊé¢„Åô
    let backRow = -1;
    let backCol = toCol;
    
    if (attackerOwner === 'player') {
      // „Éó„É¨„Ç§„É§„Éº„ÅÆÈßí„ÅÆÂ†¥Âêà„ÄÅ‰∏ãÊñπÂêëÔºàË°åÁï™Âè∑„ÅåÂ§ß„Åç„ÅÑÊñπÂêëÔºâ„ÇíÊé¢„Åô
      for (let r = toRow + 1; r < BOARD_SIZE; r++) {
        if (!state.board[r][backCol] || !state.board[r][backCol].piece) {
          backRow = r;
        } else {
          break;
        }
      }
    } else {
      // „Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÈßí„ÅÆÂ†¥Âêà„ÄÅ‰∏äÊñπÂêëÔºàË°åÁï™Âè∑„ÅåÂ∞è„Åï„ÅÑÊñπÂêëÔºâ„ÇíÊé¢„Åô
      for (let r = toRow - 1; r >= 0; r--) {
        if (!state.board[r][backCol] || !state.board[r][backCol].piece) {
          backRow = r;
        } else {
          break;
        }
      }
    }
    
    if (backRow !== -1) {
      // ÊîªÊíÉÈßí„ÇíÂàó„ÅÆÊúÄÂæå„Å´ÁßªÂãï
      state.board[backRow][backCol] = attacker;
      state.board[fromRow][fromCol] = null;
      
      console.log(`üëë ÊîªÊíÉÈßí„Äå${attacker.piece}„Äç„ÇíÂàó„ÅÆÊúÄÂæå(${backRow},${backCol})„Å´ÁßªÂãï„Åó„Åæ„Åó„Åü`);
      setStatus(`KÂçöÂ£´„ÅÆÂäõÔºÅÊîªÊíÉÈßí„ÇíÂàó„ÅÆÊúÄÂæå„Å´ÁßªÂãï„Åï„Åõ„Åæ„Åó„Åü`, 'playing');
      
      // ÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
      showKDefenseEffect(backRow, backCol);
    } else {
      console.log(`üëë ÊîªÊíÉÈßí„ÅÆÁßªÂãïÂÖà„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü`);
    }
  }

  // KÂçöÂ£´„ÅÆÈò≤Âæ°„Ç®„Éï„Çß„ÇØ„Éà
  function showKDefenseEffect(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (!cell) return;
    
    // Èò≤Âæ°„Ç®„Éï„Çß„ÇØ„Éà„Çí‰ΩúÊàê
    const effect = document.createElement('div');
    effect.className = 'k-defense-effect';
    effect.style.cssText = `
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(255, 215, 0, 0.8) 0%, rgba(255, 165, 0, 0.6) 30%, transparent 70%);
      border-radius: 50%;
      z-index: 1000;
      pointer-events: none;
      animation: kDefensePulse 1s ease-out;
    `;
    
    cell.appendChild(effect);
    
    // 1ÁßíÂæå„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂâäÈô§
    setTimeout(() => {
      if (effect.parentNode) {
        effect.parentNode.removeChild(effect);
      }
    }, 1000);
  }

  // KÂçöÂ£´„ÅÆËÄê‰πÖÂäõ„ÇíÂàùÊúüÂåñ
  function initializeKDurability() {
    for (let r = 0; r < BOARD_SIZE; r++) {
      for (let c = 0; c < BOARD_SIZE; c++) {
        const piece = state.board[r][c];
        if (piece && piece.piece === 'K') {
          piece.kDurability = 2; // KÂçöÂ£´„ÅÆËÄê‰πÖÂäõ„ÅØ2
          console.log(`üëë KÂçöÂ£´„ÅÆËÄê‰πÖÂäõ„ÇíÂàùÊúüÂåñ„Åó„Åæ„Åó„Åü: (${r},${c}) ËÄê‰πÖÂäõ=${piece.kDurability}`);
        }
      }
    }
  }

  // Â§âÂåñÂâç„ÅÆÈßí„ÅÆÁßªÂãïÁØÑÂõ≤„ÇíÂèñÂæó
  function getMutatedMoves(originalPiece) {
    const stage = STAGES[state.stageIndex];
    const pieceType = stage.pieces[originalPiece];
    
    switch (pieceType) {
      case 'king': return 'kingMoves';
      case 'rook': return 'rookMoves';
      case 'bishop': return 'bishopMoves';
      case 'gold': return 'goldMoves';
      case 'silver': return 'silverMoves';
      case 'knight': return 'knightMoves';
      case 'lance': return 'lanceMoves';
      case 'pawn': return 'pawnMoves';
      case 'ninja': return 'ninjaMoves';
      case 'shadow': return 'shadowMoves';
      case 'cannon': return 'cannonMoves';
      case 'dragon': return 'dragonMoves';
      case 'phoenix': return 'phoenixMoves';
      case 'flame': return 'flameMoves';
      case 'fire': return 'fireMoves';
      case 'water': return 'waterMoves';
      case 'wave': return 'waveMoves';
      case 'tree': return 'treeMoves';
      case 'leaf': return 'leafMoves';
      case 'light': return 'lightMoves';
      case 'star': return 'starMoves';
      case 'dark': return 'darkMoves';
      case 'demon': return 'demonMoves';
      case 'copper': return 'copperMoves';
      case 'iron': return 'ironMoves';
      case 'tin': return 'tinMoves';
      case 'lead': return 'leadMoves';
      case 'treasure': return 'treasureMoves';
      case 'electric': return 'electricMoves';
      case 'thunder': return 'thunderMoves';
      case 'time': return 'timeMoves';
      case 'ice': return 'iceMoves';
      case 'snow': return 'snowMoves';
      case 'sand': return 'sandMoves';
      case 'wind': return 'windMoves';
      case 'moss': return 'mossMoves';
      case 'fish': return 'fishMoves';
      case 'cloud': return 'cloudMoves';
      case 'rainbow': return 'rainbowMoves';
      case 'poison': return 'poisonMoves';
      case 'swamp': return 'swampMoves';
      case 'mirror': return 'mirrorMoves';
      case 'reflection': return 'reflectionMoves';
      case 'ah': return 'ahMoves';
      case 'prison': return 'prisonMoves';
      case 'fence': return 'fenceMoves';
      case 'ridge': return 'ridgeMoves';
      case 'peak': return 'peakMoves';
      case 'grave': return 'graveMoves';
      case 'spirit': return 'spiritMoves';
      case 'phantom': return 'phantomMoves';
      case 'mist': return 'mistMoves';
      case 'moon': return 'moonMoves';
      case 'boat': return 'boatMoves';
      case 'machine': return 'machineMoves';
      case 'gear': return 'gearMoves';
      case 'house': return 'houseMoves';
      case 'people': return 'peopleMoves';
      case 'field': return 'fieldMoves';
      case 'spring': return 'springMoves';
      case 'dragonAwakened': return 'dragonAwakenedMoves';
      case 'experiment': return 'experimentMoves';
      case 'mutant': return 'mutantMoves';
      case 'k': return 'kMoves';
      default: return 'mutantMoves'; // „Éá„Éï„Ç©„É´„Éà„ÅØÁï∞„ÅÆÁßªÂãïÁØÑÂõ≤
    }
  }

  // Â§âÂåñÂâç„ÅÆÈßí„ÅÆ„Çπ„Ç≠„É´„ÇíÂèñÂæó
  function getMutatedSkills(originalPiece) {
    const stage = STAGES[state.stageIndex];
    const pieceType = stage.pieces[originalPiece];
    
    // ÂêÑÈßí„ÅÆ„Çπ„Ç≠„É´„ÇíËøî„Åô
    switch (pieceType) {
      case 'time': return 'timeSkill';
      case 'ice': return 'iceSkill';
      case 'snow': return 'snowSkill';
      case 'sand': return 'sandSkill';
      case 'wind': return 'windSkill';
      case 'moss': return 'mossSkill';
      case 'fish': return 'fishSkill';
      case 'cloud': return 'cloudSkill';
      case 'rainbow': return 'rainbowSkill';
      case 'poison': return 'poisonSkill';
      case 'swamp': return 'swampSkill';
      case 'mirror': return 'mirrorSkill';
      case 'reflection': return 'reflectionSkill';
      case 'ah': return 'ahSkill';
      case 'prison': return 'prisonSkill';
      case 'fence': return 'fenceSkill';
      case 'ridge': return 'ridgeSkill';
      case 'peak': return 'peakSkill';
      case 'grave': return 'graveSkill';
      case 'spirit': return 'spiritSkill';
      case 'phantom': return 'phantomSkill';
      case 'mist': return 'mistSkill';
      case 'moon': return 'moonSkill';
      case 'boat': return 'boatSkill';
      case 'machine': return 'machineSkill';
      case 'gear': return 'gearSkill';
      case 'house': return 'houseSkill';
      case 'people': return 'peopleSkill';
      case 'field': return 'fieldSkill';
      case 'spring': return 'springSkill';
      case 'dragonAwakened': return 'dragonAwakenedSkill';
      case 'k': return 'kSkill';
      default: return null; // „Çπ„Ç≠„É´„Å™„Åó
    }
  }

  // ÂÆü„ÅÆÂ§âÂåñ„Ç®„Éï„Çß„ÇØ„Éà
  function showExperimentMutationEffect(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (!cell) return;
    
    // Â§âÂåñ„Ç®„Éï„Çß„ÇØ„Éà„Çí‰ΩúÊàê
    const effect = document.createElement('div');
    effect.className = 'experiment-mutation-effect';
    effect.style.cssText = `
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(34, 197, 94, 0.8) 0%, rgba(16, 185, 129, 0.6) 30%, transparent 70%);
      border-radius: 50%;
      z-index: 1000;
      pointer-events: none;
      animation: experimentMutationPulse 1s ease-out;
    `;
    
    cell.appendChild(effect);
    
    // 1ÁßíÂæå„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂâäÈô§
    setTimeout(() => {
      if (effect.parentNode) {
        effect.parentNode.removeChild(effect);
      }
    }, 1000);
  }

  // ÂÆü„ÅÆÊàª„Çä„Ç®„Éï„Çß„ÇØ„Éà
  function showExperimentReturnEffect(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (!cell) return;
    
    // Êàª„Çä„Ç®„Éï„Çß„ÇØ„Éà„Çí‰ΩúÊàê
    const effect = document.createElement('div');
    effect.className = 'experiment-return-effect';
    effect.style.cssText = `
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(59, 130, 246, 0.8) 0%, rgba(37, 99, 235, 0.6) 30%, transparent 70%);
      border-radius: 50%;
      z-index: 1000;
      pointer-events: none;
      animation: experimentReturnPulse 1s ease-out;
    `;
    
    cell.appendChild(effect);
    
    // 1ÁßíÂæå„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂâäÈô§
    setTimeout(() => {
      if (effect.parentNode) {
        effect.parentNode.removeChild(effect);
      }
    }, 1000);
  }

  // Â§âÂåñÂâç„ÅÆÈßí„ÅÆÁßªÂãïÁØÑÂõ≤„ÇíÂèñÂæó
  function getOriginalMoves(moveFunction, row, col) {
    console.log(`üß™ Â§âÂåñÂâç„ÅÆÈßí„ÅÆÁßªÂãïÁØÑÂõ≤„ÇíÂèñÂæó: ${moveFunction} at (${row},${col})`);
    switch (moveFunction) {
      case 'kingMoves': return kingMoves(row, col);
      case 'rookMoves': return rookMoves(row, col);
      case 'bishopMoves': return bishopMoves(row, col);
      case 'goldMoves': return goldMoves(row, col);
      case 'silverMoves': return silverMoves(row, col);
      case 'knightMoves': return knightMoves(row, col);
      case 'lanceMoves': return lanceMoves(row, col);
      case 'pawnMoves': 
        console.log(`üß™ Ê≠©„ÅÆÁßªÂãïÁØÑÂõ≤„ÇíÂèñÂæó`);
        return pawnMoves(row, col);
      case 'ninjaMoves': return ninjaMoves(row, col);
      case 'shadowMoves': return shadowMoves(row, col);
      case 'cannonMoves': return cannonMoves(row, col);
      case 'dragonMoves': return dragonMoves(row, col);
      case 'phoenixMoves': return phoenixMoves(row, col);
      case 'flameMoves': return flameMoves(row, col);
      case 'fireMoves': return fireMoves(row, col);
      case 'waterMoves': return waterMoves(row, col);
      case 'waveMoves': return waveMoves(row, col);
      case 'treeMoves': return treeMoves(row, col);
      case 'leafMoves': return leafMoves(row, col);
      case 'lightMoves': return lightMoves(row, col);
      case 'starMoves': return starMoves(row, col);
      case 'darkMoves': return darkMoves(row, col);
      case 'demonMoves': return demonMoves(row, col);
      case 'copperMoves': return copperMoves(row, col);
      case 'ironMoves': return ironMoves(row, col);
      case 'tinMoves': return tinMoves(row, col);
      case 'leadMoves': return leadMoves(row, col);
      case 'treasureMoves': return treasureMoves(row, col);
      case 'electricMoves': return electricMoves(row, col);
      case 'thunderMoves': return thunderMoves(row, col);
      case 'timeMoves': return timeMoves(row, col);
      case 'iceMoves': return iceMoves(row, col);
      case 'snowMoves': return snowMoves(row, col);
      case 'sandMoves': return sandMoves(row, col);
      case 'windMoves': return windMoves(row, col);
      case 'mossMoves': return mossMoves(row, col);
      case 'fishMoves': return fishMoves(row, col);
      case 'cloudMoves': return cloudMoves(row, col);
      case 'rainbowMoves': return rainbowMoves(row, col);
      case 'poisonMoves': return poisonMoves(row, col);
      case 'swampMoves': return swampMoves(row, col);
      case 'mirrorMoves': return mirrorMoves(row, col);
      case 'reflectionMoves': return reflectionMoves(row, col);
      case 'ahMoves': return ahMoves(row, col);
      case 'prisonMoves': return prisonMoves(row, col);
      case 'fenceMoves': return fenceMoves(row, col);
      case 'ridgeMoves': return ridgeMoves(row, col);
      case 'peakMoves': return peakMoves(row, col);
      case 'graveMoves': return graveMoves(row, col);
      case 'spiritMoves': return spiritMoves(row, col);
      case 'phantomMoves': return phantomMoves(row, col);
      case 'mistMoves': return mistMoves(row, col);
      case 'moonMoves': return moonMoves(row, col);
      case 'boatMoves': return boatMoves(row, col);
      case 'machineMoves': return machineMoves(row, col);
      case 'gearMoves': return gearMoves(row, col);
      case 'houseMoves': return houseMoves(row, col);
      case 'peopleMoves': return peopleMoves(row, col);
      case 'fieldMoves': return fieldMoves(row, col);
      case 'springMoves': return springMoves(row, col);
      case 'dragonAwakenedMoves': return dragonAwakenedMoves(row, col);
      case 'experimentMoves': return experimentMoves(row, col);
      case 'kMoves': return kMoves(row, col);
      default: return mutantMoves(row, col); // „Éá„Éï„Ç©„É´„Éà„ÅØÁï∞„ÅÆÁßªÂãïÁØÑÂõ≤
    }
  }

  // Ëæ∞„ÅÆ„Çπ„Ç≠„É´ÔºöÁßªÂãïÊôÇ10ÔºÖ„ÅÆÁ¢∫Áéá„ÅßÂë®Âõ≤8„Éû„Çπ„ÅÆÊïµÈßí„Çí„É©„É≥„ÉÄ„É†„Å´1„Å§Ê∂àÊªÖ
  function triggerDragonAwakenedSkill(row, col, owner) {
    console.log(`üêâ Ëæ∞„ÅÆ„Çπ„Ç≠„É´Áô∫Âãï„ÉÅ„Çß„ÉÉ„ÇØ: ‰ΩçÁΩÆ=(${row},${col}), ÊâÄÊúâËÄÖ=${owner}`);
    
    // 10ÔºÖ„ÅÆÁ¢∫Áéá„Åß„Çπ„Ç≠„É´Áô∫Âãï
    if (Math.random() < 0.1) {
      console.log('üêâ Ëæ∞„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÂë®Âõ≤8„Éû„Çπ„ÅÆÊïµÈßí„ÇíÊ∂àÊªÖ„Åï„Åõ„Åæ„Åô');
      
      // Âë®Âõ≤8„Éû„Çπ„ÅÆÊïµÈßí„ÇíÊé¢„Åô
      const enemyPieces = [];
      for (let dr = -1; dr <= 1; dr++) {
        for (let dc = -1; dc <= 1; dc++) {
          if (dr === 0 && dc === 0) continue; // Ëá™ÂàÜËá™Ë∫´„ÅØÈô§Â§ñ
          
          const newRow = row + dr;
          const newCol = col + dc;
          
          if (inBounds(newRow, newCol)) {
            const targetPiece = state.board[newRow][newCol];
            if (targetPiece && targetPiece.owner !== owner && targetPiece.piece !== 'Á©∫' && targetPiece.piece !== 'n' && targetPiece.piece !== 'X' && !['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(targetPiece.piece)) {
              enemyPieces.push({row: newRow, col: newCol, piece: targetPiece});
            }
          }
        }
      }
      
      if (enemyPieces.length > 0) {
        // „É©„É≥„ÉÄ„É†„Å´1„Å§„ÅÆÊïµÈßí„ÇíÈÅ∏Êäû„Åó„Å¶Ê∂àÊªÖ
        const randomIndex = Math.floor(Math.random() * enemyPieces.length);
        const target = enemyPieces[randomIndex];
        
        console.log(`üêâ ÊïµÈßí„Äå${target.piece}„Äç„ÇíÊ∂àÊªÖ„Åï„Åõ„Åæ„Åó„Åü: ‰ΩçÁΩÆ=(${target.row},${target.col})`);
        
        // Èßí„ÇíÊ∂àÊªÖ„Åï„Åõ„Çã
        state.board[target.row][target.col] = null;
        
        // „Ç®„Éï„Çß„ÇØ„ÉàË°®Á§∫
        showDragonAwakenedEffect(target.row, target.col);
        
        setStatus(`Ëæ∞„ÅÆÂäõ„ÅßÊïµÈßí„Äå${target.piece}„Äç„ÇíÊ∂àÊªÖ„Åï„Åõ„Åæ„Åó„ÅüÔºÅ`, 'success');
      } else {
        console.log('üêâ Âë®Âõ≤„Å´ÊïµÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
        setStatus('Ëæ∞„ÅÆÂäõ„ÅåÁô∫Âãï„Åó„Åæ„Åó„Åü„Åå„ÄÅÂë®Âõ≤„Å´ÊïµÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü', 'info');
      }
    } else {
      console.log('üêâ Ëæ∞„ÅÆ„Çπ„Ç≠„É´„ÅØÁô∫Âãï„Åó„Åæ„Åõ„Çì„Åß„Åó„ÅüÔºà90ÔºÖ„ÅÆÁ¢∫ÁéáÔºâ');
    }
  }

  // Ëæ∞„ÅÆ„Çπ„Ç≠„É´„Ç®„Éï„Çß„ÇØ„ÉàË°®Á§∫
  function showDragonAwakenedEffect(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (!cell) return;
    
    // Ê∂àÊªÖ„Ç®„Éï„Çß„ÇØ„Éà
    const effect = document.createElement('div');
    effect.style.cssText = `
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle, rgba(255,0,0,0.8) 0%, rgba(255,100,0,0.6) 30%, transparent 70%);
      border-radius: 50%;
      animation: dragonAwakenedDestruction 1s ease-out forwards;
      pointer-events: none;
      z-index: 1000;
    `;
    
    cell.style.position = 'relative';
    cell.appendChild(effect);
    
    // „Ç®„Éï„Çß„ÇØ„Éà„ÇíÂâäÈô§
    setTimeout(() => {
      if (effect.parentNode) {
        effect.parentNode.removeChild(effect);
      }
    }, 1000);
  }

  // ÂÆü„ÅÆÁßªÂãïÔºàÂÆüÈ®ì‰ΩìÔºâ
  function experimentMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // ÂÆüÈ®ì‰ΩìÔºö‰∏ä‰∏ãÂ∑¶Âè≥„Å´1„Éû„ÇπÁßªÂãïÂèØËÉΩ„ÄÅÁâπÊÆä„Å™ÂÆüÈ®ìËÉΩÂäõ„ÇíÊåÅ„Å§
    [[-1,0],[0,-1],[0,1],[1,0]].forEach(d => pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o));
    return m;
  }

  // Áï∞„ÅÆÁßªÂãïÔºàÂ§âÁï∞‰ΩìÔºâ
  function mutantMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    const piece = state.board[row][col];
    
    console.log(`üß™ Áï∞„ÅÆÁßªÂãïÁØÑÂõ≤„ÇíÂèñÂæó: (${row},${col}), mutatedMoves=${piece.mutatedMoves}`);
    
    // Â§âÂåñÂâç„ÅÆÈßí„ÅÆÁßªÂãïÁØÑÂõ≤„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„Åù„Çå„Çí‰ΩøÁî®
    if (piece.mutatedMoves && piece.mutatedMoves !== 'mutantMoves') {
      console.log(`üß™ Â§âÂåñÂâç„ÅÆÈßí„ÅÆÁßªÂãïÁØÑÂõ≤„Çí‰ΩøÁî®: ${piece.mutatedMoves}`);
      // Â§âÂåñÂâç„ÅÆÈßí„ÅÆÁßªÂãïÁØÑÂõ≤„ÇíÂèñÂæó
      const originalMoves = getOriginalMoves(piece.mutatedMoves, row, col);
      console.log(`üß™ Â§âÂåñÂâç„ÅÆÈßí„ÅÆÁßªÂãïÁØÑÂõ≤: ${originalMoves.length}ÂÄã`);
      return originalMoves;
    }
    
    console.log(`üß™ „Éá„Éï„Ç©„É´„Éà„ÅÆÁï∞„ÅÆÁßªÂãïÁØÑÂõ≤„Çí‰ΩøÁî®`);
    // „Éá„Éï„Ç©„É´„ÉàÔºö8ÊñπÂêë„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÁßªÂãïÂèØËÉΩ„ÄÅÂ§âÁï∞„ÅÆÂäõ„ÇíÊåÅ„Å§
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => slide(m, row, col, o, d[0], d[1], 999));
    return m;
  }

  // Ê≥â„ÅÆÂ≠òÂú®„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Å¶Á´ú„ÇíË¶öÈÜí„Åï„Åõ„Çã
  function checkDragonAwakening() {
    console.log('üêâ Á´ú„ÅÆË¶öÈÜí„ÉÅ„Çß„ÉÉ„ÇØ„ÇíÈñãÂßã„Åó„Åæ„Åô...');
    
    // „Éó„É¨„Ç§„É§„Éº„Å®„Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÁ´ú„ÇíÊé¢„Åô
    for (let owner of ['player', 'computer']) {
      const dragons = [];
      for (let r = 0; r < BOARD_SIZE; r++) {
        for (let c = 0; c < BOARD_SIZE; c++) {
          const piece = state.board[r][c];
          if (piece && piece.piece === 'Á´ú' && piece.owner === owner) {
            dragons.push({r, c, piece});
          }
        }
      }
      
      // Âêå„Åò„Ç™„Éº„Éä„Éº„ÅÆÊ≥â„ÇíÊé¢„Åô
      const springs = [];
      for (let r = 0; r < BOARD_SIZE; r++) {
        for (let c = 0; c < BOARD_SIZE; c++) {
          const piece = state.board[r][c];
          if (piece && piece.piece === 'Ê≥â' && piece.owner === owner) {
            springs.push({r, c, piece});
          }
        }
      }
      
      console.log(`üêâ ${owner}„ÅÆÁ´ú: ${dragons.length}‰Ωì, Ê≥â: ${springs.length}‰Ωì`);
      
      // Ê≥â„Åå„ÅÇ„ÇãÂ†¥Âêà„ÄÅÁ´ú„ÇíË¶öÈÜí„Åï„Åõ„Çã
      if (springs.length > 0) {
        dragons.forEach(dragon => {
          if (!dragon.piece.isAwakened) {
            console.log(`üêâ Á´ú(${dragon.r},${dragon.c})„ÇíË¶öÈÜí„Åï„Åõ„Åæ„ÅôÔºÅ`);
            dragon.piece.isAwakened = true;
            dragon.piece.originalPiece = 'Á´ú'; // ÂÖÉ„ÅÆÈßí„ÇíË®òÈå≤
            dragon.piece.piece = 'Ëæ∞'; // Ë¶öÈÜí„Åó„ÅüÈßí„Å´Â§âÊõ¥
            setStatus(`üêâ Á´ú„ÅåË¶öÈÜí„Åó„Å¶Ëæ∞„Å´„Å™„Çä„Åæ„Åó„ÅüÔºÅ`, 'success');
          }
        });
      } else {
        // Ê≥â„Åå„Å™„ÅÑÂ†¥Âêà„ÄÅÁ´ú„ÇíÈÄöÂ∏∏Áä∂ÊÖã„Å´Êàª„Åô
        dragons.forEach(dragon => {
          if (dragon.piece.isAwakened) {
            console.log(`üêâ Á´ú(${dragon.r},${dragon.c})„ÇíÈÄöÂ∏∏Áä∂ÊÖã„Å´Êàª„Åó„Åæ„Åô`);
            dragon.piece.isAwakened = false;
            dragon.piece.piece = dragon.piece.originalPiece || 'Á´ú';
            delete dragon.piece.originalPiece;
            setStatus(`üêâ Ëæ∞„ÅåÈÄöÂ∏∏„ÅÆÁ´ú„Å´Êàª„Çä„Åæ„Åó„Åü`, 'info');
          }
        });
      }
    }
  }

  // ËÅñ„ÅÆÁßªÂãïÔºàÁ´ú„ÅÆÊ≥âÔºâ
  function holyMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // ËÅñ„ÅÆÂäõÔºö8ÊñπÂêë„Å´1„Éû„Çπ + ËÅñ„Å™„ÇãÂäõ
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      pushIfEnemyOrEmpty(m, row+d[0], col+d[1], o);
    });
    return m;
  }

  // K„ÅÆÁßªÂãïÔºàKÁ†îÁ©∂ÊâÄÔºâ
  function kMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // K„ÅÆÂäõÔºö8ÊñπÂêë„Å´1„Éû„ÇπÁßªÂãïÂèØËÉΩ„ÄÅÁ©∂Ê•µ„ÅÆÁ†îÁ©∂Âäõ
    [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(d => {
      const newRow = row + d[0];
      const newCol = col + d[1];
      if (newRow >= 0 && newRow < BOARD_SIZE && newCol >= 0 && newCol < BOARD_SIZE) {
        const target = state.board[newRow][newCol];
        if (!target || !target.piece || target.owner !== o) {
          m.push({r: newRow, c: newCol});
        }
      }
    });
    return m;
  }



  // È¢®„ÅÆÁßªÂãïÔºàÁ†ÇÊº†„ÅÆÈÅ∫Ë∑°Ôºâ
  function windMoves(row, col) {
    const moves = [];
    // Á∏¶Ê®™„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÁßªÂãïÂèØËÉΩ
    for (let i = 1; i < BOARD_SIZE; i++) {
      // ‰∏ä
      if (row - i >= 0) {
        if (state.board[row - i][col] && state.board[row - i][col].piece === 'X') break;
        if (state.board[row - i][col] && state.board[row - i][col].owner === 'computer') break;
        moves.push({r: row - i, c: col});
        if (state.board[row - i][col] && state.board[row - i][col].owner === 'player') break;
      }
    }
    for (let i = 1; i < BOARD_SIZE; i++) {
      // ‰∏ã
      if (row + i < BOARD_SIZE) {
        if (state.board[row + i][col] && state.board[row + i][col].piece === 'X') break;
        if (state.board[row + i][col] && state.board[row + i][col].owner === 'computer') break;
        moves.push({r: row + i, c: col});
        if (state.board[row + i][col] && state.board[row + i][col].owner === 'player') break;
      }
    }
    for (let i = 1; i < BOARD_SIZE; i++) {
      // Â∑¶
      if (col - i >= 0) {
        if (state.board[row][col - i] && state.board[row][col - i].piece === 'X') break;
        if (state.board[row][col - i] && state.board[row][col - i].owner === 'computer') break;
        moves.push({r: row, c: col - i});
        if (state.board[row][col - i] && state.board[row][col - i].owner === 'player') break;
      }
    }
    for (let i = 1; i < BOARD_SIZE; i++) {
      // Âè≥
      if (col + i < BOARD_SIZE) {
        if (state.board[row][col + i] && state.board[row][col + i].piece === 'X') break;
        if (state.board[row][col + i] && state.board[row][col + i].owner === 'computer') break;
        moves.push({r: row, c: col + i});
        if (state.board[row][col + i] && state.board[row][col + i].owner === 'player') break;
      }
    }
    return moves;
  }

  // Êµ∑„ÅÆÁßªÂãïÔºàÊµ∑Â∫ïÁ•ûÊÆøÔºâ
  function oceanMoves(row, col) {
    const moves = [];
    // 8ÊñπÂêë„Å´2„Éû„Çπ„Åæ„ÅßÁßªÂãïÂèØËÉΩ
    const directions = [[-2,-2],[-2,-1],[-2,0],[-2,1],[-2,2],[-1,-2],[-1,-1],[-1,0],[-1,1],[-1,2],[0,-2],[0,-1],[0,1],[0,2],[1,-2],[1,-1],[1,0],[1,1],[1,2],[2,-2],[2,-1],[2,0],[2,1],[2,2]];
    
    for (const [dr, dc] of directions) {
      const newRow = row + dr;
      const newCol = col + dc;
      if (newRow >= 0 && newRow < BOARD_SIZE && newCol >= 0 && newCol < BOARD_SIZE) {
        if (state.board[newRow][newCol] && state.board[newRow][newCol].piece === 'X') continue;
        if (state.board[newRow][newCol] && state.board[newRow][newCol].owner === 'computer') continue;
        moves.push({r: newRow, c: newCol});
      }
    }
    return moves;
  }



  // Èõ≤„ÅÆÁßªÂãïÔºàÈõ≤„ÅÆÊ•ΩÂúíÔºâ
  function cloudMoves(row, col) {
    const moves = [];
    // 8ÊñπÂêë„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÁßªÂãïÂèØËÉΩ
    for (let i = 1; i < BOARD_SIZE; i++) {
      // ‰∏ä
      if (row - i >= 0) {
        if (state.board[row - i][col] && state.board[row - i][col].piece === 'X') break;
        if (state.board[row - i][col] && state.board[row - i][col].owner === 'computer') break;
        moves.push({r: row - i, c: col});
        if (state.board[row - i][col] && state.board[row - i][col].owner === 'player') break;
      }
    }
    for (let i = 1; i < BOARD_SIZE; i++) {
      // ‰∏ã
      if (row + i < BOARD_SIZE) {
        if (state.board[row + i][col] && state.board[row + i][col].piece === 'X') break;
        if (state.board[row + i][col] && state.board[row + i][col].owner === 'computer') break;
        moves.push({r: row + i, c: col});
        if (state.board[row + i][col] && state.board[row + i][col].owner === 'player') break;
      }
    }
    for (let i = 1; i < BOARD_SIZE; i++) {
      // Â∑¶
      if (col - i >= 0) {
        if (state.board[row][col - i] && state.board[row][col - i].piece === 'X') break;
        if (state.board[row][col - i] && state.board[row][col - i].owner === 'computer') break;
        moves.push({r: row, c: col - i});
        if (state.board[row][col - i] && state.board[row][col - i].owner === 'player') break;
      }
    }
    for (let i = 1; i < BOARD_SIZE; i++) {
      // Âè≥
      if (col + i < BOARD_SIZE) {
        if (state.board[row][col + i] && state.board[row][col + i].piece === 'X') break;
        if (state.board[row][col + i] && state.board[row][col + i].owner === 'computer') break;
        moves.push({r: row, c: col + i});
        if (state.board[row][col + i] && state.board[row][col + i].owner === 'player') break;
      }
    }
    // Êñú„ÇÅ„Å´„ÇÇÁßªÂãïÂèØËÉΩ
    for (let i = 1; i < BOARD_SIZE; i++) {
      // Âè≥‰∏ä
      if (row - i >= 0 && col + i < BOARD_SIZE) {
        if (state.board[row - i][col + i] && state.board[row - i][col + i].piece === 'X') break;
        if (state.board[row - i][col + i] && state.board[row - i][col + i].owner === 'computer') break;
        moves.push({r: row - i, c: col + i});
        if (state.board[row - i][col + i] && state.board[row - i][col + i].owner === 'player') break;
      }
    }
    for (let i = 1; i < BOARD_SIZE; i++) {
      // Â∑¶‰∏ä
      if (row - i >= 0 && col - i >= 0) {
        if (state.board[row - i][col - i] && state.board[row - i][col - i].piece === 'X') break;
        if (state.board[row - i][col - i] && state.board[row - i][col - i].owner === 'computer') break;
        moves.push({r: row - i, c: col - i});
        if (state.board[row - i][col - i] && state.board[row - i][col - i].owner === 'player') break;
      }
    }
    for (let i = 1; i < BOARD_SIZE; i++) {
      // Âè≥‰∏ã
      if (row + i < BOARD_SIZE && col + i < BOARD_SIZE) {
        if (state.board[row + i][col + i] && state.board[row + i][col + i].piece === 'X') break;
        if (state.board[row + i][col + i] && state.board[row + i][col + i].owner === 'computer') break;
        moves.push({r: row + i, c: col + i});
        if (state.board[row + i][col + i] && state.board[row + i][col + i].owner === 'player') break;
      }
    }
    for (let i = 1; i < BOARD_SIZE; i++) {
      // Â∑¶‰∏ã
      if (row + i < BOARD_SIZE && col - i >= 0) {
        if (state.board[row + i][col - i] && state.board[row + i][col - i].piece === 'X') break;
        if (state.board[row + i][col - i] && state.board[row + i][col - i].owner === 'computer') break;
        moves.push({r: row + i, c: col - i});
        if (state.board[row + i][col - i] && state.board[row + i][col - i].owner === 'player') break;
      }
    }
    return moves;
  }


  // Â≤©„ÅÆÁßªÂãïÔºàÂú∞Â∫ï„ÅÆÊ¥ûÁ™üÔºâ
  function rockMoves(row, col) {
    const moves = [];
    // ÂâçÂæå„Å´ÊúÄÂ§ß2„Éû„ÇπÁßªÂãïÂèØËÉΩ
    for (let i = 1; i <= 2; i++) {
      // ‰∏äÔºàÂâçÔºâ
      if (row - i >= 0) {
        if (state.board[row - i][col] && state.board[row - i][col].piece === 'X') break;
        if (state.board[row - i][col] && state.board[row - i][col].owner === 'computer') break;
        moves.push({r: row - i, c: col});
        if (state.board[row - i][col] && state.board[row - i][col].owner === 'player') break;
      }
    }
    for (let i = 1; i <= 2; i++) {
      // ‰∏ãÔºàÂæåÔºâ
      if (row + i < BOARD_SIZE) {
        if (state.board[row + i][col] && state.board[row + i][col].piece === 'X') break;
        if (state.board[row + i][col] && state.board[row + i][col].owner === 'computer') break;
        moves.push({r: row + i, c: col});
        if (state.board[row + i][col] && state.board[row + i][col].owner === 'player') break;
      }
    }
    return moves;
  }

  // Èâ±„ÅÆÁßªÂãïÔºàÂú∞Â∫ï„ÅÆÊ¥ûÁ™üÔºâ
  function mineralMoves(row, col) {
    const moves = [];
    // Èâ±„ÅÆÂäõÔºöÂë®Âõ≤8„Éû„Çπ„Å´ÁßªÂãïÂèØËÉΩÔºàÊé°ÊéòÁØÑÂõ≤Ôºâ
    const directions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    
    for (const [dr, dc] of directions) {
      const newRow = row + dr;
      const newCol = col + dc;
      if (newRow >= 0 && newRow < BOARD_SIZE && newCol >= 0 && newCol < BOARD_SIZE) {
        if (state.board[newRow][newCol] && state.board[newRow][newCol].piece === 'X') continue;
        if (state.board[newRow][newCol] && state.board[newRow][newCol].owner === 'computer') continue;
        moves.push({r: newRow, c: newCol});
      }
    }
    return moves;
  }


  // ÁµÇ„ÅÆÁßªÂãïÔºàÁµÇÁÑâ„ÅÆÁ•ûÊÆøÔºâ
  function endMoves(row, col) {
    const moves = [];
    // 8ÊñπÂêë„Å´‰Ωï„Éû„Çπ„Åß„ÇÇÁßªÂãïÂèØËÉΩ
    for (let i = 1; i < BOARD_SIZE; i++) {
      // ‰∏ä
      if (row - i >= 0) {
        if (state.board[row - i][col] && state.board[row - i][col].piece === 'X') break;
        if (state.board[row - i][col] && state.board[row - i][col].owner === 'computer') break;
        moves.push({r: row - i, c: col});
        if (state.board[row - i][col] && state.board[row - i][col].owner === 'player') break;
      }
    }
    for (let i = 1; i < BOARD_SIZE; i++) {
      // ‰∏ã
      if (row + i < BOARD_SIZE) {
        if (state.board[row + i][col] && state.board[row + i][col].piece === 'X') break;
        if (state.board[row + i][col] && state.board[row + i][col].owner === 'computer') break;
        moves.push({r: row + i, c: col});
        if (state.board[row + i][col] && state.board[row + i][col].owner === 'player') break;
      }
    }
    for (let i = 1; i < BOARD_SIZE; i++) {
      // Â∑¶
      if (col - i >= 0) {
        if (state.board[row][col - i] && state.board[row][col - i].piece === 'X') break;
        if (state.board[row][col - i] && state.board[row][col - i].owner === 'computer') break;
        moves.push({r: row, c: col - i});
        if (state.board[row][col - i] && state.board[row][col - i].owner === 'player') break;
      }
    }
    for (let i = 1; i < BOARD_SIZE; i++) {
      // Âè≥
      if (col + i < BOARD_SIZE) {
        if (state.board[row][col + i] && state.board[row][col + i].piece === 'X') break;
        if (state.board[row][col + i] && state.board[row][col + i].owner === 'computer') break;
        moves.push({r: row, c: col + i});
        if (state.board[row][col + i] && state.board[row][col + i].owner === 'player') break;
      }
    }
    // Êñú„ÇÅ„Å´„ÇÇÁßªÂãïÂèØËÉΩ
    for (let i = 1; i < BOARD_SIZE; i++) {
      // Âè≥‰∏ä
      if (row - i >= 0 && col + i < BOARD_SIZE) {
        if (state.board[row - i][col + i] && state.board[row - i][col + i].piece === 'X') break;
        if (state.board[row - i][col + i] && state.board[row - i][col + i].owner === 'computer') break;
        moves.push({r: row - i, c: col + i});
        if (state.board[row - i][col + i] && state.board[row - i][col + i].owner === 'player') break;
      }
    }
    for (let i = 1; i < BOARD_SIZE; i++) {
      // Â∑¶‰∏ä
      if (row - i >= 0 && col - i >= 0) {
        if (state.board[row - i][col - i] && state.board[row - i][col - i].piece === 'X') break;
        if (state.board[row - i][col - i] && state.board[row - i][col - i].owner === 'computer') break;
        moves.push({r: row - i, c: col - i});
        if (state.board[row - i][col - i] && state.board[row - i][col - i].owner === 'player') break;
      }
    }
    for (let i = 1; i < BOARD_SIZE; i++) {
      // Âè≥‰∏ã
      if (row + i < BOARD_SIZE && col + i < BOARD_SIZE) {
        if (state.board[row + i][col + i] && state.board[row + i][col + i].piece === 'X') break;
        if (state.board[row + i][col + i] && state.board[row + i][col + i].owner === 'computer') break;
        moves.push({r: row + i, c: col + i});
        if (state.board[row + i][col + i] && state.board[row + i][col + i].owner === 'player') break;
      }
    }
    for (let i = 1; i < BOARD_SIZE; i++) {
      // Â∑¶‰∏ã
      if (row + i < BOARD_SIZE && col - i >= 0) {
        if (state.board[row + i][col - i] && state.board[row + i][col - i].piece === 'X') break;
        if (state.board[row + i][col - i] && state.board[row + i][col - i].owner === 'computer') break;
        moves.push({r: row + i, c: col - i});
        if (state.board[row + i][col - i] && state.board[row + i][col - i].owner === 'player') break;
      }
    }
    return moves;
  }

  // ÁÑâ„ÅÆÁßªÂãïÔºàÁµÇÁÑâ„ÅÆÁ•ûÊÆøÔºâ
  function destinyMoves(row, col) {
    const moves = [];
    // 8ÊñπÂêë„Å´1„Éû„ÇπÁßªÂãïÂèØËÉΩ
    const directions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    
    for (const [dr, dc] of directions) {
      const newRow = row + dr;
      const newCol = col + dc;
      if (newRow >= 0 && newRow < BOARD_SIZE && newCol >= 0 && newCol < BOARD_SIZE) {
        if (state.board[newRow][newCol] && state.board[newRow][newCol].piece === 'X') continue;
        if (state.board[newRow][newCol] && state.board[newRow][newCol].owner === 'computer') continue;
        moves.push({r: newRow, c: newCol});
      }
    }
    return moves;
  }

  // Ëãî„ÅÆÁßªÂãïÔºàÈäÄ„Å®Âêå„ÅòÂãï„ÅçÔºâ
  function mossMoves(row, col) {
    const o = state.board[row][col].owner;
    const f = o === 'player' ? -1 : 1;
    const m = [];
    // ÈäÄ„Å®Âêå„ÅòÂãï„Åç: ÂâçÊñπ3ÊñπÂêë + ÂæåÊñπ2ÊñπÂêë
    [[f,-1],[f,0],[f,1],[-f,-1],[-f,1]].forEach(([dr,dc]) => pushIfEnemyOrEmpty(m, row+dr, col+dc, o));
    return m;
  }

  // Ëãî„ÅÆÂá∫Áèæ„Ç®„Éï„Çß„ÇØ„ÉàÔºàÂº∑ÂåñÁâàÔºâ
  function showMossSpawnEffect(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (cell) {
      // „Çª„É´„ÅÆËÉåÊôØËâ≤„Çí‰∏ÄÊôÇÁöÑ„Å´Â§âÊõ¥Ôºà„Çà„ÇäÁõÆÁ´ã„Å§Ëâ≤Ôºâ
      cell.style.backgroundColor = '#00FF00';
      cell.style.transition = 'background-color 0.3s ease';
      cell.style.boxShadow = '0 0 20px #00FF00, inset 0 0 20px #00FF00';
      
      // Ëãî„ÅÆÂá∫Áèæ„ÅÆË¶ñË¶öÁöÑ„Ç®„Éï„Çß„ÇØ„Éà
      cell.style.animation = 'mossSpawn 2s ease-in-out';
      
      // „É°„Ç§„É≥„ÅÆËãî„ÅÆÂá∫Áèæ„Éû„Éº„ÇØÔºàÂ§ß„Åç„ÅèÁõÆÁ´ã„Å§Ôºâ
      const spawnMark = document.createElement('div');
      spawnMark.className = 'moss-spawn-mark';
      spawnMark.textContent = 'üå±';
      spawnMark.style.cssText = `
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 48px;
        color: #00FF00;
        z-index: 1003;
        pointer-events: none;
        animation: mossSpawn 2s ease-in-out;
        filter: drop-shadow(0 0 25px #00FF00);
        text-shadow: 0 0 20px #00FF00;
      `;
      
      // ÊàêÈï∑„Ç®„Éï„Çß„ÇØ„Éà„Éû„Éº„ÇØÔºàÂ§ß„Åç„ÅèÁõÆÁ´ã„Å§Ôºâ
      const growthMark = document.createElement('div');
      growthMark.className = 'moss-growth-mark';
      growthMark.textContent = 'üåø';
      growthMark.style.cssText = `
        position: absolute;
        top: 30%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 36px;
        color: #00FF00;
        z-index: 1004;
        pointer-events: none;
        animation: mossGrowth 2.5s ease-in-out;
        filter: drop-shadow(0 0 20px #00FF00);
        text-shadow: 0 0 15px #00FF00;
      `;
      
      // „Çπ„Ç≠„É´Áô∫Âãï„ÉÜ„Ç≠„Çπ„ÉàÔºàÂ§ß„Åç„ÅèÁõÆÁ´ã„Å§Ôºâ
      const skillText = document.createElement('div');
      skillText.className = 'moss-skill-text';
      skillText.textContent = 'üåø Ëãî„ÅÆ„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ üåø';
      skillText.style.cssText = `
        position: absolute;
        top: 15%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 18px;
        color: #FFFFFF;
        background: linear-gradient(45deg, #00FF00, #32CD32);
        padding: 8px 16px;
        border-radius: 12px;
        z-index: 1005;
        pointer-events: none;
        font-weight: bold;
        animation: mossTextFade 3s ease-in-out;
        border: 3px solid #FFFFFF;
        box-shadow: 0 0 20px #00FF00, 0 0 40px #00FF00;
        text-shadow: 2px 2px 4px #000000;
      `;
      
      // ËøΩÂä†„ÅÆË£ÖÈ£æ„Ç®„Éï„Çß„ÇØ„Éà
      const decorationMark = document.createElement('div');
      decorationMark.className = 'moss-decoration';
      decorationMark.textContent = '‚ú®';
      decorationMark.style.cssText = `
        position: absolute;
        top: 70%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 28px;
        color: #FFD700;
        z-index: 1006;
        pointer-events: none;
        animation: mossDecoration 2s ease-in-out infinite;
        filter: drop-shadow(0 0 15px #FFD700);
      `;
      
      // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„Ç®„Éï„Çß„ÇØ„ÉàÔºàÂ§ß„Åç„ÅèÁõÆÁ´ã„Å§Ôºâ
      for (let i = 0; i < 12; i++) {
        const particle = document.createElement('div');
        particle.className = 'moss-particle';
        particle.style.cssText = `
          position: absolute;
          top: 50%;
          left: 50%;
          width: 8px;
          height: 8px;
          background: #00FF00;
          border-radius: 50%;
          z-index: 1002;
          pointer-events: none;
          animation: mossParticle 2s ease-out;
          box-shadow: 0 0 10px #00FF00;
        `;
        
        // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„ÅÆÂàùÊúü‰ΩçÁΩÆ„Å®„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÊñπÂêë„ÇíË®≠ÂÆö
        const angle = (i * 30) * Math.PI / 180;
        const distance = 50;
        particle.style.setProperty('--start-x', '0px');
        particle.style.setProperty('--start-y', '0px');
        particle.style.setProperty('--end-x', `${Math.cos(angle) * distance}px`);
        particle.style.setProperty('--end-y', `${Math.sin(angle) * distance}px`);
        
        cell.appendChild(particle);
      }
      
      // „Ç®„Éï„Çß„ÇØ„ÉàË¶ÅÁ¥†„Çí„Çª„É´„Å´ËøΩÂä†
      cell.appendChild(spawnMark);
      cell.appendChild(growthMark);
      cell.appendChild(skillText);
      cell.appendChild(decorationMark);
      
      // „Ç®„Éï„Çß„ÇØ„Éà„ÅÆÊÆµÈöéÁöÑ„Å™ÂâäÈô§
      setTimeout(() => {
        cell.style.backgroundColor = '';
        cell.style.boxShadow = '';
        if (spawnMark.parentNode) spawnMark.parentNode.removeChild(spawnMark);
        if (growthMark.parentNode) growthMark.parentNode.removeChild(growthMark);
        if (skillText.parentNode) skillText.parentNode.removeChild(skillText);
        if (decorationMark.parentNode) decorationMark.parentNode.removeChild(decorationMark);
        
        // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„ÇíÂâäÈô§
        const particles = cell.querySelectorAll('.moss-particle');
        particles.forEach(p => {
          if (p.parentNode) p.parentNode.removeChild(p);
        });
        
        cell.style.animation = '';
      }, 3000);
    }
  }

  // È≠ö„ÅÆÊ∫∫„Çå„Çπ„Ç≠„É´: ÁßªÂãïÂæå„Å´Âë®Âõ≤„ÅÆÊïµÈßí„ÇíÊ∫∫„Çå„Åï„Åõ„Çã
  function triggerFishDrowningSkill(row, col, owner) {
    console.log('üêü È≠ö„ÅÆÊ∫∫„Çå„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÂë®Âõ≤„ÅÆÊïµÈßí„ÇíÊ∫∫„Çå„Åï„Åõ„Åæ„Åô...');
    console.log('üêü „Éë„É©„É°„Éº„ÇøÁ¢∫Ë™ç:', { row, col, owner, turnCount: state.turnCount });
    
    const enemyOwner = owner === 'player' ? 'computer' : 'player';
    const directions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    let drownedCount = 0;
    
    for (const [dr, dc] of directions) {
      const checkRow = row + dr;
      const checkCol = col + dc;
      
      // Áõ§Èù¢ÂÜÖ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
      if (checkRow >= 0 && checkRow < BOARD_SIZE && checkCol >= 0 && checkCol < BOARD_SIZE) {
        const targetPiece = state.board[checkRow][checkCol];
        console.log(`üêü „ÉÅ„Çß„ÉÉ„ÇØ‰ΩçÁΩÆ (${checkRow},${checkCol}):`, targetPiece);
        
        // ÊïµÈßí„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÁâπÊÆä„Éû„Çπ„ÅØÈô§Â§ñÔºâ
        if (targetPiece && targetPiece.owner === enemyOwner && 
            targetPiece.piece !== 'X' && targetPiece.piece !== 'n' && !['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(targetPiece.piece)) {
          console.log(`üêü ÊïµÈßíÁô∫Ë¶ã: ${targetPiece.piece} (${checkRow},${checkCol})`);
          // 30%„ÅÆÁ¢∫Áéá„ÅßÊ∫∫„Çå„Åï„Åõ„Çã
          if (Math.random() < 0.3) {
            // Ê∫∫„ÇåÁä∂ÊÖã„ÇíË®≠ÂÆö
            targetPiece.isDrowned = true;
            targetPiece.drownedBy = owner;
            targetPiece.drownedTurn = state.turnCount;
            
            console.log(`üêü Ê∫∫„ÇåÁä∂ÊÖã„ÇíË®≠ÂÆöÂÆå‰∫Ü:`, {
              piece: targetPiece.piece,
              isDrowned: targetPiece.isDrowned,
              drownedBy: targetPiece.drownedBy,
              drownedTurn: targetPiece.drownedTurn
            });
            
            // Ê∫∫„Çå„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
            showFishDrowningEffect(checkRow, checkCol);
            
            drownedCount++;
            console.log(`üêü ÊïµÈßí„Äå${targetPiece.piece}„Äç„ÇíÊ∫∫„Çå„Åï„Åõ„Åæ„Åó„Åü: (${checkRow},${checkCol})`);
          } else {
            console.log(`üêü ÊïµÈßí„Äå${targetPiece.piece}„Äç„ÅØÊ∫∫„Çå„Åæ„Åõ„Çì„Åß„Åó„ÅüÔºàÁ¢∫Áéá30%Êú™Ê∫ÄÔºâ`);
          }
        } else if (targetPiece) {
          console.log(`üêü Âë≥ÊñπÈßí„Åæ„Åü„ÅØÁ©∫„Éû„Çπ: ${targetPiece.piece || 'Á©∫'} (${checkRow},${checkCol})`);
        }
      }
    }
    
    // „Çπ„Ç≠„É´Áô∫Âãï„ÅÆÁµêÊûú„ÇíË°®Á§∫
    if (drownedCount > 0) {
      setStatus(`È≠ö„ÅÆÊ∫∫„Çå„Çπ„Ç≠„É´ÔºÅ${drownedCount}ÂÄã„ÅÆÊïµÈßí„ÇíÊ∫∫„Çå„Åï„Åõ„Åæ„Åó„Åü`, 'playing');
      console.log(`üêü ÂêàË®à${drownedCount}ÂÄã„ÅÆÊïµÈßí„ÇíÊ∫∫„Çå„Åï„Åõ„Åæ„Åó„Åü`);
    } else {
      console.log('üêü Ê∫∫„Çå„Åï„Åõ„ÅüÊïµÈßí„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
    }
  }

  // Ê∫∫„ÇåÁä∂ÊÖã„ÅÆËß£Èô§Âá¶ÁêÜ
  function clearDrowningEffects() {
    for (let row = 0; row < BOARD_SIZE; row++) {
      for (let col = 0; col < BOARD_SIZE; col++) {
        const piece = state.board[row][col];
        if (piece && piece.isDrowned) {
          // 3„Çø„Éº„É≥ÁµåÈÅé„Åó„Åü„ÇâÊ∫∫„ÇåÁä∂ÊÖã„ÇíËß£Èô§Ôºà„Çà„ÇäÈï∑„ÅèË°®Á§∫Ôºâ
          if (state.turnCount > piece.drownedTurn + 2) {
            piece.isDrowned = false;
            piece.drownedBy = null;
            piece.drownedTurn = null;
            console.log(`üêü Èßí„Äå${piece.piece}„Äç„ÅÆÊ∫∫„ÇåÁä∂ÊÖã„ÅåËß£Èô§„Åï„Çå„Åæ„Åó„Åü: (${row},${col})`);
          }
        }
      }
    }
  }

  // ËôπËâ≤Âà∂ÈôêÁä∂ÊÖã„ÅÆËß£Èô§Âá¶ÁêÜ
  function clearRainbowColoringEffects() {
    for (let row = 0; row < BOARD_SIZE; row++) {
      for (let col = 0; col < BOARD_SIZE; col++) {
        const piece = state.board[row][col];
        if (piece && piece.isRainbowLimited) {
          // 2„Çø„Éº„É≥ÁµåÈÅé„Åó„Åü„ÇâËôπËâ≤Âà∂ÈôêÁä∂ÊÖã„ÇíËß£Èô§
          if (state.turnCount >= piece.rainbowLimitedTurn + 2) {
            piece.isRainbowLimited = false;
            piece.rainbowLimitedTurn = null;
            console.log(`üåà Èßí„Äå${piece.piece}„Äç„ÅÆËôπËâ≤Âà∂ÈôêÁä∂ÊÖã„ÅåËß£Èô§„Åï„Çå„Åæ„Åó„Åü: (${row},${col})`);
          }
        }
      }
    }
  }

  // ËôπËâ≤Âà∂ÈôêÁä∂ÊÖã„ÅÆÈßí„ÅÆÁßªÂãïÁØÑÂõ≤ÔºàÁ∏¶Ê®™Â∑¶Âè≥1„Éû„Çπ„ÅÆ„ÅøÔºâ
  function getRainbowLimitedMoves(row, col) {
    const o = state.board[row][col].owner;
    const m = [];
    // Á∏¶Ê®™Â∑¶Âè≥1„Éû„Çπ„ÅÆ„ÅøÁßªÂãïÂèØËÉΩ
    const directions = [[-1,0],[1,0],[0,-1],[0,1]];
    directions.forEach(([dr,dc]) => pushIfEnemyOrEmpty(m, row+dr, col+dc, o));
    return m;
  }

  // Ëôπ„ÅÆ„Ç®„Éï„Çß„ÇØ„ÉàË°®Á§∫
  function showRainbowEffect(fromRow, fromCol, toRow, toCol) {
    const fromCell = document.querySelector(`[data-row="${fromRow}"][data-col="${fromCol}"]`);
    const toCell = document.querySelector(`[data-row="${toRow}"][data-col="${toCol}"]`);
    
    if (fromCell && toCell) {
      // ÁßªÂãïÂÖÉ„Å´Ëôπ„ÅÆËªåË∑°„Ç®„Éï„Çß„ÇØ„Éà
      const rainbowTrail = document.createElement('div');
      rainbowTrail.className = 'rainbow-trail';
      rainbowTrail.style.cssText = `
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 60px;
        height: 60px;
        background: linear-gradient(45deg, #ff0000, #ff8000, #ffff00, #00ff00, #0080ff, #8000ff);
        border-radius: 50%;
        opacity: 0.8;
        animation: rainbowPulse 1s ease-in-out;
        pointer-events: none;
        z-index: 1000;
      `;
      
      fromCell.appendChild(rainbowTrail);
      
      // ÁßªÂãïÂÖà„Å´Ëôπ„ÅÆÁùÄÂú∞„Ç®„Éï„Çß„ÇØ„Éà
      const rainbowLanding = document.createElement('div');
      rainbowLanding.className = 'rainbow-landing';
      rainbowLanding.style.cssText = `
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80px;
        height: 80px;
        background: radial-gradient(circle, rgba(255,0,0,0.8), rgba(255,128,0,0.6), rgba(255,255,0,0.4), rgba(0,255,0,0.2), rgba(0,128,255,0.1), rgba(128,0,255,0.05));
        border-radius: 50%;
        animation: rainbowExpand 1.5s ease-out;
        pointer-events: none;
        z-index: 1000;
      `;
      
      toCell.appendChild(rainbowLanding);
      
      // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÁµÇ‰∫ÜÂæå„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂâäÈô§
      setTimeout(() => {
        if (rainbowTrail.parentNode) rainbowTrail.parentNode.removeChild(rainbowTrail);
        if (rainbowLanding.parentNode) rainbowLanding.parentNode.removeChild(rainbowLanding);
      }, 2000);
    }
  }

  // Ëôπ„ÅÆÊüìËâ≤„Çπ„Ç≠„É´: ÁßªÂãïÂæå„Å´Âë®Âõ≤„ÅÆÊïµÈßí„ÅÆÁßªÂãïÁØÑÂõ≤„ÇíÁ∏¶Ê®™Â∑¶Âè≥1„Éû„Çπ„ÅÆ„Åø„Å´Âà∂Èôê
  function triggerRainbowSkill(row, col, owner) {
    console.log('üåà Ëôπ„ÅÆÊüìËâ≤„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÂë®Âõ≤„ÅÆÊïµÈßí„ÅÆÁßªÂãïÁØÑÂõ≤„ÇíÂà∂Èôê„Åó„Åæ„Åô...');
    
    const enemyOwner = owner === 'player' ? 'computer' : 'player';
    let limitedCount = 0;
    
    // ÁßªÂãïÂÖà„ÅÆÂë®Âõ≤8ÊñπÂêë„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    const directions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
    
    for (const [dr, dc] of directions) {
      const checkRow = row + dr;
      const checkCol = col + dc;
      
      if (checkRow >= 0 && checkRow < BOARD_SIZE && checkCol >= 0 && checkCol < BOARD_SIZE) {
        const targetPiece = state.board[checkRow][checkCol];
        
        if (targetPiece && targetPiece.owner === enemyOwner) {
          // ÁâπÊÆä„Éû„ÇπÔºàÂë™„ÅÑ„Éû„Çπ„ÄÅÁü¢Âç∞„Éû„Çπ„ÄÅ„Éñ„É≠„ÉÉ„ÇØ„Éû„ÇπÔºâ„ÅØÈô§Â§ñ
          if (targetPiece.piece !== 'n' && targetPiece.piece !== 'X' && !['‚Üë', '‚Üê', '‚Üì', '‚Üí'].includes(targetPiece.piece)) {
          console.log(`üåà ÊïµÈßí„Äå${targetPiece.piece}„Äç„ÇíÁô∫Ë¶ã: (${checkRow},${checkCol})`);
          
          // 100%„ÅÆÁ¢∫Áéá„ÅßÁßªÂãïÁØÑÂõ≤„ÇíÂà∂Èôê
          if (Math.random() < 1.0) {
            console.log(`üåà ÊïµÈßí„Äå${targetPiece.piece}„Äç„ÅÆÁßªÂãïÁØÑÂõ≤„ÇíÂà∂Èôê„Åó„Åæ„ÅôÔºÅ`);
            targetPiece.isRainbowLimited = true;
            targetPiece.rainbowLimitedTurn = state.turnCount;
            limitedCount++;
            
            console.log(`üåà ËôπËâ≤Âà∂ÈôêÁä∂ÊÖã„ÇíË®≠ÂÆö: ${targetPiece.piece} isRainbowLimited=${targetPiece.isRainbowLimited}`);
            
            // ËôπËâ≤„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
            showRainbowColoringEffect(checkRow, checkCol);
          } else {
            console.log(`üåà ÊïµÈßí„Äå${targetPiece.piece}„Äç„ÅØÂà∂Èôê„Åï„Çå„Åæ„Åõ„Çì„Åß„Åó„ÅüÔºàÁ¢∫Áéá50%Êú™Ê∫ÄÔºâ`);
            }
          }
        }
      }
    }
    
    // „Çπ„Ç≠„É´Áô∫Âãï„ÅÆÁµêÊûú„ÇíË°®Á§∫
    if (limitedCount > 0) {
      setStatus(`Ëôπ„ÅÆÂà∂Èôê„Çπ„Ç≠„É´ÔºÅ${limitedCount}ÂÄã„ÅÆÊïµÈßí„ÅÆÁßªÂãïÁØÑÂõ≤„ÇíÂà∂Èôê„Åó„Åæ„Åó„Åü`, 'playing');
    } else {
      setStatus('Ëôπ„ÅÆÂà∂Èôê„Çπ„Ç≠„É´Áô∫ÂãïÔºÅÂë®Âõ≤„Å´ÊïµÈßí„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü', 'playing');
    }
  }

  // ËôπËâ≤ÊüìËâ≤„Ç®„Éï„Çß„ÇØ„ÉàË°®Á§∫
  function showRainbowColoringEffect(row, col) {
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    if (cell) {
      const rainbowEffect = document.createElement('div');
      rainbowEffect.className = 'rainbow-coloring-effect';
      rainbowEffect.style.cssText = `
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, #ff0000, #ff8000, #ffff00, #00ff00, #0080ff, #8000ff);
        opacity: 0.6;
        animation: rainbowShimmer 2s ease-in-out infinite;
        pointer-events: none;
        z-index: 500;
        border-radius: 4px;
      `;
      
      cell.appendChild(rainbowEffect);
      
      // „Ç®„Éï„Çß„ÇØ„Éà„Çí2ÁßíÂæå„Å´ÂâäÈô§
      setTimeout(() => {
        if (rainbowEffect.parentNode) {
          rainbowEffect.parentNode.removeChild(rainbowEffect);
        }
      }, 2000);
    }
  }

  // È≠ö„ÅÆÊ∫∫„Çå„Ç®„Éï„Çß„ÇØ„ÉàÔºàÂº∑ÂåñÁâàÔºâ
  function showFishDrowningEffect(row, col) {
    console.log('üêü „Ç®„Éï„Çß„ÇØ„ÉàÈñ¢Êï∞ÈñãÂßã:', { row, col });
    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
    console.log('üêü „Çª„É´Ë¶ÅÁ¥†:', cell);
    if (cell) {
      // „Çª„É´„ÅÆËÉåÊôØËâ≤„Çí‰∏ÄÊôÇÁöÑ„Å´Â§âÊõ¥Ôºà„Çà„ÇäÁõÆÁ´ã„Å§Ê∞¥Ëâ≤Ôºâ
      console.log('üêü „Çª„É´„ÅÆËÉåÊôØËâ≤„ÇíÂ§âÊõ¥‰∏≠...');
      cell.style.backgroundColor = '#00BFFF';
      cell.style.transition = 'background-color 0.3s ease';
      cell.style.boxShadow = '0 0 25px #00BFFF, inset 0 0 25px #00BFFF';
      console.log('üêü „Çª„É´„ÅÆËÉåÊôØËâ≤Â§âÊõ¥ÂÆå‰∫Ü');
      
      // „É°„Ç§„É≥„ÅÆÊ∫∫„Çå„Éû„Éº„ÇØÔºàÂ§ß„Åç„ÅèÁõÆÁ´ã„Å§Ôºâ
      const drowningMark = document.createElement('div');
      drowningMark.className = 'fish-drowning-mark';
      drowningMark.textContent = 'üíß';
      drowningMark.style.cssText = `
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 48px;
        color: #00BFFF;
        z-index: 9999;
        pointer-events: none;
        animation: fishDrowning 3s ease-in-out;
        filter: drop-shadow(0 0 20px #00BFFF);
        text-shadow: 0 0 15px #00BFFF;
      `;
      
      // ËøΩÂä†„ÅÆÊ∫∫„Çå„Éû„Éº„ÇØÔºàÂ∞è„Åï„Å™Ê∞¥Êª¥Ôºâ
      const smallDrops = document.createElement('div');
      smallDrops.className = 'fish-small-drops';
      smallDrops.textContent = 'üí¶';
      smallDrops.style.cssText = `
        position: absolute;
        top: 30%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 32px;
        color: #87CEEB;
        z-index: 9998;
        pointer-events: none;
        animation: fishSmallDrops 2.5s ease-in-out;
        filter: drop-shadow(0 0 15px #87CEEB);
      `;
      
      // „Çπ„Ç≠„É´Áô∫Âãï„ÉÜ„Ç≠„Çπ„ÉàÔºàÂ§ß„Åç„ÅèÁõÆÁ´ã„Å§Ôºâ
      const skillText = document.createElement('div');
      skillText.className = 'fish-skill-text';
      skillText.textContent = 'üêü Ê∫∫„Çå„Çπ„Ç≠„É´Áô∫ÂãïÔºÅ üêü';
      skillText.style.cssText = `
        position: absolute;
        top: 15%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 16px;
        color: #FFFFFF;
        background: linear-gradient(45deg, #00BFFF, #1E90FF);
        padding: 8px 16px;
        border-radius: 12px;
        z-index: 9997;
        pointer-events: none;
        font-weight: bold;
        animation: fishSkillText 3s ease-in-out;
        border: 3px solid #FFFFFF;
        box-shadow: 0 0 20px #00BFFF, 0 0 40px #00BFFF;
        text-shadow: 2px 2px 4px #000000;
      `;
      
      // Ê∫∫„ÇåÁä∂ÊÖã„ÉÜ„Ç≠„Çπ„Éà
      const drowningText = document.createElement('div');
      drowningText.className = 'fish-drowning-text';
      drowningText.textContent = 'Ê∫∫„Çå‰∏≠';
      drowningText.style.cssText = `
        position: absolute;
        top: 70%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 14px;
        color: #FFFFFF;
        background: rgba(0, 191, 255, 0.9);
        padding: 6px 12px;
        border-radius: 8px;
        z-index: 9996;
        pointer-events: none;
        font-weight: bold;
        animation: fishDrowningText 3s ease-in-out;
        border: 2px solid #FFFFFF;
        box-shadow: 0 0 15px #00BFFF;
      `;
      
      // Ë£ÖÈ£æ„Ç®„Éï„Çß„ÇØ„ÉàÔºàÊ≥¢Á¥ãÔºâ
      const waveEffect = document.createElement('div');
      waveEffect.className = 'fish-wave-effect';
      waveEffect.textContent = 'üåä';
      waveEffect.style.cssText = `
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 36px;
        color: #00CED1;
        z-index: 9995;
        pointer-events: none;
        animation: fishWaveEffect 3s ease-in-out infinite;
        filter: drop-shadow(0 0 15px #00CED1);
      `;
      
              // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„Ç®„Éï„Çß„ÇØ„ÉàÔºàÂ∞è„Åï„Å™Ê∞¥Êª¥Ôºâ
        for (let i = 0; i < 8; i++) {
          const particle = document.createElement('div');
          particle.className = 'fish-particle';
          particle.textContent = 'üíß';
          particle.style.cssText = `
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            color: #00BFFF;
            z-index: 9994;
            pointer-events: none;
            animation: fishParticle 2s ease-out;
            filter: drop-shadow(0 0 8px #00BFFF);
          `;
        
        // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„ÅÆÂàùÊúü‰ΩçÁΩÆ„Å®„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÊñπÂêë„ÇíË®≠ÂÆö
        const angle = (i * 45) * Math.PI / 180;
        const distance = 40;
        particle.style.setProperty('--start-x', '0px');
        particle.style.setProperty('--start-y', '0px');
        particle.style.setProperty('--end-x', `${Math.cos(angle) * distance}px`);
        particle.style.setProperty('--end-y', `${Math.sin(angle) * distance}px`);
        
        cell.appendChild(particle);
      }
      
      // „Ç®„Éï„Çß„ÇØ„ÉàË¶ÅÁ¥†„Çí„Çª„É´„Å´ËøΩÂä†
      console.log('üêü „Ç®„Éï„Çß„ÇØ„ÉàË¶ÅÁ¥†„Çí„Çª„É´„Å´ËøΩÂä†‰∏≠...');
      cell.appendChild(drowningMark);
      cell.appendChild(smallDrops);
      cell.appendChild(skillText);
      cell.appendChild(drowningText);
      cell.appendChild(waveEffect);
      console.log('üêü „Ç®„Éï„Çß„ÇØ„ÉàË¶ÅÁ¥†„ÅÆËøΩÂä†ÂÆå‰∫Ü');
      
      // 3ÁßíÂæå„Å´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂâäÈô§
      setTimeout(() => {
        cell.style.backgroundColor = '';
        cell.style.boxShadow = '';
        if (drowningMark.parentNode) drowningMark.parentNode.removeChild(drowningMark);
        if (smallDrops.parentNode) smallDrops.parentNode.removeChild(smallDrops);
        if (skillText.parentNode) skillText.parentNode.removeChild(skillText);
        if (drowningText.parentNode) drowningText.parentNode.removeChild(drowningText);
        if (waveEffect.parentNode) waveEffect.parentNode.removeChild(waveEffect);
        
        // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„ÇíÂâäÈô§
        const particles = cell.querySelectorAll('.fish-particle');
        particles.forEach(p => {
          if (p.parentNode) p.parentNode.removeChild(p);
        });
      }, 3000);
    }
  }


</script>
</body>
</html> 