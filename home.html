<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>三十世紀将棋 - ホーム</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
<script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: "#FFC107",
                        },
                        "background-light": "#F7F7F7",
                        "background-dark": "#121212",
                        "surface-light": "#FFFFFF",
                        "surface-dark": "#1E1E1E",
                        "text-light": "#000000",
                        "text-dark": "#FFFFFF",
                    },
                    fontFamily: {
                        display: ["Roboto", "sans-serif"],
                    },
                    borderRadius: {
                        DEFAULT: "0.5rem",
                    },
                },
            },
        };
    </script>
<style>
        .game-title {
            background: linear-gradient(135deg, #FFC107, #FF8F00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .feature-card {
            transition: all 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-4px);
        }
        .piece-showcase {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 143, 0, 0.1));
        }
        .scrolling-pieces {
            overflow: hidden;
            position: relative;
            height: 120px;
        }
        .scrolling-track {
            display: flex;
            animation: scroll 30s linear infinite;
            width: calc(200% + 2rem);
        }
        .scrolling-track:hover {
            animation-play-state: paused;
        }
        @keyframes scroll {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(-50%);
            }
        }
        .piece-card {
            flex-shrink: 0;
            width: 80px;
            margin-right: 1rem;
            background: white;
            border-radius: 8px;
            padding: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            cursor: pointer;
        }
        .piece-card:hover {
            transform: scale(1.1);
        }
        .dark .piece-card {
            background: #1E1E1E;
            box-shadow: 0 2px 8px rgba(255, 255, 255, 0.1);
        }
        
        /* モーダルスタイル */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .modal-overlay.show .modal-content {
            transform: scale(1);
        }
        .dark .modal-content {
            background: #1E1E1E;
            color: white;
        }
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            padding: 4px;
        }
        .modal-close:hover {
            color: #000;
        }
        .dark .modal-close {
            color: #ccc;
        }
        .dark .modal-close:hover {
            color: white;
        }
        
        /* 背景装飾用の将棋駒 */
        .background-piece {
            position: fixed;
            opacity: 0.1;
            font-size: 4rem;
            color: #666;
            z-index: -1;
            animation: float 20s ease-in-out infinite;
            pointer-events: none;
        }
        .dark .background-piece {
            color: #333;
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0px) rotate(0deg);
            }
            50% {
                transform: translateY(-20px) rotate(5deg);
            }
        }
        
        /* 個別のアニメーション遅延 */
        .piece-1 { animation-delay: 0s; }
        .piece-2 { animation-delay: -2s; }
        .piece-3 { animation-delay: -4s; }
        .piece-4 { animation-delay: -6s; }
        .piece-5 { animation-delay: -8s; }
        .piece-6 { animation-delay: -10s; }
        .piece-7 { animation-delay: -12s; }
        .piece-8 { animation-delay: -14s; }
        .piece-9 { animation-delay: -16s; }
        .piece-10 { animation-delay: -18s; }
        
        /* パーティクルエフェクト */
        .particle {
            position: fixed;
            width: 4px;
            height: 4px;
            background: rgba(255, 193, 7, 0.6);
            border-radius: 50%;
            pointer-events: none;
            z-index: 1;
            animation: particleFloat 8s linear infinite;
        }
        
        @keyframes particleFloat {
            0% {
                transform: translateY(100vh) translateX(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) translateX(100px) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* グラデーション背景アニメーション */
        .animated-gradient {
            background: linear-gradient(-45deg, #FFC107, #FF9800, #FF5722, #E91E63);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* カードホバーエフェクト強化 */
        .feature-card {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        
        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .feature-card:hover::before {
            left: 100%;
        }
        
        .feature-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        /* パルスエフェクト */
        .pulse-effect {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(255, 193, 7, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 193, 7, 0);
            }
        }
        
        /* スクロール時のフェードイン */
        .fade-in {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.6s ease;
        }
        
        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* タイトルのグロウエフェクト */
        .title-glow {
            text-shadow: 0 0 10px rgba(255, 193, 7, 0.5), 0 0 20px rgba(255, 193, 7, 0.3), 0 0 30px rgba(255, 193, 7, 0.2);
            animation: titleGlow 3s ease-in-out infinite alternate;
        }
        
        @keyframes titleGlow {
            0% {
                text-shadow: 0 0 10px rgba(255, 193, 7, 0.5), 0 0 20px rgba(255, 193, 7, 0.3), 0 0 30px rgba(255, 193, 7, 0.2);
            }
            100% {
                text-shadow: 0 0 20px rgba(255, 193, 7, 0.8), 0 0 30px rgba(255, 193, 7, 0.5), 0 0 40px rgba(255, 193, 7, 0.3);
            }
        }
        
        /* マウスフォロワーエフェクト */
        .mouse-follower {
            position: fixed;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, rgba(255, 193, 7, 0.8) 0%, rgba(255, 193, 7, 0.4) 50%, transparent 100%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            transition: all 0.1s ease;
            mix-blend-mode: screen;
        }
        
        /* キラキラエフェクト */
        .sparkle {
            position: fixed;
            width: 6px;
            height: 6px;
            background: #FFD700;
            border-radius: 50%;
            pointer-events: none;
            z-index: 2;
            animation: sparkleFloat 4s linear infinite;
        }
        
        @keyframes sparkleFloat {
            0% {
                transform: translateY(100vh) rotate(0deg) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
                transform: scale(1);
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg) scale(0);
                opacity: 0;
            }
        }
        
        /* 波紋エフェクト */
        .ripple {
            position: fixed;
            border: 2px solid rgba(255, 193, 7, 0.6);
            border-radius: 50%;
            pointer-events: none;
            z-index: 1;
            animation: rippleExpand 2s ease-out infinite;
        }
        
        @keyframes rippleExpand {
            0% {
                width: 0;
                height: 0;
                opacity: 1;
            }
            100% {
                width: 200px;
                height: 200px;
                opacity: 0;
            }
        }
        
        /* ローディングアニメーション */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 193, 7, 0.3);
            border-top: 4px solid #FFC107;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ネオンエフェクト */
        .neon-text {
            text-shadow: 
                0 0 5px #FFC107,
                0 0 10px #FFC107,
                0 0 15px #FFC107,
                0 0 20px #FFC107,
                0 0 35px #FFC107,
                0 0 40px #FFC107;
            animation: neonFlicker 2s infinite alternate;
        }
        
        @keyframes neonFlicker {
            0%, 100% {
                text-shadow: 
                    0 0 5px #FFC107,
                    0 0 10px #FFC107,
                    0 0 15px #FFC107,
                    0 0 20px #FFC107,
                    0 0 35px #FFC107,
                    0 0 40px #FFC107;
            }
            50% {
                text-shadow: 
                    0 0 2px #FFC107,
                    0 0 5px #FFC107,
                    0 0 8px #FFC107,
                    0 0 12px #FFC107,
                    0 0 18px #FFC107,
                    0 0 22px #FFC107;
            }
        }
        
        /* ボタンホバーエフェクト強化 */
        .magic-button {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .magic-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }
        
        .magic-button:hover::before {
            left: 100%;
        }
        
        .magic-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        /* ガチャ専用アニメーション */
        @keyframes gachaGlow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(255, 193, 7, 0.5), 0 0 40px rgba(255, 193, 7, 0.3);
            }
            50% { 
                box-shadow: 0 0 30px rgba(255, 193, 7, 0.8), 0 0 60px rgba(255, 193, 7, 0.5);
            }
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .gacha-glow {
            animation: gachaGlow 2s ease-in-out infinite;
        }
        
        .sparkle {
            animation: sparkle 1.5s ease-in-out infinite;
        }
        
        .float {
            animation: float 3s ease-in-out infinite;
        }
        
        /* ガチャボックスの特別なエフェクト */
        .gacha-box {
            position: relative;
            overflow: hidden;
        }
        
        .gacha-box::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s linear infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        /* テキストタイピングエフェクト */
        .typing-effect {
            overflow: hidden;
            border-right: 2px solid #FFC107;
            white-space: nowrap;
            animation: typing 3s steps(40, end), blink-caret 0.75s step-end infinite;
        }
        
        @keyframes typing {
            from { width: 0; }
            to { width: 100%; }
        }
        
        @keyframes blink-caret {
            from, to { border-color: transparent; }
            50% { border-color: #FFC107; }
        }
        
        /* 3Dカードエフェクト */
        .card-3d {
            transform-style: preserve-3d;
            transition: transform 0.3s ease;
        }
        
        .card-3d:hover {
            transform: rotateY(10deg) rotateX(5deg);
        }
        
        /* グラデーションテキスト */
        .gradient-text {
            background: linear-gradient(45deg, #FFC107, #FF9800, #FF5722, #E91E63);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease infinite;
        }
        
        /* ダークモード時の背景 */
        body.dark {
            background-color: #1a1a1a !important;
            background-image: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%) !important;
        }
        
        /* より強力なダークモード背景設定 */
        .dark body {
            background-color: #1a1a1a !important;
            background-image: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%) !important;
        }
</style>
</head>
<body class="font-display" style="background-color: #FFFACD; background-image: linear-gradient(135deg, #FFFACD 0%, #FFF8DC 100%);">
<!-- 背景装飾用の将棋駒 -->
<div class="background-piece piece-1" style="top: 10%; left: 5%;">玉</div>
<div class="background-piece piece-2" style="top: 20%; left: 15%;">飛</div>
<div class="background-piece piece-3" style="top: 30%; left: 85%;">角</div>
<div class="background-piece piece-4" style="top: 40%; left: 10%;">金</div>
<div class="background-piece piece-5" style="top: 50%; left: 90%;">銀</div>
<div class="background-piece piece-6" style="top: 60%; left: 5%;">桂</div>
<div class="background-piece piece-7" style="top: 70%; left: 80%;">香</div>
<div class="background-piece piece-8" style="top: 80%; left: 20%;">歩</div>
<div class="background-piece piece-9" style="top: 15%; left: 70%;">王</div>
<div class="background-piece piece-10" style="top: 85%; left: 75%;">と</div>

<!-- 背景装飾用の特殊駒 -->
<div class="background-piece piece-1" style="top: 25%; left: 50%; font-size: 3rem;">忍</div>
<div class="background-piece piece-2" style="top: 35%; left: 25%; font-size: 3rem;">龍</div>
<div class="background-piece piece-3" style="top: 45%; left: 65%; font-size: 3rem;">鳳</div>
<div class="background-piece piece-4" style="top: 55%; left: 40%; font-size: 3rem;">炎</div>
<div class="background-piece piece-5" style="top: 65%; left: 55%; font-size: 3rem;">水</div>
<div class="background-piece piece-6" style="top: 75%; left: 35%; font-size: 3rem;">木</div>
<div class="background-piece piece-7" style="top: 5%; left: 50%; font-size: 3rem;">光</div>
<div class="background-piece piece-8" style="top: 95%; left: 45%; font-size: 3rem;">星</div>

<div class="relative min-h-screen">
<!-- ヘッダー -->
<header class="relative animated-gradient text-white p-6">
<div class="container mx-auto">
<div class="flex items-center justify-between">
<div class="flex items-center space-x-4">
<div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center">
<span class="material-icons text-3xl">sports_esports</span>
</div>
<div>
<h1 class="text-5xl font-black game-title title-glow" style="font-family: 'MS Gothic', 'Hiragino Sans', sans-serif; color: #000000 !important; font-weight: 900; letter-spacing: 2px; text-stroke: 1px #000000; -webkit-text-stroke: 1px #000000;">三十世紀将棋</h1>
<p class="text-white/80 typing-effect" style="width: 0; animation: typing 3s steps(20, end) forwards, blink-caret 0.75s step-end infinite; animation-delay: 1s;">特殊駒とスキルで戦う新感覚将棋</p>
</div>
</div>
<div class="flex items-center space-x-4">
<div class="bg-white/20 rounded-full px-4 py-2 flex items-center pulse-effect">
<span class="material-icons mr-2">military_tech</span>
<span class="font-bold" id="totalScore">0</span>
</div>
<button onclick="toggleDarkMode()" class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
<span class="material-icons">dark_mode</span>
</button>
</div>
</div>
</div>
</header>

<!-- メインコンテンツ -->
<main class="container mx-auto px-6 py-8">
<!-- 進捗状況 -->
<div class="bg-surface-light dark:bg-surface-dark rounded-xl shadow-lg p-6 mb-8 fade-in">
<h2 class="text-2xl font-bold text-text-light dark:text-text-dark mb-4 flex items-center">
<span class="material-icons mr-2 text-primary">trending_up</span>
</h2>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
<div class="bg-gradient-to-br from-blue-400 to-blue-600 rounded-lg p-4 text-white card-3d">
<div class="flex items-center justify-between">
<div>
<p class="text-blue-100">クリア済み</p>
<p class="text-2xl font-bold" id="clearedCount">0</p>
<p class="text-blue-100 text-sm">/ 30ステージ</p>
</div>
<span class="material-icons text-4xl opacity-80">check_circle</span>
</div>
</div>
<div class="bg-gradient-to-br from-green-400 to-green-600 rounded-lg p-4 text-white card-3d cursor-pointer hover:from-green-500 hover:to-green-700 transition-all duration-300 transform hover:scale-105" onclick="startMatching()">
<div class="flex items-center justify-between">
<div>
<p class="text-green-100">対人マッチ</p>
<p class="text-2xl font-bold" id="unlockedPieces">1200</p>
<p class="text-green-100 text-sm">レート</p>
</div>
<span class="material-icons text-4xl opacity-80">sports_esports</span>
</div>
</div>
<div class="bg-gradient-to-br from-purple-400 to-purple-600 rounded-lg p-4 text-white card-3d cursor-pointer hover:from-purple-500 hover:to-purple-700 transition-all duration-300 transform hover:scale-105" onclick="showGachaColorInfo()">
<div class="flex items-center justify-between">
<div>
<p class="text-purple-100">ガチャ玉の色</p>
<p class="text-2xl font-bold" id="gachaColorDisplay">白</p>
<p class="text-purple-100 text-sm" id="gachaColorDesc">通常レア度</p>
</div>
<span class="material-icons text-4xl opacity-80" id="gachaColorIcon">circle</span>
</div>
</div>
</div>
</div>


<!-- ゲーム機能 -->
<!-- ダンジョン選択 -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 fade-in">
<!-- ノーマルダンジョン -->
<div class="feature-card bg-surface-light dark:bg-surface-dark rounded-xl shadow-lg p-6 cursor-pointer" onclick="goToStages()">
<div class="flex items-center mb-4">
<div class="w-12 h-12 bg-gradient-to-br from-teal-400 to-cyan-500 rounded-lg flex items-center justify-center mr-4">
<span class="material-icons text-white text-2xl">map</span>
</div>
<h3 class="text-xl font-bold text-text-light dark:text-text-dark">ノーマルダンジョン</h3>
</div>
<p class="text-gray-600 dark:text-gray-300 mb-4">30のユニークなステージで将棋を楽しもう</p>
<button class="w-full bg-gradient-to-r from-teal-400 to-cyan-500 text-white py-2 px-4 rounded-lg font-semibold hover:shadow-lg transition-all magic-button">
ノーマルダンジョン
</button>
</div>

<!-- スペシャルダンジョン -->
<div class="feature-card bg-surface-light dark:bg-surface-dark rounded-xl shadow-lg p-6 cursor-pointer" onclick="goToSpecialDungeon()">
<div class="flex items-center mb-4">
<div class="w-12 h-12 bg-gradient-to-br from-pink-400 to-rose-500 rounded-lg flex items-center justify-center mr-4">
<span class="material-icons text-white text-2xl">stars</span>
</div>
<h3 class="text-xl font-bold text-text-light dark:text-text-dark">スペシャルダンジョン</h3>
</div>
<p class="text-gray-600 dark:text-gray-300 mb-4">特別な報酬が手に入る高難度ステージ</p>
<button class="w-full bg-gradient-to-r from-pink-400 to-rose-500 text-white py-2 px-4 rounded-lg font-semibold hover:shadow-lg transition-all magic-button">
スペシャルダンジョン
</button>
</div>

<!-- イベントダンジョン -->
<div class="feature-card bg-surface-light dark:bg-surface-dark rounded-xl shadow-lg p-6 cursor-pointer" onclick="goToEventDungeon()">
<div class="flex items-center mb-4">
<div class="w-12 h-12 bg-gradient-to-br from-red-400 to-orange-500 rounded-lg flex items-center justify-center mr-4">
<span class="material-icons text-white text-2xl">celebration</span>
</div>
<h3 class="text-xl font-bold text-text-light dark:text-text-dark">イベントダンジョン</h3>
</div>
<p class="text-gray-600 dark:text-gray-300 mb-4">期間限定の特別イベントステージに挑戦</p>
<button class="w-full bg-gradient-to-r from-red-400 to-orange-500 text-white py-2 px-4 rounded-lg font-semibold hover:shadow-lg transition-all magic-button">
イベントダンジョン
</button>
</div>
</div>

<!-- デッキビルダー・駒図鑑 -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 fade-in">
<!-- デッキビルダー -->
<div class="feature-card bg-surface-light dark:bg-surface-dark rounded-xl shadow-lg p-6 cursor-pointer" onclick="goToDeckBuilder()">
<div class="flex items-center mb-4">
<div class="w-12 h-12 bg-gradient-to-br from-purple-400 to-pink-500 rounded-lg flex items-center justify-center mr-4">
<span class="material-icons text-white text-2xl">build</span>
</div>
<h3 class="text-xl font-bold text-text-light dark:text-text-dark">デッキビルダー</h3>
</div>
<p class="text-gray-600 dark:text-gray-300 mb-4">特殊駒を組み合わせて最強のデッキを作ろう</p>
<button class="w-full bg-gradient-to-r from-purple-400 to-pink-500 text-white py-2 px-4 rounded-lg font-semibold hover:shadow-lg transition-all magic-button">
デッキを作成
</button>
</div>

<!-- 駒図鑑 -->
<div class="feature-card bg-surface-light dark:bg-surface-dark rounded-xl shadow-lg p-6 cursor-pointer" onclick="goToPieceInfo()">
<div class="flex items-center mb-4">
<div class="w-12 h-12 bg-gradient-to-br from-amber-400 to-orange-500 rounded-lg flex items-center justify-center mr-4">
<span class="material-icons text-white text-2xl">collections_bookmark</span>
</div>
<h3 class="text-xl font-bold text-text-light dark:text-text-dark">駒図鑑</h3>
</div>
<p class="text-gray-600 dark:text-gray-300 mb-4">全特殊駒の詳細情報とスキルを確認</p>
<button class="w-full bg-gradient-to-r from-amber-400 to-orange-500 text-white py-2 px-4 rounded-lg font-semibold hover:shadow-lg transition-all magic-button">
駒を見る
</button>
</div>
</div>

<!-- 特殊駒ショーケース -->
<div class="bg-surface-light dark:bg-surface-dark rounded-xl shadow-lg p-6 mb-8 fade-in">
<h2 class="text-2xl font-bold text-text-light dark:text-text-dark mb-6 flex items-center">
<span class="material-icons mr-2 text-primary">auto_awesome</span>
特殊駒
</h2>
<div class="scrolling-pieces">
<div class="scrolling-track" id="scrollingTrack">
<!-- 駒がスクロールして流れてきます -->
</div>
</div>
</div>

<!-- 駒ガチャ -->
<div class="relative bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 rounded-2xl shadow-2xl p-8 mb-8 fade-in overflow-hidden">
<!-- 背景エフェクト -->
<div class="absolute inset-0 bg-gradient-to-r from-yellow-400/20 via-pink-400/20 to-purple-400/20 animate-pulse"></div>
<div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23ffffff" fill-opacity="0.1"%3E%3Ccircle cx="30" cy="30" r="2"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-30"></div>

<!-- メインコンテンツ -->
<div class="relative z-10">
<h2 class="text-4xl font-bold text-white mb-8 flex items-center justify-center">
<span class="material-icons mr-3 text-yellow-400 text-5xl animate-spin">casino</span>
<span class="bg-gradient-to-r from-yellow-400 via-pink-400 to-purple-400 bg-clip-text text-transparent animate-pulse">
駒ガチャ
</span>
</h2>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
<!-- ガチャ情報 -->
<div class="space-y-6">
<!-- ガチャポイント -->
<div class="bg-gradient-to-r from-yellow-400/20 to-orange-400/20 backdrop-blur-sm rounded-2xl p-6 border border-yellow-400/30 shadow-xl">
<div class="flex items-center justify-between mb-4">
<h3 class="text-xl font-bold text-white flex items-center">
<span class="material-icons mr-3 text-yellow-400 text-2xl animate-bounce">stars</span>
ガチャポイント
</h3>
<div class="w-8 h-8 bg-yellow-400 rounded-full flex items-center justify-center animate-pulse">
<span class="text-yellow-900 font-bold text-sm">✨</span>
</div>
</div>
<div class="flex items-center justify-between">
<span class="text-4xl font-bold text-yellow-400 animate-pulse">0</span>
<button class="bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-6 py-3 rounded-xl font-bold hover:from-yellow-600 hover:to-orange-600 transition-all transform hover:scale-105 shadow-lg hover:shadow-yellow-500/25 animate-pulse">
購入
</button>
</div>
</div>

<!-- 無料ガチャ -->
<div class="bg-gradient-to-r from-blue-400/20 to-cyan-400/20 backdrop-blur-sm rounded-2xl p-6 border border-blue-400/30 shadow-xl">
<div class="flex items-center justify-between mb-4">
<h3 class="text-xl font-bold text-white flex items-center">
<span class="material-icons mr-3 text-blue-400 text-2xl animate-bounce">card_giftcard</span>
無料ガチャ
</h3>
<div class="w-8 h-8 bg-blue-400 rounded-full flex items-center justify-center animate-pulse">
<span class="text-blue-900 font-bold text-sm">🎁</span>
</div>
</div>
<div class="flex items-center justify-between">
<span class="text-sm text-blue-200 animate-pulse">次回まで: 24:00:00</span>
<button class="bg-gradient-to-r from-blue-500 to-cyan-500 text-white px-6 py-3 rounded-xl font-bold hover:from-blue-600 hover:to-cyan-600 transition-all transform hover:scale-105 shadow-lg hover:shadow-blue-500/25 animate-pulse">
ガチャを引く
</button>
</div>
</div>
</div>

<!-- ガチャボックス表示 -->
<div class="text-center">
<div class="relative bg-gradient-to-br from-purple-500/20 to-pink-500/20 backdrop-blur-sm rounded-3xl p-12 border-2 border-purple-400/50 shadow-2xl gacha-box gacha-glow">
<!-- 装飾的な要素 -->
<div class="absolute top-4 left-4 w-6 h-6 bg-yellow-400 rounded-full sparkle"></div>
<div class="absolute top-4 right-4 w-4 h-4 bg-pink-400 rounded-full sparkle" style="animation-delay: 0.5s;"></div>
<div class="absolute bottom-4 left-4 w-5 h-5 bg-purple-400 rounded-full sparkle" style="animation-delay: 1s;"></div>
<div class="absolute bottom-4 right-4 w-3 h-3 bg-cyan-400 rounded-full sparkle" style="animation-delay: 1.5s;"></div>

<!-- メインガチャボックス -->
<div class="relative">
<div class="w-32 h-32 bg-gradient-to-br from-purple-500 via-pink-500 to-yellow-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-2xl float">
<span class="material-icons text-white text-6xl animate-spin">casino</span>
</div>
<h3 class="text-3xl font-bold text-white mb-4 bg-gradient-to-r from-yellow-400 via-pink-400 to-purple-400 bg-clip-text text-transparent">
ガチャボックス
</h3>
<p class="text-purple-200 mb-8 text-lg">✨ 神秘的な力で新しい駒を召喚しよう！ ✨</p>
<button class="bg-gradient-to-r from-purple-500 via-pink-500 to-yellow-500 text-white px-12 py-4 rounded-2xl font-bold text-xl hover:from-purple-600 hover:via-pink-600 hover:to-yellow-600 transition-all transform hover:scale-110 shadow-2xl hover:shadow-purple-500/50 animate-pulse magic-button gacha-glow">
🎰 ガチャを回す 🎰
</button>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- 最近の獲得駒 -->
<div class="mt-8">
<div class="bg-gradient-to-r from-slate-800/50 to-slate-700/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-600/30 shadow-xl">
<h3 class="text-2xl font-bold text-white mb-6 flex items-center justify-center">
<span class="material-icons mr-3 text-yellow-400 text-3xl animate-bounce">history</span>
<span class="bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent">
最近の獲得駒
</span>
</h3>
<div class="bg-gradient-to-br from-slate-700/50 to-slate-800/50 rounded-xl p-8 text-center border border-slate-600/20">
<div class="w-16 h-16 bg-gradient-to-br from-slate-600 to-slate-700 rounded-full mx-auto mb-4 flex items-center justify-center shadow-lg">
<span class="material-icons text-slate-300 text-3xl">inventory_2</span>
</div>
<p class="text-slate-300 text-lg mb-2">まだガチャを引いていません</p>
<p class="text-slate-400 text-sm">🎰 ガチャを引いて新しい駒を獲得しましょう！ 🎰</p>
</div>
</div>
</div>
</div>

<!-- 最新の更新情報 -->
<div class="bg-surface-light dark:bg-surface-dark rounded-xl shadow-lg p-6 fade-in">
<h2 class="text-2xl font-bold text-text-light dark:text-text-dark mb-4 flex items-center">
<span class="material-icons mr-2 text-primary">new_releases</span>
最新情報
</h2>
<div class="space-y-4">
<div class="flex items-start space-x-4 p-4 bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-lg">
<span class="material-icons text-blue-500">sports_esports</span>
<div>
<h3 class="font-semibold text-text-light dark:text-text-dark">新ステージ追加</h3>
<p class="text-gray-600 dark:text-gray-300 text-sm">ステージ26「月光の湖」で「月」「舟」の新駒が登場！</p>
</div>
</div>
<div class="flex items-start space-x-4 p-4 bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-lg">
<span class="material-icons text-green-500">extension</span>
<div>
<h3 class="font-semibold text-text-light dark:text-text-dark">特殊スキル実装</h3>
<p class="text-gray-600 dark:text-gray-300 text-sm">「幻」の回避スキル、「霧」の消滅スキルなど、多彩な能力を追加</p>
</div>
</div>
<div class="flex items-start space-x-4 p-4 bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-lg">
<span class="material-icons text-purple-500">auto_awesome</span>
<div>
<h3 class="font-semibold text-text-light dark:text-text-dark">視覚エフェクト強化</h3>
<p class="text-gray-600 dark:text-gray-300 text-sm">各特殊駒に美しいアニメーションとエフェクトを実装</p>
      </div>
      </div>
      </div>
    </div>
</main>

<!-- ガチャ玉の色説明モーダル -->
<div id="gachaColorModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
<div class="bg-surface-light dark:bg-surface-dark rounded-2xl p-8 max-w-2xl w-full mx-4 shadow-2xl">
<div class="flex items-center justify-between mb-6">
<h2 class="text-3xl font-bold text-text-light dark:text-text-dark flex items-center">
<span class="material-icons mr-3 text-purple-500 text-4xl">palette</span>
ガチャ玉の色順位
</h2>
<button onclick="closeGachaColorModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors">
<span class="material-icons text-3xl">close</span>
</button>
</div>

<div class="space-y-4">
<!-- 白玉 -->
<div class="bg-gradient-to-r from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 rounded-xl p-4 border-l-4 border-gray-400">
<div class="flex items-center justify-between">
<div class="flex items-center">
<div class="w-8 h-8 bg-white rounded-full border-2 border-gray-300 mr-4"></div>
<div>
<h3 class="text-xl font-bold text-gray-800 dark:text-gray-200">白玉</h3>
<p class="text-gray-600 dark:text-gray-400">通常</p>
</div>
</div>
<div class="text-right">
<p class="text-2xl font-bold text-gray-600 dark:text-gray-300">60%</p>
<p class="text-sm text-gray-500 dark:text-gray-400">出現率</p>
</div>
</div>
</div>

<!-- 青玉 -->
<div class="bg-gradient-to-r from-blue-100 to-blue-200 dark:from-blue-800 dark:to-blue-700 rounded-xl p-4 border-l-4 border-blue-400">
<div class="flex items-center justify-between">
<div class="flex items-center">
<div class="w-8 h-8 bg-blue-500 rounded-full border-2 border-blue-300 mr-4"></div>
<div>
<h3 class="text-xl font-bold text-blue-800 dark:text-blue-200">青玉</h3>
<p class="text-blue-600 dark:text-blue-400">レア</p>
</div>
</div>
<div class="text-right">
<p class="text-2xl font-bold text-blue-600 dark:text-blue-300">20%</p>
<p class="text-sm text-blue-500 dark:text-blue-400">出現率</p>
</div>
</div>
</div>

<!-- 黄玉 -->
<div class="bg-gradient-to-r from-yellow-100 to-yellow-200 dark:from-yellow-800 dark:to-yellow-700 rounded-xl p-4 border-l-4 border-yellow-400">
<div class="flex items-center justify-between">
<div class="flex items-center">
<div class="w-8 h-8 bg-yellow-400 rounded-full border-2 border-yellow-300 mr-4"></div>
<div>
<h3 class="text-xl font-bold text-yellow-800 dark:text-yellow-200">黄玉</h3>
<p class="text-yellow-600 dark:text-yellow-400">ハイレア</p>
</div>
</div>
<div class="text-right">
<p class="text-2xl font-bold text-yellow-600 dark:text-yellow-300">10%</p>
<p class="text-sm text-yellow-500 dark:text-yellow-400">出現率</p>
</div>
</div>
</div>

<!-- 赤玉 -->
<div class="bg-gradient-to-r from-red-100 to-red-200 dark:from-red-800 dark:to-red-700 rounded-xl p-4 border-l-4 border-red-400">
<div class="flex items-center justify-between">
<div class="flex items-center">
<div class="w-8 h-8 bg-red-500 rounded-full border-2 border-red-300 mr-4"></div>
<div>
<h3 class="text-xl font-bold text-red-800 dark:text-red-200">赤玉</h3>
<p class="text-red-600 dark:text-red-400">スーパーレア</p>
</div>
</div>
<div class="text-right">
<p class="text-2xl font-bold text-red-600 dark:text-red-300">7%</p>
<p class="text-sm text-red-500 dark:text-red-400">出現率</p>
</div>
</div>
</div>

<!-- 金玉 -->
<div class="bg-gradient-to-r from-amber-100 to-amber-200 dark:from-amber-800 dark:to-amber-700 rounded-xl p-4 border-l-4 border-amber-400">
<div class="flex items-center justify-between">
<div class="flex items-center">
<div class="w-8 h-8 bg-gradient-to-br from-amber-400 to-amber-600 rounded-full border-2 border-amber-300 mr-4"></div>
<div>
<h3 class="text-xl font-bold text-amber-800 dark:text-amber-200">金玉</h3>
<p class="text-amber-600 dark:text-amber-400">ウルトラレア</p>
</div>
</div>
<div class="text-right">
<p class="text-2xl font-bold text-amber-600 dark:text-amber-300">2%</p>
<p class="text-sm text-amber-500 dark:text-amber-400">出現率</p>
</div>
</div>
</div>

<!-- 黒玉 -->
<div class="bg-gradient-to-r from-gray-800 to-gray-900 dark:from-gray-600 dark:to-gray-700 rounded-xl p-4 border-l-4 border-gray-600">
<div class="flex items-center justify-between">
<div class="flex items-center">
<div class="w-8 h-8 bg-gray-800 rounded-full border-2 border-gray-600 mr-4"></div>
<div>
<h3 class="text-xl font-bold text-gray-200 dark:text-gray-300">黒玉</h3>
<p class="text-gray-300 dark:text-gray-400">レジェンダリーレア</p>
</div>
</div>
<div class="text-right">
<p class="text-2xl font-bold text-gray-300 dark:text-gray-400">1%</p>
<p class="text-sm text-gray-400 dark:text-gray-500">出現率</p>
</div>
</div>
</div>
</div>

<div class="mt-6 p-4 bg-gradient-to-r from-purple-100 to-pink-100 dark:from-purple-900/30 dark:to-pink-900/30 rounded-xl">
<p class="text-center text-purple-700 dark:text-purple-300 font-semibold">
💎 レア度が高いほど、強力な特殊駒が出現しやすくなります！ 💎
</p>
</div>
</div>
</div>

<!-- フッター -->
<footer class="bg-surface-light dark:bg-surface-dark border-t border-gray-200 dark:border-gray-700 py-6">
<div class="container mx-auto px-6 text-center">
<p class="text-gray-600 dark:text-gray-300">
© 2024 将棋ゲーム - 特殊駒とスキルで戦う新感覚将棋
</p>
</div>
</footer>
</div>

<!-- 駒情報モーダル -->
<div class="modal-overlay" id="pieceModal">
<div class="modal-content">
<div class="modal-header">
<div class="modal-title" id="modalTitle">
<span class="material-icons mr-2" id="modalIcon">extension</span>
<span id="modalPieceName">駒名</span>
</div>
<button class="modal-close" onclick="closePieceModal()">
<span class="material-icons">close</span>
</button>
      </div>
<div id="modalContent">
<!-- 駒の詳細情報がここに表示されます -->
      </div>
      </div>
    </div>

<script>
        // データの読み込み
        function loadClearedStages() {
            const cleared = localStorage.getItem('clearedStages');
            const stages = cleared ? JSON.parse(cleared) : [];
            // ステージ0は存在しないので除外
            const validStages = stages.filter(s => s > 0 && s <= 30);
            console.log('クリア済みステージ:', validStages, '件数:', validStages.length);
            return validStages;
        }

        function loadScore() {
            const score = localStorage.getItem('totalScore');
            return score ? parseInt(score) : 0;
        }

        // ガチャ玉の色システム
        function getGachaColor() {
            const colors = ['白', '黄', '青', '赤', '金', '黒'];
            const descriptions = ['普通', 'やや良い', '良い', 'とても良い', '最高', '神'];
            const icons = ['circle', 'star', 'diamond', 'favorite', 'emoji_events', 'dark_mode'];
            const colorStyles = [
                'text-white', 'text-yellow-300', 'text-blue-400', 'text-red-500', 'text-yellow-400', 'text-gray-800'
            ];
            
            // 現在時刻を4時間単位で区切ってシード値を作成
            const now = new Date();
            const hours = now.getHours();
            const dayOfYear = Math.floor((now - new Date(now.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            const timeSlot = Math.floor(hours / 4);
            const seed = dayOfYear * 6 + timeSlot;
            
            // シード値を使ってランダムな色を選択
            const randomIndex = seed % colors.length;
            
            return {
                color: colors[randomIndex],
                description: descriptions[randomIndex],
                icon: icons[randomIndex],
                style: colorStyles[randomIndex],
                rarity: randomIndex + 1 // 1-6のレア度
            };
        }
        
        function updateGachaColor() {
            const gachaInfo = getGachaColor();
            
            document.getElementById('gachaColorDisplay').textContent = gachaInfo.color;
            document.getElementById('gachaColorDisplay').className = `text-2xl font-bold ${gachaInfo.style}`;
            document.getElementById('gachaColorDesc').textContent = gachaInfo.description;
            document.getElementById('gachaColorIcon').textContent = gachaInfo.icon;
            document.getElementById('gachaColorIcon').className = `material-icons text-4xl opacity-80 ${gachaInfo.style}`;
            
            // 背景色も変更（オプション）
            const cardElement = document.querySelector('.bg-gradient-to-br.from-purple-400.to-purple-600');
            if (cardElement) {
                const gradients = [
                    'from-gray-400 to-gray-600',    // 白
                    'from-yellow-400 to-yellow-600', // 黄
                    'from-blue-400 to-blue-600',     // 青
                    'from-red-400 to-red-600',       // 赤
                    'from-yellow-500 to-yellow-700', // 金
                    'from-gray-600 to-gray-800'      // 黒
                ];
                cardElement.className = `bg-gradient-to-br ${gradients[gachaInfo.rarity - 1]} rounded-lg p-4 text-white card-3d`;
            }
            
            // 次の更新時刻を計算（4時間後）
            const now = new Date();
            const nextUpdate = new Date(now.getTime() + (4 - (now.getHours() % 4)) * 60 * 60 * 1000);
            nextUpdate.setMinutes(0, 0, 0);
            
            console.log(`ガチャ玉の色: ${gachaInfo.color} (${gachaInfo.description})`);
            console.log(`次の更新: ${nextUpdate.toLocaleString()}`);
        }

        function loadUnlockedPieces() {
            const clearedStages = loadClearedStages();
            const maxCleared = Math.max(...clearedStages, -1);
            
            // アンロック済み駒の計算
            const stagePieces = {
                1: 0, 2: 3, 3: 3, 4: 5, 5: 7, 6: 10, 7: 13, 8: 16, 9: 19, 10: 22,
                11: 25, 12: 28, 13: 31, 14: 34, 15: 37, 16: 40, 17: 43, 18: 46, 19: 49, 20: 52,
                21: 55, 22: 58, 23: 60, 24: 63, 25: 65, 26: 67, 27: 68, 28: 71, 29: 74, 30: 75
            };
            
            let totalPieces = 0;
            for (let stage = 1; stage <= maxCleared + 1; stage++) {
                if (stagePieces[stage]) {
                    totalPieces += stagePieces[stage];
                }
            }
            
            return totalPieces;
        }

        // ページ遷移
        function goToStages() {
            window.location.href = 'stage_select.html';
        }

        function goToDeckBuilder() {
            window.location.href = 'deck_builder.html';
        }

        function goToPieceInfo() {
            window.location.href = 'piece_info.html';
        }

        // スペシャルダンジョンへ遷移
        function goToSpecialDungeon() {
            // まだ実装されていない旨を通知
            showNotification('スペシャルダンジョン', '近日実装予定！お楽しみに！', 'from-pink-500 to-rose-500');
        }

        // イベントダンジョンへ遷移
        function goToEventDungeon() {
            // まだ実装されていない旨を通知
            showNotification('イベントダンジョン', '期間限定イベント開催をお待ちください！', 'from-red-500 to-orange-500');
        }

        // 汎用通知関数
        function showNotification(title, message, gradient) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 bg-gradient-to-r ${gradient} text-white px-6 py-4 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <div class="mr-3">
                        <span class="material-icons">info</span>
                    </div>
                    <div>
                        <p class="font-bold">${title}</p>
                        <p class="text-sm opacity-90">${message}</p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // 対人マッチング開始
        function startMatching() {
            // マッチング開始のアニメーション
            const matchingCard = document.querySelector('.bg-gradient-to-br.from-green-400.to-green-600');
            if (matchingCard) {
                matchingCard.style.transform = 'scale(0.95)';
                matchingCard.style.transition = 'all 0.2s ease';
                
                setTimeout(() => {
                    matchingCard.style.transform = 'scale(1)';
                }, 200);
            }
            
            // マッチング開始の通知
            showMatchingNotification();
        }

        // マッチング通知を表示
        function showMatchingNotification() {
            // 通知要素を作成
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-gradient-to-r from-green-500 to-blue-500 text-white px-6 py-4 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300';
            notification.innerHTML = `
                <div class="flex items-center">
                    <div class="animate-spin mr-3">
                        <span class="material-icons">refresh</span>
                    </div>
                    <div>
                        <p class="font-bold">マッチング中...</p>
                        <p class="text-sm opacity-90">相手を探しています</p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // アニメーションで表示
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // 3秒後に自動で閉じる
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // ガチャ玉の色説明モーダルを表示
        function showGachaColorInfo() {
            const modal = document.getElementById('gachaColorModal');
            modal.classList.remove('hidden');
            modal.style.opacity = '0';
            modal.style.transform = 'scale(0.9)';
            
            // アニメーションで表示
            setTimeout(() => {
                modal.style.transition = 'all 0.3s ease';
                modal.style.opacity = '1';
                modal.style.transform = 'scale(1)';
            }, 10);
        }

        // ガチャ玉の色説明モーダルを閉じる
        function closeGachaColorModal() {
            const modal = document.getElementById('gachaColorModal');
            modal.style.transition = 'all 0.3s ease';
            modal.style.opacity = '0';
            modal.style.transform = 'scale(0.9)';
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        // ダークモード切り替え
        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            localStorage.setItem('darkMode', isDark);
            
            // 背景色を直接変更
            const body = document.body;
            if (isDark) {
                body.style.backgroundColor = '#1a1a1a';
                body.style.backgroundImage = 'linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%)';
            } else {
                body.style.backgroundColor = '#FFFACD';
                body.style.backgroundImage = 'linear-gradient(135deg, #FFFACD 0%, #FFF8DC 100%)';
            }
        }

        // スクロール駒のデータ（全駒）
        const scrollingPieces = [
            // Stage 2
            { char: '忍', name: '忍', stage: 'ステージ2', color: 'from-gray-800 to-black', movement: '王 + 桂馬', skill: '機動力', description: '忍者のように機敏に動く' },
            { char: '影', name: '影', stage: 'ステージ2', color: 'from-gray-600 to-gray-800', movement: '斜め2マス + 左右', skill: '影の力', description: '影のように動く' },
            { char: '砲', name: '砲', stage: 'ステージ2', color: 'from-red-700 to-red-900', movement: '縦横無限', skill: 'またぎ取り', description: '駒を飛び越えて取る' },
            
            // Stage 4
            { char: '竜', name: '竜', stage: 'ステージ4', color: 'from-red-600 to-red-800', movement: '斜め無限 + 縦横1', skill: '竜の力', description: '竜の力を宿す駒' },
            { char: '鳳', name: '鳳', stage: 'ステージ4', color: 'from-orange-600 to-orange-800', movement: '縦横無限 + 斜め1', skill: '鳳凰の力', description: '不死鳥の力' },
            
            // Stage 5
            { char: '炎', name: '炎', stage: 'ステージ5', color: 'from-red-500 to-red-700', movement: '8方向1マス', skill: '10%消滅', description: '燃え盛る炎' },
            { char: '火', name: '火', stage: 'ステージ5', color: 'from-orange-500 to-orange-700', movement: '縦横3マス', skill: '火の壁', description: '火の力' },
            
            // Stage 6
            { char: '水', name: '水', stage: 'ステージ6', color: 'from-blue-500 to-blue-700', movement: '斜め2マス', skill: '水の流れ', description: '水のように流れる' },
            { char: '波', name: '波', stage: 'ステージ6', color: 'from-cyan-500 to-cyan-700', movement: '縦横2マス', skill: '波の伝播', description: '波を操る' },
            
            // Stage 7
            { char: '木', name: '木', stage: 'ステージ7', color: 'from-green-600 to-green-800', movement: '8方向1マス', skill: '木の成長', description: '生命力あふれる' },
            { char: '葉', name: '葉', stage: 'ステージ7', color: 'from-green-400 to-green-600', movement: '斜め2マス', skill: '葉の舞い', description: '風に舞う葉' },
            
            // Stage 8
            { char: '光', name: '光', stage: 'ステージ8', color: 'from-yellow-400 to-yellow-600', movement: '斜め無限', skill: '壁反射', description: '眩い光' },
            { char: '星', name: '星', stage: 'ステージ8', color: 'from-purple-500 to-purple-700', movement: '縦横無限', skill: '星の軌道', description: '夜空の星' },
            
            // Stage 9
            { char: '闇', name: '闇', stage: 'ステージ9', color: 'from-gray-700 to-gray-900', movement: '8方向2マス', skill: '闇で覆う', description: '深い闇' },
            { char: '魔', name: '魔', stage: 'ステージ9', color: 'from-purple-600 to-purple-800', movement: '縦横無限', skill: '10%消滅', description: '強大な魔力' },
            
            // Stage 10
            { char: '銅', name: '銅', stage: 'ステージ10', color: 'from-yellow-600 to-yellow-800', movement: '桂馬 + 前無限', skill: '導電性', description: '銅の鉱石' },
            { char: '鉄', name: '鉄', stage: 'ステージ10', color: 'from-gray-500 to-gray-700', movement: '銀と同じ', skill: '磁力', description: '鉄の鉱石' },
            { char: '錫', name: '錫', stage: 'ステージ10', color: 'from-gray-400 to-gray-600', movement: '銀と同じ', skill: '柔軟性', description: '錫の鉱石' },
            { char: '鉛', name: '鉛', stage: 'ステージ10', color: 'from-gray-600 to-gray-800', movement: '桂馬 + 前無限', skill: '重さ', description: '鉛の鉱石' },
            
            // Stage 11
            { char: '宝', name: '宝', stage: 'ステージ11', color: 'from-yellow-400 to-yellow-600', movement: '8方向1マス', skill: '20%獲得', description: '宝物を象徴' },
            
            // Stage 12
            { char: '電', name: '電', stage: 'ステージ12', color: 'from-yellow-500 to-yellow-700', movement: '縦横無限', skill: '20%感電', description: '電気の力' },
            { char: '雷', name: '雷', stage: 'ステージ12', color: 'from-blue-600 to-blue-800', movement: '斜め無限', skill: '10%消滅', description: '雷の力' },
            
            // Stage 13
            { char: '時', name: '時', stage: 'ステージ13', color: 'from-blue-500 to-blue-700', movement: '8方向2マス', skill: '時間操作', description: '時空を操る' },
            
            // Stage 14
            { char: '氷', name: '氷', stage: 'ステージ14', color: 'from-cyan-400 to-cyan-600', movement: '8方向1マス', skill: '凍結', description: '氷の冷気' },
            { char: '雪', name: '雪', stage: 'ステージ14', color: 'from-blue-300 to-blue-500', movement: '縦横無限', skill: '氷獲得', description: '雪が舞う' },
            
            // Stage 15
            { char: '砂', name: '砂', stage: 'ステージ15', color: 'from-yellow-500 to-yellow-700', movement: '前方1マス', skill: '連携移動', description: '砂漠の砂' },
            { char: '風', name: '風', stage: 'ステージ15', color: 'from-green-400 to-green-600', movement: '縦横無限', skill: '押し流す', description: '風のように舞う' },
            
            // Stage 16
            { char: '苔', name: '苔', stage: 'ステージ16', color: 'from-green-500 to-green-700', movement: '縦横1マス', skill: '増殖', description: '苔のように広がる' },
            { char: '魚', name: '魚', stage: 'ステージ16', color: 'from-orange-500 to-orange-700', movement: '金と同じ', skill: '30%溺れ', description: '水中を泳ぐ' },
            
            // Stage 17
            { char: '雲', name: '雲', stage: 'ステージ17', color: 'from-gray-400 to-gray-600', movement: '8方向無限', skill: '輸送', description: '雲のように浮遊' },
            { char: '虹', name: '虹', stage: 'ステージ17', color: 'from-pink-400 to-pink-600', movement: '縦横1マス', skill: '範囲制限', description: '美しい虹' },
            
            // Stage 18
            { char: '毒', name: '毒', stage: 'ステージ18', color: 'from-green-600 to-green-800', movement: '前後斜め', skill: '毒マス', description: '猛毒を操る' },
            { char: '沼', name: '沼', stage: 'ステージ18', color: 'from-brown-600 to-brown-800', movement: '前後斜め', skill: '沼に沈める', description: '沼地の泥' },
            
            // Stage 19
            { char: '鏡', name: '鏡', stage: 'ステージ19', color: 'from-blue-300 to-blue-500', movement: '縦横1マス', skill: '動きコピー', description: '攻撃を反射' },
            { char: '映', name: '映', stage: 'ステージ19', color: 'from-purple-400 to-purple-600', movement: '縦横1マス', skill: '動きコピー', description: '動きを映す' },
            
            // Stage 20
            { char: 'あ', name: 'あ', stage: 'ステージ20', color: 'from-red-700 to-red-900', movement: '縦横無限 + 斜め1', skill: '歩に変化', description: '亜空間の創造主' },
            
            // Stage 21
            { char: '牢', name: '牢', stage: 'ステージ21', color: 'from-gray-600 to-gray-800', movement: '縦横無限 + 斜め1', skill: '監禁', description: '敵を閉じ込める' },
            { char: '柵', name: '柵', stage: 'ステージ21', color: 'from-brown-500 to-brown-700', movement: '縦横1マス', skill: '監禁', description: '敵を囲む' },
            
            // Stage 22
            { char: '嶺', name: '嶺', stage: 'ステージ22', color: 'from-gray-500 to-gray-700', movement: '斜め無限', skill: '山召喚', description: '山嶺の力' },
            { char: '峰', name: '峰', stage: 'ステージ22', color: 'from-gray-600 to-gray-800', movement: '金と同じ', skill: '画数無効化', description: '山峰の力' },
            
            // Stage 23
            { char: '岩', name: '岩', stage: 'ステージ23', color: 'from-gray-700 to-gray-900', movement: '縦横1マス', skill: '岩配置', description: '岩を操る' },
            { char: '鉱', name: '鉱', stage: 'ステージ23', color: 'from-yellow-600 to-yellow-800', movement: '8方向1マス', skill: '歩変化', description: '鉱石を発掘' },
            
            // Stage 24
            { char: '墓', name: '墓', stage: 'ステージ24', color: 'from-red-600 to-red-800', movement: '縦横1 + 桂馬', skill: '霊召喚', description: '死者の力' },
            { char: '霊', name: '霊', stage: 'ステージ24', color: 'from-purple-500 to-purple-700', movement: '縦横1マス', skill: '持ち駒NG', description: '霊体' },
            
            // Stage 25
            { char: '幻', name: '幻', stage: 'ステージ25', color: 'from-purple-600 to-purple-800', movement: '縦横1 + 桂横', skill: '50%回避', description: '幻のよう' },
            { char: '霧', name: '霧', stage: 'ステージ25', color: 'from-blue-400 to-blue-600', movement: '斜め1 + 左右1', skill: '20%消去', description: '霧のよう' },
            
            // Stage 26
            { char: '月', name: '月', stage: 'ステージ26', color: 'from-yellow-400 to-yellow-600', movement: 'ターン変化', skill: '月光', description: '月の満ち欠け' },
            { char: '舟', name: '舟', stage: 'ステージ26', color: 'from-cyan-400 to-cyan-600', movement: '縦横無限', skill: '輸送', description: '水上を航行' },
            
            // Stage 27
            { char: '機', name: '機', stage: 'ステージ27', color: 'from-gray-500 to-gray-700', movement: '8方向1マス', skill: 'コピー', description: '機械の力' },
            { char: '歯', name: '歯', stage: 'ステージ27', color: 'from-gray-600 to-gray-800', movement: '斜め1マス', skill: '連動', description: '歯車' },
            
            // Stage 28
            { char: '家', name: '家', stage: 'ステージ28', color: 'from-brown-500 to-brown-700', movement: '固定駒', skill: '民召喚', description: '家族を守る' },
            { char: '民', name: '民', stage: 'ステージ28', color: 'from-blue-500 to-blue-700', movement: '縦横1マス', skill: '畑連携', description: '村人' },
            { char: '畑', name: '畑', stage: 'ステージ28', color: 'from-green-500 to-green-700', movement: '固定駒', skill: '民強化', description: '大地の恵み' },
            
            // Stage 29
            { char: '泉', name: '泉', stage: 'ステージ29', color: 'from-cyan-500 to-cyan-700', movement: '縦横1マス', skill: '強化 + 竜覚醒', description: '清らかな水' },
            { char: '辰', name: '辰', stage: 'ステージ29', color: 'from-red-700 to-red-900', movement: '8方向無限', skill: '10%消滅', description: '覚醒した竜' },
            
            // Stage 30
            { char: 'K', name: 'K', stage: 'ステージ30', color: 'from-red-600 to-red-800', movement: '8方向1マス', skill: '実験体召喚', description: '最終ボス' },
            { char: '実', name: '実', stage: 'ステージ30', color: 'from-green-500 to-green-700', movement: '縦横1マス', skill: '異に変化', description: '実験の成果' },
            { char: '異', name: '変', stage: 'ステージ30', color: 'from-purple-600 to-purple-800', movement: '8方向無限', skill: '能力継承', description: '実験の失敗作' }
        ];

        // スクロール駒の生成
        function generateScrollingPieces() {
            const track = document.getElementById('scrollingTrack');
            
            // 駒を2セット作成（無限ループのため）
            for (let i = 0; i < 2; i++) {
                scrollingPieces.forEach(piece => {
                    const pieceCard = document.createElement('div');
                    pieceCard.className = 'piece-card cursor-pointer hover:scale-110 transition-transform duration-200';
                    pieceCard.innerHTML = `
                        <div class="text-center">
                            <div class="w-12 h-12 bg-gradient-to-br ${piece.color} rounded-lg mx-auto mb-2 flex items-center justify-center shadow-lg hover:shadow-xl transition-shadow">
                                <span class="text-white font-bold text-lg">${piece.char}</span>
                            </div>
                            <p class="text-xs font-medium text-text-light dark:text-text-dark">${piece.name}</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">${piece.stage}</p>
                        </div>
                    `;
                    
                    // クリックイベントを追加 - 駒情報ページに遷移
                    pieceCard.addEventListener('click', () => {
                        window.location.href = `piece_info.html?piece=${piece.char}`;
                    });
                    
                    track.appendChild(pieceCard);
                });
            }
        }

        // 駒情報モーダルを表示
        function showPieceModal(piece) {
            const modal = document.getElementById('pieceModal');
            const modalTitle = document.getElementById('modalPieceName');
            const modalContent = document.getElementById('modalContent');
            
            // タイトルを設定
            modalTitle.textContent = piece.name;
            
            // コンテンツを生成
            modalContent.innerHTML = `
                <div class="space-y-4">
                    <div class="text-center">
                        <div class="w-20 h-20 bg-gradient-to-br ${piece.color} rounded-lg mx-auto mb-4 flex items-center justify-center">
                            <span class="text-white font-bold text-3xl">${piece.char}</span>
                        </div>
                        <h3 class="text-xl font-bold text-text-light dark:text-text-dark">${piece.name}</h3>
                        <p class="text-sm text-gray-500 dark:text-gray-400">${piece.stage}でアンロック</p>
                    </div>
                    
                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-lg p-4">
                        <h4 class="font-semibold text-text-light dark:text-text-dark mb-2 flex items-center">
                            <span class="material-icons mr-2 text-blue-500">directions_walk</span>
                            移動範囲
                        </h4>
                        <p class="text-sm text-gray-700 dark:text-gray-300">${piece.movement}</p>
                    </div>
                    
                    <div class="bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-lg p-4">
                        <h4 class="font-semibold text-text-light dark:text-text-dark mb-2 flex items-center">
                            <span class="material-icons mr-2 text-purple-500">auto_awesome</span>
                            特殊スキル
                        </h4>
                        <p class="text-sm text-gray-700 dark:text-gray-300">${piece.skill}</p>
                    </div>
                    
                    <div class="bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-lg p-4">
                        <h4 class="font-semibold text-text-light dark:text-text-dark mb-2 flex items-center">
                            <span class="material-icons mr-2 text-green-500">info</span>
                            説明
                        </h4>
                        <p class="text-sm text-gray-700 dark:text-gray-300">${piece.description}</p>
                    </div>
                    
                    <div class="text-center pt-4">
                        <button onclick="goToPieceInfo()" class="bg-primary text-white px-6 py-2 rounded-lg font-semibold hover:bg-primary-dark transition-colors">
                            駒図鑑で詳細を見る
                        </button>
                    </div>
  </div>
            `;
            
            // モーダルを表示
            modal.classList.add('show');
        }

        // 駒情報モーダルを閉じる
        function closePieceModal() {
            const modal = document.getElementById('pieceModal');
            modal.classList.remove('show');
        }

        // 駒図鑑ページに遷移
        function goToPieceInfo() {
            window.location.href = 'piece_info.html';
        }

        // モーダルの背景クリックで閉じる
        document.addEventListener('DOMContentLoaded', function() {
            const pieceModal = document.getElementById('pieceModal');
            pieceModal.addEventListener('click', function(e) {
                if (e.target === pieceModal) {
                    closePieceModal();
                }
            });

            const gachaColorModal = document.getElementById('gachaColorModal');
            gachaColorModal.addEventListener('click', function(e) {
                if (e.target === gachaColorModal) {
                    closeGachaColorModal();
                }
            });
            
            // ESCキーでモーダルを閉じる
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closePieceModal();
                    closeGachaColorModal();
                }
            });
        });

        // パーティクルエフェクト生成
        function createParticle() {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = Math.random() * 100 + '%';
            particle.style.animationDuration = (Math.random() * 3 + 5) + 's';
            particle.style.animationDelay = Math.random() * 2 + 's';
            document.body.appendChild(particle);
            
            // アニメーション終了後に削除
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, 8000);
        }

        // スクロール検知
        function handleScroll() {
            const elements = document.querySelectorAll('.fade-in');
            elements.forEach(element => {
                const elementTop = element.getBoundingClientRect().top;
                const elementVisible = 150;
                
                if (elementTop < window.innerHeight - elementVisible) {
                    element.classList.add('visible');
                }
            });
        }

        // パーティクル生成の間隔設定
        function startParticleEffect() {
            setInterval(createParticle, 800);
        }

        // キラキラエフェクト生成
        function createSparkle() {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            sparkle.style.left = Math.random() * 100 + '%';
            sparkle.style.animationDuration = (Math.random() * 2 + 3) + 's';
            sparkle.style.animationDelay = Math.random() * 1 + 's';
            document.body.appendChild(sparkle);
            
            setTimeout(() => {
                if (sparkle.parentNode) {
                    sparkle.parentNode.removeChild(sparkle);
                }
            }, 4000);
        }

        // 波紋エフェクト生成
        function createRipple(x, y) {
            const ripple = document.createElement('div');
            ripple.className = 'ripple';
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';
            ripple.style.marginLeft = '-100px';
            ripple.style.marginTop = '-100px';
            document.body.appendChild(ripple);
            
            setTimeout(() => {
                if (ripple.parentNode) {
                    ripple.parentNode.removeChild(ripple);
                }
            }, 2000);
        }

        // マウスフォロワーエフェクト
        function createMouseFollower() {
            const follower = document.createElement('div');
            follower.className = 'mouse-follower';
            document.body.appendChild(follower);
            
            document.addEventListener('mousemove', (e) => {
                follower.style.left = e.clientX - 10 + 'px';
                follower.style.top = e.clientY - 10 + 'px';
            });
        }

        // エフェクト開始関数
        function startSparkleEffect() {
            setInterval(createSparkle, 1200);
        }

        // クリック時の波紋エフェクト
        function setupRippleEffect() {
            document.addEventListener('click', (e) => {
                createRipple(e.clientX, e.clientY);
            });
        }

        // 初期化
        window.onload = function() {
            // ダークモードの復元
            const savedDarkMode = localStorage.getItem('darkMode');
            const body = document.body;
            if (savedDarkMode === 'true') {
                document.documentElement.classList.add('dark');
                body.style.backgroundColor = '#1a1a1a';
                body.style.backgroundImage = 'linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%)';
            } else {
                body.style.backgroundColor = '#FFFACD';
                body.style.backgroundImage = 'linear-gradient(135deg, #FFFACD 0%, #FFF8DC 100%)';
            }

            // データの表示
            const clearedStages = loadClearedStages();
            const score = loadScore();
            const unlockedPieces = loadUnlockedPieces();

            console.log('表示更新: クリア済み=', clearedStages.length, 'スコア=', score, 'アンロック駒=', unlockedPieces);
            
            const clearedCountEl = document.getElementById('clearedCount');
            if (clearedCountEl) {
                clearedCountEl.textContent = clearedStages.length;
                console.log('clearedCount要素に設定:', clearedStages.length);
            } else {
                console.error('clearedCount要素が見つかりません');
            }
            
            const unlockedPiecesEl = document.getElementById('unlockedPieces');
            if (unlockedPiecesEl) {
                unlockedPiecesEl.textContent = unlockedPieces;
            }
            
            // ガチャ玉の色を表示
            updateGachaColor();
            
            // 4時間ごとにガチャ玉の色を更新
            setInterval(updateGachaColor, 4 * 60 * 60 * 1000); // 4時間 = 4 * 60 * 60 * 1000ms

            // スクロール駒の生成
            generateScrollingPieces();
            
            // パーティクルエフェクト開始
            startParticleEffect();
            
            // キラキラエフェクト開始
            startSparkleEffect();
            
            // マウスフォロワーエフェクト開始
            createMouseFollower();
            
            // 波紋エフェクト設定
            setupRippleEffect();
            
            // スクロールイベントリスナー
            window.addEventListener('scroll', handleScroll);
            
            // 初回スクロール検知
            handleScroll();
        }
    </script>
</body>
</html> 